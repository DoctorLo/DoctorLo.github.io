<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>ValenShi&#39;s Blog</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://valenshi.top/"/>
  <updated>2019-11-26T12:13:00.868Z</updated>
  <id>http://valenshi.top/</id>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>2019CSP-Jæ™®åŠç»„å¤èµ›é¢˜è§£</title>
    <link href="http://valenshi.top/2019/11/26/2019CSP-J/"/>
    <id>http://valenshi.top/2019/11/26/2019CSP-J/</id>
    <published>2019-11-26T12:11:19.000Z</published>
    <updated>2019-11-26T12:13:00.868Z</updated>
    
    <content type="html"><![CDATA[<h4 id="A-æ•°å­—æ¸¸æˆ"><a href="#A-æ•°å­—æ¸¸æˆ" class="headerlink" title="A.æ•°å­—æ¸¸æˆ"></a>A.æ•°å­—æ¸¸æˆ</h4><p><strong>é¢˜æ„æè¿°</strong><br>å° K åŒå­¦å‘å° P åŒå­¦å‘é€äº†ä¸€ä¸ªé•¿åº¦ä¸º 8 çš„ 01 å­—ç¬¦ä¸²æ¥ç©æ•°å­—æ¸¸æˆï¼Œå° P åŒå­¦æƒ³ è¦çŸ¥é“å­—ç¬¦ä¸²ä¸­ç©¶ç«Ÿæœ‰å¤šå°‘ä¸ª 1ã€‚<br> æ³¨æ„ï¼š01 å­—ç¬¦ä¸²ä¸ºæ¯ä¸€ä¸ªå­—ç¬¦æ˜¯ 0 æˆ–è€… 1 çš„å­—ç¬¦ä¸²ï¼Œå¦‚â€œ101â€ï¼ˆä¸å«åŒå¼•å·ï¼‰ä¸ºä¸€ ä¸ªé•¿åº¦ä¸º 3 çš„ 01 å­—ç¬¦ä¸²ã€‚</p><p><strong>è§£é¢˜æ€è·¯</strong><br>ç­¾åˆ°é¢˜ã€‚<br><strong>ä»£ç ç¤ºä¾‹</strong><br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="built_in">string</span> str;</span><br><span class="line"><span class="keyword">int</span> cnt = <span class="number">0</span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="built_in">cin</span> &gt;&gt; str;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;str[i];i++) <span class="keyword">if</span>(str[i] == <span class="string">'1'</span>) cnt++;</span><br><span class="line"><span class="built_in">cout</span> &lt;&lt; cnt &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h4 id="B-å…¬è½¦æ¢ä¹˜"><a href="#B-å…¬è½¦æ¢ä¹˜" class="headerlink" title="B.å…¬è½¦æ¢ä¹˜"></a>B.å…¬è½¦æ¢ä¹˜</h4><p><strong>é¢˜æ„æè¿°</strong><br>è‘—åæ—…æ¸¸åŸå¸‚ B å¸‚ä¸ºäº†é¼“åŠ±å¤§å®¶é‡‡ç”¨å…¬å…±äº¤é€šæ–¹å¼å‡ºè¡Œï¼Œæ¨å‡ºäº†ä¸€ç§åœ°é“æ¢ä¹˜å…¬äº¤ è½¦çš„ä¼˜æƒ æ–¹æ¡ˆï¼šåœ¨æ­ä¹˜ä¸€æ¬¡åœ°é“åå¯ä»¥è·å¾—ä¸€å¼ ä¼˜æƒ ç¥¨ï¼Œæœ‰æ•ˆæœŸä¸º 45 åˆ†é’Ÿï¼Œåœ¨æœ‰æ•ˆæœŸå†…å¯ä»¥ æ¶ˆè€—è¿™å¼ ä¼˜æƒ ç¥¨ï¼Œå…è´¹æ­ä¹˜ä¸€æ¬¡ç¥¨ä»·ä¸è¶…è¿‡åœ°é“ç¥¨ä»·çš„å…¬äº¤è½¦ã€‚åœ¨æœ‰æ•ˆæœŸå†…æŒ‡ å¼€å§‹ä¹˜å…¬äº¤è½¦çš„æ—¶é—´ä¸å¼€å§‹ä¹˜åœ°é“çš„æ—¶é—´ä¹‹å·®å°äºç­‰äº 45 åˆ†é’Ÿï¼Œå³ï¼š$t_{bus} - t_{subway} â‰¤ 45$ã€‚<br>æ­ä¹˜åœ°é“è·å¾—çš„ä¼˜æƒ ç¥¨å¯ä»¥ç´¯ç§¯ï¼Œå³å¯ä»¥è¿ç»­æ­ä¹˜è‹¥å¹²æ¬¡åœ°é“åå†è¿ç»­ä½¿ç”¨ä¼˜ æƒ ç¥¨æ­ä¹˜å…¬äº¤è½¦ã€‚æ­ä¹˜å…¬äº¤è½¦æ—¶ï¼Œå¦‚æœå¯ä»¥ä½¿ç”¨ä¼˜æƒ ç¥¨ä¸€å®šä¼šä½¿ç”¨ä¼˜æƒ ç¥¨ï¼›å¦‚æœæœ‰å¤šå¼ ä¼˜æƒ ç¥¨æ»¡ è¶³æ¡ä»¶ï¼Œåˆ™ä¼˜å…ˆæ¶ˆè€—è·å¾—æœ€æ—©çš„ä¼˜æƒ ç¥¨ã€‚<br>ç°åœ¨ä½ å¾—åˆ°äº†å°è½©æœ€è¿‘çš„å…¬å…±äº¤é€šå‡ºè¡Œè®°å½•ï¼Œä½ èƒ½å¸®ä»–ç®—ç®—ä»–çš„èŠ±è´¹å—ï¼Ÿ</p><p><strong>è§£é¢˜æ€è·¯</strong><br>ä¸€é“æ¨¡æ‹Ÿé¢˜ï¼Œæ˜¾è€Œæ˜“è§éœ€è¦æŒ‰ç…§æ—¶é—´å‡åºï¼Œå› ä¸ºå¦‚æœè¶…è¿‡45åˆ†é’Ÿå°±æ— æ•ˆäº†ã€‚åŸºäºæ­¤åº”è¯¥æƒ³åˆ°å¯ä»¥åˆ©ç”¨ä¼˜å…ˆé˜Ÿåˆ—ï¼ˆæˆ–ç±»ä¼¼ï¼‰çš„æ•°æ®ç»“æ„æ¥ç»´æŠ¤ï¼Œæ¯æ¬¡åå…¬äº¤ï¼Œåœ¨æ‰€æœ‰ä»·å€¼å¤§äºæœ¬æ¬¡ç¥¨ä»·çš„ä¼˜æƒ åˆ¸ä¸­ä¼˜å…ˆä½¿ç”¨è¿‡æœŸæ—¶é—´æœ€æ—©çš„ï¼ˆä¸ç”¨å°±è¿‡æœŸäº†ï¼ï¼‰ï¼Œä»·å€¼æœ€ä½çš„ä¼˜æƒ åˆ¸ã€‚ä¸€æ—¦ç¥¨è¿‡æœŸäº†ï¼Œå°±åˆ æ‰ï¼Œä½†æ˜¯å¦‚æœç¥¨åªæ˜¯ä»·å€¼ä¸å¤Ÿï¼Œé‚£å¯èƒ½åé¢è¿˜ä¼šæœ‰ç”¨ï¼Œæ‰€ä»¥è¿˜è¦å‹å›å»ã€‚</p><p><strong>ä»£ç ç¤ºä¾‹</strong><br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1e5</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Node</span>&#123;</span></span><br><span class="line"><span class="keyword">int</span> ty;</span><br><span class="line">ll t,price;</span><br><span class="line"><span class="keyword">bool</span> <span class="keyword">operator</span> &lt; (<span class="keyword">const</span> Node&amp; rhs) <span class="keyword">const</span>&#123;</span><br><span class="line"><span class="keyword">if</span>(t == rhs.t) <span class="keyword">return</span> price &gt; rhs.price;</span><br><span class="line"><span class="keyword">return</span> t &gt; rhs.t;</span><br><span class="line">&#125;</span><br><span class="line">&#125;rd[N];</span><br><span class="line"><span class="keyword">int</span> n;</span><br><span class="line">priority_queue&lt;Node&gt; q;</span><br><span class="line"><span class="built_in">stack</span>&lt;Node&gt; s;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span></span>&#123;</span><br><span class="line">sort(rd+<span class="number">1</span>,rd+<span class="number">1</span>+n);</span><br><span class="line">ll res = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = n;i &gt;= <span class="number">1</span>;i--)&#123;</span><br><span class="line"><span class="keyword">if</span>(!rd[i].ty)&#123;</span><br><span class="line">res += rd[i].price, q.push(rd[i]);</span><br><span class="line"><span class="keyword">continue</span>; </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">bool</span> flag = <span class="literal">true</span>;</span><br><span class="line"><span class="keyword">while</span>(q.size())&#123;</span><br><span class="line">Node x = q.top(); q.pop();</span><br><span class="line"><span class="keyword">if</span>(rd[i].t - x.t &gt; <span class="number">45</span>) <span class="keyword">continue</span>;</span><br><span class="line"><span class="keyword">if</span>(x.price &lt; rd[i].price)&#123;</span><br><span class="line">s.push(x); <span class="keyword">continue</span>;</span><br><span class="line">&#125;</span><br><span class="line">flag = <span class="literal">false</span>; <span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(flag) res += rd[i].price;</span><br><span class="line"><span class="keyword">while</span>(s.size()) q.push(s.top()), s.pop(); </span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%lld\n"</span>,res);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;n);</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++)</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d%d%d"</span>,&amp;rd[i].ty,&amp;rd[i].price,&amp;rd[i].t);</span><br><span class="line">solve();</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h4 id="C-çºªå¿µå“"><a href="#C-çºªå¿µå“" class="headerlink" title="C.çºªå¿µå“"></a>C.çºªå¿µå“</h4><p><strong>é¢˜æ„æè¿°</strong><br>å°ä¼Ÿçªç„¶è·å¾—ä¸€ç§è¶…èƒ½åŠ›ï¼Œä»–çŸ¥é“æœªæ¥ T å¤© N ç§çºªå¿µå“æ¯å¤©çš„ä»·æ ¼ã€‚æŸä¸ªçºªå¿µå“ çš„ä»·æ ¼æ˜¯æŒ‡è´­ä¹°ä¸€ä¸ªè¯¥çºªå¿µå“æ‰€éœ€çš„é‡‘å¸æ•°é‡ï¼Œä»¥åŠå–å‡ºä¸€ä¸ªè¯¥çºªå¿µå“æ¢å›çš„é‡‘å¸æ•°é‡ã€‚<br> æ¯å¤©ï¼Œå°ä¼Ÿå¯ä»¥è¿›è¡Œä»¥ä¸‹ä¸¤ç§äº¤æ˜“<strong>æ— é™æ¬¡</strong>ï¼š<br>ä»»é€‰ä¸€ä¸ªçºªå¿µå“ï¼Œè‹¥æ‰‹ä¸Šæœ‰è¶³å¤Ÿé‡‘å¸ï¼Œä»¥å½“æ—¥ä»·æ ¼è´­ä¹°è¯¥çºªå¿µå“ï¼›å–å‡ºæŒæœ‰çš„ä»»æ„ä¸€ä¸ªçºªå¿µå“ï¼Œä»¥å½“æ—¥ä»·æ ¼æ¢å›é‡‘å¸ã€‚<br> æ¯å¤©å–å‡ºçºªå¿µå“æ¢å›çš„é‡‘å¸å¯ä»¥<strong>ç«‹å³</strong>ç”¨äºè´­ä¹°çºªå¿µå“ï¼Œå½“æ—¥è´­ä¹°çš„çºªå¿µå“ä¹Ÿå¯ä»¥<strong>å½“æ—¥å–å‡º</strong>æ¢å›é‡‘å¸ã€‚å½“ç„¶ï¼Œä¸€ç›´æŒæœ‰çºªå¿µå“ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚<br>T å¤©ä¹‹åï¼Œå°ä¼Ÿçš„è¶…èƒ½åŠ›æ¶ˆå¤±ã€‚å› æ­¤ä»–ä¸€å®šä¼šåœ¨ç¬¬ T å¤©å–å‡º<strong>æ‰€æœ‰</strong>çºªå¿µå“æ¢å›é‡‘å¸ã€‚<br>å°ä¼Ÿç°åœ¨æœ‰ M æšé‡‘å¸ï¼Œä»–æƒ³è¦åœ¨è¶…èƒ½åŠ›æ¶ˆå¤±åæ‹¥æœ‰å°½å¯èƒ½å¤šçš„é‡‘å¸ã€‚ </p><p><strong>è§£é¢˜æ€è·¯</strong><br>æœ¬é¢˜æ€è·¯å¯ä»¥æ ¹æ®æ•°æ®èŒƒå›´æ¥æƒ³ã€‚è¿™æ˜¯ä¸€é“åŠ¨æ€è§„åˆ’é¢˜ã€‚<br>åˆšå¼€å§‹æƒ³åˆ°çš„æ˜¯å»ºç«‹ä¸€å¼ å…¨å›¾ï¼Œä½†æ˜¯åæ¥å‘ç°èŠ‚ç‚¹æ•°é‡ä¸æ˜¯ N è€Œæ˜¯ NT ï¼Œå¹¶ä¸”æ€»ä»·å€¼ä¹Ÿä¸ä¸€å®šåªèƒ½èµ°ä¸€æ¡è·¯ã€‚<br>åæ¥å‘ç°å¯ä»¥ç”¨åŠ¨æ€è§„åˆ’è§£å†³ï¼Œé¦–å…ˆè®¾ f[x]: ç¬¬xå¤©èƒ½å¤Ÿèµšåˆ°æœ€å¤šå¤šå°‘é’±ã€‚é‚£ä¹ˆæ˜¾ç„¶f[1] = mï¼Œå¹¶ä¸” f æ˜¯é€’å¢çš„ã€‚é‡ç‚¹åœ¨äºçŠ¶æ€è½¬ç§»ï¼Œf[ i ] è‚¯å®šæ˜¯ç”± f[ 1~i-1 ] æ¨å‡ºæ¥çš„ï¼Œå› ä¸ºå•ç‹¬ä¸€ä¸ª f[i-1] æ— æ³•è¡¨ç¤ºæ‰€æœ‰çŠ¶æ€ã€‚<br>å‡è®¾å½“å‰å¤„äºçŠ¶æ€ j ï¼ˆj &lt; iï¼‰ï¼Œé‚£ä¹ˆå°†ç¬¬ j å¤©ç‰©å“çš„ä»·æ ¼çœ‹ä½œèŠ±è´¹ï¼Œç¬¬ i å¤©çš„ç‰©å“ä»·æ ¼çœ‹ä½œä»·å€¼ï¼Œè¿™å°±æ˜¯ä¸€ä¸ªå®Œå…¨èƒŒåŒ…é—®é¢˜ï¼ŒèƒŒåŒ…å®¹é‡æ˜¯å½“å¤©çš„é‡‘å¸æ•° f[j] ã€‚<br>äºæ˜¯æˆ‘ä»¬ä¸¤å±‚å¾ªç¯O(T^2)æ¥è®¡ç®— f[i] ï¼Œè€Œæ¯æ¬¡è®¡ç®—éœ€è¦O(MN) åšå®Œå…¨èƒŒåŒ…ï¼Œä½†æ˜¯å®é™…æµ‹è¯•æ•ˆç‡è¿˜è¡Œï¼Œå¯èƒ½æ˜¯æ•°æ®å¤ªå¼±äº†ã€‚</p><p><strong>ä»£ç ç¤ºä¾‹</strong><br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1e2</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> M = <span class="number">1e4</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">int</span> t,n,m;</span><br><span class="line"><span class="keyword">int</span> val[N][N];</span><br><span class="line"><span class="keyword">int</span> f[N];<span class="comment">//ç¬¬ x å¤©æœ€å¤šæœ‰å¤šå°‘é’±</span></span><br><span class="line"><span class="keyword">int</span> tmp[M],mx;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span></span>&#123;</span><br><span class="line">f[<span class="number">1</span>] = m;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> day = <span class="number">2</span>;day &lt;= t;day++)&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt; day;i++)&#123;</span><br><span class="line"><span class="built_in">memset</span>(tmp,<span class="number">0</span>,<span class="keyword">sizeof</span> tmp); mx = m;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">1</span>;j &lt;= n;j++)&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> v = val[i][j]; v &lt;= f[i];v++)&#123;</span><br><span class="line">tmp[v] = max(tmp[v-val[i][j]]+val[day][j],tmp[v]);</span><br><span class="line">mx = max(mx,tmp[v]+f[i]-v);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">f[day] = max(f[day],mx);</span><br><span class="line">&#125;</span><br><span class="line">f[day] = max(f[day],f[day<span class="number">-1</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//for(int i = 1;i &lt;= t;i++) printf("%d\n",f[i]);</span></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%d\n"</span>,f[t]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d%d%d"</span>,&amp;t,&amp;n,&amp;m);</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= t;i++)</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">1</span>;j &lt;= n;j++) <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;val[i][j]);</span><br><span class="line">solve();</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h4 id="D-åŠ å·¥é›¶ä»¶"><a href="#D-åŠ å·¥é›¶ä»¶" class="headerlink" title="D.åŠ å·¥é›¶ä»¶"></a>D.åŠ å·¥é›¶ä»¶</h4><p><strong>é¢˜æ„æè¿°</strong></p><p>å‡¯å‡¯çš„å·¥å‚æ­£åœ¨æœ‰æ¡ä¸ç´Šåœ°ç”Ÿäº§ä¸€ç§ç¥å¥‡çš„é›¶ä»¶ï¼Œç¥å¥‡çš„é›¶ä»¶çš„ç”Ÿäº§è¿‡ç¨‹è‡ªç„¶ä¹Ÿå¾ˆ ç¥å¥‡ã€‚å·¥å‚é‡Œæœ‰ ğ‘› ä½å·¥äººï¼Œå·¥äººä»¬ä» 1âˆ¼ğ‘›ç¼–å·ã€‚æŸäº›å·¥äººä¹‹é—´å­˜åœ¨åŒå‘çš„é›¶ä»¶ä¼ é€å¸¦ã€‚ä¿è¯æ¯ä¸¤åå·¥äººä¹‹é—´æœ€å¤šåªå­˜åœ¨ä¸€æ¡ä¼ é€å¸¦ã€‚<br>å¦‚æœ ğ‘¥ å·å·¥äººæƒ³ç”Ÿäº§ä¸€ä¸ªè¢«åŠ å·¥åˆ°ç¬¬ ğ¿(ğ¿&gt;1) é˜¶æ®µçš„é›¶ä»¶ï¼Œåˆ™æ‰€æœ‰ä¸ ğ‘¥ å·å·¥äºº æœ‰ä¼ é€å¸¦ç›´æ¥ç›¸è¿çš„å·¥äººï¼Œéƒ½éœ€è¦ç”Ÿäº§ä¸€ä¸ªè¢«åŠ å·¥åˆ°ç¬¬ ğ¿ âˆ’1 é˜¶æ®µçš„é›¶ä»¶ï¼ˆä½† ğ‘¥ å·å·¥ äººè‡ªå·±æ— éœ€ç”Ÿäº§ç¬¬ ğ¿ âˆ’1 é˜¶æ®µçš„é›¶ä»¶ï¼‰ã€‚<br>å¦‚æœ ğ‘¥ å·å·¥äººæƒ³ç”Ÿäº§ä¸€ä¸ªè¢«åŠ å·¥åˆ°ç¬¬ 1 é˜¶æ®µçš„é›¶ä»¶ï¼Œåˆ™æ‰€æœ‰ä¸ ğ‘¥ å·å·¥äººæœ‰ä¼ é€ å¸¦ç›´æ¥ç›¸è¿çš„å·¥äººï¼Œéƒ½éœ€è¦ä¸º ğ‘¥ å·å·¥äººæä¾›ä¸€ä¸ªåŸææ–™ã€‚<br>è½©è½©æ˜¯ 1 å·å·¥äººã€‚ç°åœ¨ç»™å‡º ğ‘ å¼ å·¥å•ï¼Œç¬¬ ğ‘– å¼ å·¥å•è¡¨ç¤ºç¼–å·ä¸º ğ‘ğ‘–çš„å·¥äººæƒ³ç”Ÿäº§ ä¸€ä¸ªç¬¬ ğ¿ğ‘–é˜¶æ®µçš„é›¶ä»¶ã€‚è½©è½©æƒ³çŸ¥é“å¯¹äºæ¯å¼ å·¥å•ï¼Œä»–æ˜¯å¦éœ€è¦ç»™åˆ«äººæä¾›åŸææ–™ã€‚ä»–çŸ¥é“èªæ˜çš„ä½ ä¸€å®šå¯ä»¥å¸®ä»–è®¡ç®—å‡ºæ¥ï¼</p><p><strong>è§£é¢˜æ€è·¯</strong><br>ç»è¿‡æ¨å¯¼å¯ä»¥å‘ç°ï¼Œå¦‚æœ a å·èŠ‚ç‚¹åˆ° 1 å·èŠ‚ç‚¹ï¼ˆä»¥ä¸‹åªç”¨ç¼–å·ç®€å†™ï¼‰ä¹‹é—´å­˜åœ¨ä¸€æ¡å°äº L çš„è·¯å¾„ï¼Œä¸”å®ƒä»¬çš„å·®ä¸ºå¶æ•°ï¼ˆåŒ…æ‹¬0ï¼‰ï¼Œé‚£ä¹ˆ 1 å°±è¦æä¾›åŸææ–™ã€‚<br>ä½†æ˜¯é—®é¢˜åœ¨äº 1 åˆ° a ä¹‹é—´å¯èƒ½ä¸æ­¢ä¸€æ¡è·¯å¾„ï¼Œè€Œ L ä¹Ÿä¸ä¸€å®šæ˜¯å¥‡æˆ–è€…å¶ï¼Œäºæ˜¯æˆ‘ä»¬éœ€è¦ä¿å­˜ a åˆ° 1 çš„<strong>æœ€çŸ­å¥‡è·¯å¾„</strong>ä¸<strong>æœ€çŸ­å¶è·¯å¾„</strong>ã€‚<br>åœ¨å›¾è®ºä¸­ï¼Œå¦‚æœè¾¹æƒä¸º1ï¼Œé‚£ä¹ˆæ±‚å¥‡å¶æœ€çŸ­è·¯å¾„çš„å¥½æ–¹æ³•å°±æ˜¯ç”¨åˆ†å±‚å›¾æ¥åšï¼Œå…·ä½“åšæ³•æ˜¯å»ºç«‹åŒå±‚å›¾ï¼Œå¦‚æœä»èµ·ç‚¹ä¸åœ¨åŒä¸€å±‚ï¼Œåˆ™è·¯å¾„ä¸€å®šæ˜¯å¥‡ï¼Œå¦åˆ™ä¸€å®šä¸ºå¶ï¼›è¿™æ ·åšçš„å¥½å¤„æ˜¯ä¸ç”¨é¢å¤–çš„è¾…åŠ©ä»£ç ï¼Œåªè¦åœ¨å»ºå›¾æ—¶å¤šåŠ ä¸¤æ¡è¾¹å°±è¡Œäº†ã€‚</p><p><strong>ä»£ç ç¤ºä¾‹</strong><br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">2e5</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> M = <span class="number">2</span>*N;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll;</span><br><span class="line"><span class="keyword">int</span> n,m,q;</span><br><span class="line"><span class="keyword">int</span> head[N],edge[M],ver[M],nex[M] ,tot = <span class="number">1</span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">addEdge</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> y,<span class="keyword">int</span> z)</span></span>&#123;</span><br><span class="line">ver[++tot] = y; edge[tot] = z;</span><br><span class="line">nex[tot] = head[x]; head[x] = tot;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">getInt</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">int</span> res = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">bool</span> neg = <span class="literal">false</span>;</span><br><span class="line"><span class="keyword">char</span> c = getchar();</span><br><span class="line"><span class="keyword">while</span>(c != <span class="string">'-'</span> &amp;&amp; (c &lt; <span class="string">'0'</span> || c &gt; <span class="string">'9'</span>)) c = getchar();</span><br><span class="line"><span class="keyword">if</span>(c == <span class="string">'-'</span>) neg = <span class="literal">true</span>, c = getchar();</span><br><span class="line"><span class="keyword">while</span>(c &gt;= <span class="string">'0'</span> &amp;&amp; c &lt;= <span class="string">'9'</span>) res = res*<span class="number">10</span>+c-<span class="string">'0'</span>,c = getchar();</span><br><span class="line"><span class="keyword">return</span> neg?-res:res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">queue</span>&lt;<span class="keyword">int</span>&gt; que;</span><br><span class="line"><span class="keyword">int</span> dis[N],vis[N];</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">solve</span><span class="params">(<span class="keyword">int</span> a,<span class="keyword">int</span> l)</span></span>&#123;</span><br><span class="line"><span class="keyword">if</span>(dis[a] &lt;= l &amp;&amp; !((dis[a]&amp;<span class="number">1</span>) ^ (l&amp;<span class="number">1</span>))) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line"><span class="keyword">if</span>(dis[a+n] &lt;= l &amp;&amp; !((dis[a+n]&amp;<span class="number">1</span>) ^ (l&amp;<span class="number">1</span>))) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">SPFA</span><span class="params">(<span class="keyword">int</span> s)</span></span>&#123;</span><br><span class="line">que.push(s);</span><br><span class="line"><span class="built_in">memset</span>(dis,<span class="number">0x3f</span>,<span class="keyword">sizeof</span> dis);</span><br><span class="line">dis[s] = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span>(que.size())&#123;</span><br><span class="line"><span class="keyword">int</span> x = que.front(); que.pop();</span><br><span class="line">vis[x] = <span class="literal">false</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = head[x];i ;i = nex[i])&#123;</span><br><span class="line"><span class="keyword">int</span> y = ver[i], z = edge[i];</span><br><span class="line"><span class="keyword">if</span>(dis[y] &gt; dis[x]+z)&#123;</span><br><span class="line">dis[y] = dis[x]+z;</span><br><span class="line"><span class="keyword">if</span>(!vis[y]) que.push(y),vis[y] = <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">n = getInt(); m = getInt(); q = getInt();</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>,x,y;i &lt;= m;i++)&#123;</span><br><span class="line">x = getInt(); y = getInt();</span><br><span class="line">addEdge(x,y+n,<span class="number">1</span>); addEdge(y+n,x,<span class="number">1</span>);</span><br><span class="line">addEdge(x+n,y,<span class="number">1</span>); addEdge(y,x+n,<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line">SPFA(<span class="number">1</span>);</span><br><span class="line"><span class="comment">//for(int i = 1;i &lt;= n&lt;&lt;1;i++) cout &lt;&lt; dis[i] &lt;&lt; endl;</span></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>,a,l;i &lt;= q;i++)&#123;</span><br><span class="line">a = getInt(); l = getInt();</span><br><span class="line"><span class="keyword">if</span>(solve(a,l)) <span class="built_in">puts</span>(<span class="string">"Yes"</span>);</span><br><span class="line"><span class="keyword">else</span> <span class="built_in">puts</span>(<span class="string">"No"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h4 id=&quot;A-æ•°å­—æ¸¸æˆ&quot;&gt;&lt;a href=&quot;#A-æ•°å­—æ¸¸æˆ&quot; class=&quot;headerlink&quot; title=&quot;A.æ•°å­—æ¸¸æˆ&quot;&gt;&lt;/a&gt;A.æ•°å­—æ¸¸æˆ&lt;/h4&gt;&lt;p&gt;&lt;strong&gt;é¢˜æ„æè¿°&lt;/strong&gt;&lt;br&gt;å° K åŒå­¦å‘å° P åŒå­¦å‘é€äº†ä¸€ä¸ªé•¿åº¦ä¸º 8 çš„ 01 
      
    
    </summary>
    
      <category term="ACMé¢˜è§£" scheme="http://valenshi.top/categories/ACM%E9%A2%98%E8%A7%A3/"/>
    
    
      <category term="åŠ¨æ€è§„åˆ’" scheme="http://valenshi.top/tags/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/"/>
    
      <category term="å›¾è®º" scheme="http://valenshi.top/tags/%E5%9B%BE%E8%AE%BA/"/>
    
      <category term="åˆ†å±‚å›¾" scheme="http://valenshi.top/tags/%E5%88%86%E5%B1%82%E5%9B%BE/"/>
    
  </entry>
  
  <entry>
    <title>CodeForce#600ï¼ˆDiv2ï¼‰è§£é¢˜æŠ¥å‘Š</title>
    <link href="http://valenshi.top/2019/11/24/cf600/"/>
    <id>http://valenshi.top/2019/11/24/cf600/</id>
    <published>2019-11-24T04:30:03.000Z</published>
    <updated>2019-11-24T04:36:10.475Z</updated>
    
    <content type="html"><![CDATA[<h4 id="A-Single-Push"><a href="#A-Single-Push" class="headerlink" title="A. Single Push"></a>A. Single Push</h4><p><strong>é¢˜æ„ç®€è¿°ï¼š</strong><br>ç»™å®šä¸¤ä¸ªåºåˆ— a å’Œ bï¼Œè¦æ±‚ä»åºåˆ— a ä¸­é€‰å‡ºè¿ç»­çš„ä¸€æ®µ[l , r] ï¼Œå¯¹è¿™æ®µä¸Šçš„æ¯ä¸ªä½ç½®+kï¼ˆk &gt;= 0ï¼‰ï¼Œè¯•é—®åªæ“ä½œä¸€æ¬¡èƒ½å¦ä½¿å¾—åºåˆ— a å˜ä¸ºåºåˆ— b ã€‚<br><strong>è§£é¢˜æ€è·¯ï¼š</strong><br>ç”±äºåªèƒ½æ“ä½œä¸€æ¬¡ï¼Œæ‰€ä»¥éš¾åº¦å¤§å¤§ä¸‹é™ï¼Œå› æ­¤åªéœ€è¦é¡ºåºåˆ¤æ–­ a æ˜¯å¦åªæœ‰ä¸€ä¸ªåŒºé—´å’Œ b ä¸åŒï¼Œä¸”å·®å€¼å…¨éƒ¨ç›¸åŒä¸”ä¸ºè´Ÿã€‚<br><strong>ä»£ç ç¤ºä¾‹ï¼š</strong></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">int</span> t,n;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1e5</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">int</span> a[N],b[N];</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">getInt</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">int</span> res = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">bool</span> neg = <span class="literal">false</span>;</span><br><span class="line"><span class="keyword">char</span> c = getchar();</span><br><span class="line"><span class="keyword">while</span>(c != <span class="string">'-'</span> &amp;&amp; (c &lt; <span class="string">'0'</span> || c &gt; <span class="string">'9'</span>)) c = getchar();</span><br><span class="line"><span class="keyword">if</span>(c == <span class="string">'-'</span>) neg = <span class="literal">true</span>, c = getchar();</span><br><span class="line"><span class="keyword">while</span>(c &gt;= <span class="string">'0'</span> &amp;&amp; c &lt;= <span class="string">'9'</span>) res = res*<span class="number">10</span> + c-<span class="string">'0'</span>,c = getchar();</span><br><span class="line"><span class="keyword">return</span> neg?-res:res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">solve</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++) a[i] = a[i]-b[i];</span><br><span class="line"><span class="keyword">int</span> cnt = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++)&#123;</span><br><span class="line"><span class="keyword">if</span>(a[i] &gt; <span class="number">0</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"><span class="keyword">if</span>(a[i] &amp;&amp; a[i] != a[i<span class="number">-1</span>]) cnt++;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> cnt &lt;= <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">t = getInt();</span><br><span class="line"><span class="keyword">while</span>(t--)&#123;</span><br><span class="line">n = getInt();</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++) a[i] = getInt();</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++) b[i] = getInt();</span><br><span class="line"><span class="keyword">if</span>(solve()) <span class="built_in">puts</span>(<span class="string">"YES"</span>);</span><br><span class="line"><span class="keyword">else</span> <span class="built_in">puts</span>(<span class="string">"NO"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="B-Silly-Mistake"><a href="#B-Silly-Mistake" class="headerlink" title="B. Silly Mistake"></a>B. Silly Mistake</h4><p><strong>é¢˜æ„ç®€è¿°ï¼š</strong><br>å®šä¹‰ä¸€ä¸ªè¿ç»­çš„åºåˆ—æ˜¯åˆæ³•çš„ï¼Œå½“ä¸”ä»…å½“ï¼š</p><ul><li>æœ‰ä¸€ä¸ªæ­£æ•°ï¼Œå°±æœ‰ä¸€ä¸ªè´Ÿæ•°ï¼Œä¾‹å¦‚æœ‰ 5 ï¼Œå°±è¦æœ‰ -5ï¼›</li><li>è´Ÿæ•°ä¹‹å‰å¿…é¡»æœ‰å®ƒçš„æ­£æ•°ï¼Œå³ 5 åªèƒ½åœ¨ -5 å‰é¢ï¼›</li><li>æ¯ä¸ªæ•°å¯¹ä»…å‡ºç°ä¸€æ¬¡ï¼Œå³ 5 ï¼Œ-5ï¼Œ5ï¼Œ-5æ˜¯ä¸åˆæ ¼æ³•çš„ã€‚</li></ul><p>ç»™å®šä¸€ä¸ªåºåˆ— aï¼Œå…¶ä¸­ai &lt;= 1e6ï¼Œè¯·é—®å¯ä»¥å°†åºåˆ—aåˆ†ä¸ºå¤šå°‘ä¸ªåˆæ³•çš„å­åºåˆ—ï¼Œå¹¶è¾“å‡ºæ¯ä¸ªå­åºåˆ—çš„é•¿åº¦ï¼Œè‹¥ä¸å­˜åœ¨åˆ’åˆ†æ–¹æ³•ï¼Œåˆ™è¾“å‡º-1ï¼Œå¦åˆ™è¾“å‡ºä»»æ„æ»¡è¶³æ¡ä»¶çš„ç­”æ¡ˆã€‚</p><p><strong>è§£é¢˜æ€è·¯ï¼š</strong><br>éœ€è¦åœ¨O(N)æ—¶é—´å†…è§£å†³ï¼Œå°±æ˜¯æ¨¡æ‹Ÿé¢˜ï¼Œåªéœ€è¦æ¯æ¬¡éå†åˆ°ä¸€ä¸ªæ•°å°±åˆ¤æ–­å½“ä¸”åºåˆ—æ˜¯å¦åˆæ³•å°±è¡Œäº†ï¼Œè‹¥åˆæ³•å°±åˆ’åˆ†ï¼Œå¦åˆ™æˆ–é€€å‡ºè¾“å‡º-1ï¼Œæˆ–ç»§ç»­åŠ å…¥å…ƒç´ ã€‚<br>éœ€è¦æ³¨æ„è‹¥ç”¨å‰ç¼€å’Œä½œä¸ºåˆ¤æ–­æ¡ä»¶å¯èƒ½ä¼šè¶… intï¼Œéœ€è¦ç”¨longlongï¼Œå¦å¤–å¯¹äºæ¯ä¸ªæ¡ä»¶åˆ†æ”¯ä¸€å®šè¦ä»”ç»†åˆ’åˆ†ï¼Œé¿å…é—æ¼å‡ºé”™ã€‚</p><p><strong>ä»£ç ç¤ºä¾‹ï¼š</strong><br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1e6</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">int</span> n;</span><br><span class="line"><span class="keyword">int</span> a[N];</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">getInt</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">int</span> res = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">bool</span> neg = <span class="literal">false</span>;</span><br><span class="line"><span class="keyword">char</span> c = getchar();</span><br><span class="line"><span class="keyword">while</span>(c != <span class="string">'-'</span> &amp;&amp;(c &lt; <span class="string">'0'</span> || c &gt; <span class="string">'9'</span>)) c = getchar();</span><br><span class="line"><span class="keyword">if</span>(c == <span class="string">'-'</span>) neg = <span class="literal">true</span>, c = getchar();</span><br><span class="line"><span class="keyword">while</span>(c &gt;= <span class="string">'0'</span> &amp;&amp; c &lt;= <span class="string">'9'</span>) res = res*<span class="number">10</span>+ c-<span class="string">'0'</span>, c = getchar();</span><br><span class="line"><span class="keyword">return</span> neg?-res:res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> vis[N],d[N],tot = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">int</span> num[N];</span><br><span class="line">__int64 sum[N];</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">solve</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">if</span>(n&amp;<span class="number">1</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++) sum[i] = sum[i<span class="number">-1</span>] + a[i];</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>,pre = <span class="number">0</span>;i &lt;= n;i++)&#123;</span><br><span class="line"><span class="keyword">if</span>(a[i] &gt; <span class="number">0</span>)&#123;</span><br><span class="line"><span class="keyword">if</span>(num[a[i]] != <span class="number">0</span> || vis[a[i]] &gt; pre) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">num[a[i]]++; vis[a[i]] = i;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"><span class="keyword">if</span>(num[-a[i]] != <span class="number">1</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">num[-a[i]]--;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(sum[i] == <span class="number">0</span>) d[++tot] = i-pre,pre = i;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span>(sum[i] &lt; <span class="number">0</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(!tot || sum[n]) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%d\n"</span>,tot);</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt; tot;i++) <span class="built_in">printf</span>(<span class="string">"%d "</span>,d[i]);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%d\n"</span>,d[tot]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="comment">// freopen("in","r",stdin);</span></span><br><span class="line"><span class="comment">// freopen("out","w",stdout);</span></span><br><span class="line">n = getInt();</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++) a[i] = getInt();</span><br><span class="line"><span class="keyword">if</span>(!solve()) <span class="built_in">puts</span>(<span class="string">"-1"</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h4 id="C-Sweets-Eating"><a href="#C-Sweets-Eating" class="headerlink" title="C. Sweets Eating"></a>C. Sweets Eating</h4><p><strong>é¢˜æ„ç®€è¿°ï¼š</strong><br>ç»™å®šä¸€ä¸ªåºåˆ— aï¼Œç»™å®š m ï¼Œå¯¹äº kï¼ˆkä»1åˆ°nï¼‰ ï¼Œè¦æ±‚ä»åºåˆ— a ä¸­æŒ‘å‡ºkä¸ªå…ƒç´ ï¼Œåˆ†ä¸ºè‹¥å¹²ç»„ï¼Œæ¯ç»„æœ€å¤šæœ‰mä¸ªå…ƒç´ ï¼Œä½¿å¾—ç¬¬ä¸€ç»„ <em> 1ï¼Œç¬¬äºŒç»„ </em> 2ï¼Œä¾æ¬¡ç±»æ¨ï¼Œä½¿å¾—å®ƒä»¬çš„æ€»å’Œæœ€å°ã€‚</p><p><strong>è§£é¢˜æ€è·¯ï¼š</strong><br>é¦–å…ˆå¯¹åºåˆ— a æ’åºï¼Œæ˜“å¾—è¦æƒ³æ€»å’Œæœ€å°ï¼Œåº”è¯¥é€‰å‡ºæœ€å°çš„ k ä¸ªå…ƒç´ ã€‚<br>å‡è®¾è¦æ±‚çš„æ˜¯ f(k) ï¼Œé‚£ä¹ˆéœ€è¦è§£å†³çš„æ˜¯å¦‚ä½•æ‰èƒ½å¿«é€Ÿçš„ä» f(k) è½¬ç§»åˆ° f(k+1)ï¼Œå¦‚æœæš´åŠ›è½¬ç§»ï¼Œæ˜¯ O(k) å¤æ‚åº¦ï¼Œå› ä¸ºè¦åŠ ä¸Šæ¯ä¸€ç»„æœ€å°çš„å…ƒç´ æ”¾åˆ°é«˜ä¸€ç»„å»ã€‚æˆ‘ä»¬å¯ä»¥åˆ©ç”¨å‰ç¼€å’Œæ¥ä¼˜åŒ–ï¼Œå…·ä½“åšæ³•æ˜¯å¼€ä¸€ä¸ªsumæ•°ç»„ï¼Œsum[i] è®°å½• %m ä¸º i çš„å…ƒç´ å’Œï¼Œæˆ‘ä»¬ä»å°åˆ°å¤§ä¾æ¬¡å°† a åºåˆ—ä¸­çš„å…ƒç´ åŠ å…¥ï¼Œå°±å¯ä»¥åœ¨O(1)è½¬ç§»ã€‚</p><p><strong>ä»£ç ç¤ºä¾‹ï¼š</strong></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">2e5</span>+<span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n,m;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">getInt</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">int</span> res = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">bool</span> neg = <span class="literal">false</span>;</span><br><span class="line"><span class="keyword">char</span> c = getchar();</span><br><span class="line"><span class="keyword">while</span>(c != <span class="string">'-'</span> &amp;&amp; (c &lt; <span class="string">'0'</span> || c &gt; <span class="string">'9'</span>)) c = getchar();</span><br><span class="line"><span class="keyword">if</span>(c == <span class="string">'-'</span>) neg = <span class="literal">true</span>, c = getchar();</span><br><span class="line"><span class="keyword">while</span>(c &gt;= <span class="string">'0'</span> &amp;&amp; c &lt;= <span class="string">'9'</span>) res = res*<span class="number">10</span> + c-<span class="string">'0'</span>,c = getchar();</span><br><span class="line"><span class="keyword">return</span> neg?-res:res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> a[N];</span><br><span class="line"><span class="keyword">typedef</span> __int64 ll;</span><br><span class="line">ll sum[N],ans[N];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span></span>&#123;</span><br><span class="line">sort(a+<span class="number">1</span>,a+<span class="number">1</span>+n);</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> k = <span class="number">1</span>;k &lt;= n;k++)&#123;</span><br><span class="line">ans[k] = ans[k<span class="number">-1</span>] + sum[k%m] + a[k];</span><br><span class="line">sum[k%m] += a[k];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++) <span class="built_in">printf</span>(<span class="string">"%I64d "</span>,ans[i]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="comment">// freopen("in","r",stdin);</span></span><br><span class="line"><span class="comment">// freopen("out","w",stdout);</span></span><br><span class="line">n = getInt(); m = getInt();</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++) a[i] = getInt();</span><br><span class="line">solve();</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="D-Harmonious-Graph"><a href="#D-Harmonious-Graph" class="headerlink" title="D. Harmonious Graph"></a>D. Harmonious Graph</h4><p><strong>é¢˜æ„ç®€è¿°</strong><br>ä¸€ä¸ªæœ‰ N ä¸ªç‚¹çš„æ— å‘å›¾ï¼ŒèŠ‚ç‚¹åˆ†åˆ«æ ‡å·ä¸º1~Nã€‚è¦æ±‚å¦‚æœå›¾ä¸­å­˜åœ¨ l â€”&gt; r çš„è·¯å¾„ï¼Œé‚£ä¹ˆå¯¹äºæ‰€æœ‰çš„ m (l &lt; m &lt; r)éƒ½æ»¡è¶³ l â€”&gt; m ã€‚ç»™å®šä¸€å¼ æ— å‘å›¾ï¼Œè¯•é—®æœ€å°‘æ·»åŠ å¤šå°‘æ¡è¾¹æ‰èƒ½ä½¿å¾—å…¶æ»¡è¶³è¦æ±‚ã€‚</p><p><strong>è§£é¢˜æ€è·¯</strong><br>æ€è·¯ä¸éš¾æƒ³ï¼Œå› ä¸ºåªè¦æ±‚è‹¥(l , r)æ˜¯è¿é€šçš„ï¼Œé‚£ä¹ˆå¯¹äº l åˆ° r å†…çš„æ‰€æœ‰ç‚¹éƒ½åº”ï¼ˆè‡³å¤šï¼‰å»¶ä¼¸å‡ºä¸€æ¡çº¿æ„æˆä¸€ä¸ªè¿é€šåˆ†é‡ï¼Œæ˜“å¾—ä¸€å¼ å›¾æœ€å¤šéœ€è¦ N-2 æ¡è¾¹ï¼›å¾ˆå®¹æ˜“æƒ³åˆ°ç”¨å¹¶æŸ¥é›†æ¥åšï¼Œå°†ç›¸è¿é€šçš„ç‚¹æ”¾åœ¨åŒä¸€ä¸ªé›†åˆï¼Œåˆ†é…ä¸€ä¸ªç¼–å·ã€‚ç„¶åè®°å½•æ¯ä¸ªé›†åˆï¼ˆè¿é€šåˆ†é‡ï¼‰æœ€åä¸€ä¸ªç‚¹çš„ä½ç½® ed ï¼Œç„¶ååªéœ€è¦ä»å‰å¾€åä¾æ¬¡éå†ï¼Œè‹¥å½“å‰èŠ‚ç‚¹åœ¨å¦ä¸€ä¸ªé›†åˆçš„èŒƒå›´å†…ï¼Œåˆ™åˆå¹¶ä¸¤ä¸ªé›†åˆå¹¶å°† ans++ï¼›è‹¥å½“å‰é›†åˆå¯ä»¥æ›´æ–°æœ‰è¾¹ç•Œï¼Œåˆ™æ›´æ–°ã€‚<br>æ€è·¯æ˜¯æ­£ç¡®çš„ï¼Œä½†æ˜¯è¢«å¡äº†å¥½å¤šæ¬¡ï¼Œé”™äº†å¾ˆå¤šç»†èŠ‚ï¼Œé¦–å…ˆå°±æ˜¯æ±‚é›†åˆâ€˜ç¼–å·â€™éœ€è¦è°ƒç”¨Find()å‡½æ•°ï¼Œè€Œä¸æ˜¯ç›´æ¥è®¿é—®par[]æ•°ç»„ï¼Œpar[]æ•°ç»„åªæ˜¯ä¸€ä¸ªè¾…åŠ©æ•°ç»„è€Œå·²ï¼›ç„¶åè¿˜æœ‰å°±æ˜¯é€šè¿‡Merge()å‡½æ•°åï¼Œé›†åˆçš„ç¼–å·å¯èƒ½ä¼šæ”¹å˜ï¼Œå› æ­¤æŒ‰ç…§é›†åˆçš„ç¼–å·æ¥å­˜æœ‰è¾¹ç•Œæ˜¯ä¸åˆç†çš„ï¼Œåº”è¯¥å†è½¬åŒ–ä¸ºæŒ‰ç…§ä½ç½®æ¥å­˜ã€‚</p><p><strong>ä»£ç ç¤ºä¾‹</strong><br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">2e5</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> M = <span class="number">2e5</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">int</span> par[N];</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">Find</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line"><span class="keyword">if</span>(par[x] == x) <span class="keyword">return</span> x;</span><br><span class="line"><span class="keyword">return</span> par[x] = Find(par[x]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">Merge</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> y)</span></span>&#123;</span><br><span class="line"><span class="keyword">int</span> a = Find(x), b = Find(y);</span><br><span class="line"><span class="keyword">if</span>(a == b) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"><span class="keyword">if</span>(a &lt; b) swap(a,b);</span><br><span class="line">par[a] = b;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">getInt</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">int</span> res = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">bool</span> neg = <span class="literal">false</span>;</span><br><span class="line"><span class="keyword">char</span> c = getchar();</span><br><span class="line"><span class="keyword">while</span>(c != <span class="string">'-'</span> &amp;&amp; (c &lt; <span class="string">'0'</span> || c &gt; <span class="string">'9'</span>)) c = getchar();</span><br><span class="line"><span class="keyword">if</span>(c == <span class="string">'-'</span>) neg = <span class="literal">true</span>, c = getchar();</span><br><span class="line"><span class="keyword">while</span>(c &gt;= <span class="string">'0'</span> &amp;&amp; c &lt;= <span class="string">'9'</span>) res = res*<span class="number">10</span>+c-<span class="string">'0'</span>, c = getchar();</span><br><span class="line"><span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> n,m;</span><br><span class="line"><span class="keyword">int</span> vis[N],ed[N],ls[N];</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">n = getInt(); m = getInt();</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++) par[i] = i;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>,x,y;i &lt;= m;i++)&#123;</span><br><span class="line">x = getInt(); y = getInt();</span><br><span class="line">Merge(x,y);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = n;i &gt; <span class="number">0</span>;i--)</span><br><span class="line"><span class="keyword">if</span>(!ed[Find(i)]) ed[Find(i)] = i;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++) ls[i] = ed[Find(i)];</span><br><span class="line"><span class="keyword">int</span> x = <span class="number">1</span>,last = ls[x] ,ans = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">2</span>;i &lt;= n;i++)&#123;</span><br><span class="line"><span class="keyword">if</span>(i &lt; last &amp;&amp; Merge(x,i)) ans++;</span><br><span class="line"><span class="keyword">if</span>(ls[i] &gt; last)&#123;</span><br><span class="line">last = ls[i]; x = i;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%d\n"</span>,ans);</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h4 id=&quot;A-Single-Push&quot;&gt;&lt;a href=&quot;#A-Single-Push&quot; class=&quot;headerlink&quot; title=&quot;A. Single Push&quot;&gt;&lt;/a&gt;A. Single Push&lt;/h4&gt;&lt;p&gt;&lt;strong&gt;é¢˜æ„ç®€è¿°ï¼š&lt;/strong&gt;&lt;b
      
    
    </summary>
    
      <category term="ACMé¢˜è§£" scheme="http://valenshi.top/categories/ACM%E9%A2%98%E8%A7%A3/"/>
    
    
      <category term="å¹¶æŸ¥é›†" scheme="http://valenshi.top/tags/%E5%B9%B6%E6%9F%A5%E9%9B%86/"/>
    
      <category term="å‰ç¼€å’Œ" scheme="http://valenshi.top/tags/%E5%89%8D%E7%BC%80%E5%92%8C/"/>
    
  </entry>
  
  <entry>
    <title>STLä¹‹mapå®¹å™¨é€Ÿç‡æµ‹è¯•</title>
    <link href="http://valenshi.top/2019/11/16/mapDemo/"/>
    <id>http://valenshi.top/2019/11/16/mapDemo/</id>
    <published>2019-11-16T03:46:09.000Z</published>
    <updated>2019-11-16T03:46:50.788Z</updated>
    
    <content type="html"><![CDATA[<h4 id="æ‘˜è¦"><a href="#æ‘˜è¦" class="headerlink" title="æ‘˜è¦"></a>æ‘˜è¦</h4><p>ä¸æ­¢ä¸€æ¬¡åœ¨ä½¿ç”¨ map æ—¶è¢«å¡æ—¶é™ï¼Œmap æ˜¯ c++ çš„ STL ä¸­ä¸€ä¸ªå¸¸ç”¨ä¸”æ–¹ä¾¿çš„å®¹å™¨ï¼Œå…¶æ˜¯åŸºäºæ ‘æ¥å®ç°çš„ï¼Œå®ƒçš„æ’å…¥ä¸æŸ¥æ‰¾æ•ˆç‡å®é™…ä¸Šæ›´æ¥è¿‘O(log N )ï¼ˆNä¸ºæ’å…¥çš„å…ƒç´ ä¸ªæ•°ï¼‰ã€‚å½“ç„¶åœ¨ c++ çš„ STL ä¸­è¿˜æœ‰ç”¨å“ˆå¸Œå®ç°çš„æ— åºå…³è”å®¹å™¨ï¼Œè¿™é‡Œä¸åšè®¨è®ºã€‚<br>åœ¨å®é™…åº”ç”¨ä¸­ï¼Œå¸¸å¸¸ä¼šæœ‰äººæŠŠ map æ—¶é—´å¤æ‚åº¦çœ‹ä½œO(1)ï¼Œç¡®å®åœ¨å¤§å¤šæ•°æ—¶å€™ map è¡¨ç°æ˜¯ä»¤äººæ»¡æ„çš„ï¼Œä½†åœ¨å¤§é‡ä½¿ç”¨çš„æ—¶å€™ï¼Œmapå´ä¸å°½äººæ„ã€‚</p><p>æˆ‘ä»¬å°†æµ‹è¯•å¦‚ä¸‹å‡ ç§æƒ…å½¢ä¸‹ä½¿ç”¨ map å®¹å™¨çš„æ•ˆç‡ï¼ˆæ—¶é—´ï¼‰ï¼š</p><ul><li>ä»…æ’å…¥å…ƒç´ ï¼ˆå…ƒç´ ç±»å‹ä¸ºintï¼‰</li><li>æ’å…¥ä»¥åŠæŸ¥æ‰¾ï¼ˆå…ƒç´ ç±»å‹ä¸ºintï¼‰<h4 id="æµ‹è¯•ç¯å¢ƒå‡†å¤‡"><a href="#æµ‹è¯•ç¯å¢ƒå‡†å¤‡" class="headerlink" title="æµ‹è¯•ç¯å¢ƒå‡†å¤‡"></a>æµ‹è¯•ç¯å¢ƒå‡†å¤‡</h4></li></ul><p>ä¸ºäº†ç»™å®šä¸€ä¸ªå¯¹ç…§çš„æ ‡å‡†ï¼Œå…ˆç»™å‡ºå¦‚ä¸‹æ•°æ®ï¼š</p><ul><li>æµ‹è¯•æœºç©ºå¾ªç¯ 1e6 æ¬¡å¹³å‡èŠ±è´¹ 0.0641 s</li><li>æµ‹è¯•æœºè¯»å– 1e6 ä¸ªintå‹æ•°æ®ï¼ˆå¿«è¯»+ä»æ–‡ä»¶è¾“å…¥ï¼‰å¹³å‡èŠ±è´¹ 0.2142 s</li></ul><h4 id="æµ‹è¯•ç»“æœ"><a href="#æµ‹è¯•ç»“æœ" class="headerlink" title="æµ‹è¯•ç»“æœ"></a>æµ‹è¯•ç»“æœ</h4><h5 id="ä»…æ’å…¥å…ƒç´ "><a href="#ä»…æ’å…¥å…ƒç´ " class="headerlink" title="ä»…æ’å…¥å…ƒç´ "></a>ä»…æ’å…¥å…ƒç´ </h5><p><strong>æœ¬æœºå¹³å‡èŠ±è´¹æ—¶é—´ï¼š</strong> 1.1015 s<br><strong>æµ‹è¯•ä»£ç </strong><br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> P = <span class="number">1e9</span>+<span class="number">7</span>;</span><br><span class="line"><span class="built_in">map</span>&lt;<span class="keyword">int</span>,<span class="keyword">int</span>&gt; mp;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">int</span> n = <span class="number">1e6</span>;</span><br><span class="line"><span class="keyword">long</span> <span class="keyword">long</span> gap = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++)&#123;</span><br><span class="line">mp[i*gap%P] = <span class="number">1</span>; gap += <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h5 id="æ’å…¥ä»¥åŠæŸ¥æ‰¾å…ƒç´ "><a href="#æ’å…¥ä»¥åŠæŸ¥æ‰¾å…ƒç´ " class="headerlink" title="æ’å…¥ä»¥åŠæŸ¥æ‰¾å…ƒç´ "></a>æ’å…¥ä»¥åŠæŸ¥æ‰¾å…ƒç´ </h5><p><strong>æœ¬æœºå¹³å‡èŠ±è´¹æ—¶é—´ï¼š</strong> 1.238 s<br><strong>æµ‹è¯•ä»£ç </strong><br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> P = <span class="number">1e9</span>+<span class="number">7</span>;</span><br><span class="line"><span class="built_in">map</span>&lt;<span class="keyword">int</span>,<span class="keyword">int</span>&gt; mp;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">int</span> n = <span class="number">1e6</span>;</span><br><span class="line"><span class="keyword">long</span> <span class="keyword">long</span> gap = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++)&#123;</span><br><span class="line">mp[i*gap%P] = <span class="number">1</span>; gap += <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++)</span><br><span class="line"><span class="keyword">if</span>(mp.count(i));</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h4 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h4><p>æ€»ä½“ä¸Šæµ‹è¯•ç»“æœæ˜¯ç¬¦åˆé¢„æœŸçš„ï¼Œè™½ç„¶ STL å®¹å™¨å·²ç»å¾ˆä¼˜åŒ–çš„ï¼Œä½†æ˜¯æ¯•ç«Ÿè¿˜æ˜¯ç”¨æ ‘æ¥å®ç°çš„ï¼Œè¾¾ä¸åˆ° O(1) çš„æ—¶é—´å¤æ‚åº¦ï¼Œæ‰€ä»¥å¦‚æœæ˜¯å¯¹æ—¶é™è¦æ±‚å¾ˆé«˜çš„è¯ï¼Œæœ€å¥½è¿˜æ˜¯é‡‡ç”¨æ‰‹åŠ¨å†™å“ˆå¸Œè¡¨ã€‚<br>ä¸Šè¿°è®¾è®¡çš„å®éªŒæœ‰å¾ˆå¤šç¼ºé™·ï¼Œå¦‚æœªå¯¹ long longè½¬åŒ–ã€å–æ¨¡ ä»¥åŠå…¶å®ƒå¤šä½™çš„æ“ä½œè¿›è¡Œæ’é™¤å½±å“ï¼Œå¦å¤–æœ¬æ¥è¿˜æµ‹è¯•äº†charã€stringã€setç­‰ç±»å‹çš„å…ƒç´ ï¼Œä½†æ˜¯è¦è®¾è®¡ä¸€ä¸ªå¥½çš„æµ‹è¯•ä»£ç å¤ªéº»çƒ¦äº†ï¼Œå°±åˆ äº†ï¼Œæ€»çš„ç»“è®ºæ¥è¯´å°±æ˜¯ int æ˜¯æ‰€æœ‰æµ‹è¯•çš„æ•°æ®ç±»å‹ä¸­æœ€æ…¢çš„ä¸€ç§ï¼ˆç”šè‡³æ…¢äº set å’Œ string ï¼Œå¦‚æœåªè€ƒè™‘æ’å…¥å’ŒæŸ¥æ‰¾ï¼‰ã€‚<br>æœ€ç»ˆç»“è®ºå°±æ˜¯å¦‚æœéœ€è¦ä¸€ä¸ª O(1) æ—¶é—´å¤æ‚åº¦çš„æ’å…¥å’ŒæŸ¥æ‰¾ï¼ˆint ç±»å‹çš„å…ƒç´ ï¼‰ï¼Œé‚£ä¹ˆå°±ç”¨å“ˆå¸Œè¡¨ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h4 id=&quot;æ‘˜è¦&quot;&gt;&lt;a href=&quot;#æ‘˜è¦&quot; class=&quot;headerlink&quot; title=&quot;æ‘˜è¦&quot;&gt;&lt;/a&gt;æ‘˜è¦&lt;/h4&gt;&lt;p&gt;ä¸æ­¢ä¸€æ¬¡åœ¨ä½¿ç”¨ map æ—¶è¢«å¡æ—¶é™ï¼Œmap æ˜¯ c++ çš„ STL ä¸­ä¸€ä¸ªå¸¸ç”¨ä¸”æ–¹ä¾¿çš„å®¹å™¨ï¼Œå…¶æ˜¯åŸºäºæ ‘æ¥å®ç°çš„ï¼Œå®ƒçš„æ’å…¥ä¸æŸ¥æ‰¾æ•ˆç‡å®é™…ä¸Šæ›´æ¥
      
    
    </summary>
    
    
      <category term="map" scheme="http://valenshi.top/tags/map/"/>
    
  </entry>
  
  <entry>
    <title>æœ€å¤§æµç¬”è®°</title>
    <link href="http://valenshi.top/2019/11/15/maxFlow/"/>
    <id>http://valenshi.top/2019/11/15/maxFlow/</id>
    <published>2019-11-15T05:19:48.000Z</published>
    <updated>2019-11-15T05:21:49.131Z</updated>
    
    <content type="html"><![CDATA[<h4 id="æ‘˜è¦"><a href="#æ‘˜è¦" class="headerlink" title="æ‘˜è¦"></a>æ‘˜è¦</h4><p>æ­£å¦‚å¯ä»¥é€šè¿‡å°†é“è·¯äº¤é€šå›¾æ¨¡å‹åŒ–ä¸ºæœ‰å‘å›¾æ¥æ‰¾åˆ°ä»ä¸€ä¸ªåŸå¸‚åˆ°å¦ä¸€ä¸ªåŸå¸‚ä¹‹é—´çš„æœ€çŸ­è·¯ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å°†ä¸€ä¸ªæœ‰å‘å›¾çœ‹ä½œä¸€ä¸ªâ€œæµç½‘ç»œâ€ï¼Œå¹¶ä½¿ç”¨å®ƒæ¥å›ç­”å…³äºç‰©æ–™æµåŠ¨æ–¹é¢çš„é—®é¢˜ã€‚è¿™ç§æµç½‘ç»œå¯ä»¥ç”¨æ¥å»ºæ¨¡å¾ˆå¤šå®é™…é—®é¢˜ï¼ŒåŒ…æ‹¬æ¶²ä½“åœ¨ç®¡é“ä¸­çš„æµåŠ¨ã€è£…é…çº¿ä¸Šçš„éƒ¨ä»¶çš„æµåŠ¨ã€ç”µç½‘ä¸­ç”µæµçš„æµåŠ¨å’Œé€šä¿¡ç½‘ç»œä¸­ä¿¡æ¯çš„æµåŠ¨ã€‚<br>æœ¬æ–‡é¦–å…ˆä»‹ç»ç½‘ç»œæµä¸­çš„ç›¸å…³æ¦‚å¿µï¼Œç„¶åç»™å‡ºæœ€å¤§æµé—®é¢˜çš„ä¸€èˆ¬è§£æ³•æ€è·¯ï¼Œä»¥åŠä¼˜åŒ–åçš„ç®—æ³•ã€‚æˆ‘ä»¬åº”è¯¥å°†ä¸»è¦ç²¾åŠ›æ”¾åœ¨æ€ç»´é”»ç‚¼å’Œé¢˜ç›®åˆ†æä¸Šï¼Œè€Œä¸è¦è¿‡äºæ‰§ç€äºé‚£äº›ç»å…¸ç®—æ³•çš„ç»†èŠ‚ä¼˜åŒ–ã€‚æœ¬æ–‡ä¸­æ•´ç†çš„ç®—æ³•åœ¨ç®—æ³•ç«èµ›ä¸­å·²ç»å¤Ÿç”¨ã€‚</p><h4 id="æ¦‚å¿µä»‹ç»"><a href="#æ¦‚å¿µä»‹ç»" class="headerlink" title="æ¦‚å¿µä»‹ç»"></a>æ¦‚å¿µä»‹ç»</h4><p><strong>æµç½‘ç»œï¼š</strong> æµç½‘ç»œ G = (V , E) æ˜¯ä¸€ä¸ªæœ‰å‘å›¾ï¼Œå›¾ä¸­æ¯æ¡è¾¹ (u , v) éƒ½æœ‰ä¸€ä¸ªéè´Ÿçš„<strong>å®¹é‡å€¼c(u , v)</strong> ã€‚è€Œä¸”ï¼Œå¦‚æœè¾¹é›†åˆ E åŒ…å«ä¸€æ¡è¾¹(u , v) ï¼Œåˆ™å›¾ä¸­ä¸å­˜åœ¨åå‘è¾¹(v , u)ã€‚</p><p><strong>æºèŠ‚ç‚¹så’Œæ±‡ç‚¹tï¼š</strong> åœ¨æµç½‘ç»œçš„æ‰€æœ‰èŠ‚ç‚¹ä¸­ï¼Œæˆ‘ä»¬åˆ†è¾¨å‡ºä¸¤ä¸ªç‰¹æ®Šçš„èŠ‚ç‚¹ï¼Œåˆ†åˆ«æ˜¯æºç‚¹så’Œæ±‡ç‚¹tï¼›æºç‚¹æ˜¯æ‰€æœ‰è·¯å¾„çš„èµ·ç‚¹ï¼Œè€Œæ±‡ç‚¹æ˜¯è·¯å¾„çš„ç»ˆç‚¹ã€‚åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæºç‚¹å’Œæ±‡ç‚¹éœ€è¦äººä¸ºæŒ‡å®šã€‚</p><p><strong>æµç½‘ç»œ G ä¸­çš„æµï¼š</strong> Gä¸­æµçš„å¤§å°ï¼ˆå€¼ï¼‰ç”¨ f è¡¨ç¤ºï¼Œf(u , v)è¡¨ç¤ºä»ç‚¹ u åˆ°ç‚¹ v çš„æµçš„å¤§å°ã€‚æ•´å¼ å›¾çš„æµæ˜¯ $|f| = \sum_{v \epsilon V}f(s, v) - \sum_{v \epsilon V}f(v ,s)$ï¼ˆå‰åä¸¤ä¸ª v å«ä¹‰ä¸åŒï¼‰ï¼Œå³ä»æºç‚¹ s æµå‡ºçš„æµé‡å’Œï¼Œæˆ–ç§°ä¸ºæµå…¥æ±‡ç‚¹ t çš„æµé‡å’Œã€‚</p><p><strong>å®¹é‡é™åˆ¶ï¼š</strong> å¯¹äºæ‰€æœ‰çš„èŠ‚ç‚¹$u, v \epsilon V$ï¼Œè¦æ±‚$0 &lt;= f(u , v) &lt;= c(u , v)$<br><strong>æµé‡å®ˆæ’ï¼š</strong> å¯¹äºæ‰€æœ‰çš„èŠ‚ç‚¹ $u \epsilon V$ - { s , t }ï¼Œè¦æ±‚æµå…¥ u çš„æµé‡ç­‰äºæµå‡º u çš„æµé‡ï¼Œå³ï¼š</p><script type="math/tex; mode=display">\sum_{v \epsilon V}f(v,u) = \sum_{v \epsilon V}f(u,v)</script><p>ï¼ˆå‰åä¸¤ä¸ª v çš„å«ä¹‰ä¸åŒï¼Œä¸€ä¸ªæ˜¯å…¥è¾¹çš„èµ·ç‚¹ï¼Œä¸€ä¸ªæ˜¯å‡ºè¾¹çš„ç»ˆç‚¹ï¼‰</p><p><strong>é—®é¢˜æ¨¡å‹ï¼š</strong> åœ¨æœ€å¤§æµé—®é¢˜ä¸­ï¼Œç»™å®šä¸€ä¸ªæµç½‘ç»œG ã€ä¸€ä¸ªæºèŠ‚ç‚¹sã€ä¸€ä¸ªæ±‡ç‚¹tï¼Œæˆ‘ä»¬å¸Œæœ›æ‰¾åˆ°å€¼æœ€å¤§çš„ä¸€ä¸ªæµã€‚</p><h4 id="Edmonds-Karpç®—æ³•"><a href="#Edmonds-Karpç®—æ³•" class="headerlink" title="Edmonds-Karpç®—æ³•"></a>Edmonds-Karpç®—æ³•</h4><p>è‹¥ä¸€æ¡ä»æºç‚¹ s åˆ°æ±‡ç‚¹ t çš„è·¯å¾„ä¸Šçš„å„æ¡è¾¹çš„å‰©ä½™å®¹é‡éƒ½å¤§äº 0ï¼Œåˆ™ç§°è¿™æ¡è·¯å¾„ä¸ºä¸€æ¡å¢å¹¿è·¯å¾„ã€‚æ˜¾ç„¶ï¼Œå¯ä»¥è®©ä¸€è‚¡æµæ²¿ç€å¢å¹¿è·¯å¾„ä» s æµåˆ° tï¼Œä½¿ç½‘ç»œçš„æµé‡å¢å¤§ã€‚Edmonds-Karpç®—æ³•æ€æƒ³å°±æ˜¯ä¸æ–­ç”¨BFSå¯»æ‰¾å¢å¹¿è·¯ï¼Œç›´è‡³ç½‘ç»œä¸Šä¸å­˜åœ¨å¢å¹¿è·¯ä¸ºæ­¢ã€‚<br>è¯¥ç®—æ³•çš„æ—¶é—´å¤æ‚åº¦ä¸º$O(nm^2)$ã€‚ç„¶è€Œåœ¨å®é™…è¿ç”¨ä¸­åˆ™è¿œè¿œè¾¾ä¸åˆ°è¿™ä¸ªä¸Šç•Œï¼Œæ•ˆç‡è¾ƒé«˜ï¼Œä¸€èˆ¬èƒ½å¤Ÿå¤„ç† $10^3 - 10^4$è§„æ¨¡çš„ç½‘ç»œã€‚</p><p><strong>ç®—æ³•æ€è·¯ï¼š</strong><br>è¿™é‡Œä»‹ç»çš„æ˜¯åˆ©ç”¨ bfs å¯»æ‰¾å¢å¹¿è·¯çš„Edmonds-Karpå¢å¹¿è·¯ç®—æ³•ã€‚åœ¨è¯¥ç®—æ³•ä¸­ï¼Œæˆ‘ä»¬ä¸æ–­çš„å¯»æ‰¾å¢å¹¿è·¯ï¼Œå¹¶å¢åŠ å¢å¹¿è·¯ä¸Šçš„æµï¼›é‡å¤è¿™ä¸€æ­¥éª¤ç›´è‡³ä¸å­˜åœ¨å¢å¹¿è·¯ã€‚<br>åœ¨æ¯è½®å¯»æ‰¾å¢å¹¿è·¯çš„è¿‡ç¨‹ä¸­ï¼ŒEdmonds-Karpç®—æ³•åªè€ƒè™‘å›¾ä¸­æ‰€æœ‰ f(x ,y) &lt; c(x, y)çš„è¾¹ï¼Œç”¨BFSæ‰¾åˆ°ä»»æ„ä¸€æ¡ä» s åˆ° t çš„è·¯å¾„ï¼ŒåŒæ—¶è®¡ç®—å‡ºè·¯å¾„ä¸Šå„è¾¹çš„å‰©ä½™å®¹é‡çš„æœ€å°å€¼ minfï¼Œåˆ™ç½‘ç»œçš„æµé‡å°±å¯ä»¥å¢åŠ  minfã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå½“ä¸€æ¡è¾¹çš„æµé‡ f(x ,y) &gt; 0æ—¶ï¼Œæ ¹æ®æ–œå¯¹ç§°æ€§è´¨ï¼Œå®ƒçš„åå‘è¾¹æµé‡ f(y ,x) &lt; 0ï¼Œæ­¤æ—¶å¿…å®šæœ‰ f(y , x) &lt; c(y ,x)ã€‚æ•…Edmonds-Karpç®—æ³•åœ¨BFSæ—¶é™¤äº†åŸå›¾çš„è¾¹é›† E å¤–ï¼Œè¿˜åº”è€ƒè™‘éå† E ä¸­æ¯æ¡è¾¹çš„åå‘è¾¹ã€‚<br>å…·ä½“å®ç°æ—¶ï¼Œæœ¬æ–‡é‡‡ç”¨é‚»æ¥è¡¨â€œæˆå¯¹å­˜å‚¨â€æŠ€å·§ï¼ˆå³â€™2â€™å’Œâ€™3â€™æ˜¯ä¸€å¯¹ï¼Œâ€™4â€™å’Œâ€™5â€™æ˜¯ä¸€å¯¹ï¼‰ã€‚æ¯æ¡è¾¹åªè®°å½•å‰©ä½™å®¹é‡ c-f å³å¯ï¼Œå½“ä¸€æ¡è¾¹ (x ,y) æµè¿‡å¤§å°ä¸º e çš„æµæ—¶ï¼Œä»¤ (x ,y) çš„å®¹é‡å‡å°‘ eï¼Œ(y ,x) çš„å®¹é‡å¢åŠ  e ã€‚</p><p><strong>ä»£ç æ¨¡æ¿ï¼š</strong><br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1e3</span>+<span class="number">10</span>;<span class="comment">//æœ€å¤§ç‚¹æ•°</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> M = <span class="number">1e3</span>+<span class="number">10</span>;<span class="comment">//æœ€å¤§è¾¹æ•°</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> INF = <span class="number">0x3f3f3f3f</span>;<span class="comment">//intèŒƒå›´å†…çš„æ— ç©·å¤§</span></span><br><span class="line"><span class="keyword">int</span> head[N], edge[M], ver[M], nex[M], tot = <span class="number">1</span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">addEdge</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> y,<span class="keyword">int</span> z)</span></span>&#123;</span><br><span class="line">ver[++tot] = y; edge[tot] = z;</span><br><span class="line">nex[tot] = head[x]; head[x] = tot;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> n,m,s,t;<span class="comment">// å…±nä¸ªç‚¹,mæ¡è¾¹,sæ˜¯æºç‚¹,tæ˜¯æ±‡ç‚¹</span></span><br><span class="line"><span class="keyword">int</span> pre[N],incf[N];<span class="comment">//å¢å¹¿è·¯ä¸Šå„è¾¹çš„æœ€å°å‰©ä½™å®¹é‡</span></span><br><span class="line"><span class="keyword">bool</span> vis[N];<span class="comment">//æ ‡è®°æ•°ç»„</span></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">bfs</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="built_in">memset</span>(vis,<span class="number">0</span>,<span class="keyword">sizeof</span> vis);</span><br><span class="line"><span class="built_in">queue</span>&lt;<span class="keyword">int</span>&gt; q;</span><br><span class="line">q.push(s); vis[s] = <span class="literal">true</span>;</span><br><span class="line">incf[s] = INF;</span><br><span class="line"><span class="keyword">while</span>(!q.empty())&#123;</span><br><span class="line"><span class="keyword">int</span> x = q.front(); q.pop();</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = head[x];i ;i = nex[i])&#123;</span><br><span class="line"><span class="keyword">int</span> y = ver[i],z = edge[i];</span><br><span class="line"><span class="keyword">if</span>(!z || vis[y]) <span class="keyword">continue</span>;</span><br><span class="line">incf[y] = min(incf[x],z);</span><br><span class="line">pre[y] = i;<span class="comment">//è®°å½•å‰é©±*è¾¹*</span></span><br><span class="line">q.push(y); vis[y] = <span class="literal">true</span>;</span><br><span class="line"><span class="keyword">if</span>(y == t) <span class="keyword">return</span> <span class="literal">true</span>;<span class="comment">//æ‰¾åˆ°ä¸€æ¡å¢å¹¿è·¯</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">EK</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="comment">/*è¿”å›æœ€å¤§æµçš„å€¼*/</span></span><br><span class="line"><span class="keyword">int</span> flow = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span>(bfs())&#123;</span><br><span class="line"><span class="keyword">int</span> x = t;</span><br><span class="line"><span class="keyword">while</span>(x != s)&#123;</span><br><span class="line"><span class="keyword">int</span> i = pre[x];<span class="comment">//å‰é©± *è¾¹* </span></span><br><span class="line">edge[i] -= incf[t];</span><br><span class="line">edge[i^<span class="number">1</span>] += incf[t];</span><br><span class="line">x = ver[i^<span class="number">1</span>];<span class="comment">//å‰é©±ç‚¹ = åå‘è¾¹çš„ç»ˆç‚¹</span></span><br><span class="line">&#125;</span><br><span class="line">flow += incf[t];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> flow;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d%d%d%d"</span>,&amp;n,&amp;m,&amp;s,&amp;t);</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>,x,y,z;i &lt;= m;i++)&#123;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d%d%d"</span>,&amp;x,&amp;y,&amp;z);</span><br><span class="line">addEdge(x,y,z); addEdge(y,x,<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%d\n"</span>,EK());</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ç®—æ³•æ­£ç¡®æ€§éœ€è¦ç”¨åˆ°æœ€å°å‰²æ¥è¯æ˜ï¼Œè¯¦è§ã€ŠæŒ‘æˆ˜ç¨‹åºè®¾è®¡ç«èµ›ç¬¬äºŒç‰ˆã€‹P212ã€‚</p><h4 id="Dinicç®—æ³•"><a href="#Dinicç®—æ³•" class="headerlink" title="Dinicç®—æ³•"></a>Dinicç®—æ³•</h4><p> åœ¨ä»»æ„æ—¶åˆ»ï¼Œç½‘ç»œä¸­æ‰€æœ‰èŠ‚ç‚¹ä»¥åŠå‰©ä½™å®¹é‡å¤§äº0çš„è¾¹æ„æˆçš„å­å›¾è¢«ç§°ä¸ºæ®‹é‡ç½‘ç»œã€‚Edmonds-Karpæ¯è½®å¯èƒ½ä¼šéå†æ•´ä¸ªæ®‹é‡ç½‘ç»œï¼Œä½†åªæ‰¾å‡º 1 æ¡å¢å¹¿è·¯ï¼Œè¿˜æœ‰è¿›ä¸€æ­¥ä¼˜åŒ–çš„ç©ºé—´ã€‚<br> åœ¨å®½åº¦ä¼˜å…ˆéå†æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥è®¡ç®—å‡º<strong>èŠ‚ç‚¹çš„å±‚æ¬¡d[x]</strong> ï¼Œå®ƒè¡¨ç¤º s åˆ° x æœ€å°‘éœ€è¦ç»è¿‡çš„è¾¹æ•°ã€‚åœ¨æ®‹é‡ç½‘ç»œä¸­ï¼Œæ»¡è¶³d[y] = d[x] + 1 çš„è¾¹(x ,y) æ„æˆçš„å­å›¾è¢«ç§°ä¸º<strong>åˆ†å±‚å›¾</strong> ã€‚åˆ†å±‚å›¾æ˜¾ç„¶æ˜¯ä¸€å¼ æœ‰å‘æ— ç¯å›¾ã€‚</p><p> Dinic ç®—æ³•ä¸æ–­é‡å¤ä»¥ä¸‹æ­¥éª¤ï¼Œç›´åˆ°æ®‹é‡ç½‘ç»œä¸­ s ä¸èƒ½åˆ°è¾¾ tï¼š</p><ol><li>åœ¨æ®‹é‡ç½‘ç»œä¸Š BFS æ±‚å‡ºèŠ‚ç‚¹çš„å±‚æ¬¡ï¼Œæ„é€ åˆ†å±‚å›¾</li><li>åœ¨åˆ†å±‚å›¾ä¸Š DFS å¯»æ‰¾å¢å¹¿è·¯ï¼Œåœ¨å›æº¯æ—¶å®æ—¶æ›´æ–°å‰©ä½™å®¹é‡ã€‚å¦å¤–ï¼Œæ¯ä¸ªç‚¹å¯ä»¥æµå‘å¤šæ¡å‡ºè¾¹ï¼ŒåŒæ—¶è¿˜åŠ å…¥äº†è‹¥å¹²å‰ªæï¼Œè¯¦æƒ…å‚è€ƒä»£ç ç¤ºä¾‹ã€‚</li></ol><p>Dinic ç®—æ³•çš„æ—¶é—´å¤æ‚åº¦æ˜¯$O(n^2m)$ã€‚å®é™…è¿ç”¨ä¸­è¿œè¿œè¾¾ä¸åˆ°è¿™ä¸ªä¸Šç•Œï¼Œå¯ä»¥è¯´æ˜¯æ¯”è¾ƒå®¹æ˜“å®ç°çš„æ•ˆç‡æœ€é«˜çš„ç½‘ç»œæµç®—æ³•ä¹‹ä¸€ï¼Œä¸€èˆ¬èƒ½å¤Ÿå¤„ç†$10^4 - 10^5$è§„æ¨¡çš„ç½‘ç»œã€‚ç‰¹åˆ«åœ°ï¼ŒDinicç®—æ³•æ±‚è§£äºŒåˆ†å›¾æœ€å¤§åŒ¹é…çš„æ—¶é—´å¤æ‚åº¦ä¸º$O(m\sqrt n)$ï¼Œå®é™…è¡¨ç°åˆ™æ›´å¿«ã€‚</p><p> <strong>ä»£ç ç¤ºä¾‹</strong><br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> INF = <span class="number">0x3f3f3f3f</span>;<span class="comment">//intæ‰€èƒ½è¡¨ç¤ºçš„æœ€å¤§èŒƒå›´çš„ä¸€åŠ</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1e5</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> M = <span class="number">5</span>*N;</span><br><span class="line"><span class="keyword">int</span> head[N],edge[M],ver[M],nex[M], tot = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">int</span> d[N];<span class="comment">//è®°å½•èŠ‚ç‚¹çš„å±‚æ¬¡</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">addEdge</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> y,<span class="keyword">int</span> z)</span></span>&#123;</span><br><span class="line">ver[++tot] = y; edge[tot] = z;</span><br><span class="line">nex[tot] = head[x]; head[x] = tot;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">queue</span>&lt;<span class="keyword">int</span>&gt; q;</span><br><span class="line"><span class="keyword">int</span> n,m,s,t;</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">bfs</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="comment">/*åˆ©ç”¨bfsæ¥æ±‚å‡ºèŠ‚ç‚¹çš„å±‚æ¬¡ï¼Œæ„é€ åˆ†å±‚å›¾*/</span></span><br><span class="line"><span class="built_in">memset</span>(d,<span class="number">0</span>,<span class="keyword">sizeof</span> d);</span><br><span class="line"><span class="keyword">while</span>(q.size()) q.pop();</span><br><span class="line">q.push(s); d[s] = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">while</span>(q.size())&#123;</span><br><span class="line"><span class="keyword">int</span> x = q.front(); q.pop();</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = head[x];i ;i = nex[i])&#123;</span><br><span class="line"><span class="keyword">int</span> y = ver[i],z = edge[i];</span><br><span class="line"><span class="keyword">if</span>(!z || d[y]) <span class="keyword">continue</span>;</span><br><span class="line">q.push(y);</span><br><span class="line">d[y] = d[x] + <span class="number">1</span>;</span><br><span class="line"><span class="keyword">if</span>(y == t) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">dinic</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> flow)</span></span>&#123;</span><br><span class="line"><span class="comment">/* åˆ©ç”¨é€’å½’åœ¨åˆ†å±‚å›¾ä¸Šæ‰¾å¢å¹¿è·¯,è¿”å›æœ¬æ¬¡å¢å¹¿çš„æµé‡ */</span></span><br><span class="line"><span class="keyword">if</span>(x == t) <span class="keyword">return</span> flow;</span><br><span class="line"><span class="keyword">int</span> res = flow, k;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = head[x];i ;i = nex[i])&#123;</span><br><span class="line"><span class="keyword">int</span> y = ver[i], z = edge[i];</span><br><span class="line"><span class="keyword">if</span>(z &amp;&amp; d[y] == d[x]+<span class="number">1</span>)&#123;</span><br><span class="line">k = dinic(y,min(res,z));<span class="comment">//é€’å½’</span></span><br><span class="line"><span class="keyword">if</span>(!k) d[y] = <span class="number">0</span>;<span class="comment">//å‰ªæ,å»æ‰å¢å¹¿å®Œæ¯•çš„ç‚¹</span></span><br><span class="line">edge[i] -= k; edge[i^<span class="number">1</span>] += k;</span><br><span class="line">res -= k;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> flow - res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d%d%d%d"</span>,&amp;n,&amp;m,&amp;s,&amp;t);</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>,x,y,z;i &lt;= m;i++)&#123;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d%d%d"</span>,&amp;x,&amp;y,&amp;z);</span><br><span class="line">addEdge(x,y,z); addEdge(y,x,<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> flow = <span class="number">0</span>,maxflow = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span>(bfs())</span><br><span class="line"><span class="keyword">while</span>(flow = dinic(s,INF)) maxflow += flow;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%d\n"</span>,maxflow);</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h4 id="ISAPç®—æ³•"><a href="#ISAPç®—æ³•" class="headerlink" title="ISAPç®—æ³•"></a>ISAPç®—æ³•</h4><p>ISAPç®—æ³•æ²¡æœ‰æ­£å¼çš„åç§°ï¼Œé¦–æ¬¡å‡ºç°äº Ahujaå’ŒOrlinçš„ç»å…¸æ•™æã€ŠNetwork Flowsï¼šTheoryï¼ŒAlgorithms and Applicationsã€‹ä¸­ï¼Œä½œè€…ç§°å®ƒæ˜¯ä¸€ç§ï¼šæ”¹è¿›ç‰ˆçš„SAPï¼ˆImproved SAPï¼ŒISAPï¼‰â€œã€‚</p><p>è¯¥ç®—æ³•åŸºäºè¿™æ ·ä¸€ä¸ªäº‹å®ï¼šæ¯æ¬¡å¢å¹¿åï¼Œä»»æ„èŠ‚ç‚¹åˆ°æ±‡ç‚¹ï¼ˆåœ¨æ®‹é‡ç½‘ç»œä¸­ï¼‰çš„æœ€çŸ­è·ç¦»éƒ½ä¸ä¼šå‡å°ã€‚è¿™æ ·ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ä¸€ä¸ªå‡½æ•°d(x)æ¥è¡¨ç¤ºæ®‹é‡ç½‘ç»œä¸­èŠ‚ç‚¹ x åˆ°æ±‡ç‚¹çš„è·ç¦»çš„ä¸‹ç•Œï¼ˆåœ¨Dinicä¸­æ˜¯ç”¨æ•°ç»„ d[]ï¼‰ï¼Œç„¶ååœ¨å¢å¹¿è¿‡ç¨‹ä¸­ä¸æ–­ä¿®æ­£è¿™ä¸ªä¸‹ç•Œï¼ˆè€Œä¸æ˜¯åƒDinic ç®—æ³•é‚£æ ·å¤šæ¬¡å¢å¹¿ä»¥åæ‰é‡å»ºå±‚æ¬¡å›¾ï¼‰ï¼Œåˆ™å¢å¹¿çš„æ—¶å€™å’Œ Dinic ç±»ä¼¼ï¼Œåªå…è®¸æ²¿ç€ d(y) = d(x) + 1 çš„æœ‰å‘è¾¹ (x , y) èµ°ã€‚</p><p>ä¸¥æ ¼çš„è¯´ï¼Œç®—æ³•ä¸­çš„ d å‡½æ•°æ˜¯æ»¡è¶³å¦‚ä¸‹ä¸¤ä¸ªæ¡ä»¶çš„éè´Ÿå‡½æ•°ï¼Œå³ d(t) = 0ï¼›å¯¹äºæ®‹é‡ç½‘ç»œä¸­çš„ä»»æ„å¼§ (x ,y)ï¼Œd(x) &lt;= d(y) + 1ã€‚ä¸éš¾è¯æ˜ï¼Œåªè¦æ»¡è¶³è¿™ä¸¤ä¸ªæ¡ä»¶ï¼Œd(x) å°±æ˜¯ x~t è·ç¦»çš„ä¸‹ç•Œã€‚è€Œä¸”å½“ d(s) &gt;= næ—¶ï¼Œæ®‹é‡ç½‘ç»œä¸­ä¸å­˜åœ¨ s-t è·¯ã€‚</p><p><strong>ç®—æ³•æ€è·¯</strong><br>å’Œ Dinic ç®—æ³•ç±»ä¼¼ï¼Œæ‰¾å¢å¹¿è·¯çš„è¿‡ç¨‹æ˜¯ä» s å¼€å§‹æ²¿ç€â€œå…è®¸å¼§â€ï¼ˆå³åœ¨æ®‹é‡ç½‘ç»œä¸­çš„ï¼Œæ»¡è¶³ d[x] = d[y] + 1 çš„å¼§ x â€”&gt; yï¼‰å¾€å‰èµ°ï¼ˆISAP ç®—æ³•ä¸­å«Advanceï¼‰å¦‚æœèµ°ä¸åŠ¨äº†æ€ä¹ˆåŠï¼Ÿåœ¨Dinicç®—æ³•ä¸­ï¼Œç›´æ¥â€œå¾€å›èµ°ä¸€æ­¥â€å³å¯ï¼Œå› ä¸ºå¦‚æœæ‰¾ä¸åˆ°å¢å¹¿è·¯ï¼Œä¼šé‡æ–°æ„é€ å±‚æ¬¡å›¾ï¼›ä½†åœ¨ISAPä¸­ï¼Œå¹¶æ²¡æœ‰ä¸€ä¸ªâ€œä¸€æ¬¡æ€§ä¿®æ”¹æ‰€æœ‰è·ç¦»æ ‡å·â€çš„è¿‡ç¨‹ï¼Œåªèƒ½è¾¹å¢å¹¿è¾¹ä¿®æ”¹ã€‚å…·ä½“æ¥è¯´ï¼Œåœ¨ä»ç»“ç‚¹ x å¾€å›èµ°çš„æ—¶å€™ï¼ŒæŠŠ d(x) ä¿®æ”¹ä¸º min{d(y) | (x , y)  æ˜¯æ®‹é‡ç½‘ç»œä¸­çš„å¼§ } + 1ï¼ˆISAPç®—æ³•å« Retreatï¼‰å³å¯ã€‚æ³¨æ„ï¼Œå¦‚æœæ®‹é‡ç½‘ç»œä¸­ä» x å‡ºå‘æ²¡æœ‰å¼§ï¼Œåˆ™è®¾ d(x) = nã€‚<br>ISAPç®—æ³•çœ‹ä¸Šå»ä¸éš¾ç†è§£ï¼Œä½†æ˜¯å®ç°èµ·æ¥å´æœ‰è¯¸å¤šç»†èŠ‚ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨ä¸€ç§â€œå½“<br>å‰å¼§â€çš„æ•°æ®ç»“æ„åŠ é€Ÿ å…è®¸å¼§ çš„æŸ»æ‰¾ï¼Œå…¶æ¬¡ï¼Œè¿˜éœ€è¦ä¸€ä¸ª gap æ•°ç»„ç»´æŠ¤æ¯ä¸ªè·ç¦»æ ‡å·<br>ç»“ç‚¹ç¼–å·ã€‚å½“æŠŠä¸€ä¸ªç»“ç‚¹çš„è·ç¦»æ ‡å·ä» x æ”¹æˆ y çš„æ—¶å€™,æŠŠ gap[x] å‡1,gap[y]åŠ 1,ç„¶å<br>æ£€æŸ¥ gap[x] æ˜¯å¦ä¸º0ã€‚å¦‚æœæ˜¯ 0 çš„è¯,è¯´æ˜ s-t ä¸è¿é€šï¼Œç®—æ³•ç»ˆæ­¢ã€‚è¿™å°±æ˜¯æ‰€è°“çš„ gap ä¼˜åŒ–ã€‚æœ€åï¼Œåˆå§‹è·ç¦»æ ‡å·å¯ä»¥ç»Ÿä¸€è®¾ä¸º 0 ï¼Œä¹Ÿå¯ä»¥ç”¨é€†å‘BFSæ‰¾ï¼Œå•æ¬¡è¿è¡Œæ—¶æ•ˆç‡ç›¸å·®ä¸å¤§ï¼Œä½†å¦‚æœæ˜¯å¤šæ¬¡æ±‚è§£å°è§„æ¨¡ç½‘ç»œæµï¼ŒåŠ ä¸ŠBFSä»¥åé€Ÿåº¦å¾€å¾€ä¼šæœ‰æ˜æ˜¾æå‡ã€‚</p><p>æ•°æ®ç»“æ„æ–¹é¢ï¼Œåªå¤šäº†ä¸¤ä¸ªæ•°ç»„ï¼š<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> pre[N];        <span class="comment">//å¯å¢å¹¿è·¯çš„ä¸Šä¸€æ¡å¼§</span></span><br><span class="line"><span class="keyword">int</span> gap[N];       <span class="comment">//è·ç¦»æ ‡å·è®¡æ•°</span></span><br></pre></td></tr></table></figure></p><p><strong>ä»£ç ç¤ºä¾‹ï¼š</strong><br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1e5</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> M = <span class="number">5</span>*N;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> INF = <span class="number">0x3f3f3f3f</span>;</span><br><span class="line"><span class="comment">/*ä»¥ä¸‹6è¡Œæ˜¯æ•°ç»„æ¨¡æ‹Ÿé‚»æ¥è¡¨éƒ¨åˆ†*/</span></span><br><span class="line"><span class="keyword">int</span> head[N],ver[M],edge[M],nex[M],tot;</span><br><span class="line"><span class="keyword">int</span> cur[N],dis[N],gap[N],pre[N];</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">gap[k]:kå±‚æœ‰å¤šå°‘ä¸ªèŠ‚ç‚¹</span></span><br><span class="line"><span class="comment">pre[x]:xç‚¹å‰ä¸€æ¡è¾¹çš„ç¼–å·</span></span><br><span class="line"><span class="comment">cur[]æ˜¯ä¸´æ—¶æ•°ç»„</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">addEdge</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> y,<span class="keyword">int</span> z)</span></span>&#123;</span><br><span class="line">ver[++tot] = y, edge[tot] = z;</span><br><span class="line">nex[tot] = head[x]; head[x] = tot;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> n,m,s,t;</span><br><span class="line"><span class="keyword">int</span> que[N],front,rear;<span class="comment">//æ‰‹å·¥æ¨¡æ‹Ÿé˜Ÿåˆ—ï¼ŒèŠ‚çœéƒ¨åˆ†æ—¶é—´</span></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">bfs</span><span class="params">(<span class="keyword">int</span> n)</span></span>&#123;</span><br><span class="line">front = rear = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++) </span><br><span class="line">dis[i] = <span class="number">-1</span>,cur[i] = head[i],gap[i]= <span class="number">0</span>;</span><br><span class="line">dis[t] = <span class="number">0</span>;  que[rear++] = t;</span><br><span class="line"><span class="keyword">while</span>(front != rear)&#123;</span><br><span class="line"><span class="keyword">int</span> x = que[front++];</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = head[x];i ;i = nex[i])&#123;</span><br><span class="line"><span class="keyword">int</span> y = ver[i],z = edge[i];</span><br><span class="line"><span class="keyword">if</span>(dis[y] == <span class="number">-1</span>) </span><br><span class="line">que[rear++] = y, dis[y] = dis[x] + <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> ~dis[t];<span class="comment">//-1çš„è¡¥ç æ˜¯11111111,æŒ‰ä½å–ååæ˜¯0</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">ISAP</span><span class="params">(<span class="keyword">int</span> n)</span></span>&#123;</span><br><span class="line"><span class="keyword">int</span> k = s, ans = <span class="number">0</span>, i;<span class="comment">//æ—¶åˆ»æ³¨æ„iä¸èƒ½è¢«è¦†ç›–ï¼ï¼ï¼</span></span><br><span class="line">bfs(n);<span class="comment">//ä¸€æ¬¡bfsä»æ±‡ç‚¹å‘å‰æ›´æ–°å±‚æ¬¡æ•°ç»„dis</span></span><br><span class="line"><span class="keyword">for</span>(i = <span class="number">1</span>;i &lt;= n;i++) gap[dis[i]]++;</span><br><span class="line"><span class="keyword">while</span>(dis[s] &lt; n)&#123;</span><br><span class="line"><span class="keyword">if</span>(k == t)&#123;</span><br><span class="line"><span class="keyword">int</span> mi = INF, loc = t;</span><br><span class="line"><span class="keyword">while</span>(loc != s)&#123;</span><br><span class="line">mi = min(mi,edge[pre[loc]]);</span><br><span class="line">loc = ver[pre[loc]^<span class="number">1</span>];<span class="comment">//å‰ä¸€ä¸ªé¡¶ç‚¹</span></span><br><span class="line">&#125;</span><br><span class="line">loc = t;</span><br><span class="line"><span class="keyword">while</span>(loc != s)&#123;</span><br><span class="line">edge[pre[loc]] -= mi;</span><br><span class="line">edge[pre[loc]^<span class="number">1</span>] += mi;</span><br><span class="line">loc = ver[pre[loc]^<span class="number">1</span>];</span><br><span class="line">&#125;</span><br><span class="line">ans += mi, k = s;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span>(i = cur[k];i;i = nex[i])&#123;</span><br><span class="line"><span class="keyword">int</span> y = ver[i], z = edge[i];</span><br><span class="line"><span class="keyword">if</span>(z &amp;&amp; dis[k] == dis[y]+<span class="number">1</span>)&#123;</span><br><span class="line">pre[y] = cur[k] = i; k = y;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(i) <span class="keyword">continue</span>;</span><br><span class="line"><span class="keyword">int</span> m = n;</span><br><span class="line"><span class="keyword">for</span>(i = head[k];i;i = nex[i])&#123;</span><br><span class="line"><span class="keyword">int</span> y = ver[i],z = edge[i];</span><br><span class="line"><span class="keyword">if</span>(z &amp;&amp; dis[y] &lt; m) m = dis[y], cur[k] = i;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(--gap[dis[k]] == <span class="number">0</span>) <span class="keyword">break</span>;</span><br><span class="line">dis[k] = m+<span class="number">1</span>, ++gap[dis[k]];</span><br><span class="line"><span class="keyword">if</span>(k != s) k = ver[pre[k]^<span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">int</span> n,m;</span><br><span class="line"><span class="keyword">while</span>(~<span class="built_in">scanf</span>(<span class="string">"%d%d%d%d"</span>,&amp;n,&amp;m,&amp;s,&amp;t))&#123;</span><br><span class="line"><span class="built_in">memset</span>(head,<span class="number">0</span> ,<span class="keyword">sizeof</span> head); tot = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>,x,y,z;i &lt;= m;i++)&#123;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d%d%d"</span>,&amp;x,&amp;y,&amp;z);</span><br><span class="line">addEdge(x,y,z); addEdge(y,x,<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%d\n"</span>,ISAP(n));</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h4 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h4><ul><li>åˆ˜æ±ä½³ï¼Œç®—æ³•ç«èµ›å…¥é—¨ç»å…¸è®­ç»ƒæŒ‡å—ï¼ŒåŒ—äº¬ï¼šæ¸…åå¤§å­¦å‡ºç‰ˆç¤¾ï¼Œ2012ï¼Œ362-363.</li><li>æç…œä¸œï¼Œç®—æ³•ç«èµ›è¿›é˜¶æŒ‡å—ï¼Œéƒ‘å·ï¼šæ²³å—ç”µå­éŸ³åƒå‡ºç‰ˆç¤¾ï¼Œ2017ï¼Œ410-415.</li><li>ç§‹å¶æ‹“å“‰ï¼ŒæŒ‘æˆ˜ç¨‹åºè®¾è®¡ç«èµ›ç¬¬2ç‰ˆï¼ŒåŒ—äº¬ï¼šäººæ°‘é‚®ç”µå‡ºç‰ˆç¤¾ï¼Œ2013ï¼Œ209-215.</li><li>Thomas H.Cormenï¼Œç®—æ³•å¯¼è®ºï¼ˆåŸä¹¦ç¬¬3ç‰ˆï¼‰ï¼ŒåŒ—äº¬ï¼šæœºæ¢°å·¥ä¸šå‡ºç‰ˆç¤¾ï¼Œ2013ï¼Œ414-417.</li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h4 id=&quot;æ‘˜è¦&quot;&gt;&lt;a href=&quot;#æ‘˜è¦&quot; class=&quot;headerlink&quot; title=&quot;æ‘˜è¦&quot;&gt;&lt;/a&gt;æ‘˜è¦&lt;/h4&gt;&lt;p&gt;æ­£å¦‚å¯ä»¥é€šè¿‡å°†é“è·¯äº¤é€šå›¾æ¨¡å‹åŒ–ä¸ºæœ‰å‘å›¾æ¥æ‰¾åˆ°ä»ä¸€ä¸ªåŸå¸‚åˆ°å¦ä¸€ä¸ªåŸå¸‚ä¹‹é—´çš„æœ€çŸ­è·¯ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å°†ä¸€ä¸ªæœ‰å‘å›¾çœ‹ä½œä¸€ä¸ªâ€œæµç½‘ç»œâ€ï¼Œå¹¶ä½¿ç”¨å®ƒæ¥å›ç­”å…³äº
      
    
    </summary>
    
      <category term="ACMå­¦ä¹ ç¬”è®°" scheme="http://valenshi.top/categories/ACM%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
    
      <category term="å›¾è®º" scheme="http://valenshi.top/tags/%E5%9B%BE%E8%AE%BA/"/>
    
      <category term="æ•°æ®ç»“æ„ä¸ç®—æ³•" scheme="http://valenshi.top/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/"/>
    
      <category term="æœ€å¤§æµ" scheme="http://valenshi.top/tags/%E6%9C%80%E5%A4%A7%E6%B5%81/"/>
    
  </entry>
  
  <entry>
    <title>ä¼™ä¼´ç®—æ³•</title>
    <link href="http://valenshi.top/2019/11/13/buddy-system/"/>
    <id>http://valenshi.top/2019/11/13/buddy-system/</id>
    <published>2019-11-13T12:13:59.000Z</published>
    <updated>2019-11-13T12:16:54.000Z</updated>
    
    <content type="html"><![CDATA[<h4 id="ä¼™ä¼´ç³»ç»Ÿï¼ˆBuddy-Systemï¼‰"><a href="#ä¼™ä¼´ç³»ç»Ÿï¼ˆBuddy-Systemï¼‰" class="headerlink" title="ä¼™ä¼´ç³»ç»Ÿï¼ˆBuddy Systemï¼‰"></a>ä¼™ä¼´ç³»ç»Ÿï¼ˆBuddy Systemï¼‰</h4><p><strong>ä¼™ä¼´ç³»ç»Ÿçš„ç‰¹ç‚¹</strong></p><ul><li>æ•´ä¸ªå¯åˆ†é…çš„åˆ†åŒºå¤§å°ä¸º $2^u$ã€‚</li><li>éœ€è¦çš„åˆ†åŒºå¤§å°ä¸º $2^{u-1} &lt; s &lt;= 2^u$æ—¶ï¼ŒæŠŠæ•´ä¸ªå—åˆ†é…ç»™è¯¥è¿›ç¨‹ã€‚</li></ul><p><strong>åˆ†é…åˆ†åŒºçš„è¿‡ç¨‹ï¼š</strong><br>å¦‚æœ $s &lt;= 2^{i-1}$ï¼Œåˆ™å°†å¤§å°ä¸º$2^i$çš„å½“å‰ç©ºé—²åˆ†åŒºåˆ’åˆ†ä¸ºä¸¤ä¸ªå¤§å°ä¸º$2^{i-1}$çš„ç©ºé—²åˆ†åŒº<br>é‡å¤åˆ’åˆ†è¿‡ç¨‹ï¼Œç›´è‡³$2^{i-1} &lt; s &lt;= 2^i$ï¼Œå¹¶æŠŠä¸€ä¸ªç©ºé—²åˆ†åŒºåˆ†é…ç»™è¯¥è¿›ç¨‹ã€‚</p><h4 id="ä¼™ä¼´ç³»ç»Ÿçš„å®ç°"><a href="#ä¼™ä¼´ç³»ç»Ÿçš„å®ç°" class="headerlink" title="ä¼™ä¼´ç³»ç»Ÿçš„å®ç°"></a>ä¼™ä¼´ç³»ç»Ÿçš„å®ç°</h4><p><strong>æ•°æ®ç»“æ„ï¼š</strong></p><ul><li>ç©ºé—²å—æŒ‰ç…§å¤§å°å’Œèµ·å§‹åœ°å€ç»„æˆäºŒç»´æ•°ç»„ã€‚</li><li>åˆå§‹çŠ¶æ€ï¼šåªæœ‰ä¸€ä¸ªå¤§å°ä¸º$2^u$çš„ç©ºé—²å—ã€‚</li></ul><p><strong>åˆ†é…è¿‡ç¨‹ï¼š</strong></p><ul><li>ç”±å¤§åˆ°å°åœ¨ç©ºé—²å—æ•°ç»„ä¸­æ‰¾åˆ°æœ€å°çš„å¯ç”¨ç©ºé—²å—ã€‚</li><li>å¦‚æœç©ºé—²å—è¿‡å¤§ï¼Œå¯¹å¯ç”¨çš„ç©ºé—²å—è¿›è¡ŒäºŒç­‰åˆ†ï¼Œç›´åˆ°å¾—åˆ°åˆé€‚çš„å¯ç”¨çš„ç©ºé—²å—ã€‚</li></ul><p><strong>åˆ†é…æ ·ä¾‹å›¾ç¤ºï¼š</strong><br><img src="/2019/11/13/buddy-system/1.png" alt="1"></p><p><strong>é‡Šæ”¾è¿‡ç¨‹ï¼š</strong></p><ul><li>æŠŠé‡Šæ”¾çš„ç©ºé—²å—æ”¾å…¥ç©ºé—²æ•°ç»„</li><li>åˆå¹¶æ»¡è¶³åˆå¹¶æ¡ä»¶çš„ç©ºé—²å—</li></ul><p><strong>åˆå¹¶æ¡ä»¶ï¼š</strong></p><ul><li>å¤§å°ç›¸åŒï¼Œä¾‹å¦‚éƒ½æ˜¯$2^i$</li><li>åœ°å€ç›¸é‚»</li><li>ä½åœ°å€ç©ºé—²å—èµ·å§‹åœ°å€ä¸º$2^{i+1}$çš„ä½æ•°</li></ul><h4 id="ä¼™ä¼´ç®—æ³•çš„ä¼˜ç¼ºç‚¹"><a href="#ä¼™ä¼´ç®—æ³•çš„ä¼˜ç¼ºç‚¹" class="headerlink" title="ä¼™ä¼´ç®—æ³•çš„ä¼˜ç¼ºç‚¹"></a>ä¼™ä¼´ç®—æ³•çš„ä¼˜ç¼ºç‚¹</h4><p><strong>ä¼˜ç‚¹ï¼š</strong></p><ul><li>è¾ƒå¥½çš„è§£å†³å¤–éƒ¨ç¢ç‰‡é—®é¢˜</li><li>å½“éœ€è¦åˆ†é…è‹¥å¹²ä¸ªå†…å­˜é¡µé¢æ—¶ï¼Œç”¨äºDMAçš„å†…å­˜é¡µé¢å¿…é¡»è¿ç»­ï¼Œä¼™ä¼´ç®—æ³•å¾ˆå¥½çš„æ»¡è¶³äº†è¿™ä¸ªè¦æ±‚</li><li>åªè¦è¯·æ±‚çš„å—ä¸è¶…è¿‡512ä¸ªé¡µé¢ï¼ˆ2kï¼‰ï¼Œå†…æ ¸å°±å°½é‡åˆ†é…è¿ç»­çš„é¡µé¢ã€‚</li><li>é’ˆå¯¹å¤§å†…å­˜åˆ†é…è®¾è®¡</li></ul><p><strong>ç¼ºç‚¹ï¼š</strong></p><ul><li>åˆå¹¶çš„è¦æ±‚è¿‡äºä¸¥æ ¼ï¼Œåªèƒ½æ˜¯æ»¡è¶³ä¼™ä¼´å…³ç³»çš„å—æ‰èƒ½åˆå¹¶</li><li>ç¢ç‰‡é—®é¢˜ï¼šä¸€ä¸ªè¿ç»­çš„å†…å­˜ä¸­ä»…ä»…ä¸€ä¸ªé¡µé¢è¢«å ç”¨ï¼Œå¯¼è‡´æ•´ä¸ªå†…å­˜åŒºéƒ½ä¸å…·å¤‡åˆå¹¶æ¡ä»¶</li><li>æµªè´¹é—®é¢˜ï¼šä¼™ä¼´ç®—æ³•åªèƒ½åˆ†é…2çš„å¹‚æ¬¡æ–¹å†…å­˜åŒºï¼Œå½“éœ€è¦çš„å†…å­˜ä¸º$2^i+1$ K æ—¶ï¼Œä¾‹å¦‚éœ€è¦ 9K æ—¶ï¼Œå°±éœ€è¦åˆ†é…16Kçš„å†…å­˜ç©ºé—´ï¼Œå‰©ä¸‹çš„ 7K æµªè´¹äº†ã€‚</li><li>ç®—æ³•çš„æ•ˆç‡é—®é¢˜ï¼šä¼™ä¼´ç®—æ³•ä¸­æ¶‰åŠäº†æ¯”è¾ƒå¤šçš„è®¡ç®—è¿˜æœ‰é“¾è¡¨å’Œä½å›¾çš„æ“ä½œï¼Œå¼€é”€æ¯”è¾ƒå¤§ï¼Œå¦‚æœæ¯æ¬¡åˆå¹¶$2^n$å¤§å°çš„å—ä¸º$2^{n+1}$çš„å°ï¼Œé‚£ä¹ˆå¤§å°ä¸º$2^n$çš„å—ä¼šå‡å°‘ï¼Œå¦‚æœéšåç³»ç»Ÿåˆéœ€è¦$2^n$å¤§å°çš„å—ï¼Œå°±åˆè¦æ‹†åˆ†ï¼Œè¿™æ ·çš„ç«‹å³åˆå¹¶å’Œæ‹†åˆ†è¿‡ç¨‹æ— æ•ˆç‡ã€‚</li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h4 id=&quot;ä¼™ä¼´ç³»ç»Ÿï¼ˆBuddy-Systemï¼‰&quot;&gt;&lt;a href=&quot;#ä¼™ä¼´ç³»ç»Ÿï¼ˆBuddy-Systemï¼‰&quot; class=&quot;headerlink&quot; title=&quot;ä¼™ä¼´ç³»ç»Ÿï¼ˆBuddy Systemï¼‰&quot;&gt;&lt;/a&gt;ä¼™ä¼´ç³»ç»Ÿï¼ˆBuddy Systemï¼‰&lt;/h4&gt;&lt;p&gt;&lt;stron
      
    
    </summary>
    
      <category term="è®¡ç®—æœºæ“ä½œç³»ç»Ÿ" scheme="http://valenshi.top/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/"/>
    
    
      <category term="å†…å­˜åˆ†é…" scheme="http://valenshi.top/tags/%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D/"/>
    
  </entry>
  
  <entry>
    <title>Ubuntuä¸‹vimç®€å•å…¥é—¨</title>
    <link href="http://valenshi.top/2019/10/26/vim-use/"/>
    <id>http://valenshi.top/2019/10/26/vim-use/</id>
    <published>2019-10-26T02:34:59.000Z</published>
    <updated>2019-10-26T02:36:02.627Z</updated>
    
    <content type="html"><![CDATA[<h4 id="å®‰è£…vim"><a href="#å®‰è£…vim" class="headerlink" title="å®‰è£…vim"></a>å®‰è£…vim</h4><p>åœ¨ubuntuçš„å‘½ä»¤è¡Œä¸‹è¾“å…¥<code>sudo apt install vim</code> ä»¥è·å¾—vimã€‚å¦‚é‡åˆ°æŠ¥é”™ï¼Œå¯å¤åˆ¶æŠ¥é”™ä¿¡æ¯å»ç™¾åº¦å¯»æ‰¾å¯¹åº”è§£å†³ç­–ç•¥ã€‚</p><h4 id="vimçš„ä½¿ç”¨"><a href="#vimçš„ä½¿ç”¨" class="headerlink" title="vimçš„ä½¿ç”¨"></a>vimçš„ä½¿ç”¨</h4><p>vimç¼–è¾‘å™¨æœ‰ä¸‰ç§ï¼šå‘½ä»¤æ¨¡å¼ï¼Œæœ«è¡Œæ¨¡å¼ï¼Œæ’å…¥æ¨¡å¼ã€‚</p><p>æ‰“å¼€vimæ—¶é»˜è®¤çš„æ˜¯<strong>å‘½ä»¤æ¨¡å¼</strong>ï¼Œæ­¤çŠ¶æ€ä¸‹æ•²å‡»é”®ç›˜è§†ä¸ºè¾“å…¥å‘½ä»¤è€Œéå­—ç¬¦ã€‚è‹¥æƒ³è¿›å…¥<strong>æ’å…¥æ¨¡å¼</strong>ï¼Œåˆ™è¦åœ¨å‘½ä»¤æ¨¡å¼ä¸‹è¾“å…¥ i ï¼Œæ­¤æ—¶å¯ä»¥è¾“å…¥å­—ç¬¦ï¼Œç¼–è¾‘æ–‡æœ¬ï¼›è¾“å…¥å®Œæ¯•åï¼ŒæŒ‰ESCå¯é€€å›åˆ°å‘½ä»¤æ¨¡å¼ã€‚<br>å‘½ä»¤æ¨¡å¼åªæœ‰ä¸€äº›ç®€å•çš„å‘½ä»¤ï¼Œæ›´å¤šå‘½ä»¤éœ€è¦ä½¿ç”¨æœ«è¡Œæ¨¡å¼ï¼›åœ¨å‘½ä»¤æ¨¡å¼ä¸‹è¾“å…¥â€ : â€œï¼ˆä¸å«å¼•å·ï¼‰å¯è¿›å…¥æœ«è¡Œæ¨¡å¼ï¼Œæœ«è¡Œæ¨¡å¼å¯ä»¥è¿›è¡Œæ›´å¤šçµæ´»çš„æ“ä½œã€‚</p><p>ä»¥ä¸Šæ˜¯ä¸‰ç§æ¨¡å¼çš„å¼‚åŒä»¥åŠåˆ‡æ¢æ–¹æ³•ã€‚</p><h4 id="å¸¸ç”¨å‘½ä»¤"><a href="#å¸¸ç”¨å‘½ä»¤" class="headerlink" title="å¸¸ç”¨å‘½ä»¤"></a>å¸¸ç”¨å‘½ä»¤</h4><p>ä»¥ä¸‹å¤åˆ¶è€å¸ˆçš„ç¬”è®°ï¼š</p><p><strong>æ¨¡å¼åˆ‡æ¢</strong></p><ol><li>è¾“å…¥iè¿›å…¥æ’å…¥æ¨¡å¼</li><li>åœ¨æ’å…¥æ¨¡å¼ä¸­æŒ‰ESCè¿›å…¥å‘½ä»¤æ¨¡å¼</li><li>åœ¨å‘½ä»¤æ¨¡å¼ä¸­è¾“å…¥ â€œ : â€œ è¿›å…¥æœ«è¡Œæ¨¡å¼</li></ol><p><strong>ä¿å­˜ï¼š</strong></p><ol><li>å‘½ä»¤æ¨¡å¼ä¸­è¾“å…¥ZZ</li><li>åœ¨æœ«è¡Œæ¨¡å¼ä¸­è¾“å…¥:wq</li></ol><p><strong>ç¼–è¯‘ï¼š</strong></p><ol><li>g++ -o test test.cpp -Wall</li></ol><p><strong>å®šä½ï¼š</strong></p><ol><li>:i å®šä½åˆ°ç¬¬ i è¡Œ</li><li>:/x å®šä½åˆ°xç¬¬ä¸€æ¬¡å‡ºç°çš„è¡Œ</li></ol><p><strong>åˆ é™¤è¡Œï¼ˆå‘½ä»¤æ¨¡å¼ä¸‹ï¼‰ï¼š</strong></p><ol><li>ddåˆ é™¤å½“å‰è¡Œ</li><li>d2dåˆ é™¤åŒ…å«å½“å‰è¡Œçš„2è¡Œï¼Œå‘ä¸‹çš„</li></ol><p><strong>æ’¤å›ï¼š</strong></p><ol><li>å‘½ä»¤æ¨¡å¼ä¸‹è¾“å…¥ u</li></ol><p><strong>å¤åˆ¶ï¼ˆå‘½ä»¤æ¨¡å¼ä¸‹ï¼‰ï¼š</strong></p><ol><li>yyï¼Œä¸ddåŠŸèƒ½ç›¸ä¼¼</li><li>ç²˜è´´æ—¶æŒ‰p</li></ol><h4 id="é…ç½®vim"><a href="#é…ç½®vim" class="headerlink" title="é…ç½®vim"></a>é…ç½®vim</h4><p>æ­¤æ—¶vimå¯ä»¥æ­£å¸¸ä½¿ç”¨ï¼Œä½†æ˜¯ç•Œé¢æœ‰äº›ä¸å‹å¥½ï¼Œæ²¡æœ‰è¡Œå·ï¼Œç¼©è¿›ä¹Ÿå¾ˆéš¾çœ‹ï¼Œæ›´æ²¡æœ‰è‡ªåŠ¨è¡¥å…¨ç­‰ã€‚<br>æˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨æœ«è¡Œæ¨¡å¼ä¸­è¾“å…¥ä¸€äº›å‘½ä»¤æ¥ä½¿å¾—ç•Œé¢ä»¥åŠæ“ä½œæ›´åŠ å‹å¥½ï¼Œä¾‹å¦‚æ·»åŠ è¡Œå·ï¼Œè®¾ç½®ç¼©è¿›ç­‰ï¼Œä½†æ˜¯è¿™æ ·éœ€è¦æ¯æ¬¡æ‰“å¼€viméƒ½è¦é‡æ–°é…ç½®ï¼Œæ‰€ä»¥ä¸ºäº†æ–¹ä¾¿èµ·è§ï¼Œå¯ä»¥ä¿®æ”¹é…ç½®æ–‡ä»¶è¾¾åˆ°è‡ªåŠ¨é…ç½®çš„ç›®çš„ã€‚</p><p>é¦–å…ˆé€šè¿‡ <code>cd ~</code> è¿›å…¥ç”¨æˆ·æ ¹ç›®å½•ï¼Œç„¶å<code>vim .vimrc</code> æ–°å»ºä¸€ä¸ªéšè—æ–‡ä»¶<code>.vimrc</code>ï¼Œå¹¶æ‰“å¼€ç¼–è¾‘ï¼›è¾“å…¥å¦‚ä¸‹é…ç½®ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">set nu          //æ˜¾ç¤ºè¡Œå·</span><br><span class="line">set ts=4        //åˆ¶è¡¨ç¬¦å®½åº¦</span><br><span class="line">set history=1000    </span><br><span class="line">set showmatch   //é«˜äº®æ˜¾ç¤ºåŒ¹é…çš„æ‹¬å·</span><br><span class="line">set ruler       //æ˜¾ç¤ºå°ºå¯¸</span><br><span class="line">set mouse=a     //å¯ç”¨é¼ æ ‡é€‰æ‹©</span><br><span class="line">set autoindent  //è‡ªåŠ¨ç¼©è¿›</span><br><span class="line">set cindent     //è‡ªåŠ¨ç¼©è¿›</span><br><span class="line">set nobackup    //ç¦æ­¢ç”Ÿæˆä¸´æ—¶æ–‡ä»¶</span><br><span class="line">set smartindent //è‡ªåŠ¨ç¼©è¿›</span><br><span class="line">set shiftwidth=4    //è‡ªåŠ¨ç¼©è¿›çš„é•¿åº¦</span><br><span class="line">set expandtab   //tabå˜ç©ºæ ¼</span><br><span class="line"></span><br><span class="line">//ä»¥ä¸‹æ˜¯è‡ªåŠ¨è¡¥å…¨</span><br><span class="line">inoremap&#123; &#123;&#125;&lt;ESC&gt;i&lt;CR&gt;&lt;ESC&gt;O</span><br><span class="line">inoremap( ()&lt;ESC&gt;i</span><br><span class="line">inoremap[ []&lt;ESC&gt;i</span><br><span class="line">inoremap&apos; &apos;&apos;&lt;ESC&gt;i</span><br><span class="line">inoremap&quot; &quot;&quot;&lt;ESC&gt;i</span><br><span class="line"></span><br><span class="line">set encoding=utf-8</span><br><span class="line">set softtabstop=4</span><br><span class="line"></span><br><span class="line">//å®šä¹‰F6å¿«æ·ç¼–è¯‘è¿è¡Œï¼Œåœ¨å‘½ä»¤æ¨¡å¼ä¸‹</span><br><span class="line">map &lt;F6&gt; :cal CR() &lt;CR&gt;</span><br><span class="line">func! CR()</span><br><span class="line">exec &quot;w&quot;</span><br><span class="line">exec &quot;!g++ % -o %&lt;&quot;</span><br><span class="line">exec &quot;! ./%&lt;&quot;</span><br><span class="line">endfunc</span><br></pre></td></tr></table></figure></p><p>è¾“å…¥å®ŒæˆåæŒ‰ESCè¿›å…¥å‘½ä»¤æ¨¡å¼ï¼Œå† :wq ä¿å­˜é€€å‡ºå³å¯ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h4 id=&quot;å®‰è£…vim&quot;&gt;&lt;a href=&quot;#å®‰è£…vim&quot; class=&quot;headerlink&quot; title=&quot;å®‰è£…vim&quot;&gt;&lt;/a&gt;å®‰è£…vim&lt;/h4&gt;&lt;p&gt;åœ¨ubuntuçš„å‘½ä»¤è¡Œä¸‹è¾“å…¥&lt;code&gt;sudo apt install vim&lt;/code&gt; ä»¥è·å¾—vimã€‚å¦‚é‡åˆ°
      
    
    </summary>
    
      <category term="Linux" scheme="http://valenshi.top/categories/Linux/"/>
    
    
      <category term="vim" scheme="http://valenshi.top/tags/vim/"/>
    
  </entry>
  
  <entry>
    <title>å•è°ƒæ ˆä¸å•è°ƒé˜Ÿåˆ—</title>
    <link href="http://valenshi.top/2019/10/17/ddz/"/>
    <id>http://valenshi.top/2019/10/17/ddz/</id>
    <published>2019-10-17T05:42:19.000Z</published>
    <updated>2019-10-17T05:42:57.769Z</updated>
    
    <content type="html"><![CDATA[<h4 id="æ‘˜è¦"><a href="#æ‘˜è¦" class="headerlink" title="æ‘˜è¦"></a>æ‘˜è¦</h4><p>å•è°ƒæ ˆå’Œå•è°ƒé˜Ÿåˆ—éƒ½å¯ä»¥çœ‹ä½œæ˜¯ä¸€ç§å¯¹æ ˆå’Œé˜Ÿåˆ—çš„ç‰¹æ®Šç”¨æ³•ï¼Œå³è¦æ±‚æ ˆæˆ–é˜Ÿåˆ—ä¸­çš„å…ƒç´ å…·æœ‰å•è°ƒæ€§ï¼Œé€’å¢æˆ–é€’å‡ã€‚é‚£ä¹ˆå¾ˆæ˜¾ç„¶è¿™ç§æ•°æ®ç»“æ„å°±æ˜¯åŸºäºæ ˆå’Œé˜Ÿåˆ—å®ç°çš„ï¼Œå³å®ƒæ—¢ä¿ç•™äº†æ ˆçš„å…ˆè¿›åå‡ºï¼ˆé˜Ÿåˆ—å°±æ˜¯ä¿ç•™å…ˆè¿›å…ˆå‡ºï¼‰ï¼Œåˆå…·æœ‰å•è°ƒæ€§ã€‚è€Œæˆ‘ä»¬åœ¨æŸäº›æ—¶å€™æ­£éœ€è¦å…¶è¿™ç§æ€§è´¨ï¼Œæˆ‘ä»¬åœ¨è®²è§£äº†å•è°ƒæ ˆå’Œå•è°ƒé˜Ÿåˆ—çš„å®šä¹‰ã€ç‰¹æ€§ã€æ„é€ æ–¹æ³•åï¼Œä¼šå„ç»™å‡ºä¸€é“ä¾‹é¢˜æ¥ä½“ç°å®ƒä»¬çš„ç”¨æ³•ã€‚</p><h4 id="å•è°ƒæ ˆ"><a href="#å•è°ƒæ ˆ" class="headerlink" title="å•è°ƒæ ˆ"></a>å•è°ƒæ ˆ</h4><h5 id="å•è°ƒæ ˆçš„æ¦‚å¿µ"><a href="#å•è°ƒæ ˆçš„æ¦‚å¿µ" class="headerlink" title="å•è°ƒæ ˆçš„æ¦‚å¿µ"></a>å•è°ƒæ ˆçš„æ¦‚å¿µ</h5><p>å•è°ƒæ ˆæ˜¯ä¸€ç§ç‰¹æ®Šçš„æ ˆï¼Œæ ˆå†…çš„æ‰€æœ‰å…ƒç´ éƒ½ä¿æŒç€å•è°ƒæ€§ï¼Œå³å•è°ƒé€’å¢æˆ–å•è°ƒé€’å‡ã€‚</p><h5 id="å•è°ƒæ ˆçš„æ€§è´¨"><a href="#å•è°ƒæ ˆçš„æ€§è´¨" class="headerlink" title="å•è°ƒæ ˆçš„æ€§è´¨"></a>å•è°ƒæ ˆçš„æ€§è´¨</h5><ul><li>å•è°ƒæ€§ã€‚è‹¥æ˜¯å•è°ƒé€’å¢æ ˆï¼Œåˆ™ä»æ ˆé¡¶åˆ°æ ˆåº•çš„å…ƒç´ æ˜¯ä¸¥æ ¼é€’å¢çš„ã€‚è‹¥æ˜¯å•è°ƒé€’å‡æ ˆï¼Œåˆ™ä»æ ˆé¡¶åˆ°æ ˆåº•çš„å…ƒç´ æ˜¯ä¸¥æ ¼é€’å‡çš„ã€‚</li><li>é è¿‘æ ˆåº•çš„å…ƒç´ å…ˆè¿›æ ˆï¼Œè¶Šé åçš„å…ƒç´ è¶Šåè¿›æ ˆã€‚</li></ul><p>å•è°ƒæ ˆå’Œæ™®é€šçš„æ ˆä¸€æ ·ï¼Œéƒ½åªèƒ½åœ¨æ ˆé¡¶æ“ä½œï¼Œå‹å…¥æˆ–å¼¹å‡ºã€‚è€Œæˆ‘ä»¬éœ€è¦é€šè¿‡ä¸€äº›çº¦æŸæ¥ä½¿å¾—æ ˆå†…å…ƒç´ å…·æœ‰å•è°ƒæ€§ï¼Œä»è€Œæ„æˆå•è°ƒæ ˆã€‚</p><h5 id="æ„é€ å•è°ƒæ ˆ"><a href="#æ„é€ å•è°ƒæ ˆ" class="headerlink" title="æ„é€ å•è°ƒæ ˆ"></a>æ„é€ å•è°ƒæ ˆ</h5><p>ä»¥å•è°ƒé€’å¢æ ˆä¸ºä¾‹ï¼šå¯¹äºå½“å‰å…ƒç´ eï¼Œè‹¥eå¤§äºæ ˆé¡¶å…ƒç´ ï¼Œåˆ™è¿›æ ˆï¼Œå¦åˆ™å¼¹å‡ºæ ˆé¡¶å…ƒç´ ï¼Œå†æ¬¡è¿›è¡Œæ¯”è¾ƒï¼Œé‡å¤ç›´è‡³æ ˆé¡¶å…ƒç´ å°äºeæˆ–æ ˆä¸ºç©ºä¸ºæ­¢ï¼Œæ­¤æ—¶å°†eå‹å…¥æ ˆã€‚<br>å¯¹äºå¼¹å‡ºçš„å…ƒç´ ï¼Œæˆ‘ä»¬å¹¶ä¸éœ€è¦é‡æ–°å‹å›ï¼Œå› ä¸ºä¸€èˆ¬æƒ…å†µä¸‹å®ƒä»¬éƒ½å±äºè¢«â€œæ·˜æ±°â€çš„å…ƒç´ ï¼Œåé¢å‹å…¥çš„å…ƒç´ ä¸€èˆ¬åˆâ€œæ–°é²œâ€åˆâ€œç¾å‘³â€ï¼Œå³æ—¶é—´ä¸Šå’Œæ•°å€¼ä¸Šéƒ½æ¯”å…¶ä¼˜ç§€ã€‚</p><h5 id="ä¾‹é¢˜HDU1506"><a href="#ä¾‹é¢˜HDU1506" class="headerlink" title="ä¾‹é¢˜HDU1506"></a>ä¾‹é¢˜HDU1506</h5><p>å…ˆæ€è€ƒä¸€ä¸ªé—®é¢˜ï¼Œå¦‚æœé¢˜ç›®ä¸­çš„çŸ©å½¢çš„é«˜åº¦éƒ½æ˜¯å•è°ƒé€’å¢çš„ï¼Œå¦‚ä½•å¾—åˆ°æœ€ä¼˜è§£ï¼Ÿæ˜¾ç„¶æœ‰ä¸€ä¸ªè´ªå¿ƒçš„ç­–ç•¥ï¼Œå°±æ˜¯ä»¥æ¯ä¸€ä¸ªçŸ©å½¢çš„é«˜åº¦ä½œä¸ºæœ€ç»ˆå¤§çŸ©å½¢çš„é«˜åº¦ï¼Œçœ‹æœ€å®½èƒ½æ˜¯å¤šå°‘ï¼Œç„¶åç»Ÿè®¡æœ€ä¼˜è§£ã€‚<br>ä½†å¦‚æœè¿›æ¥çš„ä¸‹ä¸€çŸ©å½¢æ¯”ä¸Šä¸€ä¸ªä½ï¼Œå®ƒå…¶å®ç›¸å½“äºé™åˆ¶äº†ä¹‹å‰çŸ©å½¢çš„é«˜åº¦ï¼Œé‚£ä¹ˆä¹‹å‰çŸ©å½¢æ¯”è¿™ä¸ªçŸ©å½¢é«˜å‡ºçš„é«˜åº¦åœ¨ä»¥åçš„ç»Ÿè®¡ä¸­å°±æ²¡æœ‰ä¸æ¯«ç”¨å¤„äº†ï¼Œå¦‚æœæˆ‘ä»¬åœ¨è¿™ä¸ªæ—¶å€™æŠŠä»¥ä¹‹å‰çŸ©å½¢çš„é«˜åº¦ä½œä¸ºæœ€ç»ˆé«˜åº¦çš„ç­”æ¡ˆç»Ÿè®¡æ‰ï¼Œé‚£ä¹ˆåæ­£ä»¥åçš„ç»Ÿè®¡å’Œä¸Šä¸€ä¸ªçŸ©å½¢æ²¡æœ‰å…³ç³»ï¼Œè¿˜ä¸å¦‚æŠŠä»–åˆ é™¤ã€‚<br>è¿™æ ·ï¼Œæˆ‘ä»¬å®é™…ä¸Šå°±å¾—åˆ°äº†å•è°ƒæ ˆçš„æ¨¡å‹ï¼Œåªéœ€è¦ç»´æŠ¤ä¸€ä¸ªå•è°ƒæ ˆï¼Œåœ¨ç»´æŠ¤å•è°ƒæ€§çš„å¼¹å‡ºæ“ä½œæ—¶ç»Ÿè®¡å®½åº¦ï¼Œæ›´æ–°ç­”æ¡ˆå³å¯åœ¨O(n) æ—¶é—´å†…å¾—åˆ°æœ€ä¼˜è§£ã€‚<br>ä¸ºäº†æ–¹ä¾¿æŠŠæœ€åå‰©ä¸‹çš„ï¼Œä»¥åŠå•è°ƒé€’å¢çš„çŸ©å½¢ä¹Ÿç»Ÿè®¡è¿›å»ï¼Œæˆ‘ä»¬å‡è®¾a[n+1]çš„ä½ç½®æœ‰ä¸€ä¸ªé«˜åº¦ä¸º0çš„çŸ©å½¢ï¼Œæœ€åå°†å®ƒåŠ å…¥å•è°ƒæ ˆæ—¶ä»–ä¼šå°†æ‰€æœ‰çŸ©å½¢éƒ½å¼¹å‡ºï¼Œé‚£ä¹ˆç­”æ¡ˆä¹Ÿå°±å®Œæˆæœ€åçš„æ›´æ–°äº†ã€‚</p><h5 id="ä»£ç ç¤ºä¾‹"><a href="#ä»£ç ç¤ºä¾‹" class="headerlink" title="ä»£ç ç¤ºä¾‹"></a>ä»£ç ç¤ºä¾‹</h5><p>è§é™„å½•éƒ¨åˆ†code-1</p><h4 id="å•è°ƒé˜Ÿåˆ—"><a href="#å•è°ƒé˜Ÿåˆ—" class="headerlink" title="å•è°ƒé˜Ÿåˆ—"></a>å•è°ƒé˜Ÿåˆ—</h4><h5 id="æ¦‚å¿µ"><a href="#æ¦‚å¿µ" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h5><p>å•è°ƒé˜Ÿåˆ—çš„æ¦‚å¿µå’Œå•è°ƒæ ˆç±»ä¼¼ï¼Œåªæ˜¯æŠŠå…ˆè¿›åå‡ºæ”¹æˆå…ˆè¿›å…ˆå‡ºå°±å¯ä»¥äº†ã€‚å…¶å…·æœ‰å…ˆè¿›å…ˆå‡ºçš„ç‰¹æ€§å¹¶ä¸”é˜Ÿåˆ—ä¸­å…ƒç´ å…·æœ‰å•è°ƒæ€§ã€‚<br>å•è°ƒæ˜¯ä¸€ç§æ€æƒ³ï¼Œå½“æˆ‘ä»¬è§£å†³é—®é¢˜çš„æ—¶å€™å‘ç°æœ‰è®¸å¤šå†—æ‚æ— ç”¨çš„çŠ¶æ€æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥é‡‡ç”¨å•è°ƒæ€æƒ³ï¼Œç”¨å•è°ƒé˜Ÿåˆ—æˆ–ç±»ä¼¼äºå•è°ƒé˜Ÿåˆ—çš„æ–¹æ³•å»é™¤å†—æ‚çŠ¶æ€ï¼Œä¿å­˜æˆ‘ä»¬æƒ³è¦çš„çŠ¶æ€ã€‚</p><h5 id="å•è°ƒé˜Ÿåˆ—çš„æ€§è´¨"><a href="#å•è°ƒé˜Ÿåˆ—çš„æ€§è´¨" class="headerlink" title="å•è°ƒé˜Ÿåˆ—çš„æ€§è´¨"></a>å•è°ƒé˜Ÿåˆ—çš„æ€§è´¨</h5><ul><li>å•è°ƒé˜Ÿåˆ—çš„æœ€ä¼˜é€‰æ‹©åœ¨é˜Ÿé¦–ã€‚</li><li>é˜Ÿåˆ—å…ƒç´ å…·æœ‰å•è°ƒæ€§ã€‚</li><li>å»é™¤å†—ä½™çŠ¶æ€ï¼ˆæ— ç”¨çŠ¶æ€ï¼‰ã€‚</li><li>ç»´æŠ¤åŒºé—´æœ€å€¼ã€‚</li></ul><h5 id="å•è°ƒé˜Ÿåˆ—çš„æ„é€ æ–¹æ³•"><a href="#å•è°ƒé˜Ÿåˆ—çš„æ„é€ æ–¹æ³•" class="headerlink" title="å•è°ƒé˜Ÿåˆ—çš„æ„é€ æ–¹æ³•"></a>å•è°ƒé˜Ÿåˆ—çš„æ„é€ æ–¹æ³•</h5><ul><li>ç»´æŠ¤é˜Ÿé¦–ï¼ˆå¯¹äºä¸Šé¢˜å°±æ˜¯å¦‚æœé˜Ÿé¦–å·²ç»æ˜¯å½“å‰å…ƒç´ çš„mä¸ªä¹‹å‰ï¼Œåˆ™é˜Ÿé¦–å°±åº”è¯¥è¢«åˆ äº†,head++ï¼‰</li><li>åœ¨é˜Ÿå°¾æ’å…¥ï¼ˆæ¯æ’å…¥ä¸€ä¸ªå°±è¦ä»é˜Ÿå°¾å¼€å§‹å¾€å‰å»é™¤å†—æ‚çŠ¶æ€ï¼Œä¿æŒå•è°ƒæ€§ï¼‰</li></ul><p>å‡å¦‚å¯¹äºåºåˆ—Aï¼ša1,  a2 , â€¦ an å»ºç«‹ä¸€ä¸ªå•è°ƒé€’å‡æ ˆç»´æŠ¤é•¿åº¦ä¸ºmçš„å­—æ®µæœ€å¤§å€¼ï¼Œé‚£ä¹ˆå¯¹äºå½“å‰å…ƒç´ eï¼Œè‹¥é˜Ÿé¦–å…ƒç´ å°äºeï¼Œé‚£ä¹ˆå…¶ä½ç½®ä¸Šä¸å ä¼˜åŠ¿ï¼ˆè¦è¢«è¸¢å‡ºé•¿åº¦ä¸ºmçš„å­—æ®µï¼‰ï¼Œè€Œä¸”å…¶æ•°å€¼ä¸Šä¹Ÿä¸å ä¼˜åŠ¿ï¼ˆæ¯”æ–°æ¥çš„eè¦å°ï¼‰ï¼Œæ‰€ä»¥å…¶å°±è¦è¢«èˆå¼ƒã€‚é‡å¤è¿™ä¸€æ“ä½œï¼Œç›´è‡³é˜Ÿé¦–å…ƒç´ å¤§äºå…ƒç´ eï¼Œé‚£ä¹ˆè¯´æ˜å…¶è¿˜æœ‰ç”¨ï¼Œå°±ä¿ç•™ã€‚<br>ä¸¾ä¸ªåº”ç”¨ä¾‹å­ï¼š</p><p>æ•°åˆ—ä¸ºï¼š6 4 10 10 8 6 4 2 12 14<br>N=10,K=3;<br>é‚£ä¹ˆæˆ‘ä»¬æ„é€ ä¸€ä¸ªé•¿åº¦ä¸º3çš„å•è°ƒé€’å‡é˜Ÿåˆ—ï¼š<br>é¦–å…ˆï¼Œé‚£6å’Œå®ƒçš„ä½ç½®0æ”¾å…¥é˜Ÿåˆ—ä¸­ï¼Œæˆ‘ä»¬ç”¨(6,0)è¡¨ç¤ºï¼Œæ¯ä¸€æ­¥æ’å…¥å…ƒç´ æ—¶é˜Ÿåˆ—ä¸­çš„å…ƒç´ å¦‚ä¸‹<br>æ’å…¥6ï¼š(6,0);<br>æ’å…¥4ï¼š(6,0),(4,1);<br>æ’å…¥10ï¼š(10,2);<br>æ’å…¥ç¬¬äºŒä¸ª10ï¼Œä¿ç•™åé¢é‚£ä¸ªï¼š(10,3);<br>æ’å…¥8ï¼š(10,3),(8,4);<br>æ’å…¥6ï¼š(10,3),(8,4),(6,5);<br>æ’å…¥4ï¼Œä¹‹å‰çš„10å·²ç»è¶…å‡ºèŒƒå›´æ‰€ä»¥æ’æ‰ï¼š(8,4),(6,5),(4,6);<br>æ’å…¥2ï¼ŒåŒç†ï¼š(6,5),(4,6),(2,7);<br>æ’å…¥12ï¼š(12,8);<br>æ’å…¥14ï¼š(14,9);<br>é‚£ä¹ˆf(i)å°±æ˜¯ç¬¬iæ­¥æ—¶é˜Ÿåˆ—å½“ä¸­çš„é¦–å…ƒç´ ï¼š6,6,10,10,10,10,8,6,12,14åŒç†ï¼Œæœ€å°å€¼ä¹Ÿå¯ä»¥ç”¨å•è°ƒé˜Ÿåˆ—æ¥åšã€‚</p><h5 id="ä¾‹é¢˜Poj-2823"><a href="#ä¾‹é¢˜Poj-2823" class="headerlink" title="ä¾‹é¢˜Poj 2823"></a>ä¾‹é¢˜Poj 2823</h5><p>ç»™å®šä¸€ä¸ªæ•°åˆ—ï¼Œä»å·¦è‡³å³è¾“å‡ºæ¯ä¸ªé•¿åº¦ä¸ºmçš„æ•°åˆ—æ®µå†…çš„æœ€å°æ•°å’Œæœ€å¤§æ•°ã€‚æ•°åˆ—é•¿åº¦ï¼š$N&lt;=10^6ï¼Œm&lt;=N$<br><strong>è§£é¢˜æ€è·¯ï¼š</strong><br>æˆ‘ä»¬çŸ¥é“ï¼Œæš´åŠ›æšä¸¾çš„è¿‡ç¨‹ä¸­ï¼Œæœ‰ä¸€ä¸ªåœ°æ–¹æ˜¯é‡å¤æ¯”è¾ƒäº†ï¼Œå°±æ˜¯åœ¨æ‰¾å½“å‰çš„f(i)çš„æ—¶å€™ï¼Œiçš„å‰é¢å…¶å®ƒm-1ä¸ªæ•°åœ¨ç®—f(i-1)çš„æ—¶å€™æˆ‘ä»¬å°±æ¯”è¾ƒè¿‡äº†ã€‚å½“ä½ ä¸€ä¸ªä¸ªå¾€ä¸‹æ‰¾æ—¶ï¼Œæ¯ä¸€æ¬¡éƒ½æ˜¯å°‘ä¸€ä¸ªç„¶åå¤šä¸€ä¸ªï¼Œå¦‚æœå°‘çš„ä¸æ˜¯æœ€å¤§å€¼ï¼Œç„¶åå†é—®æ–°åŠ è¿›æ¥çš„ï¼Œçœ‹èµ·æ¥å¾ˆçœæ—¶é—´å¯¹å§ï¼Œé‚£ä¹ˆå¦‚æœå°‘äº†çš„æ˜¯æœ€å¤§å€¼å‘¢ï¼Ÿç¬¬äºŒä¸ªæœ€å¤§å€¼æ˜¯ä»€ä¹ˆï¼Ÿï¼Ÿé‚£ä¹ˆæˆ‘ä»¬èƒ½ä¸èƒ½ä¿å­˜ä¸Šä¸€æ¬¡çš„ç»“æœå‘¢ï¼Ÿå½“ç„¶ä¸»è¦æ˜¯içš„å‰k-1ä¸ªæ•°ä¸­çš„æœ€å¤§å€¼äº†ã€‚ç­”æ¡ˆæ˜¯å¯ä»¥ï¼Œè¿™å°±è¦ç”¨åˆ°å•è°ƒé˜Ÿåˆ—ã€‚</p><h5 id="ä»£ç ç¤ºä¾‹-1"><a href="#ä»£ç ç¤ºä¾‹-1" class="headerlink" title="ä»£ç ç¤ºä¾‹"></a>ä»£ç ç¤ºä¾‹</h5><p>è§é™„å½•éƒ¨åˆ†code-2</p><h4 id="é™„å½•"><a href="#é™„å½•" class="headerlink" title="é™„å½•"></a>é™„å½•</h4><h5 id="code-1ï¼š-HDU1506"><a href="#code-1ï¼š-HDU1506" class="headerlink" title="code-1ï¼š HDU1506"></a>code-1ï¼š HDU1506</h5><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1e5</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">int</span> a[N],n,Stack[N],w[N];</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll;</span><br><span class="line">ll ans = <span class="number">0</span>;</span><br><span class="line"><span class="function">ll <span class="title">max</span><span class="params">(ll a,ll b)</span></span>&#123;</span><br><span class="line"><span class="keyword">return</span> a &gt; b?a:b;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="built_in">memset</span>(Stack,<span class="number">0</span>,<span class="keyword">sizeof</span> Stack);</span><br><span class="line"><span class="keyword">int</span> top = <span class="number">0</span>;ans = <span class="number">0</span>;a[n+<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n+<span class="number">1</span>;i++)&#123;</span><br><span class="line"><span class="keyword">if</span>(Stack[top] &lt; a[i])&#123;</span><br><span class="line">Stack[++top] = a[i];</span><br><span class="line">w[top] = <span class="number">1</span>;</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">ll sumw = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span>(Stack[top] &gt; a[i])&#123;</span><br><span class="line">sumw += w[top];</span><br><span class="line">ans = max(ans,sumw*Stack[top]);</span><br><span class="line">top--;</span><br><span class="line">&#125;</span><br><span class="line">Stack[++top] = a[i];w[top] = sumw + <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%lld\n"</span>,ans);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">while</span>(<span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;n) &amp;&amp; n)&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++) <span class="built_in">scanf</span>(<span class="string">"%d"</span>,a+i);</span><br><span class="line">solve();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="code-2-Poj2823"><a href="#code-2-Poj2823" class="headerlink" title="code-2 Poj2823"></a>code-2 Poj2823</h5><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">node</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">int</span> x,y;</span><br><span class="line">&#125;v[<span class="number">1010000</span>]; <span class="comment">//xè¡¨ç¤ºå€¼ï¼Œyè¡¨ç¤ºä½ç½® å¯ä»¥ç†è§£ä¸ºä¸‹æ ‡</span></span><br><span class="line"><span class="keyword">int</span> a[<span class="number">1010000</span>],n,m,mx[<span class="number">1010000</span>],mn[<span class="number">1010000</span>];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">getmin</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i,head=<span class="number">1</span>,tail=<span class="number">0</span>;<span class="comment">// é»˜è®¤èµ·å§‹ä½ç½®ä¸º1 å› ä¸ºæ’å…¥æ˜¯v[++tail]æ•…åˆå§‹åŒ–ä¸º0</span></span><br><span class="line">    <span class="keyword">for</span>(i=<span class="number">1</span>;i&lt;m;i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">while</span>(head&lt;=tail &amp;&amp; v[tail].x&gt;=a[i]) tail--;</span><br><span class="line">        v[++tail].x=a[i],v[tail].y=i;</span><br><span class="line">                <span class="comment">// æ ¹æ®é¢˜ç›® å‰m-1ä¸ªå…ˆç›´æ¥è¿›å…¥é˜Ÿåˆ—</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(;i&lt;=n;i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">while</span>(head&lt;=tail &amp;&amp; v[tail].x&gt;=a[i]) tail--;</span><br><span class="line">        v[++tail].x=a[i],v[tail].y=i;</span><br><span class="line">        <span class="keyword">while</span>(v[head].y&lt;i-m+<span class="number">1</span>) head++;</span><br><span class="line">        mn[i-m+<span class="number">1</span>]=v[head].x;</span><br><span class="line">               <span class="comment">// é“ç†åŒä¸Šï¼Œå½“ç„¶äº† è¦æŠŠå·²ç»è¶…å‡ºèŒƒå›´çš„ä»headå¼€å§‹æ’å‡º</span></span><br><span class="line">               <span class="comment">//  ç„¶åæ¯ä¸ªé˜Ÿé¦–åˆ™æ˜¯ç›®å‰mä¸ªæ•°çš„æœ€å°å€¼</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">getmax</span><span class="params">()</span> <span class="comment">//æœ€å¤§å€¼åŒæœ€å°å€¼çš„é“ç†ï¼Œåªä¸è¿‡æ˜¯ç»´æŠ¤çš„æ˜¯é€’å‡é˜Ÿåˆ—</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i,head=<span class="number">1</span>,tail=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(i=<span class="number">1</span>;i&lt;m;i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">while</span>(head&lt;=tail &amp;&amp; v[tail].x&lt;=a[i]) tail--;</span><br><span class="line">        v[++tail].x=a[i],v[tail].y=i;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(;i&lt;=n;i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">while</span>(head&lt;=tail &amp;&amp; v[tail].x&lt;=a[i]) tail--;</span><br><span class="line">        v[++tail].x=a[i],v[tail].y=i;</span><br><span class="line">        <span class="keyword">while</span>(v[head].y&lt;i-m+<span class="number">1</span>) head++;</span><br><span class="line">        mx[i-m+<span class="number">1</span>]=v[head].x;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i,j;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;n,&amp;m);</span><br><span class="line">    <span class="keyword">for</span>(i=<span class="number">1</span>;i&lt;=n;i++)<span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;a[i]);</span><br><span class="line">    getmin();</span><br><span class="line">    getmax();</span><br><span class="line">    <span class="keyword">for</span>(i=<span class="number">1</span>;i&lt;=n-m+<span class="number">1</span>;i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(i==<span class="number">1</span>)<span class="built_in">printf</span>(<span class="string">"%d"</span>,mn[i]);</span><br><span class="line">        <span class="keyword">else</span> <span class="built_in">printf</span>(<span class="string">" %d"</span>,mn[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"\n"</span>);</span><br><span class="line">    <span class="keyword">for</span>(i=<span class="number">1</span>;i&lt;=n-m+<span class="number">1</span>;i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(i==<span class="number">1</span>)<span class="built_in">printf</span>(<span class="string">"%d"</span>,mx[i]);</span><br><span class="line">        <span class="keyword">else</span> <span class="built_in">printf</span>(<span class="string">" %d"</span>,mx[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"\n"</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h4 id=&quot;æ‘˜è¦&quot;&gt;&lt;a href=&quot;#æ‘˜è¦&quot; class=&quot;headerlink&quot; title=&quot;æ‘˜è¦&quot;&gt;&lt;/a&gt;æ‘˜è¦&lt;/h4&gt;&lt;p&gt;å•è°ƒæ ˆå’Œå•è°ƒé˜Ÿåˆ—éƒ½å¯ä»¥çœ‹ä½œæ˜¯ä¸€ç§å¯¹æ ˆå’Œé˜Ÿåˆ—çš„ç‰¹æ®Šç”¨æ³•ï¼Œå³è¦æ±‚æ ˆæˆ–é˜Ÿåˆ—ä¸­çš„å…ƒç´ å…·æœ‰å•è°ƒæ€§ï¼Œé€’å¢æˆ–é€’å‡ã€‚é‚£ä¹ˆå¾ˆæ˜¾ç„¶è¿™ç§æ•°æ®ç»“æ„å°±æ˜¯åŸºäºæ ˆå’Œé˜Ÿåˆ—å®
      
    
    </summary>
    
      <category term="ACMå­¦ä¹ ç¬”è®°" scheme="http://valenshi.top/categories/ACM%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
    
      <category term="å•è°ƒæ ˆ" scheme="http://valenshi.top/tags/%E5%8D%95%E8%B0%83%E6%A0%88/"/>
    
      <category term="å•è°ƒé˜Ÿåˆ—" scheme="http://valenshi.top/tags/%E5%8D%95%E8%B0%83%E9%98%9F%E5%88%97/"/>
    
  </entry>
  
  <entry>
    <title>åç¼€æ•°ç»„é¢˜é›†</title>
    <link href="http://valenshi.top/2019/10/17/lcp-problems/"/>
    <id>http://valenshi.top/2019/10/17/lcp-problems/</id>
    <published>2019-10-17T05:13:33.000Z</published>
    <updated>2019-10-17T05:19:45.526Z</updated>
    
    <content type="html"><![CDATA[<p>sa[i]ï¼šæ’åä¸ºiçš„åç¼€èµ·å§‹ä½ç½®æ˜¯å¤šå°‘ã€‚<br>rank[i]ï¼šä» i ä½ç½®èµ·å§‹çš„åç¼€åœ¨æ‰€æœ‰åç¼€ä¸­å­—å…¸åºæ’åºååºå·ï¼Œä¸saäº’é€†ã€‚<br>lcp[i]ï¼šS[sa[i] ,â€¦] ä¸ S[sa[i+1] , â€¦]çš„æœ€é•¿å…¬å…±å‰ç¼€ã€‚</p><h4 id="Musical-Theme"><a href="#Musical-Theme" class="headerlink" title="Musical Theme"></a>Musical Theme</h4><p><a href="http://poj.org/problem?id=1743" target="_blank" rel="noopener">æµ‹è¯•åœ°å€</a><br><strong>é¢˜æ„ç®€è¿°</strong><br>ç»™nä¸ªæ•°ç»„æˆçš„ä¸²ï¼Œæ±‚æ˜¯å¦æœ‰å¤šä¸ªâ€œç›¸ä¼¼â€ä¸”ä¸é‡å çš„å­ä¸²çš„é•¿åº¦å¤§äºç­‰äº5ï¼Œä¸¤ä¸ªå­ä¸²ç›¸ä¼¼å½“ä¸”ä»…å½“é•¿åº¦ç›¸ç­‰ä¸”æ¯ä¸€ä½çš„æ•°å­—å·®éƒ½ç›¸ç­‰ã€‚</p><p><strong>è§£é¢˜æ€è·¯</strong><br>æœ¬é¢˜é¢˜æ„æœ‰äº›éš¾ç†è§£ã€‚å°±æ˜¯åˆ©ç”¨åç¼€æ•°ç»„+é«˜åº¦æ•°ç»„è§£å†³æœ€é•¿ä¸é‡å¤å­ä¸²é—®é¢˜ï¼Œè§£æ³•å¾ˆå¥—è·¯ï¼Œå°±æ˜¯äºŒåˆ†+åˆ¤æ–­ã€‚</p><p><strong>ä»£ç ç¤ºä¾‹</strong><br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//POJ1743</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">2e4</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">int</span> n,a[N],b[N];</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">getInt</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">int</span> ans = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">bool</span> neg = <span class="literal">false</span>;</span><br><span class="line"><span class="keyword">char</span> c = getchar();</span><br><span class="line"><span class="keyword">while</span> (c!=<span class="string">'-'</span> &amp;&amp; (c&lt;<span class="string">'0'</span> || c&gt;<span class="string">'9'</span>)) c = getchar();</span><br><span class="line"><span class="keyword">if</span> (c == <span class="string">'-'</span>) neg = <span class="literal">true</span>, c = getchar();</span><br><span class="line"><span class="keyword">while</span> (c&gt;=<span class="string">'0'</span> &amp;&amp; c&lt;=<span class="string">'9'</span>)</span><br><span class="line">ans = ans*<span class="number">10</span> + c-<span class="string">'0'</span>, c = getchar();</span><br><span class="line"><span class="keyword">return</span> neg ? -ans : ans; </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> sa[N],rk[N],lcp[N],tmp[N];</span><br><span class="line"><span class="keyword">int</span> len,k;</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">compare_sa</span><span class="params">(<span class="keyword">int</span> i,<span class="keyword">int</span> j)</span></span>&#123;</span><br><span class="line"><span class="keyword">if</span>(rk[i] != rk[j]) <span class="keyword">return</span> rk[i] &lt; rk[j];</span><br><span class="line"><span class="keyword">int</span> ri = i+k &lt;= len?rk[i+k]:<span class="number">-1</span>;</span><br><span class="line"><span class="keyword">int</span> rj = j+k &lt;= len?rk[j+k]:<span class="number">-1</span>;</span><br><span class="line"><span class="keyword">return</span> ri &lt; rj;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">construct_sa</span><span class="params">(<span class="keyword">int</span> S[],<span class="keyword">int</span> sa[])</span></span>&#123;</span><br><span class="line">len = n;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt;= len;i++)&#123;</span><br><span class="line">sa[i] = i;</span><br><span class="line">rk[i] = i &lt; len?S[i]:<span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span>(k = <span class="number">1</span>;k &lt;= n;k *= <span class="number">2</span>)&#123;</span><br><span class="line">sort(sa,sa+<span class="number">1</span>+len,compare_sa);</span><br><span class="line">tmp[sa[<span class="number">0</span>]] = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= len;i++)</span><br><span class="line">tmp[sa[i]] = tmp[sa[i<span class="number">-1</span>]]+compare_sa(sa[i<span class="number">-1</span>],sa[i]);</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt;= len;i++) rk[i] = tmp[i];</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">construct_lcp</span><span class="params">(<span class="keyword">int</span> S[],<span class="keyword">int</span> sa[],<span class="keyword">int</span> lcp[])</span></span>&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt;= len;i++) rk[sa[i]] = i;</span><br><span class="line"><span class="keyword">int</span> h = <span class="number">0</span>; lcp[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; len;i++)&#123;</span><br><span class="line"><span class="keyword">int</span> j = sa[rk[i]<span class="number">-1</span>];</span><br><span class="line"><span class="keyword">if</span>(h &gt; <span class="number">0</span>) h--;</span><br><span class="line"><span class="keyword">for</span>(;j + h &lt; len &amp;&amp; i + h &lt; len;h++)</span><br><span class="line"><span class="keyword">if</span>(S[j+h] != S[i+h]) <span class="keyword">break</span>;</span><br><span class="line">lcp[rk[i]<span class="number">-1</span>] = h;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">check</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line"><span class="keyword">int</span> pre = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">if</span>(lcp[<span class="number">1</span>] &gt;= x) pre = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">2</span>;i &lt; len;i++)&#123;</span><br><span class="line"><span class="keyword">if</span>(!pre &amp;&amp; lcp[i] &gt;= x) pre = i;</span><br><span class="line"><span class="keyword">if</span>(lcp[i<span class="number">-1</span>] &gt;= x)<span class="comment">//æ³¨æ„ä¸€ä¸‹åˆ°åº•æ˜¯iè¿˜æ˜¯i-1</span></span><br><span class="line"><span class="keyword">if</span>(<span class="built_in">abs</span>(sa[pre] - sa[i]) &gt; x) <span class="keyword">return</span> <span class="literal">true</span>; </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span></span>&#123;</span><br><span class="line">construct_sa(a,sa);</span><br><span class="line">construct_lcp(a,sa,lcp);</span><br><span class="line"><span class="keyword">int</span> l = <span class="number">0</span>,r = n;</span><br><span class="line"><span class="keyword">while</span>(l &lt;= r)&#123;</span><br><span class="line"><span class="keyword">int</span> mid = l+r&gt;&gt;<span class="number">1</span>;</span><br><span class="line"><span class="keyword">if</span>(check(mid)) l = mid+<span class="number">1</span>;</span><br><span class="line"><span class="keyword">else</span> r = mid<span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(++r &lt; <span class="number">5</span>) r = <span class="number">0</span>;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%d\n"</span>,r);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">while</span>(<span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;n) &amp;&amp; n)&#123;</span><br><span class="line"><span class="comment">//æ³¨æ„ï¼Œè¯¥æ¨¡æ¿å¿…é¡»ä»ä¸‹æ ‡0å¼€å§‹å­˜ï¼</span></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; n;i++) b[i] = getInt();</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt; n;i++) a[i] = b[i]-b[i<span class="number">-1</span>]+<span class="number">100</span>;</span><br><span class="line">a[<span class="number">0</span>] = b[<span class="number">0</span>]+<span class="number">100</span>; solve();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h4 id="Milk-Patterns"><a href="#Milk-Patterns" class="headerlink" title="Milk Patterns"></a>Milk Patterns</h4><p><a href="http://poj.org/problem?id=3261" target="_blank" rel="noopener">æµ‹è¯•åœ°å€</a><br><strong>é¢˜æ„ç®€è¿°</strong><br>æ±‚å¯é‡å çš„ï¼Œå‡ºç°kæ¬¡çš„æœ€é•¿é‡å¤å­ä¸²ã€‚<br><strong>è§£é¢˜æ€è·¯</strong><br>è¿™ä¸ªå°±æ˜¯å¯é‡å çš„æœ€é•¿é‡å¤å­ä¸²äº†ï¼Œè¦æ±‚æ±‚å‡ºæœ€é•¿çš„ï¼Œé‡å¤å‡ºç°kæ¬¡ä»¥ä¸Šçš„å­ä¸²ï¼Œé€šè¿‡é¢˜æ„ä»¥åŠæ ·ä¾‹è§‚å¯Ÿå¯çŸ¥ï¼Œæ˜¯å…è®¸å­ä¸²é‡å¤çš„ã€‚è§£å†³æ–¹æ³•å’Œä¸Šé¢˜ç±»ä¼¼ï¼Œä¹Ÿæ˜¯åç¼€æ•°ç»„+äºŒåˆ†ã€‚</p><p><strong>ä»£ç ç¤ºä¾‹</strong><br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//POJ3261</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">2e4</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">int</span> n,k,a[N],kk;</span><br><span class="line"><span class="keyword">int</span> rk[N],sa[N],lcp[N],tmp[N];</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">compare_sa</span><span class="params">(<span class="keyword">int</span> i,<span class="keyword">int</span> j)</span></span>&#123;</span><br><span class="line"><span class="keyword">if</span>(rk[i] != rk[j]) <span class="keyword">return</span> rk[i] &lt; rk[j];</span><br><span class="line"><span class="keyword">int</span> ri = i+k &lt;= n?rk[i+k]:<span class="number">-1</span>;</span><br><span class="line"><span class="keyword">int</span> rj = j+k &lt;= n?rk[j+k]:<span class="number">-1</span>;</span><br><span class="line"><span class="keyword">return</span> ri &lt; rj;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">construct_sa</span><span class="params">(<span class="keyword">int</span> S[],<span class="keyword">int</span> sa[])</span></span>&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt;= n;i++)&#123;</span><br><span class="line">sa[i] = i;</span><br><span class="line">rk[i] = i &lt; n?S[i]:<span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//åˆ«æŠŠå…¨å±€å˜é‡çš„kè¦†ç›–äº†ï¼ï¼ï¼</span></span><br><span class="line"><span class="keyword">for</span>(k = <span class="number">1</span>;k &lt;= n;k *= <span class="number">2</span>)&#123;</span><br><span class="line">sort(sa,sa+<span class="number">1</span>+n,compare_sa);</span><br><span class="line">tmp[sa[<span class="number">0</span>]] = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++) </span><br><span class="line">tmp[sa[i]] = tmp[sa[i<span class="number">-1</span>]] + compare_sa(sa[i<span class="number">-1</span>],sa[i]);</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt;= n;i++) rk[i] = tmp[i];</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">construct_lcp</span><span class="params">(<span class="keyword">int</span> S[],<span class="keyword">int</span> sa[],<span class="keyword">int</span> lcp[])</span></span>&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt;= n;i++) rk[sa[i]] = i;</span><br><span class="line"><span class="keyword">int</span> h = <span class="number">0</span>; lcp[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; n;i++)&#123;</span><br><span class="line"><span class="keyword">int</span> j = sa[rk[i]<span class="number">-1</span>];</span><br><span class="line"><span class="keyword">if</span>(h &gt; <span class="number">0</span>) h--;</span><br><span class="line"><span class="keyword">for</span>(;j+h &lt; n &amp;&amp; i+h &lt; n;h++)</span><br><span class="line"><span class="keyword">if</span>(S[j+h] != S[i+h]) <span class="keyword">break</span>;</span><br><span class="line">lcp[rk[i]<span class="number">-1</span>] = h;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">check</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line"><span class="keyword">int</span> cnt = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">2</span>;i &lt;= n;i++)&#123;</span><br><span class="line"><span class="keyword">if</span>(lcp[i<span class="number">-1</span>] &gt;= x) cnt++;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line"><span class="keyword">if</span>(cnt &gt;= kk) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">cnt = <span class="number">1</span>;</span><br><span class="line">&#125; </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> cnt &gt;= kk;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span></span>&#123;</span><br><span class="line">construct_sa(a,sa);</span><br><span class="line">construct_lcp(a,sa,lcp);</span><br><span class="line"><span class="keyword">int</span> l = <span class="number">0</span>, r = n;</span><br><span class="line"><span class="comment">//for(int i = 1;i &lt;= n;i++) printf("%d ",lcp[i]);</span></span><br><span class="line"><span class="keyword">while</span>(l &lt;= r)&#123;</span><br><span class="line"><span class="keyword">int</span> mid = l+r&gt;&gt;<span class="number">1</span>;</span><br><span class="line"><span class="keyword">if</span>(check(mid)) l = mid+<span class="number">1</span>;</span><br><span class="line"><span class="keyword">else</span> r = mid<span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%d\n"</span>,r);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">while</span>(<span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;n,&amp;kk) != EOF)&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; n;i++) <span class="built_in">scanf</span>(<span class="string">"%d"</span>,a+i);</span><br><span class="line">solve();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h4 id="ä¸åŒå­ä¸²çš„ä¸ªæ•°"><a href="#ä¸åŒå­ä¸²çš„ä¸ªæ•°" class="headerlink" title="ä¸åŒå­ä¸²çš„ä¸ªæ•°"></a>ä¸åŒå­ä¸²çš„ä¸ªæ•°</h4><p><a href="https://www.luogu.org/problem/P2408" target="_blank" rel="noopener">æµ‹è¯•åœ°å€</a><br><strong>é¢˜æ„ç®€è¿°</strong><br>ç»™å®šä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œæ±‚å…¶æ‰€æœ‰å­ä¸²ä¸­ï¼Œä¸åŒçš„å­ä¸²æ•°é‡ã€‚</p><p><strong>è§£é¢˜æ€è·¯</strong><br>åˆ©ç”¨åç¼€æ•°ç»„+é«˜åº¦æ•°ç»„æ±‚è§£ã€‚å·²çŸ¥é«˜åº¦æ•°ç»„lcpï¼Œé‚£ä¹ˆé¦–å…ˆå¯ä»¥çŸ¥é“ç¬¬ä¸€ä¸ªsa[1]æœ‰n - sa[1]ä¸ªä¸åŒå­ä¸²ï¼›è€Œ2~nï¼Œæ¯ä¸ªsa[i] æœ‰ n - sa[i] - lcp[i-1] ä¸ªä¸åŒå­ä¸²ã€‚ç´¯åŠ å³å¯ï¼Œæ³¨æ„ç»“æœå¯èƒ½çˆ† intã€‚</p><p><strong>ä»£ç ç¤ºä¾‹</strong><br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//P2408ä¸åŒå­ä¸²çš„ä¸ªæ•°</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1e5</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">char</span> str[N];</span><br><span class="line"><span class="keyword">int</span> n;</span><br><span class="line"><span class="keyword">int</span> sa[N],lcp[N],tmp[N],k,rk[N];</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">compare_sa</span><span class="params">(<span class="keyword">int</span> i,<span class="keyword">int</span> j)</span></span>&#123;</span><br><span class="line"><span class="keyword">if</span>(rk[i] != rk[j]) <span class="keyword">return</span> rk[i] &lt; rk[j];</span><br><span class="line"><span class="keyword">int</span> ri = i+k &lt;= n?rk[i+k]:<span class="number">-1</span>;</span><br><span class="line"><span class="keyword">int</span> rj = j+k &lt;= n?rk[j+k]:<span class="number">-1</span>;</span><br><span class="line"><span class="keyword">return</span> ri &lt; rj;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">construct_sa</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> *S,<span class="keyword">int</span> sa[])</span></span>&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt;= n;i++)&#123;</span><br><span class="line">sa[i] = i;</span><br><span class="line">rk[i] = i &lt; n?S[i]:<span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span>(k = <span class="number">1</span>;k &lt;= n;k *= <span class="number">2</span>)&#123;</span><br><span class="line">sort(sa,sa+<span class="number">1</span>+n,compare_sa);</span><br><span class="line">tmp[sa[<span class="number">0</span>]] = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++) </span><br><span class="line">tmp[sa[i]] = tmp[sa[i<span class="number">-1</span>]] + compare_sa(sa[i<span class="number">-1</span>],sa[i]);</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt;= n;i++) rk[i] = tmp[i];</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">construct_lcp</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span>* S,<span class="keyword">int</span> sa[],<span class="keyword">int</span> lcp[])</span></span>&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt;= n;i++) rk[sa[i]] = i;</span><br><span class="line"><span class="keyword">int</span> h = <span class="number">0</span>; lcp[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; n;i++)&#123;</span><br><span class="line"><span class="keyword">int</span> j = sa[rk[i]<span class="number">-1</span>];</span><br><span class="line"><span class="keyword">if</span>(h &gt; <span class="number">0</span>) h--;</span><br><span class="line"><span class="keyword">for</span>(;j+h &lt; n &amp;&amp; i+h &lt; n;h++)</span><br><span class="line"><span class="keyword">if</span>(S[j+h] != S[i+h]) <span class="keyword">break</span>;</span><br><span class="line">lcp[rk[i]<span class="number">-1</span>] = h;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">ll sum = <span class="number">0</span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">calc</span><span class="params">()</span></span>&#123;</span><br><span class="line">sum = n - sa[<span class="number">1</span>];</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">2</span>;i &lt;= n;i++)</span><br><span class="line">sum += n - sa[i] - lcp[i<span class="number">-1</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span></span>&#123;</span><br><span class="line">construct_sa(str,sa);</span><br><span class="line">construct_lcp(str,sa,lcp);</span><br><span class="line">calc();</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%lld\n"</span>,sum);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> LOCAL</span></span><br><span class="line">freopen(<span class="string">"123.txt"</span>,<span class="string">"r"</span>,<span class="built_in">stdin</span>);</span><br><span class="line">freopen(<span class="string">"222.txt"</span>,<span class="string">"w"</span>,<span class="built_in">stdout</span>);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"><span class="keyword">while</span>(~<span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;n))&#123;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%s"</span>,str);</span><br><span class="line">solve();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h4 id="Substring"><a href="#Substring" class="headerlink" title="Substring"></a>Substring</h4><p><a href="http://acm.hdu.edu.cn/showproblem.php?pid=5769" target="_blank" rel="noopener">æµ‹è¯•åœ°å€</a><br><strong>é¢˜æ„ç®€è¿°</strong><br>ç»™å®šä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œæ±‚æ‰€æœ‰ä¸åŒçš„ï¼Œä¸”åŒ…å«<strong>å­—ç¬¦x</strong>çš„å­ä¸²æ•°é‡ã€‚</p><p><strong>è§£é¢˜æ€è·¯</strong><br>å’Œä¸Šä¸€é¢˜æœ‰äº›ç±»ä¼¼ï¼Œä½†æ˜¯æˆ‘ä»¬éœ€è¦ç¡®ä¿æ¯ä¸€ä¸ªè¢«ç»Ÿè®¡çš„å­ä¸²åŒ…å«å­—ç¬¦xã€‚é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ç”¨ä¸€ä¸ªæ•°ç»„pos[p]æ¥è®°å½• p åé¢ç¬¬ä¸€ä¸ªå­—ç¬¦ x çš„ä½ç½®ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä»å¤´å¼€å§‹ç»Ÿè®¡æ—¶ï¼Œsa[1]æœ‰n - pos[ sa[1] ] ä¸ªåˆæ³•å­ä¸²ï¼Œå…¶å®ƒä½ç½®æœ‰ n - max(pos[ sa[i] ] , sa[i] + lcp[i])ä¸ªåˆæ³•å­ä¸²ï¼Œå°†å®ƒä»¬ç´¯åŠ èµ·æ¥å³å¯ã€‚<br>è¿™é¢˜é€‰G++ç¼–è¯‘å™¨å°±è¶…æ—¶ï¼Œé€‰C++å°±å¯ä»¥é€šè¿‡ï¼ŒçŒœæµ‹å¯èƒ½å’ŒSTLæœ‰å…³ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Hdu5769,G++è¶…æ—¶,C++AC</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1e5</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">int</span> t,n;</span><br><span class="line"><span class="keyword">char</span> str[N],lv[<span class="number">3</span>];</span><br><span class="line"><span class="keyword">int</span> rk[N],sa[N],lcp[N],tmp[N],k;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">bool</span> <span class="title">compare_sa</span><span class="params">(<span class="keyword">int</span> i,<span class="keyword">int</span> j)</span></span>&#123;</span><br><span class="line"><span class="keyword">if</span>(rk[i] != rk[j]) <span class="keyword">return</span> rk[i] &lt; rk[j];</span><br><span class="line"><span class="keyword">int</span> ri = i+k &lt;= n?rk[i+k]:<span class="number">-1</span>;</span><br><span class="line"><span class="keyword">int</span> rj = j+k &lt;= n?rk[j+k]:<span class="number">-1</span>;</span><br><span class="line"><span class="keyword">return</span> ri &lt; rj;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">construct_sa</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span>* S,<span class="keyword">int</span> sa[])</span></span>&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt;= n;i++)&#123;</span><br><span class="line">sa[i] = i;</span><br><span class="line">rk[i] = i &lt; n?S[i]:<span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span>(k = <span class="number">1</span>;k &lt;= n;k *= <span class="number">2</span>)&#123;</span><br><span class="line">sort(sa,sa+<span class="number">1</span>+n,compare_sa);</span><br><span class="line">tmp[sa[<span class="number">0</span>]] = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++)</span><br><span class="line">tmp[sa[i]] = tmp[sa[i<span class="number">-1</span>]] + compare_sa(sa[i<span class="number">-1</span>],sa[i]);</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt;= n;i++) rk[i] = tmp[i];</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">construct_lcp</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span>* S,<span class="keyword">int</span> sa[],<span class="keyword">int</span> lcp[])</span></span>&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt;= n;i++) rk[sa[i]] = i;</span><br><span class="line"><span class="keyword">int</span> h = <span class="number">0</span>; lcp[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; n;i++)&#123;</span><br><span class="line"><span class="keyword">int</span> j = sa[rk[i]<span class="number">-1</span>];</span><br><span class="line"><span class="keyword">if</span>(h &gt; <span class="number">0</span>) h--;</span><br><span class="line"><span class="keyword">for</span>(;j+h &lt; n &amp;&amp; i+h &lt; n;h++)</span><br><span class="line"><span class="keyword">if</span>(S[j+h] != S[i+h]) <span class="keyword">break</span>;</span><br><span class="line">lcp[rk[i]<span class="number">-1</span>] = h;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> pos[N];<span class="comment">//pos[x]:xåé¢ç¬¬ä¸€ä¸ªlvå‡ºç°çš„ä½ç½®</span></span><br><span class="line"><span class="keyword">long</span> <span class="keyword">long</span> sum = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">int</span> idx = <span class="number">0</span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span></span>&#123;</span><br><span class="line">construct_sa(str,sa);</span><br><span class="line">construct_lcp(str,sa,lcp);</span><br><span class="line">pos[n] = n;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = n<span class="number">-1</span>;i &gt;= <span class="number">0</span>;i--)</span><br><span class="line"><span class="keyword">if</span>(str[i] == lv[<span class="number">0</span>]) pos[i] = i;</span><br><span class="line"><span class="keyword">else</span> pos[i] = pos[i+<span class="number">1</span>];</span><br><span class="line">sum = n - pos[sa[<span class="number">1</span>]];</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">2</span>;i &lt;= n;i++)</span><br><span class="line">sum += n - max(pos[sa[i]],sa[i]+lcp[i<span class="number">-1</span>]);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"Case #%d: %lld\n"</span>,++idx,sum);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> LOCAL</span></span><br><span class="line">freopen(<span class="string">"123.txt"</span>,<span class="string">"r"</span>,<span class="built_in">stdin</span>);</span><br><span class="line">freopen(<span class="string">"222.txt"</span>,<span class="string">"w"</span>,<span class="built_in">stdout</span>);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;t);</span><br><span class="line"><span class="keyword">while</span>(t--)&#123;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%s%s"</span>,lv,str);</span><br><span class="line">n = <span class="built_in">strlen</span>(str);</span><br><span class="line">solve();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Life-Forms"><a href="#Life-Forms" class="headerlink" title="Life Forms"></a>Life Forms</h4><p><a href="http://poj.org/problem?id=3294" target="_blank" rel="noopener">æµ‹è¯•åœ°å€</a><br><strong>é¢˜æ„ç®€è¿°</strong><br>ç»™å®šnä¸ªå­—ç¬¦ä¸²ï¼Œè¯·é—®å®ƒä»¬ä¹‹é—´å‡ºç°æ¬¡æ•°è¶…è¿‡ä¸€åŠçš„æœ€é•¿å…¬å…±å­ä¸²æ˜¯ä»€ä¹ˆï¼Ÿå¦‚æœæœ‰å¤šä¸ªï¼ŒæŒ‰å­—å…¸åºè¾“å‡ºã€‚</p><p><strong>è§£é¢˜æ€è·¯</strong><br>åˆ©ç”¨åç¼€æ•°ç»„+é«˜åº¦æ•°ç»„æ±‚è§£ã€‚æˆ‘ä»¬å°†nä¸ªå­—ç¬¦ä¸²æ‹¼æ¥ä¸­ä¸€ä¸ªâ€œæ¯ä¸²â€ï¼Œä¸­é—´ç”¨ä¸åŒçš„å­—ç¬¦é—´éš”ï¼›ç„¶åå¯¹æ¯ä¸²æ±‚é«˜åº¦æ•°ç»„lcpï¼Œæˆ‘ä»¬ä¾æ—§æ˜¯ç”¨äºŒåˆ†æœç´¢åˆ¤å®šé•¿åº¦pæ˜¯å¦åˆæ³•ï¼Œæ¯æ¬¡åˆ¤å®šä»å‰å‘åç”¨O(N)æ—¶é—´éå†ç»Ÿè®¡ä¸€éå³å¯ã€‚å½“æˆ‘ä»¬å¾—åˆ°æœ€é•¿çš„åˆæ³•é•¿åº¦ p åï¼Œå†åˆ©ç”¨ç±»ä¼¼çš„æ–¹æ³•è¾“å‡ºæ‰€æœ‰çš„å­ä¸²ã€‚</p><p><strong>ä»£ç ç¤ºä¾‹</strong></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="built_in">string</span> str,s;</span><br><span class="line"><span class="keyword">int</span> n,k,len;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">2e5</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">int</span> sa[N],rk[N],lcp[N],tmp[N];</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">compare_sa</span><span class="params">(<span class="keyword">int</span> i,<span class="keyword">int</span> j)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(rk[i] != rk[j]) <span class="keyword">return</span> rk[i] &lt; rk[j];</span><br><span class="line">    <span class="keyword">int</span> ri = i+k &lt;= len?rk[i+k]:<span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">int</span> rj = j+k &lt;= len?rk[j+k]:<span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">return</span> ri &lt; rj;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">construct_sa</span><span class="params">(<span class="built_in">string</span> S,<span class="keyword">int</span> sa[])</span></span>&#123;</span><br><span class="line">    len = S.length();</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt;= len;i++)&#123;</span><br><span class="line">        sa[i] = i;</span><br><span class="line">        rk[i] = i &lt; len ? S[i]:<span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//kä¸€å®šä¸èƒ½è®¾ç½®æˆå±€éƒ¨å˜é‡å¯¼è‡´è¦†ç›–å…¨å±€å˜é‡ï¼ï¼ï¼</span></span><br><span class="line">    <span class="keyword">for</span>(k = <span class="number">1</span>;k &lt;= len;k *= <span class="number">2</span>)&#123;</span><br><span class="line">        sort(sa,sa+len+<span class="number">1</span>,compare_sa);</span><br><span class="line">        tmp[sa[<span class="number">0</span>]] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= len;i++)</span><br><span class="line">            tmp[sa[i]] = tmp[sa[i<span class="number">-1</span>]] + compare_sa(sa[i<span class="number">-1</span>],sa[i]);</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt;= len;i++) rk[i] = tmp[i];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">construct_lcp</span><span class="params">(<span class="built_in">string</span> S,<span class="keyword">int</span> sa[],<span class="keyword">int</span> lcp[])</span></span>&#123;</span><br><span class="line">    len = S.length();</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt;= len;i++) rk[sa[i]] = i;</span><br><span class="line">    <span class="keyword">int</span> h = <span class="number">0</span>; lcp[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; len;i++)&#123;</span><br><span class="line">        <span class="keyword">int</span> j = sa[rk[i]<span class="number">-1</span>];</span><br><span class="line">        <span class="keyword">if</span>(h &gt; <span class="number">0</span>) h--;</span><br><span class="line">        <span class="keyword">for</span>(;j+h &lt; len &amp;&amp; i+h &lt; len;h++)</span><br><span class="line">            <span class="keyword">if</span>(S[j+h] != S[i+h]) <span class="keyword">break</span>;</span><br><span class="line">        lcp[rk[i]<span class="number">-1</span>] = h;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> vis[<span class="number">110</span>],idx[N];</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">check</span><span class="params">(<span class="keyword">int</span> p)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> cnt = <span class="number">1</span>; <span class="built_in">memset</span>(vis,<span class="number">0</span>,<span class="keyword">sizeof</span> vis);</span><br><span class="line">    vis[idx[sa[<span class="number">1</span>]]] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">2</span>;i &lt;= len;i++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(lcp[i<span class="number">-1</span>] &lt; p)&#123;</span><br><span class="line">            cnt = <span class="number">1</span>; <span class="built_in">memset</span>(vis,<span class="number">0</span>,<span class="keyword">sizeof</span> vis);vis[idx[sa[i]]] = <span class="number">1</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(!vis[idx[sa[i]]]) cnt++,vis[idx[sa[i]]] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(cnt &gt;= n/<span class="number">2</span>+<span class="number">1</span>) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">print</span><span class="params">(<span class="keyword">int</span> p)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> cnt = <span class="number">1</span>; <span class="built_in">memset</span>(vis,<span class="number">0</span>,<span class="keyword">sizeof</span> vis);</span><br><span class="line">    vis[idx[sa[<span class="number">1</span>]]] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">2</span>;i &lt;= len+<span class="number">1</span>;i++)&#123;  <span class="comment">//lcp[len+1] = 0,ä½œä¸ºç»“æŸæ ‡å¿—</span></span><br><span class="line">        <span class="keyword">if</span>(lcp[i<span class="number">-1</span>] &lt; p)&#123;</span><br><span class="line">            <span class="keyword">if</span>(cnt &gt;= n/<span class="number">2</span>+<span class="number">1</span>) &#123;</span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> j = sa[i<span class="number">-1</span>];j &lt; sa[i<span class="number">-1</span>]+p;j++) <span class="built_in">cout</span> &lt;&lt; str[j];</span><br><span class="line">                <span class="built_in">cout</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            cnt = <span class="number">1</span>; <span class="built_in">memset</span>(vis,<span class="number">0</span>,<span class="keyword">sizeof</span> vis);vis[idx[sa[i]]] = <span class="number">1</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(!vis[idx[sa[i]]]) cnt++,vis[idx[sa[i]]] = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span></span>&#123;</span><br><span class="line">    construct_sa(str,sa);</span><br><span class="line">    construct_lcp(str,sa,lcp);</span><br><span class="line">    <span class="comment">/*sa[i]ï¼šå­˜æ”¾æ’åç¬¬içš„åç¼€çš„èµ·å§‹ä½ç½®*/</span></span><br><span class="line">    <span class="keyword">int</span> l = <span class="number">0</span>, r = len;</span><br><span class="line">    <span class="keyword">while</span>(l &lt;= r)&#123;</span><br><span class="line">        <span class="keyword">int</span> mid = l+r&gt;&gt;<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(check(mid)) l = mid+<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">else</span> r = mid<span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(r &lt;= <span class="number">0</span>) <span class="built_in">cout</span> &lt;&lt; <span class="string">"?"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="keyword">else</span> print(r);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">while</span>(<span class="built_in">cin</span> &gt;&gt; n &amp;&amp; n)&#123;</span><br><span class="line">        <span class="keyword">if</span>(n == <span class="number">1</span>)&#123;</span><br><span class="line">            <span class="built_in">cin</span> &gt;&gt; str; <span class="built_in">cout</span> &lt;&lt; str &lt;&lt; <span class="built_in">endl</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">int</span> cnt = <span class="number">2</span>,tot = <span class="number">0</span>; str = <span class="string">""</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++)&#123;</span><br><span class="line">            <span class="built_in">cin</span> &gt;&gt; s; str += s+<span class="keyword">char</span>(++cnt);</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span>;j &lt;= s.length();j++) idx[tot++] = i;</span><br><span class="line">        &#125; </span><br><span class="line">        solve();</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Maximum-repetition-substring"><a href="#Maximum-repetition-substring" class="headerlink" title="Maximum repetition substring"></a>Maximum repetition substring</h4><p><strong>é¢˜æ„ç®€è¿°</strong><br>æ±‚ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­ï¼Œé‡å¤æ¬¡æ•°æœ€å¤šçš„è¿ç»­é‡å¤å­ä¸²æ˜¯ä»€ä¹ˆï¼ˆå¾ªç¯æ¬¡æ•°æœ€å¤šçš„å¾ªç¯å­ä¸²ï¼‰ã€‚è¦æ±‚è¾“å‡ºå­—å…¸åºæœ€å°çš„ã€‚</p><p>ä¾‹å¦‚ï¼šccabababcä¸­ï¼Œè¿ç»­å¾ªç¯æ¬¡æ•°æœ€å¤šçš„å­ä¸²æ˜¯abababã€‚</p><p><strong>è§£é¢˜æ€è·¯</strong><br>è¿™é¢˜æˆ‘å¯¹ç…§é¢˜è§£å†™äº†å¾ˆä¹…ï¼Œæ€æƒ³å‹‰å¼ºææ‡‚ã€‚<br>å…ˆè¯´åšæ³•ï¼Œæ˜¯æšä¸¾é•¿åº¦lenï¼ˆä»1åˆ°nï¼‰ï¼Œç„¶ååˆ¤æ–­ä»¥ len ä¸ºå¾ªç¯é•¿åº¦çš„ è¿ç»­å¾ªç¯æ¬¡æ•° æœ€å¤šçš„ å­ä¸² é•¿åº¦ æ˜¯å¤šå°‘ï¼›å‡è®¾è¿™ä¸ªå­ä¸²é•¿åº¦æ˜¯ l ï¼Œé‚£ä¹ˆå®ƒçš„è¿ç»­å¾ªç¯æ¬¡æ•°å°±æ˜¯ l/lenã€‚<br>æˆ‘ä»¬è€ƒè™‘å¦‚ä½•æ±‚å­ä¸²é•¿åº¦ l ã€‚å¦‚æœæœ‰ä¸€ä¸ªå­—ç¬¦ä¸²çš„å¾ªç¯èŠ‚é•¿åº¦ä¸ºlenï¼Œé‚£ä¹ˆå¿…ç„¶æœ‰s[1,n-len] = s[len , n]ï¼Œå› æ­¤ï¼Œå¦‚æœå­—ç¬¦ä¸² s[len, n] ä¸ s[ 2 <em> len, n] çš„å…¬å…±å‰ç¼€é•¿åº¦ä¸º lcpï¼Œé‚£ä¹ˆ s[len ,n] çš„å¾ªç¯èŠ‚ä¸ªæ•°ä¸ºlcp / len + 1ï¼ˆåŠ ä¸Šçš„ä¸€ä¸ªæ˜¯å¼€å¤´ä¸ºè®¡ç®—åœ¨lcpå†…çš„å¾ªç¯èŠ‚ ï¼‰ã€‚<br>å› æ­¤æˆ‘ä»¬åªéœ€è¦å¯¹s[0] , s[len] ,s[2 </em> len] â€¦ , åˆ¤æ–­ç›¸å·® len çš„ä¸¤ä¸ªç›¸é‚»åç¼€çš„ lcpï¼Œå°±å¯ä»¥è®¡ç®—è¯¥å­ä¸²å¾ªç¯èŠ‚ä¸ªæ•°ã€‚è¿™æ˜¯ç”±äºå¦‚æœä¸€ä¸ªå­ä¸²çš„å¾ªç¯èŠ‚é•¿åº¦ä¸º lenï¼Œä¸”å¾ªç¯è‡³å°‘ä¸¤æ¬¡ï¼Œé‚£ä¹ˆæ˜¾ç„¶å®ƒä¼šåŒ…å«ç›¸é‚»çš„ä¸¤ä¸ªlenï¼Œå¦åˆ™å°±æ„ä¸æˆå¾ªç¯äº†ã€‚å½“ç„¶å¯èƒ½èµ·ç‚¹å¹¶ä¸åœ¨lençš„å€æ•°ä½ç½®ä¸Šï¼Œå› æ­¤æˆ‘ä»¬è¿˜éœ€è¦å‘å‰æ‹“å±•ä¸€ä¸‹ã€‚</p><p><strong>ä»£ç ç¤ºä¾‹</strong><br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1e5</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">char</span> str[N];</span><br><span class="line"><span class="keyword">int</span> cse = <span class="number">0</span>,n;</span><br><span class="line"><span class="keyword">int</span> k,rk[N],lcp[N],sa[N],tmp[N];</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">compare_sa</span><span class="params">(<span class="keyword">int</span> i,<span class="keyword">int</span> j)</span></span>&#123;</span><br><span class="line"><span class="keyword">if</span>(rk[i] != rk[j]) <span class="keyword">return</span> rk[i] &lt; rk[j];</span><br><span class="line"><span class="keyword">int</span> ri = i+k &lt;= n?rk[i+k]:<span class="number">-1</span>;</span><br><span class="line"><span class="keyword">int</span> rj = j+k &lt;= n?rk[j+k]:<span class="number">-1</span>;</span><br><span class="line"><span class="keyword">return</span> ri &lt; rj;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">construct_sa</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span>* S,<span class="keyword">int</span> sa[])</span></span>&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt;= n;i++)&#123;</span><br><span class="line">sa[i] = i;</span><br><span class="line">rk[i] = i &lt; n?S[i]:<span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span>(k = <span class="number">1</span>;k &lt;= n;k *= <span class="number">2</span>)&#123;</span><br><span class="line">sort(sa,sa+<span class="number">1</span>+n,compare_sa);</span><br><span class="line">tmp[sa[<span class="number">0</span>]] = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++)</span><br><span class="line">tmp[sa[i]] = tmp[sa[i<span class="number">-1</span>]]+compare_sa(sa[i<span class="number">-1</span>],sa[i]);</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt;= n;i++) rk[i] = tmp[i];</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">construct_lcp</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span>* S,<span class="keyword">int</span> sa[],<span class="keyword">int</span> lcp[])</span></span>&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt;= n;i++) rk[sa[i]] = i;</span><br><span class="line"><span class="keyword">int</span> h = <span class="number">0</span>; lcp[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; n;i++)&#123;</span><br><span class="line"><span class="keyword">int</span> j = sa[rk[i]<span class="number">-1</span>];</span><br><span class="line"><span class="keyword">if</span>(h &gt; <span class="number">0</span>) h--;</span><br><span class="line"><span class="keyword">for</span>(;j+h &lt; n &amp;&amp; i+h &lt; n;h++)</span><br><span class="line"><span class="keyword">if</span>(S[j+h] != S[i+h]) <span class="keyword">break</span>;</span><br><span class="line">lcp[rk[i]<span class="number">-1</span>] = h;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> st[N][<span class="number">22</span>],Log[N];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">st_init</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++) st[i][<span class="number">0</span>] = lcp[i];</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">2</span>;i &lt;= n;i++) Log[i] = Log[i/<span class="number">2</span>]+<span class="number">1</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">1</span>;(<span class="number">1</span>&lt;&lt;j) &lt;= n;j++)&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i + (<span class="number">1</span>&lt;&lt;j<span class="number">-1</span>) &lt;= n;i++)</span><br><span class="line">st[i][j] = min(st[i][j<span class="number">-1</span>],st[i+(<span class="number">1</span>&lt;&lt;j<span class="number">-1</span>)][j<span class="number">-1</span>]);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">ask</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r)</span></span>&#123;</span><br><span class="line"><span class="keyword">if</span>(l &gt; r) swap(l,r); r--;</span><br><span class="line"><span class="keyword">int</span> kk = Log[r-l+<span class="number">1</span>];</span><br><span class="line"><span class="keyword">return</span> min(st[l][kk],st[r-(<span class="number">1</span>&lt;&lt;kk)+<span class="number">1</span>][kk]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> mxtc = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">int</span> q[N],cnt = <span class="number">0</span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">calc</span><span class="params">(<span class="keyword">int</span> len)</span></span>&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i+len &lt; n;i += len)&#123;</span><br><span class="line"><span class="keyword">int</span> l = ask(rk[i],rk[i+len]);</span><br><span class="line"><span class="keyword">int</span> res = l/len+<span class="number">1</span>;</span><br><span class="line"><span class="keyword">int</span> pre = i - (len-l%len);</span><br><span class="line"><span class="keyword">if</span>(pre &gt;= <span class="number">0</span> &amp;&amp; ask(rk[pre],rk[pre+len]) &gt;= len) res++;</span><br><span class="line"><span class="keyword">if</span>(mxtc &lt; res) mxtc = res,cnt = <span class="number">0</span>,q[++cnt] = len;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span>(mxtc == res &amp;&amp; len != q[cnt]) q[++cnt] = len;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">printAns</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++)</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">1</span>;j &lt;= cnt;j++)</span><br><span class="line"><span class="keyword">if</span>(ask(rk[sa[i]],rk[sa[i]+q[j]]) &gt;= q[j]*(mxtc<span class="number">-1</span>))&#123;</span><br><span class="line">str[sa[i]+q[j]*mxtc] = <span class="string">'\0'</span>;</span><br><span class="line"><span class="built_in">puts</span>(str+sa[i]); <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span></span>&#123;</span><br><span class="line">construct_sa(str,sa);</span><br><span class="line">construct_lcp(str,sa,lcp);<span class="comment">//lcp[n]æ˜¯æ’ç­‰äº0çš„</span></span><br><span class="line"><span class="comment">/*ä¸‹ä¸€æ­¥æ±‚é‡å¤æ¬¡æ•°æœ€å¤šçš„è¿ç»­é‡å¤å­ä¸²*/</span></span><br><span class="line">st_init();</span><br><span class="line">mxtc = cnt = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++) calc(i); </span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"Case %d: "</span>,++cse);</span><br><span class="line">printAns();</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">while</span>(<span class="built_in">scanf</span>(<span class="string">"%s"</span>,str) != EOF)&#123;</span><br><span class="line">n = <span class="built_in">strlen</span>(str);</span><br><span class="line"><span class="keyword">if</span>(n == <span class="number">1</span> &amp;&amp; str[<span class="number">0</span>] == <span class="string">'#'</span>) <span class="keyword">break</span>;</span><br><span class="line">solve();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h4 id="Common-Substrings"><a href="#Common-Substrings" class="headerlink" title="Common Substrings"></a>Common Substrings</h4><p><a href="http://poj.org/problem?id=3415" target="_blank" rel="noopener">æµ‹è¯•åœ°å€</a><br><strong>é¢˜æ„ç®€è¿°</strong><br>ç»™å®š2ä¸ªå­—ç¬¦ä¸²Aå’ŒBï¼Œä»¥åŠä¸€ä¸ªæ•´æ•°kã€‚ç›®æ ‡æ˜¯æ±‚å‡ºè¿™ä¸¤ä¸ªå­—ç¬¦ä¸²ä¸­å…¬å…±å­ä¸²çš„æ•°é‡ï¼Œä¾‹å¦‚A:xx , B:xxï¼Œk = 1ï¼Œé‚£ä¹ˆå…¬å…±å­ä¸²æ•°é‡å°±æ˜¯5ã€‚<br><strong>è§£é¢˜æ€è·¯</strong><br>å°†Aå’ŒBæ‹¼æ¥åœ¨ä¸€èµ·ï¼Œä¸­é—´ç”¨ä¸€ä¸ªæœªå‡ºç°è¿‡çš„å­—ç¬¦é—´éš”ï¼Œæ–°ä¸²S = A+â€™#â€™+Bï¼›ç„¶åå¯¹Sæ±‚é«˜åº¦æ•°ç»„ï¼Œåˆ©ç”¨é«˜åº¦æ•°ç»„æ¥æ±‚è§£ã€‚<br>å¯¹äºå±äº B çš„æ¯ä¸€ä¸ªåç¼€ï¼Œç»Ÿè®¡å®ƒä¸æ‰€æœ‰å±äº A çš„åç¼€çš„ lcpï¼ˆæœ€é•¿å…¬å…±å‰ç¼€ï¼‰ï¼Œå¹¶ç»Ÿè®¡lcp-m+1ï¼Œè¿™å°±æ˜¯è¯¥åç¼€å’Œ A çš„å…¬å…±å­ä¸²æ•°é‡ã€‚è¿™æ ·åšçš„å¤æ‚åº¦æ˜¯O(N^2)ã€‚</p><p>æˆ‘ä»¬å¯ä»¥åˆ©ç”¨å•è°ƒæ ˆæ¥åœ¨ O(N) æ—¶é—´å†…è§£å†³ï¼›æˆ‘ä»¬ä»å‰å‘åéå†lcpæ•°ç»„ï¼Œå°†å±äºAçš„åç¼€çš„ lcp å‹å…¥æ ˆï¼›ç”±äºä¸¤ä¸ªå­—ç¬¦ä¸²çš„åç¼€æ˜¯å–å®ƒä»¬ä¸­é—´çš„æœ€å°å€¼ï¼Œæ‰€ä»¥æˆ‘ä»¬åº”è¯¥ç»´æŠ¤å•è°ƒé€’å‡æ ˆï¼ŒåŒæ—¶éœ€è¦ç»´æŠ¤çš„æ˜¯ sumï¼Œsumä»£è¡¨å½“å‰ A ä¸­ç›¸åŒçš„å­ä¸²æ•°é‡ï¼Œä¹Ÿå°±æ˜¯è¯´å¦‚æœå½“å‰åç¼€å±äº B ï¼Œåˆ™ç›´æ¥åŠ ä¸Šsumå³å¯ã€‚</p><p>ç”±äºæˆ‘ä»¬æ˜¯é¡ºåºéå†çš„ï¼Œåªç»Ÿè®¡äº†Aå¯¹Bçš„è´¡çŒ®ï¼Œå†åè¿‡æ¥ç»Ÿè®¡ä¸€æ¬¡Bå¯¹Açš„è´¡çŒ®å³å¯ã€‚<br><strong>ä»£ç ç¤ºä¾‹</strong></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">2e5</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">char</span> A[N],B[N];</span><br><span class="line"><span class="keyword">int</span> rk[N],tmp[N],lcp[N],sa[N],k;</span><br><span class="line"><span class="keyword">int</span> n,m;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll;</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">compare_sa</span><span class="params">(<span class="keyword">int</span> i,<span class="keyword">int</span> j)</span></span>&#123;</span><br><span class="line"><span class="keyword">if</span>(rk[i] != rk[j]) <span class="keyword">return</span> rk[i] &lt; rk[j];</span><br><span class="line"><span class="keyword">int</span> ri = i+k &lt;= n?rk[i+k]:<span class="number">-1</span>;</span><br><span class="line"><span class="keyword">int</span> rj = i+k &lt;= n?rk[j+k]:<span class="number">-1</span>;</span><br><span class="line"><span class="keyword">return</span> ri &lt; rj;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">construct_sa</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span>* S,<span class="keyword">int</span> sa[])</span></span>&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt;= n;i++)&#123;</span><br><span class="line">sa[i] = i;</span><br><span class="line">rk[i] = i &lt; n?S[i]:<span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span>(k = <span class="number">1</span>;k &lt;= n;k *= <span class="number">2</span>)&#123;</span><br><span class="line">sort(sa,sa+<span class="number">1</span>+n,compare_sa);</span><br><span class="line">tmp[sa[<span class="number">0</span>]] = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++)</span><br><span class="line">tmp[sa[i]] = tmp[sa[i<span class="number">-1</span>]] + compare_sa(sa[i<span class="number">-1</span>],sa[i]);</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt;= n;i++) rk[i] = tmp[i];</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">construct_lcp</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> *S,<span class="keyword">int</span> sa[],<span class="keyword">int</span> lcp[])</span></span>&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt;= n;i++) rk[sa[i]] = i;</span><br><span class="line"><span class="keyword">int</span> h = <span class="number">0</span>; lcp[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; n;i++)&#123;</span><br><span class="line"><span class="keyword">int</span> j =sa[rk[i]<span class="number">-1</span>];</span><br><span class="line"><span class="keyword">if</span>(h &gt; <span class="number">0</span>) h--;</span><br><span class="line"><span class="keyword">for</span>(;j+h &lt; n &amp;&amp; i+h &lt; n;h++)</span><br><span class="line"><span class="keyword">if</span>(S[j+h] != S[i+h]) <span class="keyword">break</span>;</span><br><span class="line">lcp[rk[i]<span class="number">-1</span>] = h;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> idx[N];<span class="comment">//åˆå§‹åŒ–ä¸º0</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Node</span>&#123;</span></span><br><span class="line">ll h,cnt;</span><br><span class="line">&#125;Stack[N];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span></span>&#123;</span><br><span class="line">construct_sa(A,sa);</span><br><span class="line">construct_lcp(A,sa,lcp);</span><br><span class="line">ll ans = <span class="number">0</span>,sum = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">int</span> top = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">2</span>;i &lt;= n;i++)&#123;</span><br><span class="line">ll cnt = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span>(top &amp;&amp; Stack[top].h &gt;= lcp[i<span class="number">-1</span>])&#123;</span><br><span class="line">cnt += Stack[top].cnt;</span><br><span class="line">sum -= Stack[top].cnt * (Stack[top].h-m+<span class="number">1</span>);</span><br><span class="line">top--;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(lcp[i<span class="number">-1</span>] &gt;= m)&#123;</span><br><span class="line">cnt += idx[sa[i<span class="number">-1</span>]] == <span class="number">0</span>;</span><br><span class="line"><span class="keyword">if</span>(cnt) Stack[++top] = Node&#123;lcp[i<span class="number">-1</span>],cnt&#125;;</span><br><span class="line">sum += (lcp[i<span class="number">-1</span>]-m+<span class="number">1</span>)*cnt;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(idx[sa[i]] == <span class="number">1</span>) ans += sum;</span><br><span class="line">&#125;</span><br><span class="line">top = <span class="number">0</span>; sum = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">2</span>;i &lt;= n;i++)&#123;</span><br><span class="line">ll cnt = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span>(top &amp;&amp; Stack[top].h &gt;= lcp[i<span class="number">-1</span>])&#123;</span><br><span class="line">cnt += Stack[top].cnt;</span><br><span class="line">sum -= Stack[top].cnt * (Stack[top].h-m+<span class="number">1</span>);</span><br><span class="line">top--;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(lcp[i<span class="number">-1</span>] &gt;= m)&#123;</span><br><span class="line">cnt += idx[sa[i<span class="number">-1</span>]] == <span class="number">1</span>;</span><br><span class="line"><span class="keyword">if</span>(cnt) Stack[++top] = Node&#123;lcp[i<span class="number">-1</span>],cnt&#125;;</span><br><span class="line">sum += (lcp[i<span class="number">-1</span>]-m+<span class="number">1</span>)*cnt;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(!idx[sa[i]]) ans += sum;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%lld\n"</span>,ans);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">while</span>(<span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;m) != EOF &amp;&amp; m)&#123;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%s"</span>,A);</span><br><span class="line"><span class="built_in">memset</span>(idx,<span class="number">0</span>,<span class="keyword">sizeof</span> idx);</span><br><span class="line">n = <span class="built_in">strlen</span>(A); </span><br><span class="line">idx[n] = <span class="number">2</span>; A[n++] = <span class="string">'#'</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; n;i++) idx[i] = <span class="number">1</span>;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%s"</span>,A+n);</span><br><span class="line">n = <span class="built_in">strlen</span>(A);</span><br><span class="line">solve();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;sa[i]ï¼šæ’åä¸ºiçš„åç¼€èµ·å§‹ä½ç½®æ˜¯å¤šå°‘ã€‚&lt;br&gt;rank[i]ï¼šä» i ä½ç½®èµ·å§‹çš„åç¼€åœ¨æ‰€æœ‰åç¼€ä¸­å­—å…¸åºæ’åºååºå·ï¼Œä¸saäº’é€†ã€‚&lt;br&gt;lcp[i]ï¼šS[sa[i] ,â€¦] ä¸ S[sa[i+1] , â€¦]çš„æœ€é•¿å…¬å…±å‰ç¼€ã€‚&lt;/p&gt;
&lt;h4 id=&quot;Musical-Them
      
    
    </summary>
    
      <category term="ACMé¢˜è§£" scheme="http://valenshi.top/categories/ACM%E9%A2%98%E8%A7%A3/"/>
    
    
      <category term="åç¼€æ•°ç»„" scheme="http://valenshi.top/tags/%E5%90%8E%E7%BC%80%E6%95%B0%E7%BB%84/"/>
    
  </entry>
  
  <entry>
    <title>åç¼€æ•°ç»„çš„å¸¸è§åº”ç”¨</title>
    <link href="http://valenshi.top/2019/10/17/lcp-use/"/>
    <id>http://valenshi.top/2019/10/17/lcp-use/</id>
    <published>2019-10-17T05:13:32.000Z</published>
    <updated>2019-10-17T05:20:01.958Z</updated>
    
    <content type="html"><![CDATA[<h3 id="åç¼€æ•°ç»„çš„åº”ç”¨"><a href="#åç¼€æ•°ç»„çš„åº”ç”¨" class="headerlink" title="åç¼€æ•°ç»„çš„åº”ç”¨"></a>åç¼€æ•°ç»„çš„åº”ç”¨</h3><h4 id="æ‘˜è¦"><a href="#æ‘˜è¦" class="headerlink" title="æ‘˜è¦"></a>æ‘˜è¦</h4><p>åç¼€æ•°ç»„æ˜¯å¤„ç†å­—ç¬¦ä¸²ç›¸å…³é—®é¢˜çš„æœ‰åŠ›å·¥å…·ï¼Œåç¼€æ•°ç»„çš„é¢˜å‹ä¸è§£æ³•ç›¸å¯¹å›ºå®šï¼Œå› æ­¤å¯¹äºæœ¬æ–‡ä¸­çš„å‡ ç§é¢˜å‹è¦æŒæ¡è§£æ³•ä¸åŸç†ã€‚æœ¬æ–‡å‡è®¾è¯»è€…å·²ç»æŒæ¡æ±‚åç¼€æ•°ç»„ï¼ˆsaï¼‰ä»¥åŠé«˜åº¦æ•°ç»„ï¼ˆlcpï¼‰çš„ç®—æ³•ã€‚<br>æœ¬æ–‡å°†ä»‹ç»4ç±»åç¼€æ•°ç»„çš„åº”ç”¨ï¼Œåˆ†åˆ«æ˜¯ï¼š</p><ul><li>æœ€é•¿å…¬å…±å‰ç¼€</li><li>å•ä¸ªå­—ç¬¦ä¸²ç›¸å…³é—®é¢˜</li><li>ä¸¤ä¸ªå­—ç¬¦ä¸²ç›¸å…³é—®é¢˜</li><li>å¤šä¸ªå­—ç¬¦ä¸²ç›¸å…³é—®é¢˜<h4 id="ç›¸å…³ç¬¦å·è¯´æ˜"><a href="#ç›¸å…³ç¬¦å·è¯´æ˜" class="headerlink" title="ç›¸å…³ç¬¦å·è¯´æ˜"></a>ç›¸å…³ç¬¦å·è¯´æ˜</h4>S æ˜¯åŸå­—ç¬¦ä¸²ã€‚<br>suffix( i )è¡¨ç¤ºå­—ç¬¦ä¸² S ä»ä½ç½® i å¼€å§‹çš„åç¼€ã€‚<br>sa( i )è¡¨ç¤ºæ’åä¸ºç¬¬ i çš„åç¼€çš„èµ·å§‹ä½ç½®ã€‚<br>rk( i )è¡¨ç¤º èµ·å§‹ä½ç½®ä¸º i çš„åç¼€çš„æ’åã€‚<br>lcp( i )è¡¨ç¤ºæ’åä¸º i çš„åç¼€ä¸æ’åä¸º i+1 çš„åç¼€çš„æœ€é•¿å…¬å…±å‰ç¼€çš„é•¿åº¦ã€‚</li></ul><h4 id="æœ€é•¿å…¬å…±å‰ç¼€"><a href="#æœ€é•¿å…¬å…±å‰ç¼€" class="headerlink" title="æœ€é•¿å…¬å…±å‰ç¼€"></a>æœ€é•¿å…¬å…±å‰ç¼€</h4><p><strong>ä¾‹1ï¼š</strong> ç»™å®šä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¯¢é—®æŸä¸¤ä¸ªåç¼€çš„æœ€é•¿å…¬å…±å‰ç¼€ã€‚<br><strong>è§£é¢˜æ€è·¯ï¼š</strong><br>æˆ‘ä»¬å·²ç»çŸ¥é“lcp[ i ]æ˜¯æ’åä¸º i çš„åç¼€ä¸æ’åä¸º i+1 çš„åç¼€çš„æœ€é•¿å…¬å…±å‰ç¼€çš„é•¿åº¦ï¼Œè€Œæˆ‘ä»¬åˆå¯ä»¥é€šè¿‡saæ•°ç»„æ¥å¾—åˆ°ä»»æ„ä¿©ä¸ªåç¼€çš„æ’åï¼Œå› æ­¤å¯¹äºç»™å®šçš„ä¸¤ä¸ªåç¼€ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆæ±‚å‡ºå®ƒä»¬çš„æ’åï¼Œåˆ†åˆ«è®¾ä¸º i å’Œ j ï¼ˆi &lt;= jï¼‰ï¼Œé‚£ä¹ˆans = min{ lcp[i] , lcp[i+1] , â€¦ , lcp[j - 1] }ï¼Œä¹Ÿå°±ç›¸å½“äºæ±‚RMQé—®é¢˜ï¼Œæ‰€ä»¥æ¥ä¸‹æ¥çš„è¯¢é—®å¯ä»¥å½“åšRMQé—®é¢˜æ¥é‡‡ç”¨åˆé€‚çš„ç®—æ³•ï¼ˆä¾‹å¦‚stè¡¨ï¼‰ã€‚</p><h4 id="å•ä¸ªå­—ç¬¦ä¸²ç›¸å…³é—®é¢˜"><a href="#å•ä¸ªå­—ç¬¦ä¸²ç›¸å…³é—®é¢˜" class="headerlink" title="å•ä¸ªå­—ç¬¦ä¸²ç›¸å…³é—®é¢˜"></a>å•ä¸ªå­—ç¬¦ä¸²ç›¸å…³é—®é¢˜</h4><p>è¿™ç±»é—®é¢˜çš„ä¸€ä¸ªå¸¸ç”¨åšæ³•æ˜¯å…ˆæ±‚åç¼€æ•°ç»„å’Œlcpæ•°ç»„ï¼Œç„¶ååˆ©ç”¨lcpæ•°ç»„æ±‚è§£ã€‚</p><h5 id="é‡å¤å­ä¸²é—®é¢˜"><a href="#é‡å¤å­ä¸²é—®é¢˜" class="headerlink" title="é‡å¤å­ä¸²é—®é¢˜"></a>é‡å¤å­ä¸²é—®é¢˜</h5><p><strong>é‡å¤å­ä¸²ï¼š</strong> å­—ç¬¦ä¸²Råœ¨å­—ç¬¦ä¸²Lä¸­è‡³å°‘å‡ºç°ä¸¤æ¬¡ï¼Œåˆ™ç§° R æ˜¯ L çš„é‡å¤å­ä¸²ã€‚</p><p><strong>ä¾‹2ï¼šå¯é‡å æœ€é•¿é‡å¤å­ä¸²</strong><br>ç»™å®šä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œæ±‚æœ€é•¿é‡å¤å­ä¸²ï¼Œè¿™ä¸¤ä¸ªå­ä¸²å¯ä»¥é‡å ã€‚<br><strong>è§£é¢˜æ€è·¯ï¼š</strong><br>æ±‚æœ€é•¿é‡å¤å­ä¸²ï¼Œç­‰ä»·äºæ±‚ä¸¤ä¸ªåç¼€çš„æœ€é•¿å…¬å…±å‰ç¼€çš„æœ€å¤§å€¼ã€‚äºæ˜¯æˆ‘ä»¬åªéœ€è¦æ±‚å‡ºlcpæ•°ç»„ä¸­çš„æœ€å¤§å€¼å³å¯ã€‚ç”±äºä»»æ„ä¸¤ä¸ªåç¼€çš„æœ€é•¿å…¬å…±å‰ç¼€ä¸€å®šæ˜¯lcpæ•°ç»„ä¸­æŸä¸€æ®µçš„æœ€å°å€¼ï¼Œé‚£ä¹ˆè¿™ä¸ªå€¼ä¸€å®šä¸å¤§äºlcpæ•°ç»„é‡Œçš„æœ€å¤§å€¼ã€‚æ‰€ä»¥æœ€é•¿é‡å¤å­ä¸²çš„é•¿åº¦å°±æ˜¯lcpæ•°ç»„é‡Œçš„æœ€å¤§å€¼ã€‚è¯¥åšæ³•æ—¶é—´å¤æ‚åº¦ä¸ºO(N)ã€‚</p><p><strong>ä¾‹3ï¼šä¸å¯é‡å æœ€é•¿é‡å¤å­ä¸²</strong><br>ç»™å®šä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œæ±‚æœ€é•¿é‡å¤å­ä¸²ï¼Œè¿™ä¸¤ä¸ªå­ä¸²ä¸èƒ½é‡å ã€‚<br><strong>Musical Theme</strong><br><a href="http://poj.org/problem?id=1743" target="_blank" rel="noopener">æµ‹è¯•åœ°å€</a><br><strong>é¢˜æ„ç®€è¿°</strong><br>ç»™nä¸ªæ•°ç»„æˆçš„ä¸²ï¼Œæ±‚æ˜¯å¦æœ‰å¤šä¸ªâ€œç›¸ä¼¼â€ä¸”ä¸é‡å çš„å­ä¸²çš„é•¿åº¦å¤§äºç­‰äº5ï¼Œä¸¤ä¸ªå­ä¸²ç›¸ä¼¼å½“ä¸”ä»…å½“é•¿åº¦ç›¸ç­‰ä¸”æ¯ä¸€ä½çš„æ•°å­—å·®éƒ½ç›¸ç­‰ã€‚</p><p><strong>è§£é¢˜æ€è·¯</strong><br>æœ¬é¢˜é¢˜æ„æœ‰äº›éš¾ç†è§£ã€‚å°±æ˜¯åˆ©ç”¨åç¼€æ•°ç»„+é«˜åº¦æ•°ç»„è§£å†³æœ€é•¿ä¸é‡å¤å­ä¸²é—®é¢˜ï¼Œè§£æ³•å¾ˆå¥—è·¯ï¼Œå°±æ˜¯äºŒåˆ†+åˆ¤æ–­ã€‚</p><p><strong>ä»£ç ç¤ºä¾‹</strong><br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//POJ1743</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">2e4</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">int</span> n,a[N],b[N];</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">getInt</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">int</span> ans = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">bool</span> neg = <span class="literal">false</span>;</span><br><span class="line"><span class="keyword">char</span> c = getchar();</span><br><span class="line"><span class="keyword">while</span> (c!=<span class="string">'-'</span> &amp;&amp; (c&lt;<span class="string">'0'</span> || c&gt;<span class="string">'9'</span>)) c = getchar();</span><br><span class="line"><span class="keyword">if</span> (c == <span class="string">'-'</span>) neg = <span class="literal">true</span>, c = getchar();</span><br><span class="line"><span class="keyword">while</span> (c&gt;=<span class="string">'0'</span> &amp;&amp; c&lt;=<span class="string">'9'</span>)</span><br><span class="line">ans = ans*<span class="number">10</span> + c-<span class="string">'0'</span>, c = getchar();</span><br><span class="line"><span class="keyword">return</span> neg ? -ans : ans; </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> sa[N],rk[N],lcp[N],tmp[N];</span><br><span class="line"><span class="keyword">int</span> len,k;</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">compare_sa</span><span class="params">(<span class="keyword">int</span> i,<span class="keyword">int</span> j)</span></span>&#123;</span><br><span class="line"><span class="keyword">if</span>(rk[i] != rk[j]) <span class="keyword">return</span> rk[i] &lt; rk[j];</span><br><span class="line"><span class="keyword">int</span> ri = i+k &lt;= len?rk[i+k]:<span class="number">-1</span>;</span><br><span class="line"><span class="keyword">int</span> rj = j+k &lt;= len?rk[j+k]:<span class="number">-1</span>;</span><br><span class="line"><span class="keyword">return</span> ri &lt; rj;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">construct_sa</span><span class="params">(<span class="keyword">int</span> S[],<span class="keyword">int</span> sa[])</span></span>&#123;</span><br><span class="line">len = n;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt;= len;i++)&#123;</span><br><span class="line">sa[i] = i;</span><br><span class="line">rk[i] = i &lt; len?S[i]:<span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span>(k = <span class="number">1</span>;k &lt;= n;k *= <span class="number">2</span>)&#123;</span><br><span class="line">sort(sa,sa+<span class="number">1</span>+len,compare_sa);</span><br><span class="line">tmp[sa[<span class="number">0</span>]] = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= len;i++)</span><br><span class="line">tmp[sa[i]] = tmp[sa[i<span class="number">-1</span>]]+compare_sa(sa[i<span class="number">-1</span>],sa[i]);</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt;= len;i++) rk[i] = tmp[i];</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">construct_lcp</span><span class="params">(<span class="keyword">int</span> S[],<span class="keyword">int</span> sa[],<span class="keyword">int</span> lcp[])</span></span>&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt;= len;i++) rk[sa[i]] = i;</span><br><span class="line"><span class="keyword">int</span> h = <span class="number">0</span>; lcp[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; len;i++)&#123;</span><br><span class="line"><span class="keyword">int</span> j = sa[rk[i]<span class="number">-1</span>];</span><br><span class="line"><span class="keyword">if</span>(h &gt; <span class="number">0</span>) h--;</span><br><span class="line"><span class="keyword">for</span>(;j + h &lt; len &amp;&amp; i + h &lt; len;h++)</span><br><span class="line"><span class="keyword">if</span>(S[j+h] != S[i+h]) <span class="keyword">break</span>;</span><br><span class="line">lcp[rk[i]<span class="number">-1</span>] = h;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">check</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line"><span class="keyword">int</span> pre = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">if</span>(lcp[<span class="number">1</span>] &gt;= x) pre = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">2</span>;i &lt; len;i++)&#123;</span><br><span class="line"><span class="keyword">if</span>(!pre &amp;&amp; lcp[i] &gt;= x) pre = i;</span><br><span class="line"><span class="keyword">if</span>(lcp[i<span class="number">-1</span>] &gt;= x)<span class="comment">//æ³¨æ„ä¸€ä¸‹åˆ°åº•æ˜¯iè¿˜æ˜¯i-1</span></span><br><span class="line"><span class="keyword">if</span>(<span class="built_in">abs</span>(sa[pre] - sa[i]) &gt; x) <span class="keyword">return</span> <span class="literal">true</span>; </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span></span>&#123;</span><br><span class="line">construct_sa(a,sa);</span><br><span class="line">construct_lcp(a,sa,lcp);</span><br><span class="line"><span class="keyword">int</span> l = <span class="number">0</span>,r = n;</span><br><span class="line"><span class="keyword">while</span>(l &lt;= r)&#123;</span><br><span class="line"><span class="keyword">int</span> mid = l+r&gt;&gt;<span class="number">1</span>;</span><br><span class="line"><span class="keyword">if</span>(check(mid)) l = mid+<span class="number">1</span>;</span><br><span class="line"><span class="keyword">else</span> r = mid<span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(++r &lt; <span class="number">5</span>) r = <span class="number">0</span>;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%d\n"</span>,r);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">while</span>(<span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;n) &amp;&amp; n)&#123;</span><br><span class="line"><span class="comment">//æ³¨æ„ï¼Œè¯¥æ¨¡æ¿å¿…é¡»ä»ä¸‹æ ‡0å¼€å§‹å­˜ï¼</span></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; n;i++) b[i] = getInt();</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt; n;i++) a[i] = b[i]-b[i<span class="number">-1</span>]+<span class="number">100</span>;</span><br><span class="line">a[<span class="number">0</span>] = b[<span class="number">0</span>]+<span class="number">100</span>; solve();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p><strong>ä¾‹4ï¼šå¯é‡å çš„kæ¬¡æœ€é•¿é‡å¤å­ä¸²POJ3261</strong><br><a href="http://poj.org/problem?id=3261" target="_blank" rel="noopener">æµ‹è¯•åœ°å€</a><br><strong>é¢˜æ„ç®€è¿°</strong><br>æ±‚å¯é‡å çš„ï¼Œå‡ºç°kæ¬¡çš„æœ€é•¿é‡å¤å­ä¸²ã€‚<br><strong>è§£é¢˜æ€è·¯</strong><br>è¿™ä¸ªå°±æ˜¯å¯é‡å çš„æœ€é•¿é‡å¤å­ä¸²äº†ï¼Œè¦æ±‚æ±‚å‡ºæœ€é•¿çš„ï¼Œé‡å¤å‡ºç°kæ¬¡ä»¥ä¸Šçš„å­ä¸²ï¼Œé€šè¿‡é¢˜æ„ä»¥åŠæ ·ä¾‹è§‚å¯Ÿå¯çŸ¥ï¼Œæ˜¯å…è®¸å­ä¸²é‡å¤çš„ã€‚è§£å†³æ–¹æ³•å’Œä¸Šé¢˜ç±»ä¼¼ï¼Œä¹Ÿæ˜¯åç¼€æ•°ç»„+äºŒåˆ†ã€‚</p><p><strong>ä»£ç ç¤ºä¾‹</strong><br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//POJ3261</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">2e4</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">int</span> n,k,a[N],kk;</span><br><span class="line"><span class="keyword">int</span> rk[N],sa[N],lcp[N],tmp[N];</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">compare_sa</span><span class="params">(<span class="keyword">int</span> i,<span class="keyword">int</span> j)</span></span>&#123;</span><br><span class="line"><span class="keyword">if</span>(rk[i] != rk[j]) <span class="keyword">return</span> rk[i] &lt; rk[j];</span><br><span class="line"><span class="keyword">int</span> ri = i+k &lt;= n?rk[i+k]:<span class="number">-1</span>;</span><br><span class="line"><span class="keyword">int</span> rj = j+k &lt;= n?rk[j+k]:<span class="number">-1</span>;</span><br><span class="line"><span class="keyword">return</span> ri &lt; rj;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">construct_sa</span><span class="params">(<span class="keyword">int</span> S[],<span class="keyword">int</span> sa[])</span></span>&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt;= n;i++)&#123;</span><br><span class="line">sa[i] = i;</span><br><span class="line">rk[i] = i &lt; n?S[i]:<span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//åˆ«æŠŠå…¨å±€å˜é‡çš„kè¦†ç›–äº†ï¼ï¼ï¼</span></span><br><span class="line"><span class="keyword">for</span>(k = <span class="number">1</span>;k &lt;= n;k *= <span class="number">2</span>)&#123;</span><br><span class="line">sort(sa,sa+<span class="number">1</span>+n,compare_sa);</span><br><span class="line">tmp[sa[<span class="number">0</span>]] = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++) </span><br><span class="line">tmp[sa[i]] = tmp[sa[i<span class="number">-1</span>]] + compare_sa(sa[i<span class="number">-1</span>],sa[i]);</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt;= n;i++) rk[i] = tmp[i];</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">construct_lcp</span><span class="params">(<span class="keyword">int</span> S[],<span class="keyword">int</span> sa[],<span class="keyword">int</span> lcp[])</span></span>&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt;= n;i++) rk[sa[i]] = i;</span><br><span class="line"><span class="keyword">int</span> h = <span class="number">0</span>; lcp[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; n;i++)&#123;</span><br><span class="line"><span class="keyword">int</span> j = sa[rk[i]<span class="number">-1</span>];</span><br><span class="line"><span class="keyword">if</span>(h &gt; <span class="number">0</span>) h--;</span><br><span class="line"><span class="keyword">for</span>(;j+h &lt; n &amp;&amp; i+h &lt; n;h++)</span><br><span class="line"><span class="keyword">if</span>(S[j+h] != S[i+h]) <span class="keyword">break</span>;</span><br><span class="line">lcp[rk[i]<span class="number">-1</span>] = h;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">check</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line"><span class="keyword">int</span> cnt = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">2</span>;i &lt;= n;i++)&#123;</span><br><span class="line"><span class="keyword">if</span>(lcp[i<span class="number">-1</span>] &gt;= x) cnt++;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line"><span class="keyword">if</span>(cnt &gt;= kk) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">cnt = <span class="number">1</span>;</span><br><span class="line">&#125; </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> cnt &gt;= kk;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span></span>&#123;</span><br><span class="line">construct_sa(a,sa);</span><br><span class="line">construct_lcp(a,sa,lcp);</span><br><span class="line"><span class="keyword">int</span> l = <span class="number">0</span>, r = n;</span><br><span class="line"><span class="comment">//for(int i = 1;i &lt;= n;i++) printf("%d ",lcp[i]);</span></span><br><span class="line"><span class="keyword">while</span>(l &lt;= r)&#123;</span><br><span class="line"><span class="keyword">int</span> mid = l+r&gt;&gt;<span class="number">1</span>;</span><br><span class="line"><span class="keyword">if</span>(check(mid)) l = mid+<span class="number">1</span>;</span><br><span class="line"><span class="keyword">else</span> r = mid<span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%d\n"</span>,r);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">while</span>(<span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;n,&amp;kk) != EOF)&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; n;i++) <span class="built_in">scanf</span>(<span class="string">"%d"</span>,a+i);</span><br><span class="line">solve();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h5 id="å­ä¸²çš„ä¸ªæ•°"><a href="#å­ä¸²çš„ä¸ªæ•°" class="headerlink" title="å­ä¸²çš„ä¸ªæ•°"></a>å­ä¸²çš„ä¸ªæ•°</h5><p><strong>ä¾‹5ï¼šæ±‚ä¸åŒå­ä¸²çš„ä¸ªæ•°</strong><br><strong>é¢˜æ„ç®€è¿°</strong><br>ç»™å®šä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œæ±‚å…¶æ‰€æœ‰å­ä¸²ä¸­ï¼Œä¸åŒçš„å­ä¸²æ•°é‡ã€‚<br><strong>è§£é¢˜æ€è·¯</strong><br>åˆ©ç”¨åç¼€æ•°ç»„+é«˜åº¦æ•°ç»„æ±‚è§£ã€‚å·²çŸ¥é«˜åº¦æ•°ç»„lcpï¼Œé‚£ä¹ˆé¦–å…ˆå¯ä»¥çŸ¥é“ç¬¬ä¸€ä¸ªsa[1]æœ‰n - sa[1]ä¸ªä¸åŒå­ä¸²ï¼›è€Œ2~nï¼Œæ¯ä¸ªsa[i] æœ‰ n - sa[i] - lcp[i-1] ä¸ªä¸åŒå­ä¸²ã€‚ç´¯åŠ å³å¯ï¼Œæ³¨æ„ç»“æœå¯èƒ½çˆ† intã€‚<br><strong>ä»£ç ç¤ºä¾‹</strong><br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//P2408ä¸åŒå­ä¸²çš„ä¸ªæ•°</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1e5</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">char</span> str[N];</span><br><span class="line"><span class="keyword">int</span> n;</span><br><span class="line"><span class="keyword">int</span> sa[N],lcp[N],tmp[N],k,rk[N];</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">compare_sa</span><span class="params">(<span class="keyword">int</span> i,<span class="keyword">int</span> j)</span></span>&#123;</span><br><span class="line"><span class="keyword">if</span>(rk[i] != rk[j]) <span class="keyword">return</span> rk[i] &lt; rk[j];</span><br><span class="line"><span class="keyword">int</span> ri = i+k &lt;= n?rk[i+k]:<span class="number">-1</span>;</span><br><span class="line"><span class="keyword">int</span> rj = j+k &lt;= n?rk[j+k]:<span class="number">-1</span>;</span><br><span class="line"><span class="keyword">return</span> ri &lt; rj;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">construct_sa</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> *S,<span class="keyword">int</span> sa[])</span></span>&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt;= n;i++)&#123;</span><br><span class="line">sa[i] = i;</span><br><span class="line">rk[i] = i &lt; n?S[i]:<span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span>(k = <span class="number">1</span>;k &lt;= n;k *= <span class="number">2</span>)&#123;</span><br><span class="line">sort(sa,sa+<span class="number">1</span>+n,compare_sa);</span><br><span class="line">tmp[sa[<span class="number">0</span>]] = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++) </span><br><span class="line">tmp[sa[i]] = tmp[sa[i<span class="number">-1</span>]] + compare_sa(sa[i<span class="number">-1</span>],sa[i]);</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt;= n;i++) rk[i] = tmp[i];</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">construct_lcp</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span>* S,<span class="keyword">int</span> sa[],<span class="keyword">int</span> lcp[])</span></span>&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt;= n;i++) rk[sa[i]] = i;</span><br><span class="line"><span class="keyword">int</span> h = <span class="number">0</span>; lcp[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; n;i++)&#123;</span><br><span class="line"><span class="keyword">int</span> j = sa[rk[i]<span class="number">-1</span>];</span><br><span class="line"><span class="keyword">if</span>(h &gt; <span class="number">0</span>) h--;</span><br><span class="line"><span class="keyword">for</span>(;j+h &lt; n &amp;&amp; i+h &lt; n;h++)</span><br><span class="line"><span class="keyword">if</span>(S[j+h] != S[i+h]) <span class="keyword">break</span>;</span><br><span class="line">lcp[rk[i]<span class="number">-1</span>] = h;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">ll sum = <span class="number">0</span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">calc</span><span class="params">()</span></span>&#123;</span><br><span class="line">sum = n - sa[<span class="number">1</span>];</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">2</span>;i &lt;= n;i++)</span><br><span class="line">sum += n - sa[i] - lcp[i<span class="number">-1</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span></span>&#123;</span><br><span class="line">construct_sa(str,sa);</span><br><span class="line">construct_lcp(str,sa,lcp);</span><br><span class="line">calc();</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%lld\n"</span>,sum);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> LOCAL</span></span><br><span class="line">freopen(<span class="string">"123.txt"</span>,<span class="string">"r"</span>,<span class="built_in">stdin</span>);</span><br><span class="line">freopen(<span class="string">"222.txt"</span>,<span class="string">"w"</span>,<span class="built_in">stdout</span>);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"><span class="keyword">while</span>(~<span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;n))&#123;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%s"</span>,str);</span><br><span class="line">solve();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h5 id="å›æ–‡å­ä¸²"><a href="#å›æ–‡å­ä¸²" class="headerlink" title="å›æ–‡å­ä¸²"></a>å›æ–‡å­ä¸²</h5><p><strong>ä¾‹6ï¼šæ±‚æœ€é•¿å›æ–‡å­ä¸²</strong></p><p>ç©·ä¸¾æ¯ä¸€ä½ï¼Œç„¶åè®¡ç®—ä»¥è¿™ä¸ªå­—ç¬¦ä¸ºä¸­å¿ƒçš„æœ€é•¿å›æ–‡å­ä¸²ã€‚æ³¨æ„è¿™é‡Œè¦å¯¹é•¿åº¦åˆ†å¥‡å¶è®¨è®ºã€‚ä¸¤ç§æƒ…å†µéƒ½å¯ä»¥è½¬åŒ–ä¸ºæ±‚ä¸€ä¸ªåç¼€å’Œä¸€ä¸ªåè¿‡æ¥å†™çš„åç¼€çš„æœ€é•¿å…¬å…±å‰ç¼€ã€‚å…·ä½“åšæ³•æ˜¯ï¼šå°†æ•´ä¸ªå­—ç¬¦åè¿‡æ¥æ”¾åœ¨åŸå­—ç¬¦ä¸²åé¢ï¼Œä¸­é—´ç”¨ä¸€ä¸ªç‰¹æ®Šå­—ç¬¦éš”å¼€ï¼Œè¿™æ ·å°±è½¬åŒ–ä¸ºäº†æ±‚æ–°ä¸²çš„æŸä¸¤ä¸ªåç¼€çš„æœ€é•¿å…¬å…±å‰ç¼€ã€‚</p><h5 id="è¿ç»­é‡å¤å­ä¸²"><a href="#è¿ç»­é‡å¤å­ä¸²" class="headerlink" title="è¿ç»­é‡å¤å­ä¸²"></a>è¿ç»­é‡å¤å­ä¸²</h5><p><strong>ä¾‹7ï¼šé‡å¤æ¬¡æ•°æœ€å¤šçš„è¿ç»­å­ä¸²</strong><br><strong>Maximum repetition substring</strong><br><strong>é¢˜æ„ç®€è¿°</strong><br>æ±‚ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­ï¼Œé‡å¤æ¬¡æ•°æœ€å¤šçš„è¿ç»­é‡å¤å­ä¸²æ˜¯ä»€ä¹ˆï¼ˆå¾ªç¯æ¬¡æ•°æœ€å¤šçš„å¾ªç¯å­ä¸²ï¼‰ã€‚è¦æ±‚è¾“å‡ºå­—å…¸åºæœ€å°çš„ã€‚</p><p>ä¾‹å¦‚ï¼šccabababcä¸­ï¼Œè¿ç»­å¾ªç¯æ¬¡æ•°æœ€å¤šçš„å­ä¸²æ˜¯abababã€‚</p><p><strong>è§£é¢˜æ€è·¯</strong><br>è¿™é¢˜æˆ‘å¯¹ç…§é¢˜è§£å†™äº†å¾ˆä¹…ï¼Œæ€æƒ³å‹‰å¼ºææ‡‚ã€‚<br>å…ˆè¯´åšæ³•ï¼Œæ˜¯æšä¸¾é•¿åº¦lenï¼ˆä»1åˆ°nï¼‰ï¼Œç„¶ååˆ¤æ–­ä»¥ len ä¸ºå¾ªç¯é•¿åº¦çš„ è¿ç»­å¾ªç¯æ¬¡æ•° æœ€å¤šçš„ å­ä¸² é•¿åº¦ æ˜¯å¤šå°‘ï¼›å‡è®¾è¿™ä¸ªå­ä¸²é•¿åº¦æ˜¯ l ï¼Œé‚£ä¹ˆå®ƒçš„è¿ç»­å¾ªç¯æ¬¡æ•°å°±æ˜¯ l/lenã€‚<br>æˆ‘ä»¬è€ƒè™‘å¦‚ä½•æ±‚å­ä¸²é•¿åº¦ l ã€‚å¦‚æœæœ‰ä¸€ä¸ªå­—ç¬¦ä¸²çš„å¾ªç¯èŠ‚é•¿åº¦ä¸ºlenï¼Œé‚£ä¹ˆå¿…ç„¶æœ‰s[1,n-len] = s[len , n]ï¼Œå› æ­¤ï¼Œå¦‚æœå­—ç¬¦ä¸² s[len, n] ä¸ s[ 2 <em> len, n] çš„å…¬å…±å‰ç¼€é•¿åº¦ä¸º lcpï¼Œé‚£ä¹ˆ s[len ,n] çš„å¾ªç¯èŠ‚ä¸ªæ•°ä¸ºlcp / len + 1ï¼ˆåŠ ä¸Šçš„ä¸€ä¸ªæ˜¯å¼€å¤´ä¸ºè®¡ç®—åœ¨lcpå†…çš„å¾ªç¯èŠ‚ ï¼‰ã€‚<br>å› æ­¤æˆ‘ä»¬åªéœ€è¦å¯¹s[0] , s[len] ,s[2 </em> len] â€¦ , åˆ¤æ–­ç›¸å·® len çš„ä¸¤ä¸ªç›¸é‚»åç¼€çš„ lcpï¼Œå°±å¯ä»¥è®¡ç®—è¯¥å­ä¸²å¾ªç¯èŠ‚ä¸ªæ•°ã€‚è¿™æ˜¯ç”±äºå¦‚æœä¸€ä¸ªå­ä¸²çš„å¾ªç¯èŠ‚é•¿åº¦ä¸º lenï¼Œä¸”å¾ªç¯è‡³å°‘ä¸¤æ¬¡ï¼Œé‚£ä¹ˆæ˜¾ç„¶å®ƒä¼šåŒ…å«ç›¸é‚»çš„ä¸¤ä¸ªlenï¼Œå¦åˆ™å°±æ„ä¸æˆå¾ªç¯äº†ã€‚å½“ç„¶å¯èƒ½èµ·ç‚¹å¹¶ä¸åœ¨lençš„å€æ•°ä½ç½®ä¸Šï¼Œå› æ­¤æˆ‘ä»¬è¿˜éœ€è¦å‘å‰æ‹“å±•ä¸€ä¸‹ã€‚</p><p><strong>ä»£ç ç¤ºä¾‹</strong><br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1e5</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">char</span> str[N];</span><br><span class="line"><span class="keyword">int</span> cse = <span class="number">0</span>,n;</span><br><span class="line"><span class="keyword">int</span> k,rk[N],lcp[N],sa[N],tmp[N];</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">compare_sa</span><span class="params">(<span class="keyword">int</span> i,<span class="keyword">int</span> j)</span></span>&#123;</span><br><span class="line"><span class="keyword">if</span>(rk[i] != rk[j]) <span class="keyword">return</span> rk[i] &lt; rk[j];</span><br><span class="line"><span class="keyword">int</span> ri = i+k &lt;= n?rk[i+k]:<span class="number">-1</span>;</span><br><span class="line"><span class="keyword">int</span> rj = j+k &lt;= n?rk[j+k]:<span class="number">-1</span>;</span><br><span class="line"><span class="keyword">return</span> ri &lt; rj;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">construct_sa</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span>* S,<span class="keyword">int</span> sa[])</span></span>&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt;= n;i++)&#123;</span><br><span class="line">sa[i] = i;</span><br><span class="line">rk[i] = i &lt; n?S[i]:<span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span>(k = <span class="number">1</span>;k &lt;= n;k *= <span class="number">2</span>)&#123;</span><br><span class="line">sort(sa,sa+<span class="number">1</span>+n,compare_sa);</span><br><span class="line">tmp[sa[<span class="number">0</span>]] = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++)</span><br><span class="line">tmp[sa[i]] = tmp[sa[i<span class="number">-1</span>]]+compare_sa(sa[i<span class="number">-1</span>],sa[i]);</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt;= n;i++) rk[i] = tmp[i];</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">construct_lcp</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span>* S,<span class="keyword">int</span> sa[],<span class="keyword">int</span> lcp[])</span></span>&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt;= n;i++) rk[sa[i]] = i;</span><br><span class="line"><span class="keyword">int</span> h = <span class="number">0</span>; lcp[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; n;i++)&#123;</span><br><span class="line"><span class="keyword">int</span> j = sa[rk[i]<span class="number">-1</span>];</span><br><span class="line"><span class="keyword">if</span>(h &gt; <span class="number">0</span>) h--;</span><br><span class="line"><span class="keyword">for</span>(;j+h &lt; n &amp;&amp; i+h &lt; n;h++)</span><br><span class="line"><span class="keyword">if</span>(S[j+h] != S[i+h]) <span class="keyword">break</span>;</span><br><span class="line">lcp[rk[i]<span class="number">-1</span>] = h;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> st[N][<span class="number">22</span>],Log[N];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">st_init</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++) st[i][<span class="number">0</span>] = lcp[i];</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">2</span>;i &lt;= n;i++) Log[i] = Log[i/<span class="number">2</span>]+<span class="number">1</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">1</span>;(<span class="number">1</span>&lt;&lt;j) &lt;= n;j++)&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i + (<span class="number">1</span>&lt;&lt;j<span class="number">-1</span>) &lt;= n;i++)</span><br><span class="line">st[i][j] = min(st[i][j<span class="number">-1</span>],st[i+(<span class="number">1</span>&lt;&lt;j<span class="number">-1</span>)][j<span class="number">-1</span>]);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">ask</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r)</span></span>&#123;</span><br><span class="line"><span class="keyword">if</span>(l &gt; r) swap(l,r); r--;</span><br><span class="line"><span class="keyword">int</span> kk = Log[r-l+<span class="number">1</span>];</span><br><span class="line"><span class="keyword">return</span> min(st[l][kk],st[r-(<span class="number">1</span>&lt;&lt;kk)+<span class="number">1</span>][kk]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> mxtc = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">int</span> q[N],cnt = <span class="number">0</span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">calc</span><span class="params">(<span class="keyword">int</span> len)</span></span>&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i+len &lt; n;i += len)&#123;</span><br><span class="line"><span class="keyword">int</span> l = ask(rk[i],rk[i+len]);</span><br><span class="line"><span class="keyword">int</span> res = l/len+<span class="number">1</span>;</span><br><span class="line"><span class="keyword">int</span> pre = i - (len-l%len);</span><br><span class="line"><span class="keyword">if</span>(pre &gt;= <span class="number">0</span> &amp;&amp; ask(rk[pre],rk[pre+len]) &gt;= len) res++;</span><br><span class="line"><span class="keyword">if</span>(mxtc &lt; res) mxtc = res,cnt = <span class="number">0</span>,q[++cnt] = len;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span>(mxtc == res &amp;&amp; len != q[cnt]) q[++cnt] = len;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">printAns</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++)</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">1</span>;j &lt;= cnt;j++)</span><br><span class="line"><span class="keyword">if</span>(ask(rk[sa[i]],rk[sa[i]+q[j]]) &gt;= q[j]*(mxtc<span class="number">-1</span>))&#123;</span><br><span class="line">str[sa[i]+q[j]*mxtc] = <span class="string">'\0'</span>;</span><br><span class="line"><span class="built_in">puts</span>(str+sa[i]); <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span></span>&#123;</span><br><span class="line">construct_sa(str,sa);</span><br><span class="line">construct_lcp(str,sa,lcp);<span class="comment">//lcp[n]æ˜¯æ’ç­‰äº0çš„</span></span><br><span class="line"><span class="comment">/*ä¸‹ä¸€æ­¥æ±‚é‡å¤æ¬¡æ•°æœ€å¤šçš„è¿ç»­é‡å¤å­ä¸²*/</span></span><br><span class="line">st_init();</span><br><span class="line">mxtc = cnt = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++) calc(i); </span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"Case %d: "</span>,++cse);</span><br><span class="line">printAns();</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">while</span>(<span class="built_in">scanf</span>(<span class="string">"%s"</span>,str) != EOF)&#123;</span><br><span class="line">n = <span class="built_in">strlen</span>(str);</span><br><span class="line"><span class="keyword">if</span>(n == <span class="number">1</span> &amp;&amp; str[<span class="number">0</span>] == <span class="string">'#'</span>) <span class="keyword">break</span>;</span><br><span class="line">solve();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h4 id="ä¸¤ä¸ªå­—ç¬¦ä¸²ç›¸å…³é—®é¢˜"><a href="#ä¸¤ä¸ªå­—ç¬¦ä¸²ç›¸å…³é—®é¢˜" class="headerlink" title="ä¸¤ä¸ªå­—ç¬¦ä¸²ç›¸å…³é—®é¢˜"></a>ä¸¤ä¸ªå­—ç¬¦ä¸²ç›¸å…³é—®é¢˜</h4><p>è¿™ç±»é—®é¢˜çš„ä¸€ä¸ªå¸¸ç”¨åšæ³•æ˜¯ï¼Œå…ˆè¿æ¥è¿™ä¸¤ä¸ªå­—ç¬¦ä¸²ï¼Œç„¶åæ±‚åç¼€æ•°ç»„å’Œé«˜åº¦æ•°ç»„ï¼Œå†åˆ©ç”¨é«˜åº¦æ•°ç»„æ±‚è§£ã€‚</p><h5 id="å…¬å…±å­ä¸²"><a href="#å…¬å…±å­ä¸²" class="headerlink" title="å…¬å…±å­ä¸²"></a>å…¬å…±å­ä¸²</h5><p><strong>ä¾‹8ï¼šå…¬å…±å­ä¸²çš„æ•°é‡ï¼šCommon Substrings</strong></p><p><strong>é¢˜æ„ç®€è¿°</strong><br>ç»™å®š2ä¸ªå­—ç¬¦ä¸²Aå’ŒBï¼Œä»¥åŠä¸€ä¸ªæ•´æ•°kã€‚ç›®æ ‡æ˜¯æ±‚å‡ºè¿™ä¸¤ä¸ªå­—ç¬¦ä¸²ä¸­å…¬å…±å­ä¸²çš„æ•°é‡ï¼Œä¾‹å¦‚A:xx , B:xxï¼Œk = 1ï¼Œé‚£ä¹ˆå…¬å…±å­ä¸²æ•°é‡å°±æ˜¯5ã€‚<br><strong>è§£é¢˜æ€è·¯</strong><br>å°†Aå’ŒBæ‹¼æ¥åœ¨ä¸€èµ·ï¼Œä¸­é—´ç”¨ä¸€ä¸ªæœªå‡ºç°è¿‡çš„å­—ç¬¦é—´éš”ï¼Œæ–°ä¸²S = A+â€™#â€™+Bï¼›ç„¶åå¯¹Sæ±‚é«˜åº¦æ•°ç»„ï¼Œåˆ©ç”¨é«˜åº¦æ•°ç»„æ¥æ±‚è§£ã€‚<br>å¯¹äºå±äº B çš„æ¯ä¸€ä¸ªåç¼€ï¼Œç»Ÿè®¡å®ƒä¸æ‰€æœ‰å±äº A çš„åç¼€çš„ lcpï¼ˆæœ€é•¿å…¬å…±å‰ç¼€ï¼‰ï¼Œå¹¶ç»Ÿè®¡lcp-m+1ï¼Œè¿™å°±æ˜¯è¯¥åç¼€å’Œ A çš„å…¬å…±å­ä¸²æ•°é‡ã€‚è¿™æ ·åšçš„å¤æ‚åº¦æ˜¯O(N^2)ã€‚</p><p>æˆ‘ä»¬å¯ä»¥åˆ©ç”¨å•è°ƒæ ˆæ¥åœ¨ O(N) æ—¶é—´å†…è§£å†³ï¼›æˆ‘ä»¬ä»å‰å‘åéå†lcpæ•°ç»„ï¼Œå°†å±äºAçš„åç¼€çš„ lcp å‹å…¥æ ˆï¼›ç”±äºä¸¤ä¸ªå­—ç¬¦ä¸²çš„åç¼€æ˜¯å–å®ƒä»¬ä¸­é—´çš„æœ€å°å€¼ï¼Œæ‰€ä»¥æˆ‘ä»¬åº”è¯¥ç»´æŠ¤å•è°ƒé€’å‡æ ˆï¼ŒåŒæ—¶éœ€è¦ç»´æŠ¤çš„æ˜¯ sumï¼Œsumä»£è¡¨å½“å‰ A ä¸­ç›¸åŒçš„å­ä¸²æ•°é‡ï¼Œä¹Ÿå°±æ˜¯è¯´å¦‚æœå½“å‰åç¼€å±äº B ï¼Œåˆ™ç›´æ¥åŠ ä¸Šsumå³å¯ã€‚</p><p>ç”±äºæˆ‘ä»¬æ˜¯é¡ºåºéå†çš„ï¼Œåªç»Ÿè®¡äº†Aå¯¹Bçš„è´¡çŒ®ï¼Œå†åè¿‡æ¥ç»Ÿè®¡ä¸€æ¬¡Bå¯¹Açš„è´¡çŒ®å³å¯ã€‚<br><strong>ä»£ç ç¤ºä¾‹</strong><br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">2e5</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">char</span> A[N],B[N];</span><br><span class="line"><span class="keyword">int</span> rk[N],tmp[N],lcp[N],sa[N],k;</span><br><span class="line"><span class="keyword">int</span> n,m;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll;</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">compare_sa</span><span class="params">(<span class="keyword">int</span> i,<span class="keyword">int</span> j)</span></span>&#123;</span><br><span class="line"><span class="keyword">if</span>(rk[i] != rk[j]) <span class="keyword">return</span> rk[i] &lt; rk[j];</span><br><span class="line"><span class="keyword">int</span> ri = i+k &lt;= n?rk[i+k]:<span class="number">-1</span>;</span><br><span class="line"><span class="keyword">int</span> rj = i+k &lt;= n?rk[j+k]:<span class="number">-1</span>;</span><br><span class="line"><span class="keyword">return</span> ri &lt; rj;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">construct_sa</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span>* S,<span class="keyword">int</span> sa[])</span></span>&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt;= n;i++)&#123;</span><br><span class="line">sa[i] = i;</span><br><span class="line">rk[i] = i &lt; n?S[i]:<span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span>(k = <span class="number">1</span>;k &lt;= n;k *= <span class="number">2</span>)&#123;</span><br><span class="line">sort(sa,sa+<span class="number">1</span>+n,compare_sa);</span><br><span class="line">tmp[sa[<span class="number">0</span>]] = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++)</span><br><span class="line">tmp[sa[i]] = tmp[sa[i<span class="number">-1</span>]] + compare_sa(sa[i<span class="number">-1</span>],sa[i]);</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt;= n;i++) rk[i] = tmp[i];</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">construct_lcp</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> *S,<span class="keyword">int</span> sa[],<span class="keyword">int</span> lcp[])</span></span>&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt;= n;i++) rk[sa[i]] = i;</span><br><span class="line"><span class="keyword">int</span> h = <span class="number">0</span>; lcp[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; n;i++)&#123;</span><br><span class="line"><span class="keyword">int</span> j =sa[rk[i]<span class="number">-1</span>];</span><br><span class="line"><span class="keyword">if</span>(h &gt; <span class="number">0</span>) h--;</span><br><span class="line"><span class="keyword">for</span>(;j+h &lt; n &amp;&amp; i+h &lt; n;h++)</span><br><span class="line"><span class="keyword">if</span>(S[j+h] != S[i+h]) <span class="keyword">break</span>;</span><br><span class="line">lcp[rk[i]<span class="number">-1</span>] = h;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> idx[N];<span class="comment">//åˆå§‹åŒ–ä¸º0</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Node</span>&#123;</span></span><br><span class="line">ll h,cnt;</span><br><span class="line">&#125;Stack[N];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span></span>&#123;</span><br><span class="line">construct_sa(A,sa);</span><br><span class="line">construct_lcp(A,sa,lcp);</span><br><span class="line">ll ans = <span class="number">0</span>,sum = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">int</span> top = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">2</span>;i &lt;= n;i++)&#123;</span><br><span class="line">ll cnt = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span>(top &amp;&amp; Stack[top].h &gt;= lcp[i<span class="number">-1</span>])&#123;</span><br><span class="line">cnt += Stack[top].cnt;</span><br><span class="line">sum -= Stack[top].cnt * (Stack[top].h-m+<span class="number">1</span>);</span><br><span class="line">top--;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(lcp[i<span class="number">-1</span>] &gt;= m)&#123;</span><br><span class="line">cnt += idx[sa[i<span class="number">-1</span>]] == <span class="number">0</span>;</span><br><span class="line"><span class="keyword">if</span>(cnt) Stack[++top] = Node&#123;lcp[i<span class="number">-1</span>],cnt&#125;;</span><br><span class="line">sum += (lcp[i<span class="number">-1</span>]-m+<span class="number">1</span>)*cnt;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(idx[sa[i]] == <span class="number">1</span>) ans += sum;</span><br><span class="line">&#125;</span><br><span class="line">top = <span class="number">0</span>; sum = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">2</span>;i &lt;= n;i++)&#123;</span><br><span class="line">ll cnt = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span>(top &amp;&amp; Stack[top].h &gt;= lcp[i<span class="number">-1</span>])&#123;</span><br><span class="line">cnt += Stack[top].cnt;</span><br><span class="line">sum -= Stack[top].cnt * (Stack[top].h-m+<span class="number">1</span>);</span><br><span class="line">top--;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(lcp[i<span class="number">-1</span>] &gt;= m)&#123;</span><br><span class="line">cnt += idx[sa[i<span class="number">-1</span>]] == <span class="number">1</span>;</span><br><span class="line"><span class="keyword">if</span>(cnt) Stack[++top] = Node&#123;lcp[i<span class="number">-1</span>],cnt&#125;;</span><br><span class="line">sum += (lcp[i<span class="number">-1</span>]-m+<span class="number">1</span>)*cnt;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(!idx[sa[i]]) ans += sum;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%lld\n"</span>,ans);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">while</span>(<span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;m) != EOF &amp;&amp; m)&#123;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%s"</span>,A);</span><br><span class="line"><span class="built_in">memset</span>(idx,<span class="number">0</span>,<span class="keyword">sizeof</span> idx);</span><br><span class="line">n = <span class="built_in">strlen</span>(A); </span><br><span class="line">idx[n] = <span class="number">2</span>; A[n++] = <span class="string">'#'</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; n;i++) idx[i] = <span class="number">1</span>;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%s"</span>,A+n);</span><br><span class="line">n = <span class="built_in">strlen</span>(A);</span><br><span class="line">solve();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h4 id="å¤šä¸ªå­—ç¬¦ä¸²ç›¸å…³é—®é¢˜"><a href="#å¤šä¸ªå­—ç¬¦ä¸²ç›¸å…³é—®é¢˜" class="headerlink" title="å¤šä¸ªå­—ç¬¦ä¸²ç›¸å…³é—®é¢˜"></a>å¤šä¸ªå­—ç¬¦ä¸²ç›¸å…³é—®é¢˜</h4><p>è¿™ç±»é—®é¢˜çš„ä¸€ä¸ªå¸¸ç”¨åšæ³•æ˜¯ï¼Œå…ˆå°†æ‰€æœ‰çš„å­—ç¬¦ä¸²è¿æ¥èµ·æ¥ï¼Œç„¶åæ±‚åç¼€æ•°ç»„å’Œé«˜åº¦æ•°ç»„ï¼Œå†åˆ©ç”¨é«˜åº¦æ•°ç»„è¿›è¡Œæ±‚è§£ã€‚ä¸­é—´å¯èƒ½è¿˜è¦åˆ©ç”¨äºŒåˆ†ç­”æ¡ˆã€‚</p><p><strong>ä¾‹9ï¼šä¸å°äºkä¸ªå­—ç¬¦ä¸²ä¸­çš„æœ€é•¿å­ä¸²ã€‚</strong></p><p><strong>Life Forms</strong><br><a href="http://poj.org/problem?id=3294" target="_blank" rel="noopener">æµ‹è¯•åœ°å€</a><br><strong>é¢˜æ„ç®€è¿°</strong><br>ç»™å®šnä¸ªå­—ç¬¦ä¸²ï¼Œè¯·é—®å®ƒä»¬ä¹‹é—´å‡ºç°æ¬¡æ•°è¶…è¿‡ä¸€åŠçš„æœ€é•¿å…¬å…±å­ä¸²æ˜¯ä»€ä¹ˆï¼Ÿå¦‚æœæœ‰å¤šä¸ªï¼ŒæŒ‰å­—å…¸åºè¾“å‡ºã€‚</p><p><strong>è§£é¢˜æ€è·¯</strong><br>åˆ©ç”¨åç¼€æ•°ç»„+é«˜åº¦æ•°ç»„æ±‚è§£ã€‚æˆ‘ä»¬å°†nä¸ªå­—ç¬¦ä¸²æ‹¼æ¥ä¸­ä¸€ä¸ªâ€œæ¯ä¸²â€ï¼Œä¸­é—´ç”¨ä¸åŒçš„å­—ç¬¦é—´éš”ï¼›ç„¶åå¯¹æ¯ä¸²æ±‚é«˜åº¦æ•°ç»„lcpï¼Œæˆ‘ä»¬ä¾æ—§æ˜¯ç”¨äºŒåˆ†æœç´¢åˆ¤å®šé•¿åº¦pæ˜¯å¦åˆæ³•ï¼Œæ¯æ¬¡åˆ¤å®šä»å‰å‘åç”¨O(N)æ—¶é—´éå†ç»Ÿè®¡ä¸€éå³å¯ã€‚å½“æˆ‘ä»¬å¾—åˆ°æœ€é•¿çš„åˆæ³•é•¿åº¦ p åï¼Œå†åˆ©ç”¨ç±»ä¼¼çš„æ–¹æ³•è¾“å‡ºæ‰€æœ‰çš„å­ä¸²ã€‚</p><p><strong>ä»£ç ç¤ºä¾‹</strong><br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="built_in">string</span> str,s;</span><br><span class="line"><span class="keyword">int</span> n,k,len;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">2e5</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">int</span> sa[N],rk[N],lcp[N],tmp[N];</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">compare_sa</span><span class="params">(<span class="keyword">int</span> i,<span class="keyword">int</span> j)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(rk[i] != rk[j]) <span class="keyword">return</span> rk[i] &lt; rk[j];</span><br><span class="line">    <span class="keyword">int</span> ri = i+k &lt;= len?rk[i+k]:<span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">int</span> rj = j+k &lt;= len?rk[j+k]:<span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">return</span> ri &lt; rj;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">construct_sa</span><span class="params">(<span class="built_in">string</span> S,<span class="keyword">int</span> sa[])</span></span>&#123;</span><br><span class="line">    len = S.length();</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt;= len;i++)&#123;</span><br><span class="line">        sa[i] = i;</span><br><span class="line">        rk[i] = i &lt; len ? S[i]:<span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//kä¸€å®šä¸èƒ½è®¾ç½®æˆå±€éƒ¨å˜é‡å¯¼è‡´è¦†ç›–å…¨å±€å˜é‡ï¼ï¼ï¼</span></span><br><span class="line">    <span class="keyword">for</span>(k = <span class="number">1</span>;k &lt;= len;k *= <span class="number">2</span>)&#123;</span><br><span class="line">        sort(sa,sa+len+<span class="number">1</span>,compare_sa);</span><br><span class="line">        tmp[sa[<span class="number">0</span>]] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= len;i++)</span><br><span class="line">            tmp[sa[i]] = tmp[sa[i<span class="number">-1</span>]] + compare_sa(sa[i<span class="number">-1</span>],sa[i]);</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt;= len;i++) rk[i] = tmp[i];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">construct_lcp</span><span class="params">(<span class="built_in">string</span> S,<span class="keyword">int</span> sa[],<span class="keyword">int</span> lcp[])</span></span>&#123;</span><br><span class="line">    len = S.length();</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt;= len;i++) rk[sa[i]] = i;</span><br><span class="line">    <span class="keyword">int</span> h = <span class="number">0</span>; lcp[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; len;i++)&#123;</span><br><span class="line">        <span class="keyword">int</span> j = sa[rk[i]<span class="number">-1</span>];</span><br><span class="line">        <span class="keyword">if</span>(h &gt; <span class="number">0</span>) h--;</span><br><span class="line">        <span class="keyword">for</span>(;j+h &lt; len &amp;&amp; i+h &lt; len;h++)</span><br><span class="line">            <span class="keyword">if</span>(S[j+h] != S[i+h]) <span class="keyword">break</span>;</span><br><span class="line">        lcp[rk[i]<span class="number">-1</span>] = h;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> vis[<span class="number">110</span>],idx[N];</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">check</span><span class="params">(<span class="keyword">int</span> p)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> cnt = <span class="number">1</span>; <span class="built_in">memset</span>(vis,<span class="number">0</span>,<span class="keyword">sizeof</span> vis);</span><br><span class="line">    vis[idx[sa[<span class="number">1</span>]]] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">2</span>;i &lt;= len;i++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(lcp[i<span class="number">-1</span>] &lt; p)&#123;</span><br><span class="line">            cnt = <span class="number">1</span>; <span class="built_in">memset</span>(vis,<span class="number">0</span>,<span class="keyword">sizeof</span> vis);vis[idx[sa[i]]] = <span class="number">1</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(!vis[idx[sa[i]]]) cnt++,vis[idx[sa[i]]] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(cnt &gt;= n/<span class="number">2</span>+<span class="number">1</span>) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">print</span><span class="params">(<span class="keyword">int</span> p)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> cnt = <span class="number">1</span>; <span class="built_in">memset</span>(vis,<span class="number">0</span>,<span class="keyword">sizeof</span> vis);</span><br><span class="line">    vis[idx[sa[<span class="number">1</span>]]] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">2</span>;i &lt;= len+<span class="number">1</span>;i++)&#123;  <span class="comment">//lcp[len+1] = 0,ä½œä¸ºç»“æŸæ ‡å¿—</span></span><br><span class="line">        <span class="keyword">if</span>(lcp[i<span class="number">-1</span>] &lt; p)&#123;</span><br><span class="line">            <span class="keyword">if</span>(cnt &gt;= n/<span class="number">2</span>+<span class="number">1</span>) &#123;</span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> j = sa[i<span class="number">-1</span>];j &lt; sa[i<span class="number">-1</span>]+p;j++) <span class="built_in">cout</span> &lt;&lt; str[j];</span><br><span class="line">                <span class="built_in">cout</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            cnt = <span class="number">1</span>; <span class="built_in">memset</span>(vis,<span class="number">0</span>,<span class="keyword">sizeof</span> vis);vis[idx[sa[i]]] = <span class="number">1</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(!vis[idx[sa[i]]]) cnt++,vis[idx[sa[i]]] = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span></span>&#123;</span><br><span class="line">    construct_sa(str,sa);</span><br><span class="line">    construct_lcp(str,sa,lcp);</span><br><span class="line">    <span class="comment">/*sa[i]ï¼šå­˜æ”¾æ’åç¬¬içš„åç¼€çš„èµ·å§‹ä½ç½®*/</span></span><br><span class="line">    <span class="keyword">int</span> l = <span class="number">0</span>, r = len;</span><br><span class="line">    <span class="keyword">while</span>(l &lt;= r)&#123;</span><br><span class="line">        <span class="keyword">int</span> mid = l+r&gt;&gt;<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(check(mid)) l = mid+<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">else</span> r = mid<span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(r &lt;= <span class="number">0</span>) <span class="built_in">cout</span> &lt;&lt; <span class="string">"?"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="keyword">else</span> print(r);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">while</span>(<span class="built_in">cin</span> &gt;&gt; n &amp;&amp; n)&#123;</span><br><span class="line">        <span class="keyword">if</span>(n == <span class="number">1</span>)&#123;</span><br><span class="line">            <span class="built_in">cin</span> &gt;&gt; str; <span class="built_in">cout</span> &lt;&lt; str &lt;&lt; <span class="built_in">endl</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">int</span> cnt = <span class="number">2</span>,tot = <span class="number">0</span>; str = <span class="string">""</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++)&#123;</span><br><span class="line">            <span class="built_in">cin</span> &gt;&gt; s; str += s+<span class="keyword">char</span>(++cnt);</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span>;j &lt;= s.length();j++) idx[tot++] = i;</span><br><span class="line">        &#125; </span><br><span class="line">        solve();</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h4 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h4><ul><li>ç½—ç©—éªï¼Œåç¼€æ•°ç»„â€”â€”å¤„ç†å­—ç¬¦ä¸²çš„æœ‰åˆ©å·¥å…·ï¼Œ2009.1</li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;åç¼€æ•°ç»„çš„åº”ç”¨&quot;&gt;&lt;a href=&quot;#åç¼€æ•°ç»„çš„åº”ç”¨&quot; class=&quot;headerlink&quot; title=&quot;åç¼€æ•°ç»„çš„åº”ç”¨&quot;&gt;&lt;/a&gt;åç¼€æ•°ç»„çš„åº”ç”¨&lt;/h3&gt;&lt;h4 id=&quot;æ‘˜è¦&quot;&gt;&lt;a href=&quot;#æ‘˜è¦&quot; class=&quot;headerlink&quot; title=&quot;æ‘˜
      
    
    </summary>
    
      <category term="ACMå­¦ä¹ ç¬”è®°" scheme="http://valenshi.top/categories/ACM%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
    
      <category term="åç¼€æ•°ç»„" scheme="http://valenshi.top/tags/%E5%90%8E%E7%BC%80%E6%95%B0%E7%BB%84/"/>
    
  </entry>
  
  <entry>
    <title>æ ‘é“¾å‰–åˆ†é¢˜é›†</title>
    <link href="http://valenshi.top/2019/10/12/lct-problems/"/>
    <id>http://valenshi.top/2019/10/12/lct-problems/</id>
    <published>2019-10-12T06:30:05.000Z</published>
    <updated>2019-10-12T06:32:22.569Z</updated>
    
    <content type="html"><![CDATA[<p>æ ‘é“¾å‰–åˆ†å¸¸ç”¨äºå¤„ç†é™æ€æ ‘ä¸Šæ“ä½œï¼Œæ•ˆç‡å¾ˆé«˜ï¼Œå†™èµ·æ¥ä¹Ÿå°±æ˜¯å›ºå®šçš„è½»é‡è¾¹æ‹†åˆ†+çº¿æ®µæ ‘ï¼Œä½†æ˜¯ä»£ç ä¸€èˆ¬éƒ½æ˜¯100è¡Œ+ï¼Œå®¹æ˜“å‡ºé”™ã€‚<br>æœ¬é¢˜é›†ä¸­çš„æ ‘é“¾å‰–åˆ†ç»ƒä¹ é¢˜ï¼Œåœ¨è§£å†³æ€è·¯ä¸Šæ²¡ä»€ä¹ˆéš¾ç‚¹ï¼Œä¸»è¦æ˜¯å¦‚ä½•è®¾è®¡çº¿æ®µæ ‘ä»¥åŠå¦‚ä½•æ›´æ–°+è¯¢é—®ï¼Œä¹Ÿå°±æ˜¯è¯´è¦æƒ³å¥½æ€ä¹ˆç»´æŠ¤çº¿æ®µæ ‘ï¼Œå…¶å®ƒåœ°æ–¹æ²¡ä»€ä¹ˆå¤ªéš¾çš„ï¼Œä½†æ˜¯ä»£ç é•¿å°±å®¹æ˜“å‡ºbugï¼Œå¤šå†™å†™å°±å¥½äº†ã€‚æœ€åä¸€é¢˜æ˜¯çº¿æ®µæ ‘åŠ¨æ€å¼€ç‚¹ï¼Œè¿™å’Œå¯æŒä¹…åŒ–æƒå€¼çº¿æ®µæ ‘ï¼ˆåŠ¨æ€ä¸»å¸­æ ‘ï¼‰ä¸€æ ·çš„æ€æƒ³ï¼Œåªéœ€è¦å°†æ™®é€šçš„çº¿æ®µæ ‘ç»™ç¨å¾®ä¿®æ”¹ä¸€ä¸‹å³å¯ã€‚</p><h4 id="æ ‘çš„ç»Ÿè®¡"><a href="#æ ‘çš„ç»Ÿè®¡" class="headerlink" title="æ ‘çš„ç»Ÿè®¡"></a>æ ‘çš„ç»Ÿè®¡</h4><p><strong>é¢˜æ„ç®€è¿°</strong><br>åŸé¢˜æ¥è‡ªï¼šZJOI 2008<br>ä¸€æ ‘ä¸Šæœ‰ n ä¸ªèŠ‚ç‚¹ï¼Œç¼–å·åˆ†åˆ«ä¸º 1 åˆ° nï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰ä¸€ä¸ªæƒå€¼ wã€‚æˆ‘ä»¬å°†ä»¥ä¸‹é¢çš„å½¢å¼æ¥è¦æ±‚ä½ å¯¹è¿™æ£µæ ‘å®Œæˆä¸€äº›æ“ä½œï¼š</p><p>1.CHANGE u t ï¼šæŠŠèŠ‚ç‚¹ u æƒå€¼æ”¹ä¸º tï¼›</p><p>2.QMAX u v ï¼šè¯¢é—®ç‚¹ u åˆ°ç‚¹ v è·¯å¾„ä¸Šçš„èŠ‚ç‚¹çš„æœ€å¤§æƒå€¼ï¼›</p><p>3.QSUM u v ï¼šè¯¢é—®ç‚¹ u åˆ°ç‚¹ v è·¯å¾„ä¸Šçš„èŠ‚ç‚¹çš„æƒå€¼å’Œã€‚</p><p>æ³¨æ„ï¼šä»ç‚¹ u åˆ°ç‚¹ v è·¯å¾„ä¸Šçš„èŠ‚ç‚¹åŒ…æ‹¬ u å’Œ v æœ¬èº«ã€‚</p><p><strong>è§£é¢˜æ€è·¯</strong><br>æ ‘é“¾å‰–åˆ†+çº¿æ®µæ ‘ä¸Šå•ç‚¹ä¿®æ”¹ï¼ŒåŒºé—´æŸ¥è¯¢ï¼Œéœ€è¦æ³¨æ„æŸ¥è¯¢æ“ä½œï¼Œåˆ©ç”¨åˆ°äº†LCAå€å¢æ€æƒ³ï¼Œæ ‘é“¾å‰–åˆ†ä¸­å¾ˆå¤šåŒºé—´ä¿®æ”¹å’ŒæŸ¥è¯¢æ“ä½œéƒ½æ˜¯è¿™æ ·å®Œæˆçš„ã€‚</p><p><strong>ä»£ç ç¤ºä¾‹</strong><br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll;</span><br><span class="line"><span class="keyword">const</span> ll INF = <span class="number">1e18</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">3e4</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> M = <span class="number">2</span>*N;</span><br><span class="line"><span class="keyword">int</span> head[N],ver[M],edge[M],nex[M],tot = <span class="number">1</span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">addEdge</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> y,<span class="keyword">int</span> z)</span></span>&#123;</span><br><span class="line">    ver[++tot] = y, edge[tot] = z;</span><br><span class="line">    nex[tot] = head[x], head[x] = tot;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> n,q,a[N];</span><br><span class="line"><span class="comment">/*çˆ¶äº²,æ·±åº¦,å­æ ‘å¤§å°,é‡å„¿å­,é‡è·¯å¾„é¡¶éƒ¨èŠ‚ç‚¹,</span></span><br><span class="line"><span class="comment">    æ ‘ä¸­èŠ‚ç‚¹åœ¨çº¿æ®µæ ‘ä¸­ä¸‹æ ‡,çº¿æ®µæ ‘ä¸­èŠ‚ç‚¹å¯¹åº”æ ‘ä¸­ä½ç½®*/</span></span><br><span class="line"><span class="keyword">int</span> par[N],deep[N],size[N],son[N],top[N],seg[N],rev[N];</span><br><span class="line"><span class="keyword">int</span> vis[N];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs1</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> fa)</span></span>&#123;</span><br><span class="line">    <span class="comment">/*åˆ©ç”¨æ·±æœæ›´æ–°par,size,deep,sonæ•°ç»„*/</span></span><br><span class="line">    vis[x] = <span class="literal">true</span>; size[x] = <span class="number">1</span>;</span><br><span class="line">    par[x] = fa; deep[x] = deep[fa]+<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = head[x];i ;i = nex[i])&#123;</span><br><span class="line">        <span class="keyword">int</span> y = ver[i], z = edge[i];</span><br><span class="line">        <span class="keyword">if</span>(y == fa || vis[y]) <span class="keyword">continue</span>;</span><br><span class="line">        dfs1(y,x);</span><br><span class="line">        size[x] += size[y]; <span class="comment">//ç´¯åŠ å­æ ‘å¤§å°</span></span><br><span class="line">        <span class="keyword">if</span>(size[y] &gt; size[son[x]]) son[x] = y;<span class="comment">//æ±‚é‡å„¿å­</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs2</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> fa)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(son[x])&#123; <span class="comment">//å…ˆèµ°é‡å„¿å­,ä½¿å¾—é‡è·¯å¾„åœ¨çº¿æ®µæ ‘ä¸­è¿ç»­</span></span><br><span class="line">        seg[son[x]] = ++seg[<span class="number">0</span>];<span class="comment">//0ä½ç½®ç”¨ä¸åˆ°,åˆ©ç”¨æ¥è®¡æ•°</span></span><br><span class="line">        top[son[x]] = top[x];</span><br><span class="line">        rev[seg[<span class="number">0</span>]] = son[x];</span><br><span class="line">        dfs2(son[x],x);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = head[x];i;i = nex[i])&#123;</span><br><span class="line">        <span class="keyword">int</span> y = ver[i], z = edge[i];</span><br><span class="line">        <span class="keyword">if</span>(top[y]) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="comment">/*è‹¥yæ²¡æœ‰è¢«éå†è¿‡,å³yä¸æ˜¯xçš„é‡å„¿å­æˆ–è€…çˆ¶äº²*/</span></span><br><span class="line">        seg[y] = ++seg[<span class="number">0</span>]; rev[seg[<span class="number">0</span>]] = y;</span><br><span class="line">        top[y] = y; dfs2(y,x);</span><br><span class="line">        <span class="comment">/*å¦‚æœx--&gt;yæ˜¯è½»è¾¹,é‚£ä¹ˆyå°±æ˜¯å…¶æ‰€åœ¨é‡è·¯å¾„é¡¶éƒ¨èŠ‚ç‚¹*/</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">SegmentTree</span>&#123;</span></span><br><span class="line">    <span class="keyword">int</span> l,r;</span><br><span class="line">    ll mx, sum;</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> l(x) t[x].l</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> r(x) t[x].r</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> mx(x) t[x].mx</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> sum(x) t[x].sum</span></span><br><span class="line">&#125;t[N*<span class="number">4</span>];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">BuildTree</span><span class="params">(<span class="keyword">int</span> rt,<span class="keyword">int</span> l,<span class="keyword">int</span> r)</span></span>&#123;</span><br><span class="line">    l(rt) = l, r(rt) = r;</span><br><span class="line">    <span class="keyword">if</span>(l == r)&#123;</span><br><span class="line">        mx(rt) = sum(rt) = a[rev[l]]; <span class="comment">//çº¿æ®µæ ‘ä¸ŠlèŠ‚ç‚¹å¯¹åº”ç€æ ‘ä¸Šrev[l]ç‚¹</span></span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> mid = l+r&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    BuildTree(rt*<span class="number">2</span>,l,mid); BuildTree(rt*<span class="number">2</span>+<span class="number">1</span>,mid+<span class="number">1</span>,r);</span><br><span class="line">    mx(rt) = max(mx(rt&lt;&lt;<span class="number">1</span>),mx(rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>));</span><br><span class="line">    sum(rt) = sum(rt&lt;&lt;<span class="number">1</span>) + sum(rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">preHandle</span><span class="params">()</span></span>&#123;</span><br><span class="line">    dfs1(<span class="number">1</span>,<span class="number">0</span>); <span class="comment">//æˆ‘ä»¬ä»¥1å·èŠ‚ç‚¹ä¸ºæ ¹</span></span><br><span class="line">    <span class="comment">/*æ ¹èŠ‚ç‚¹æ‰€åœ¨é‡è·¯å¾„çš„é¡¶éƒ¨èŠ‚ç‚¹ä¹Ÿæ˜¯æ ¹èŠ‚ç‚¹,èµ‹åˆå€¼*/</span></span><br><span class="line">    seg[<span class="number">0</span>] = seg[<span class="number">1</span>] = top[<span class="number">1</span>] = rev[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">    dfs2(<span class="number">1</span>,<span class="number">0</span>);</span><br><span class="line">    BuildTree(<span class="number">1</span>,<span class="number">1</span>,seg[<span class="number">0</span>]);</span><br><span class="line">&#125;</span><br><span class="line">ll tmx,tsum;<span class="comment">//åˆ©ç”¨å…¨å±€å˜é‡åŒæ—¶ç»Ÿè®¡2ä¸ªç­”æ¡ˆ</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">query</span><span class="params">(<span class="keyword">int</span> rt,<span class="keyword">int</span> l,<span class="keyword">int</span> r)</span></span>&#123;</span><br><span class="line">    <span class="comment">/*å°†ä»¥rtä¸ºæ ¹çš„åŒºé—´å†…å±äº[l,r]éƒ¨åˆ†çš„å’Œç´¯åŠ åˆ°tsumä¸Š,å¹¶æ›´æ–°tmx*/</span></span><br><span class="line">    <span class="keyword">if</span>(l &lt;= l(rt) &amp;&amp; r(rt) &lt;= r)&#123;</span><br><span class="line">        tsum += sum(rt); tmx = max(tmx,mx(rt));</span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> mid = l(rt)+r(rt)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>(l &lt;= mid) query(rt&lt;&lt;<span class="number">1</span>,l,r);</span><br><span class="line">    <span class="keyword">if</span>(r &gt; mid) query(rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>,l,r);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ask</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> y)</span></span>&#123;</span><br><span class="line">    <span class="comment">/*è¿”å›xä¸yä¹‹é—´è·¯å¾„ä¸Šæƒå€¼æœ€å¤§ç‚¹çš„æƒå€¼*/</span></span><br><span class="line">    <span class="keyword">int</span> fx = top[x] , fy = top[y];</span><br><span class="line">    <span class="keyword">while</span>(fx != fy)&#123;<span class="comment">//å…ˆå°†xå’Œyæ¡æ•´åˆ°åŒä¸€ä¸ªé‡é“¾ä¸Š</span></span><br><span class="line">        <span class="keyword">if</span>(deep[fx] &lt; deep[fy]) swap(x,y),swap(fx,fy);</span><br><span class="line">        query(<span class="number">1</span>,seg[fx],seg[x]);</span><br><span class="line">        x = par[fx]; fx = top[x];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(deep[x] &gt; deep[y]) swap(x,y);<span class="comment">//è·¯å¾„æµ…çš„ç¼–å·å°</span></span><br><span class="line">    query(<span class="number">1</span>,seg[x],seg[y]); <span class="comment">//å†æ›´æ–°ä¸€æ¬¡</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">change</span><span class="params">(<span class="keyword">int</span> rt,<span class="keyword">int</span> x,<span class="keyword">int</span> val)</span></span>&#123;</span><br><span class="line">    <span class="comment">/*æŠŠçº¿æ®µæ ‘èŠ‚ç‚¹xçš„æƒå€¼æ”¹ä¸ºval*/</span></span><br><span class="line">    <span class="keyword">if</span>(l(rt) == r(rt))&#123;</span><br><span class="line">        mx(rt) = sum(rt) = val;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> mid = l(rt) + r(rt) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>(x &gt; mid) change(rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>,x,val);</span><br><span class="line">    <span class="keyword">else</span> change(rt&lt;&lt;<span class="number">1</span>,x,val);</span><br><span class="line">    mx(rt) = max(mx(rt&lt;&lt;<span class="number">1</span>),mx(rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>));</span><br><span class="line">    sum(rt) = sum(rt&lt;&lt;<span class="number">1</span>) + sum(rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">ifdef</span> LOCAL</span></span><br><span class="line">        freopen(<span class="string">"123.txt"</span>,<span class="string">"r"</span>,<span class="built_in">stdin</span>);</span><br><span class="line">        freopen(<span class="string">"222.txt"</span>,<span class="string">"w"</span>,<span class="built_in">stdout</span>);</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;n);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>,x,y;i &lt; n;i++)&#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;x,&amp;y);</span><br><span class="line">        addEdge(x,y,<span class="number">1</span>); addEdge(y,x,<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++) <span class="built_in">scanf</span>(<span class="string">"%d"</span>,a+i);</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;q);</span><br><span class="line">    preHandle();<span class="comment">//æ ‘é“¾å‰–åˆ†é¢„å¤„ç†</span></span><br><span class="line">    <span class="keyword">char</span> op[<span class="number">20</span>];</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>,x,y;i &lt;= q;i++)&#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">"%s%d%d"</span>,op,&amp;x,&amp;y);</span><br><span class="line">        <span class="keyword">if</span>(op[<span class="number">0</span>] == <span class="string">'C'</span>) change(<span class="number">1</span>,seg[x],y);</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            tmx = -INF; tsum = <span class="number">0</span>;</span><br><span class="line">            ask(x,y);<span class="comment">//åŒæ—¶æ›´æ–°æœ€å¤§å€¼ä¸è·¯å¾„å’Œ</span></span><br><span class="line">            <span class="keyword">if</span>(op[<span class="number">1</span>] == <span class="string">'M'</span>) <span class="built_in">printf</span>(<span class="string">"%lld\n"</span>,tmx);</span><br><span class="line">            <span class="keyword">else</span> <span class="built_in">printf</span>(<span class="string">"%lld\n"</span>,tsum);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h4 id="ã€ŒHAOI2015ã€æ ‘ä¸Šæ“ä½œ"><a href="#ã€ŒHAOI2015ã€æ ‘ä¸Šæ“ä½œ" class="headerlink" title="ã€ŒHAOI2015ã€æ ‘ä¸Šæ“ä½œ"></a>ã€ŒHAOI2015ã€æ ‘ä¸Šæ“ä½œ</h4><p><strong>é¢˜æ„ç®€è¿°</strong><br>æœ‰ä¸€æ£µç‚¹æ•°ä¸º N çš„æ ‘ï¼Œä»¥ç‚¹ 1 ä¸ºæ ¹ï¼Œä¸”æ ‘æœ‰ç‚¹æƒã€‚ç„¶åæœ‰ M ä¸ªæ“ä½œï¼Œåˆ†ä¸ºä¸‰ç§ï¼š</p><p>1ã€æŠŠæŸä¸ªèŠ‚ç‚¹ x çš„ç‚¹æƒå¢åŠ  a ã€‚</p><p>2ã€æŠŠæŸä¸ªèŠ‚ç‚¹ x ä¸ºæ ¹çš„å­æ ‘ä¸­æ‰€æœ‰ç‚¹çš„ç‚¹æƒéƒ½å¢åŠ  a ã€‚</p><p>3ã€è¯¢é—®æŸä¸ªèŠ‚ç‚¹ x åˆ°æ ¹çš„è·¯å¾„ä¸­æ‰€æœ‰ç‚¹çš„ç‚¹æƒå’Œã€‚</p><p><strong>è§£é¢˜æ€è·¯</strong><br>æ ‘é“¾å‰–åˆ†+çº¿æ®µæ ‘ä¸ŠåŒºé—´ä¿®æ”¹ï¼ŒåŒºé—´æŸ¥è¯¢ã€‚ç”¨åˆ°äº†çº¿æ®µæ ‘ä¸Šçš„å»¶è¿Ÿæ ‡è®°ï¼Œå…¶å®å’Œæ™®é€šçº¿æ®µæ ‘æ²¡å•¥åŒºåˆ«ï¼Œå°±æ˜¯æŸ¥è¯¢å’Œä¿®æ”¹æ—¶å€™è¦ç”¨LCAå€å¢æ€æƒ³å°†æ ‘ä¸Šçš„é“¾è½¬åŒ–ä¸ºçº¿æ®µæ ‘ä¸Šçš„åŒºé—´ã€‚åªè¦ç†è§£äº†æ ‘ä¸ŠèŠ‚ç‚¹å’Œçº¿æ®µæ ‘ä¸‹æ ‡æ˜¯é€šè¿‡seg[x] å’Œ rev[seg[x]]æ¥è½¬æ¢çš„å³å¯ã€‚</p><p>å¦å¤–è¿˜éœ€è¦æ˜ç™½çº¿æ®µæ ‘ä¸Šé‡é“¾çš„seg[]å€¼æ˜¯è¿ç»­çš„ï¼ŒåŒä¸€ä¸ªå­æ ‘ä¸Šçš„æ‰€æœ‰èŠ‚ç‚¹ä¸‹æ ‡ä¹Ÿæ˜¯è¿ç»­çš„ï¼Œè¿™ä¸ªç»“è®ºå¯ä»¥é€šè¿‡è§‚å¯Ÿdfs2çš„å®ç°å¾—åˆ°ã€‚</p><p><strong>ä»£ç ç¤ºä¾‹</strong><br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1e5</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> M = <span class="number">2e5</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">int</span> head[N],ver[M],edge[M],nex[M],tot = <span class="number">1</span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">addEdge</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> y,<span class="keyword">int</span> z)</span></span>&#123;</span><br><span class="line">    ver[++tot] = y,edge[tot] = z;</span><br><span class="line">    nex[tot] = head[x]; head[x] = tot;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> n,m,a[N];</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">getInt</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> ans = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">bool</span> neg = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">char</span> c = getchar();</span><br><span class="line">    <span class="keyword">while</span> (c!=<span class="string">'-'</span> &amp;&amp; (c&lt;<span class="string">'0'</span> || c&gt;<span class="string">'9'</span>)) c = getchar();</span><br><span class="line">    <span class="keyword">if</span> (c == <span class="string">'-'</span>) neg = <span class="literal">true</span>, c = getchar();</span><br><span class="line">    <span class="keyword">while</span> (c&gt;=<span class="string">'0'</span> &amp;&amp; c&lt;=<span class="string">'9'</span>)</span><br><span class="line">        ans = ans*<span class="number">10</span> + c-<span class="string">'0'</span>, c = getchar();</span><br><span class="line">    <span class="keyword">return</span> neg ? -ans : ans; </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> deep[N],par[N],top[N],size[N],son[N],seg[N],rev[N];</span><br><span class="line"><span class="keyword">int</span> vis[N];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs1</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> fa)</span></span>&#123;</span><br><span class="line">    vis[x] = <span class="literal">true</span>; par[x] = fa;</span><br><span class="line">    deep[x] = deep[fa]+<span class="number">1</span>; size[x] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = head[x];i ;i = nex[i])&#123;</span><br><span class="line">        <span class="keyword">int</span> y = ver[i], z = edge[i];</span><br><span class="line">        <span class="keyword">if</span>(vis[y] || y == fa) <span class="keyword">continue</span>;</span><br><span class="line">        dfs1(y,x);</span><br><span class="line">        size[x] += size[y]; </span><br><span class="line">        <span class="keyword">if</span>(size[y] &gt; size[son[x]]) son[x] = y;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs2</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> fa)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(son[x])&#123;</span><br><span class="line">        seg[son[x]] = ++seg[<span class="number">0</span>];</span><br><span class="line">        rev[seg[<span class="number">0</span>]] = son[x];</span><br><span class="line">        top[son[x]] = top[x];</span><br><span class="line">        dfs2(son[x],x);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = head[x];i;i = nex[i])&#123;</span><br><span class="line">        <span class="keyword">int</span> y = ver[i], z = edge[i];</span><br><span class="line">        <span class="keyword">if</span>(top[y]) <span class="keyword">continue</span>;</span><br><span class="line">        seg[y] = ++seg[<span class="number">0</span>]; rev[seg[<span class="number">0</span>]] = y;</span><br><span class="line">        top[y] = y; dfs2(y,x);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">SegmentTree</span>&#123;</span></span><br><span class="line">    <span class="keyword">int</span> l,r;</span><br><span class="line">    ll sum,add;</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> l(x) t[x].l</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> r(x) t[x].r</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> sum(x) t[x].sum</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> add(x) t[x].add</span></span><br><span class="line">&#125;t[N*<span class="number">4</span>];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">BuildTree</span><span class="params">(<span class="keyword">int</span> rt,<span class="keyword">int</span> l,<span class="keyword">int</span> r)</span></span>&#123;</span><br><span class="line">    l(rt) = l,r(rt) = r,add(rt) = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span>(l == r)&#123;</span><br><span class="line">        sum(rt) = a[rev[l]]; <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> mid = l+r&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    BuildTree(rt&lt;&lt;<span class="number">1</span>,l,mid); BuildTree(rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>,mid+<span class="number">1</span>,r);</span><br><span class="line">    sum(rt) = sum(rt&lt;&lt;<span class="number">1</span>) + sum(rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">preHandle</span><span class="params">()</span></span>&#123;</span><br><span class="line">    dfs1(<span class="number">1</span>,<span class="number">0</span>);</span><br><span class="line">    seg[<span class="number">0</span>] = seg[<span class="number">1</span>] = top[<span class="number">1</span>] = rev[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">    dfs2(<span class="number">1</span>,<span class="number">0</span>);</span><br><span class="line">    BuildTree(<span class="number">1</span>,<span class="number">1</span>,seg[<span class="number">0</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">spread</span><span class="params">(<span class="keyword">int</span> rt)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!add(rt)) <span class="keyword">return</span>;</span><br><span class="line">    sum(rt&lt;&lt;<span class="number">1</span>) += (r(rt&lt;&lt;<span class="number">1</span>)-l(rt&lt;&lt;<span class="number">1</span>)+<span class="number">1</span>)*add(rt);</span><br><span class="line">    sum(rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>) += (r(rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>)-l(rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>)+<span class="number">1</span>)*add(rt);</span><br><span class="line">    add(rt&lt;&lt;<span class="number">1</span>) += add(rt); add(rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>) += add(rt);</span><br><span class="line">    add(rt) = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Add</span><span class="params">(<span class="keyword">int</span> rt,<span class="keyword">int</span> l,<span class="keyword">int</span> r,ll val)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(l &lt;= l(rt) &amp;&amp; r(rt) &lt;= r)&#123;</span><br><span class="line">        sum(rt) += (r(rt) - l(rt)+<span class="number">1</span>)*val;</span><br><span class="line">        add(rt) += val; <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    spread(rt);</span><br><span class="line">    <span class="keyword">int</span> mid = l(rt)+r(rt)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>(l &lt;= mid) Add(rt&lt;&lt;<span class="number">1</span>,l,r,val);</span><br><span class="line">    <span class="keyword">if</span>(r &gt; mid) Add(rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>,l,r,val);</span><br><span class="line">    sum(rt) = sum(rt&lt;&lt;<span class="number">1</span>)+sum(rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">ll <span class="title">query</span><span class="params">(<span class="keyword">int</span> rt,<span class="keyword">int</span> l,<span class="keyword">int</span> r)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(l &lt;= l(rt) &amp;&amp; r(rt) &lt;= r) <span class="keyword">return</span> sum(rt);</span><br><span class="line">    spread(rt); ll res = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> mid = l(rt) + r(rt) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>(l &lt;= mid) res += query(rt&lt;&lt;<span class="number">1</span>,l,r);</span><br><span class="line">    <span class="keyword">if</span>(r &gt; mid) res += query(rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>,l,r);</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">ll <span class="title">ask</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">    <span class="comment">/*ä»èŠ‚ç‚¹xåˆ°æ ¹èŠ‚ç‚¹çš„è·¯å¾„å’Œ*/</span></span><br><span class="line">    ll res = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(x)&#123;</span><br><span class="line">        res += query(<span class="number">1</span>,seg[top[x]],seg[x]);</span><br><span class="line">        x = par[top[x]];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    n = getInt(); m = getInt();</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++) a[i] = getInt();</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>,x,y;i &lt; n;i++)&#123;</span><br><span class="line">        x = getInt(); y = getInt();</span><br><span class="line">        addEdge(x,y,<span class="number">1</span>); addEdge(y,x,<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    preHandle();</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>,op,x,y;i &lt;= m;i++)&#123;</span><br><span class="line">        op = getInt();</span><br><span class="line">        <span class="keyword">if</span>(op == <span class="number">1</span>)&#123;</span><br><span class="line">            x = getInt(); y = getInt();</span><br><span class="line">            Add(<span class="number">1</span>,seg[x],seg[x],y);</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(op == <span class="number">2</span>)&#123;</span><br><span class="line">            x = getInt(); y = getInt();</span><br><span class="line">            Add(<span class="number">1</span>,seg[x],seg[x]+size[x]<span class="number">-1</span>,y);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            x = getInt(); <span class="built_in">printf</span>(<span class="string">"%lld\n"</span>,ask(x));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h4 id="ã€ŒNOI2015ã€è½¯ä»¶åŒ…ç®¡ç†å™¨"><a href="#ã€ŒNOI2015ã€è½¯ä»¶åŒ…ç®¡ç†å™¨" class="headerlink" title="ã€ŒNOI2015ã€è½¯ä»¶åŒ…ç®¡ç†å™¨"></a>ã€ŒNOI2015ã€è½¯ä»¶åŒ…ç®¡ç†å™¨</h4><p><strong>é¢˜æ„ç®€è¿°</strong><br>Linux ç”¨æˆ·å’Œ OSX ç”¨æˆ·ä¸€å®šå¯¹è½¯ä»¶åŒ…ç®¡ç†å™¨ä¸ä¼šé™Œç”Ÿã€‚é€šè¿‡è½¯ä»¶åŒ…ç®¡ç†å™¨ï¼Œä½ å¯ä»¥é€šè¿‡ä¸€è¡Œå‘½ä»¤å®‰è£…æŸä¸€ä¸ªè½¯ä»¶åŒ…ï¼Œç„¶åè½¯ä»¶åŒ…ç®¡ç†å™¨ä¼šå¸®åŠ©ä½ ä»è½¯ä»¶æºä¸‹è½½è½¯ä»¶åŒ…ï¼ŒåŒæ—¶è‡ªåŠ¨è§£å†³æ‰€æœ‰çš„ä¾èµ–ï¼ˆå³ä¸‹è½½å®‰è£…è¿™ä¸ªè½¯ä»¶åŒ…çš„å®‰è£…æ‰€ä¾èµ–çš„å…¶å®ƒè½¯ä»¶åŒ…ï¼‰ï¼Œå®Œæˆæ‰€æœ‰çš„é…ç½®ã€‚Debian/Ubuntu ä½¿ç”¨çš„ apt-getï¼ŒFedora/CentOS ä½¿ç”¨çš„ yumï¼Œä»¥åŠ OSX ä¸‹å¯ç”¨çš„ Homebrew éƒ½æ˜¯ä¼˜ç§€çš„è½¯ä»¶åŒ…ç®¡ç†å™¨ã€‚</p><p>ä½ å†³å®šè®¾è®¡ä½ è‡ªå·±çš„è½¯ä»¶åŒ…ç®¡ç†å™¨ã€‚ä¸å¯é¿å…åœ°ï¼Œä½ è¦è§£å†³è½¯ä»¶åŒ…ä¹‹é—´çš„ä¾èµ–é—®é¢˜ã€‚å¦‚æœè½¯ä»¶åŒ… A ä¾èµ–è½¯ä»¶åŒ… Bï¼Œé‚£ä¹ˆå®‰è£…è½¯ä»¶åŒ… A ä»¥å‰ï¼Œå¿…é¡»å…ˆå®‰è£…è½¯ä»¶åŒ… Bã€‚åŒæ—¶ï¼Œå¦‚æœæƒ³è¦å¸è½½è½¯ä»¶åŒ… Bï¼Œåˆ™å¿…é¡»å¸è½½è½¯ä»¶åŒ… Aã€‚ç°åœ¨ä½ å·²ç»è·å¾—äº†æ‰€æœ‰çš„è½¯ä»¶åŒ…ä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚è€Œä¸”ï¼Œç”±äºä½ ä¹‹å‰çš„å·¥ä½œï¼Œé™¤ 0 å·è½¯ä»¶åŒ…ä»¥å¤–ï¼Œåœ¨ä½ çš„ç®¡ç†å™¨å½“ä¸­çš„è½¯ä»¶åŒ…éƒ½ä¼šä¾èµ–ä¸€ä¸ªä¸”ä»…ä¸€ä¸ªè½¯ä»¶åŒ…ï¼Œè€Œ 0 å·è½¯ä»¶åŒ…ä¸ä¾èµ–ä»»ä½•ä¸€ä¸ªè½¯ä»¶åŒ…ã€‚ä¾èµ–å…³ç³»ä¸å­˜åœ¨ç¯ï¼ˆè‹¥æœ‰m(mâ‰¥2) ä¸ªè½¯ä»¶åŒ…A1,A2,A3,â€¦,Am ï¼Œå…¶ä¸­ A1 ä¾èµ– A2ï¼ŒA2ä¾èµ– A3 ä¾èµ– A4 ï¼Œâ€¦â€¦ï¼ŒAmâˆ’1 ä¾èµ– Am ï¼Œè€Œ Am ä¾èµ– A1 ï¼Œåˆ™ç§°è¿™ m ä¸ªè½¯ä»¶åŒ…çš„ä¾èµ–å…³ç³»æ„æˆç¯ï¼‰ï¼Œå½“ç„¶ä¹Ÿä¸ä¼šæœ‰ä¸€ä¸ªè½¯ä»¶åŒ…ä¾èµ–è‡ªå·±ã€‚</p><p>ç°åœ¨ä½ è¦ä¸ºä½ çš„è½¯ä»¶åŒ…ç®¡ç†å™¨å†™ä¸€ä¸ªä¾èµ–è§£å†³ç¨‹åºã€‚æ ¹æ®åé¦ˆï¼Œç”¨æˆ·å¸Œæœ›åœ¨å®‰è£…å’Œå¸è½½æŸä¸ªè½¯ä»¶åŒ…æ—¶ï¼Œå¿«é€Ÿåœ°çŸ¥é“è¿™ä¸ªæ“ä½œå®é™…ä¸Šä¼šæ”¹å˜å¤šå°‘ä¸ªè½¯ä»¶åŒ…çš„å®‰è£…çŠ¶æ€ï¼ˆå³å®‰è£…æ“ä½œä¼šå®‰è£…å¤šå°‘ä¸ªæœªå®‰è£…çš„è½¯ä»¶åŒ…ï¼Œæˆ–å¸è½½æ“ä½œä¼šå¸è½½å¤šå°‘ä¸ªå·²å®‰è£…çš„è½¯ä»¶åŒ…ï¼‰ï¼Œä½ çš„ä»»åŠ¡å°±æ˜¯å®ç°è¿™ä¸ªéƒ¨åˆ†ã€‚æ³¨æ„ï¼Œå®‰è£…ä¸€ä¸ªå·²å®‰è£…çš„è½¯ä»¶åŒ…ï¼Œæˆ–å¸è½½ä¸€ä¸ªæœªå®‰è£…çš„è½¯ä»¶åŒ…ï¼Œéƒ½ä¸ä¼šæ”¹å˜ä»»ä½•è½¯ä»¶åŒ…çš„å®‰è£…çŠ¶æ€ï¼Œå³åœ¨æ­¤æƒ…å†µä¸‹ï¼Œæ”¹å˜å®‰è£…çŠ¶æ€çš„è½¯ä»¶åŒ…æ•°ä¸º 0ã€‚</p><p><strong>è§£é¢˜æ€è·¯</strong><br>è¦ç”»å›¾ç†è§£é¢˜æ„ï¼Œè‹¥Aä¾èµ–Bï¼Œåˆ™å®‰è£…Aä¹‹å‰è¦å®‰è£…Bï¼Œè‹¥å¸è½½Bè¦å…ˆå¸è½½Aã€‚ä¹Ÿå°±æ˜¯è¯´è¦å®‰è£…Aï¼Œå°±è¦ç¡®ä¿Aåˆ°æ ¹èŠ‚ç‚¹è·¯å¾„ä¸Šè½¯ä»¶éƒ½å·²å®‰è£…ï¼›è‹¥å¸è½½Aï¼Œå°±è¦ç¡®ä¿ A çš„å­æ ‘ä¸ºç©ºã€‚</p><p>äºæ˜¯å°±æ˜¯æ ‘ä¸Šæ“ä½œï¼Œè‹¥å¸è½½ä¸€ä¸ªè½¯ä»¶ x ï¼Œå°±æ˜¯æŸ¥è¯¢å®ƒå­æ ‘ä¸Šå·²å®‰è£…çš„è½¯ä»¶ä¸ªæ•°ï¼ˆåŒ…æ‹¬å®ƒè‡ªå·±ï¼‰ï¼Œè¾“å‡ºåå†åˆ é™¤å³å¯ï¼›è‹¥å®‰è£…ä¸€ä¸ªè½¯ä»¶ x ï¼Œå°±æ˜¯æŸ¥è¯¢ x åˆ°æ ¹èŠ‚ç‚¹è·¯å¾„ä¸Šæœªå®‰è£…çš„è½¯ä»¶ä¸ªæ•°ï¼ˆåŒ…æ‹¬å®ƒè‡ªå·±ï¼‰ï¼Œè¾“å‡ºåå†å®‰è£…ã€‚å› ä¸ºè½¯ä»¶å®‰è£…å’Œå¸è½½åªæ˜¯æ”¹å˜å…¶çŠ¶æ€ï¼ˆå·²å®‰è£…ï¼š1ï¼Œæœªå®‰è£…ï¼š0ï¼‰ï¼Œè€Œä¸æ”¹å˜ç»“æ„ï¼ˆå½»åº•åˆ é™¤èŠ‚ç‚¹ï¼‰ï¼Œæ‰€ä»¥å¯ä»¥ç”¨æ ‘é“¾å‰–åˆ†+çº¿æ®µæ ‘è§£å†³ã€‚</p><p>ä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ€ä¹ˆæŠŠæ•´æ£µå­æ ‘éƒ½æ¸…é›¶ï¼Œæ€ä¹ˆæŠŠåˆ°æ ¹èŠ‚ç‚¹çš„è·¯å¾„éƒ½ç½® 1ï¼Œæ˜¾ç„¶è¦ç”¨å»¶è¿Ÿæ ‡è®°ï¼Œä½†æ˜¯å»¶è¿Ÿæ ‡è®°å´ä¸åº”è¯¥ç´¯åŠ ï¼Œé‚£è¦æ€ä¹ˆå¤„ç†ï¼Ÿ<br>ç½® 1 æ—¶å»¶è¿Ÿæ ‡è®°add = 1ï¼Œç½®0æ—¶å»¶è¿Ÿæ ‡è®°add = -1ï¼Œæ¯ä¸€ä¸ªèŠ‚ç‚¹å¦‚æœå»¶è¿Ÿæ ‡è®°ä¸ä¸º0ï¼Œé‚£ä¹ˆè¯¥èŠ‚ç‚¹ä¸ºæ ¹çš„å­æ ‘æ‰€æœ‰è½¯ä»¶çŠ¶æ€ç›¸åŒã€‚æˆ‘ä»¬ä¸‹ä¼ å»¶è¿Ÿæ ‡è®°æ“ä½œå°è£…åœ¨spreadå‡½æ•°å†…ï¼Œå¯ä»¥å‚è€ƒå¦‚ä½•å®ç°å»¶è¿Ÿæ ‡è®°çš„æ›´æ–°ã€‚</p><p><strong>ä»£ç ç¤ºä¾‹</strong></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1e5</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> M = <span class="number">2e5</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">int</span> ll;</span><br><span class="line"><span class="keyword">int</span> head[N],ver[M],edge[M],nex[M],tot = <span class="number">1</span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">addEdge</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> y,<span class="keyword">int</span> z)</span></span>&#123;</span><br><span class="line">    ver[++tot] = y, edge[tot] = z;</span><br><span class="line">    nex[tot] = head[x], head[x] = tot;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> n,m;</span><br><span class="line"><span class="keyword">int</span> par[N],deep[N],size[N],son[N],top[N],seg[N],rev[N];</span><br><span class="line"><span class="keyword">int</span> vis[N];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs1</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> fa)</span></span>&#123;</span><br><span class="line">    vis[x] = <span class="literal">true</span>; par[x] = fa;</span><br><span class="line">    deep[x] = deep[fa]+<span class="number">1</span>; size[x] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = head[x];i ;i = nex[i])&#123;</span><br><span class="line">        <span class="keyword">int</span> y = ver[i], z = edge[i];</span><br><span class="line">        <span class="keyword">if</span>(vis[y]) <span class="keyword">continue</span>;</span><br><span class="line">        dfs1(y,x);</span><br><span class="line">        size[x] += size[y];</span><br><span class="line">        <span class="keyword">if</span>(size[y] &gt; size[son[x]]) son[x] = y;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs2</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> fa)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(son[x])&#123;</span><br><span class="line">        seg[son[x]] = ++seg[<span class="number">0</span>];</span><br><span class="line">        rev[seg[<span class="number">0</span>]] = son[x];</span><br><span class="line">        top[son[x]] = top[x];</span><br><span class="line">        dfs2(son[x],x);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = head[x];i ;i = nex[i])&#123;</span><br><span class="line">        <span class="keyword">int</span> y = ver[i], z = edge[i];</span><br><span class="line">        <span class="keyword">if</span>(top[y]) <span class="keyword">continue</span>;</span><br><span class="line">        seg[y] = ++seg[<span class="number">0</span>]; rev[seg[<span class="number">0</span>]] = y;</span><br><span class="line">        top[y] = y; dfs2(y,x);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">SegmentTree</span>&#123;</span></span><br><span class="line">    <span class="keyword">int</span> l,r,sum,add;</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> l(x) t[x].l</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> r(x) t[x].r</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> sum(x) t[x].sum</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> add(x) t[x].add</span></span><br><span class="line">&#125;t[N*<span class="number">4</span>];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">BuildTree</span><span class="params">(<span class="keyword">int</span> rt,<span class="keyword">int</span> l,<span class="keyword">int</span> r)</span></span>&#123;</span><br><span class="line">    l(rt) = l,r(rt) = r,add(rt) = sum(rt) = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span>(l == r) <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">int</span> mid = l+r&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    BuildTree(rt&lt;&lt;<span class="number">1</span>,l,mid); BuildTree(rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>,mid+<span class="number">1</span>,r);</span><br><span class="line">    sum(rt) = sum(rt&lt;&lt;<span class="number">1</span>) + sum(rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">preHandle</span><span class="params">()</span></span>&#123;</span><br><span class="line">    dfs1(<span class="number">1</span>,<span class="number">0</span>);</span><br><span class="line">    seg[<span class="number">0</span>] = seg[<span class="number">1</span>] = top[<span class="number">1</span>] = rev[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">    dfs2(<span class="number">1</span>,<span class="number">0</span>);</span><br><span class="line">    BuildTree(<span class="number">1</span>,<span class="number">1</span>,seg[<span class="number">0</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">spread</span><span class="params">(<span class="keyword">int</span> rt)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!add(rt)) <span class="keyword">return</span>; </span><br><span class="line">    <span class="keyword">if</span>(add(rt) == <span class="number">-1</span>)&#123;</span><br><span class="line">        sum(rt&lt;&lt;<span class="number">1</span>) = sum(rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>) = <span class="number">0</span>;</span><br><span class="line">        add(rt&lt;&lt;<span class="number">1</span>) = add(rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>) = add(rt);</span><br><span class="line">        add(rt) = <span class="number">0</span>; <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    sum(rt&lt;&lt;<span class="number">1</span>) = (r(rt&lt;&lt;<span class="number">1</span>)-l(rt&lt;&lt;<span class="number">1</span>)+<span class="number">1</span>)*add(rt);</span><br><span class="line">    sum(rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>) = (r(rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>)-l(rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>)+<span class="number">1</span>)*add(rt);</span><br><span class="line">    add(rt&lt;&lt;<span class="number">1</span>) = add(rt); add(rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>) = add(rt);</span><br><span class="line">    add(rt) = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Add</span><span class="params">(<span class="keyword">int</span> rt,<span class="keyword">int</span> l,<span class="keyword">int</span> r,ll val)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(l &lt;= l(rt) &amp;&amp; r(rt) &lt;= r)&#123;</span><br><span class="line">        <span class="keyword">if</span>(val == <span class="number">-1</span>) sum(rt) = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">else</span> sum(rt) = (r(rt) - l(rt)+<span class="number">1</span>);</span><br><span class="line">        add(rt) = val; </span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    spread(rt);</span><br><span class="line">    <span class="keyword">int</span> mid = l(rt)+r(rt)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>(l &lt;= mid) Add(rt&lt;&lt;<span class="number">1</span>,l,r,val);</span><br><span class="line">    <span class="keyword">if</span>(r &gt; mid) Add(rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>,l,r,val);</span><br><span class="line">    sum(rt) = sum(rt&lt;&lt;<span class="number">1</span>)+sum(rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">ll <span class="title">query</span><span class="params">(<span class="keyword">int</span> rt,<span class="keyword">int</span> l,<span class="keyword">int</span> r)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(l &lt;= l(rt) &amp;&amp; r(rt) &lt;= r) <span class="keyword">return</span> sum(rt);</span><br><span class="line">    spread(rt); ll res = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> mid = l(rt) + r(rt) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>(l &lt;= mid) res += query(rt&lt;&lt;<span class="number">1</span>,l,r);</span><br><span class="line">    <span class="keyword">if</span>(r &gt; mid) res += query(rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>,l,r);</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">ask1</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> query(<span class="number">1</span>,seg[x],seg[x]+size[x]<span class="number">-1</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">ask2</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> res = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(x)&#123;</span><br><span class="line">        res += query(<span class="number">1</span>,seg[top[x]],seg[x]);</span><br><span class="line">        x = par[top[x]];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Add2</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">    <span class="keyword">while</span>(x)&#123;</span><br><span class="line">        Add(<span class="number">1</span>,seg[top[x]],seg[x],<span class="number">1</span>);</span><br><span class="line">        x = par[top[x]];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;n);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>,x;i &lt; n;i++)&#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;x);</span><br><span class="line">        addEdge(x+<span class="number">1</span>,i+<span class="number">1</span>,<span class="number">1</span>); addEdge(i+<span class="number">1</span>,x+<span class="number">1</span>,<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    preHandle();</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;m); <span class="keyword">char</span> op[<span class="number">22</span>];</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>,x;i &lt;= m;i++)&#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">"%s%d"</span>,op,&amp;x); x++;</span><br><span class="line">        <span class="keyword">if</span>(op[<span class="number">0</span>] == <span class="string">'u'</span>)&#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">"%d\n"</span>,ask1(x));</span><br><span class="line">            Add(<span class="number">1</span>,seg[x],seg[x]+size[x]<span class="number">-1</span>,<span class="number">-1</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">"%d\n"</span>,deep[x]-ask2(x));</span><br><span class="line">            Add2(x);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æŸ“è‰²"><a href="#æŸ“è‰²" class="headerlink" title="æŸ“è‰²"></a>æŸ“è‰²</h4><p><strong>é¢˜æ„ç®€è¿°</strong><br>åŸé¢˜æ¥è‡ªï¼šSDOI 2011<br>ç»™å®šä¸€æ£µæœ‰ n ä¸ªèŠ‚ç‚¹çš„æ— æ ¹æ ‘å’Œ m ä¸ªæ“ä½œï¼Œæ“ä½œå…±ä¸¤ç±»ã€‚<br>1ã€å°†èŠ‚ç‚¹ a åˆ°èŠ‚ç‚¹ b è·¯å¾„ä¸Šçš„æ‰€æœ‰èŠ‚ç‚¹éƒ½æŸ“ä¸Šé¢œè‰²ï¼›<br>2ã€è¯¢é—®èŠ‚ç‚¹ a åˆ°èŠ‚ç‚¹ b è·¯å¾„ä¸Šçš„é¢œè‰²æ®µæ•°é‡ï¼Œè¿ç»­ç›¸åŒé¢œè‰²çš„è®¤ä¸ºæ˜¯åŒä¸€æ®µï¼Œä¾‹å¦‚ 112221 ç”±ä¸‰æ®µç»„æˆï¼š11 ã€ 222ã€1ã€‚</p><p>è¯·ä½ å†™ä¸€ä¸ªç¨‹åºä¾æ¬¡å®Œæˆæ“ä½œã€‚</p><p><strong>è§£é¢˜æ€è·¯</strong><br>å¦‚æœä¸æ˜¯åœ¨æ ‘ä¸Šï¼Œæ˜¯åœ¨åŒºé—´ä¸Šï¼Œè¯¥å¦‚ä½•æ“ä½œï¼Ÿç”¨çº¿æ®µæ ‘è§£å†³ã€‚çº¿æ®µæ ‘ä¸Šæ¯ä¸ªèŠ‚ç‚¹æœ‰lcï¼šå·¦ç«¯ç‚¹é¢œè‰²ï¼Œrcï¼šå³ç«¯ç‚¹é¢œè‰²ï¼Œsameï¼šåŒºé—´é¢œè‰²æ˜¯å¦å”¯ä¸€ï¼ˆ1è¡¨ç¤ºå”¯ä¸€ï¼Œ0è¡¨ç¤ºä¸å”¯ä¸€ï¼‰ï¼Œsumï¼šåŒºé—´å†…é¢œè‰²æ®µæ•°é‡ã€‚<br>é‚£ä¹ˆæ›´æ–°æ˜¾ç„¶è¦ç”¨å»¶è¿Ÿæ ‡è®°ï¼Œæ ‡è®°åœ¨sameä¸Šï¼Œè€Œåˆå¹¶æ“ä½œéœ€è¦è€ƒè™‘ä¸­é—´ç›¸æ¥çš„ç«¯ç‚¹é¢œè‰²æ˜¯å¦ç›¸åŒï¼Œè‹¥ç›¸åŒåˆ™é¢œè‰²æ®µæ•°é‡è¦-1ã€‚äºæ˜¯åŒºé—´ä¸Šâ€œæŸ“è‰²â€é—®é¢˜å°±å¯ä»¥ç”¨çº¿æ®µæ ‘è§£å†³äº†ã€‚</p><p>åœ¨æ ‘ä¸Šæ˜¾ç„¶ç±»ä¼¼ï¼Œå› ä¸ºæˆ‘ä»¬å¯ä»¥é€šè¿‡æ ‘é“¾å‰–åˆ†æ¥å°†æ ‘ç»™è½¬åŒ–ä¸ºåŒºé—´ã€‚å”¯ä¸€éº»çƒ¦çš„åœ°æ–¹å°±æ˜¯ç«¯ç‚¹é¢œè‰²é—®é¢˜ï¼Œåœ¨åŒºé—´ä¸Šï¼Œæˆ‘ä»¬åªéœ€è¦åˆ¤æ–­å·¦å­æ ‘çš„å³ç«¯ç‚¹ã€å³å­æ ‘çš„å·¦ç«¯ç‚¹æ˜¯å¦é¢œè‰²ç›¸åŒå³å¯ï¼Œä½†æ˜¯æ ‘ä¸Šçš„è·¯å¾„æ˜¯é€šè¿‡å€å¢æ¥æ‰¾çš„ï¼Œæ˜¾ç„¶éœ€è¦è®°å½•æ¯ä¸€æ¡é“¾çš„ç«¯ç‚¹é¢œè‰²ï¼Œéº»çƒ¦åœ¨äºå¦‚ä½•è®°å½•å¹¶åˆ¤æ–­ã€‚</p><p>æ ‘é“¾å‰–åˆ†åèŠ‚ç‚¹è¶Šæµ…ï¼Œå…¶segè¶Šå°ï¼Œäºæ˜¯éœ€è¦åˆ¤æ–­é¢œè‰²æ˜¯å¦ç›¸åŒçš„æ˜¯seg[fx]å’Œ seg[par[fx]]ï¼Œè¿™æ˜¯ç”±äºæˆ‘ä»¬åœ¨å€å¢è°ƒæ•´æ·±åº¦æ—¶å€™æ˜¯è‡ªåº•å‘ä¸Šçš„ï¼Œè‡ªç„¶è¦åˆ¤æ–­æ·±åº¦æµ…çš„èŠ‚ç‚¹ã€‚ä¸ºäº†ç¾è§‚ä»¥åŠç®€ä¾¿ï¼Œè®¾ getcol(x) è¿”å›è¯¥èŠ‚ç‚¹çš„é¢œè‰²ã€‚</p><p><strong>ä»£ç ç¤ºä¾‹</strong><br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1e5</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> M = <span class="number">2e5</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> INF = <span class="number">0x3f3f3f3f</span>;</span><br><span class="line"><span class="keyword">int</span> head[N],edge[M],ver[M],nex[M], tot = <span class="number">1</span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">addEdge</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> y,<span class="keyword">int</span> z)</span></span>&#123;</span><br><span class="line">    ver[++tot] = y, edge[tot] = z;</span><br><span class="line">    nex[tot] = head[x], head[x] = tot;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> deep[N],seg[N],rev[N],top[N],son[N],size[N],par[N];</span><br><span class="line"><span class="keyword">int</span> vis[N],a[N];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs1</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> fa)</span></span>&#123;</span><br><span class="line">    vis[x] = <span class="literal">true</span>; par[x] = fa;</span><br><span class="line">    deep[x] = deep[fa]+<span class="number">1</span>; size[x] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = head[x];i;i = nex[i])&#123;</span><br><span class="line">        <span class="keyword">int</span> y = ver[i], z = edge[i];</span><br><span class="line">        <span class="keyword">if</span>(vis[y] || y == fa) <span class="keyword">continue</span>;</span><br><span class="line">        dfs1(y,x);</span><br><span class="line">        size[x] += size[y];</span><br><span class="line">        <span class="keyword">if</span>(size[y] &gt; size[son[x]]) son[x] = y;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs2</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> fa)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(son[x])&#123;</span><br><span class="line">        seg[son[x]] = ++seg[<span class="number">0</span>];</span><br><span class="line">        rev[seg[<span class="number">0</span>]] = son[x];</span><br><span class="line">        top[son[x]] = top[x];</span><br><span class="line">        dfs2(son[x],x);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = head[x];i;i = nex[i])&#123;</span><br><span class="line">        <span class="keyword">int</span> y = ver[i], z = edge[i];</span><br><span class="line">        <span class="keyword">if</span>(top[y]) <span class="keyword">continue</span>;</span><br><span class="line">        seg[y] = ++seg[<span class="number">0</span>]; rev[seg[<span class="number">0</span>]] = y;</span><br><span class="line">        top[y] = y; dfs2(y,x);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">SegmentTree</span>&#123;</span></span><br><span class="line">    <span class="comment">/*lc:åŒºé—´å·¦ç«¯ç‚¹é¢œè‰²,rc:åŒºé—´å³ç«¯ç‚¹é¢œè‰²,sum:åŒºé—´å†…é¢œè‰²æ®µæ•°*/</span></span><br><span class="line">    <span class="keyword">int</span> l,r,lc,rc,sum;</span><br><span class="line">    <span class="keyword">int</span> same;</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> l(x) t[x].l</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> r(x) t[x].r</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> lc(x) t[x].lc</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> rc(x) t[x].rc</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> sum(x) t[x].sum</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> same(x) t[x].same</span></span><br><span class="line">&#125;t[N*<span class="number">4</span>];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Updata</span><span class="params">(<span class="keyword">int</span> rt)</span></span>&#123;<span class="comment">//æ›´æ–°èŠ‚ç‚¹rtçš„sameã€rcã€lcå’Œsum</span></span><br><span class="line">    same(rt) = same(rt&lt;&lt;<span class="number">1</span>) &amp;&amp; same(rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>) &amp;&amp; rc(rt&lt;&lt;<span class="number">1</span>) == lc(rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>);</span><br><span class="line">    sum(rt) = sum(rt&lt;&lt;<span class="number">1</span>)+sum(rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span>(rc(rt&lt;&lt;<span class="number">1</span>) == lc(rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>)) sum(rt)--;</span><br><span class="line">    lc(rt) = lc(rt&lt;&lt;<span class="number">1</span>); rc(rt) = rc(rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">BuildTree</span><span class="params">(<span class="keyword">int</span> rt,<span class="keyword">int</span> l,<span class="keyword">int</span> r)</span></span>&#123;</span><br><span class="line">    l(rt) = l,r(rt) = r,same(rt) = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span>(l == r)&#123;</span><br><span class="line">        lc(rt) = rc(rt) = a[rev[l]];</span><br><span class="line">        sum(rt) = <span class="number">1</span>; <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> mid = l + r &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    BuildTree(rt&lt;&lt;<span class="number">1</span>,l,mid); BuildTree(rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>,mid+<span class="number">1</span>,r);</span><br><span class="line">    Updata(rt);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">preHandle</span><span class="params">()</span></span>&#123;</span><br><span class="line">    dfs1(<span class="number">1</span>,<span class="number">0</span>);</span><br><span class="line">    seg[<span class="number">0</span>] = seg[<span class="number">1</span>] = rev[<span class="number">1</span>] = top[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">    dfs2(<span class="number">1</span>,<span class="number">0</span>);</span><br><span class="line">    BuildTree(<span class="number">1</span>,<span class="number">1</span>,seg[<span class="number">0</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">spread</span><span class="params">(<span class="keyword">int</span> rt)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!same(rt)) <span class="keyword">return</span>;<span class="comment">//å°†æ‡’æƒ°æ ‡è®°ä¸‹ä¼ ï¼Œå³å¯¹å­æ ‘æŸ“ç›¸åŒé¢œè‰²</span></span><br><span class="line">    sum(rt&lt;&lt;<span class="number">1</span>) = sum(rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>) = <span class="number">1</span>;</span><br><span class="line">    lc(rt&lt;&lt;<span class="number">1</span>) = rc(rt&lt;&lt;<span class="number">1</span>) = lc(rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>) = rc(rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>) = lc(rt);</span><br><span class="line">    same(rt&lt;&lt;<span class="number">1</span>) = same(rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>) = <span class="number">1</span>; same(rt) = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">modify</span><span class="params">(<span class="keyword">int</span> rt,<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> col)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(l &lt;= l(rt) &amp;&amp; r(rt) &lt;= r)&#123;</span><br><span class="line">        sum(rt) = <span class="number">1</span>; lc(rt) = rc(rt) = col;</span><br><span class="line">        same(rt) = <span class="number">1</span>; <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    spread(rt);<span class="comment">//æ‡’æƒ°æ ‡è®°</span></span><br><span class="line">    <span class="keyword">int</span> mid = l(rt)+r(rt)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>(l &lt;= mid) modify(rt&lt;&lt;<span class="number">1</span>,l,r,col);</span><br><span class="line">    <span class="keyword">if</span>(r &gt; mid) modify(rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>,l,r,col);</span><br><span class="line">    Updata(rt);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">change</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> y,<span class="keyword">int</span> z)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> fx = top[x],fy = top[y];</span><br><span class="line">    <span class="keyword">while</span>(fx != fy)&#123;</span><br><span class="line">        <span class="keyword">if</span>(deep[fx] &lt; deep[fy]) swap(x,y),swap(fx,fy);</span><br><span class="line">        modify(<span class="number">1</span>,seg[fx],seg[x],z);</span><br><span class="line">        x = par[fx]; fx = top[x];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(deep[x] &gt; deep[y]) swap(x,y);</span><br><span class="line">    modify(<span class="number">1</span>,seg[x],seg[y],z);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">query</span><span class="params">(<span class="keyword">int</span> rt,<span class="keyword">int</span> l,<span class="keyword">int</span> r)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(l &lt;= l(rt) &amp;&amp; r(rt) &lt;= r) <span class="keyword">return</span> sum(rt);</span><br><span class="line">    spread(rt);</span><br><span class="line">    <span class="keyword">int</span> mid = l(rt)+r(rt)&gt;&gt;<span class="number">1</span> ,res= <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span>(l &lt;= mid) res += query(rt&lt;&lt;<span class="number">1</span>,l,r);</span><br><span class="line">    <span class="keyword">if</span>(r &gt; mid) res += query(rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>,l,r);</span><br><span class="line">    <span class="comment">/*åˆå¹¶æ—¶ä¸­é—´é¢œè‰²ç›¸åŒ,è¦å‡å»ä¸€æ®µ*/</span></span><br><span class="line">    <span class="keyword">if</span>(l &lt;= mid &amp;&amp; mid &lt; r &amp;&amp; rc(rt&lt;&lt;<span class="number">1</span>) == lc(rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>)) res--;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">getcol</span><span class="params">(<span class="keyword">int</span> rt,<span class="keyword">int</span> x)</span></span>&#123;<span class="comment">//è¿™ä¸ªå‡½æ•°å¤ªå¥½ç”¨äº†ï¼Œå“­å“­</span></span><br><span class="line">    <span class="keyword">if</span>(l(rt) == r(rt)) <span class="keyword">return</span> lc(rt);</span><br><span class="line">    spread(rt);</span><br><span class="line">    <span class="keyword">int</span> mid = l(rt)+r(rt)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>(x &lt;= mid) <span class="keyword">return</span> getcol(rt&lt;&lt;<span class="number">1</span>,x);</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">return</span> getcol(rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>,x);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">ask</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> y)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> fx = top[x], fy = top[y], res = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(fx != fy)&#123;</span><br><span class="line">        <span class="keyword">if</span>(deep[fx] &lt; deep[fy]) swap(fx,fy),swap(x,y);</span><br><span class="line">        res += query(<span class="number">1</span>,seg[fx],seg[x]);</span><br><span class="line">        <span class="keyword">if</span>(getcol(<span class="number">1</span>,seg[fx]) == getcol(<span class="number">1</span>,seg[par[fx]])) res--;</span><br><span class="line">        x = par[fx]; fx = top[x];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(deep[x] &gt; deep[y]) swap(x,y);</span><br><span class="line">    res += query(<span class="number">1</span>,seg[x],seg[y]);</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> n,m;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;n,&amp;m);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++) <span class="built_in">scanf</span>(<span class="string">"%d"</span>,a+i);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>,x,y;i &lt; n;i++)&#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;x,&amp;y); </span><br><span class="line">        addEdge(x,y,<span class="number">1</span>); addEdge(y,x,<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    preHandle(); <span class="keyword">char</span> op[<span class="number">4</span>];</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>,x,y,z;i &lt;= m;i++)&#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">"%s"</span>,op);</span><br><span class="line">        <span class="keyword">if</span>(op[<span class="number">0</span>] == <span class="string">'Q'</span>)&#123;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;x,&amp;y);</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">"%d\n"</span>,ask(x,y));</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">"%d%d%d"</span>,&amp;x,&amp;y,&amp;z);</span><br><span class="line">            change(x,y,z);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h4 id="ã€ŒSDOI2014ã€æ—…è¡Œ"><a href="#ã€ŒSDOI2014ã€æ—…è¡Œ" class="headerlink" title="ã€ŒSDOI2014ã€æ—…è¡Œ"></a>ã€ŒSDOI2014ã€æ—…è¡Œ</h4><p><strong>é¢˜æ„ç®€è¿°</strong><br>S å›½æœ‰ N ä¸ªåŸå¸‚ï¼Œç¼–å·ä» 1 åˆ° Nã€‚åŸå¸‚é—´ç”¨ Nâˆ’1 æ¡åŒå‘é“è·¯è¿æ¥ï¼Œæ»¡è¶³ä»ä¸€ä¸ªåŸå¸‚å‡ºå‘å¯ä»¥åˆ°è¾¾å…¶å®ƒæ‰€æœ‰åŸå¸‚ã€‚æ¯ä¸ªåŸå¸‚ä¿¡ä»°ä¸åŒçš„å®—æ•™ï¼Œå¦‚é£å¤©é¢æ¡ç¥æ•™ã€éšå½¢ç‹¬è§’å…½æ•™ã€ç»åœ°æ•™éƒ½æ˜¯å¸¸è§çš„ä¿¡ä»°ã€‚ä¸ºäº†æ–¹ä¾¿ï¼Œæˆ‘ä»¬ç”¨ä¸åŒçš„æ­£æ•´æ•°ä»£è¡¨å„ç§å®—æ•™ï¼ŒS å›½å¢ƒå†…æ€»å…±æœ‰ C ç§ä¸åŒçš„å®—æ•™ã€‚<br>S å›½çš„å±…æ°‘å¸¸å¸¸æ—…è¡Œã€‚æ—…è¡Œæ—¶ä»–ä»¬æ€»ä¼šèµ°æœ€çŸ­è·¯ï¼Œå¹¶ä¸”ä¸ºäº†é¿å…éº»çƒ¦ï¼Œåªåœ¨ä¿¡ä»°å’Œä»–ä»¬ç›¸åŒçš„åŸå¸‚ç•™å®¿ã€‚å½“ç„¶æ—…ç¨‹çš„ç»ˆç‚¹ä¹Ÿæ˜¯ä¿¡ä»°ä¸ä»–ç›¸åŒçš„åŸå¸‚ã€‚S å›½æ”¿åºœä¸ºæ¯ä¸ªåŸå¸‚æ ‡å®šäº†ä¸åŒçš„æ—…è¡Œè¯„çº§ï¼Œæ—…è¡Œè€…ä»¬å¸¸ä¼šè®°ä¸‹é€”ä¸­ï¼ˆåŒ…æ‹¬èµ·ç‚¹å’Œç»ˆç‚¹ï¼‰ç•™å®¿è¿‡çš„åŸå¸‚çš„è¯„çº§æ€»å’Œæˆ–æœ€å¤§å€¼ã€‚<br>åœ¨ S å›½çš„å†å²ä¸Šå¸¸ä¼šå‘ç”Ÿä»¥ä¸‹å‡ ç§äº‹ä»¶ï¼š</p><p>1ã€CC x cï¼šåŸå¸‚ x çš„å±…æ°‘å…¨ä½“æ”¹ä¿¡äº† c æ•™ï¼›</p><p>2ã€CW x wï¼šåŸå¸‚ x çš„è¯„çº§è°ƒæ•´ä¸º wï¼›</p><p>3ã€QS x yï¼šä¸€ä½æ—…è¡Œè€…ä»åŸå¸‚ x å‡ºå‘ï¼Œåˆ°åŸå¸‚ yï¼Œå¹¶è®°ä¸‹äº†é€”ä¸­ç•™å®¿è¿‡çš„åŸå¸‚çš„è¯„çº§æ€»å’Œï¼›</p><p>4ã€QM x yï¼šä¸€ä½æ—…è¡Œè€…ä»åŸå¸‚ x å‡ºå‘ï¼Œåˆ°åŸå¸‚ yï¼Œå¹¶è®°ä¸‹äº†é€”ä¸­ç•™å®¿è¿‡çš„åŸå¸‚çš„è¯„çº§æœ€å¤§å€¼ã€‚<br>ç”±äºå¹´ä»£ä¹…è¿œï¼Œæ—…è¡Œè€…è®°ä¸‹çš„æ•°å­—å·²ç»é—å¤±äº†ï¼Œä½†è®°å½•å¼€å§‹ä¹‹å‰æ¯åº§åŸå¸‚çš„ä¿¡ä»°ä¸è¯„çº§ï¼Œè¿˜æœ‰äº‹ä»¶è®°å½•æœ¬èº«æ˜¯å®Œå¥½çš„ã€‚è¯·æ ¹æ®è¿™äº›ä¿¡æ¯ï¼Œè¿˜åŸæ—…è¡Œè€…è®°ä¸‹çš„æ•°å­—ã€‚</p><p>ä¸ºäº†æ–¹ä¾¿ï¼Œæˆ‘ä»¬è®¤ä¸ºäº‹ä»¶ä¹‹é—´çš„é—´éš”è¶³å¤Ÿé•¿ï¼Œä»¥è‡´åœ¨ä»»æ„ä¸€æ¬¡æ—…è¡Œä¸­ï¼Œæ‰€æœ‰åŸå¸‚çš„è¯„çº§å’Œä¿¡ä»°ä¿æŒä¸å˜ã€‚<br><strong>è§£é¢˜æ€è·¯</strong><br>å¦‚æœæ²¡æœ‰ä¿¡ä»°ï¼Œé‚£å°±æ˜¯ç®€å•çš„æ ‘é“¾å‰–åˆ†æ¨¡æ¿é¢˜ï¼Œä½†è¿™é¢˜å¤šäº†ä¸ªä¿¡ä»°ï¼Œæ­£å¸¸æ€è·¯æ˜¯å¼€æ•°ç»„å­˜æ”¾å¯¹åº”ä¿¡ä»°çš„è¯„çº§ï¼Œä½†æ˜¯æ˜¾ç„¶ä¸ç°å®ï¼Œä»ç©ºé—´è§’åº¦æ¥çœ‹ã€‚<br>è¿™é¢˜ç”¨åˆ°äº†åŠ¨æ€å¼€ç‚¹ï¼Œå’Œå¯æŒä¹…åŒ–çº¿æ®µæ ‘ç±»ä¼¼ï¼Œåªéœ€è¦ç¨å¾®æ”¹ä¸€ä¸‹çº¿æ®µæ ‘æ¨¡æ¿å³å¯ã€‚</p><p><strong>ä»£ç ç¤ºä¾‹</strong><br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1e5</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> M = <span class="number">2e5</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">int</span> head[N],ver[M],edge[M],nex[M],tot = <span class="number">1</span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">addEdge</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> y,<span class="keyword">int</span> z)</span></span>&#123;</span><br><span class="line">    ver[++tot] = y,edge[tot] = z;</span><br><span class="line">    nex[tot] = head[x], head[x] = tot;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> n,m;</span><br><span class="line"><span class="keyword">int</span> deep[N],par[N],size[N],top[N],seg[N],rev[N],son[N];</span><br><span class="line"><span class="keyword">int</span> vis[N],a[N],c[N];<span class="comment">//a:åˆå§‹è¯„çº§ c:åˆå§‹ä¿¡ä»°</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs1</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> fa)</span></span>&#123;</span><br><span class="line">    deep[x] = deep[fa]+<span class="number">1</span>;par[x] = fa;</span><br><span class="line">    size[x] = <span class="number">1</span>;vis[x] = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = head[x];i ;i = nex[i])&#123;</span><br><span class="line">        <span class="keyword">int</span> y = ver[i], z = edge[i];</span><br><span class="line">        <span class="keyword">if</span>(vis[y] || y == fa) <span class="keyword">continue</span>;</span><br><span class="line">        dfs1(y,x);</span><br><span class="line">        size[x] += size[y];</span><br><span class="line">        <span class="keyword">if</span>(size[y] &gt; size[son[x]]) son[x] = y;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs2</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> fa)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(son[x])&#123;</span><br><span class="line">        seg[son[x]] = ++seg[<span class="number">0</span>];</span><br><span class="line">        rev[seg[<span class="number">0</span>]] = son[x];</span><br><span class="line">        top[son[x]] = top[x];</span><br><span class="line">        dfs2(son[x],x);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = head[x];i;i = nex[i])&#123;</span><br><span class="line">        <span class="keyword">int</span> y = ver[i],z = edge[i];</span><br><span class="line">        <span class="keyword">if</span>(top[y]) <span class="keyword">continue</span>;</span><br><span class="line">        seg[y] = ++seg[<span class="number">0</span>]; rev[seg[<span class="number">0</span>]] = y;</span><br><span class="line">        top[y] = y; dfs2(y,x);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">SegmentTree</span>&#123;</span></span><br><span class="line">    <span class="keyword">int</span> ls,rs;</span><br><span class="line">    ll mx,sum;</span><br><span class="line">    SegmentTree()&#123;</span><br><span class="line">        ls = rs = mx = sum = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> ls(x) t[x].ls</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> rs(x) t[x].rs</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> mx(x) t[x].mx</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> sum(x) t[x].sum</span></span><br><span class="line">&#125;t[N*<span class="number">20</span>];</span><br><span class="line"><span class="keyword">int</span> root[N],sz = <span class="number">1</span>;<span class="comment">//æœ€å¤šæœ‰å¤šå°‘ä¸ªæ ¹èŠ‚ç‚¹</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">preHandle</span><span class="params">()</span></span>&#123;</span><br><span class="line">    dfs1(<span class="number">1</span>,<span class="number">0</span>);</span><br><span class="line">    seg[<span class="number">0</span>] = seg[<span class="number">1</span>] = rev[<span class="number">1</span>] = top[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">    dfs2(<span class="number">1</span>,<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Add</span><span class="params">(<span class="keyword">int</span> &amp;rt,<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> pos,ll val)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!rt) rt = ++sz;</span><br><span class="line">    mx(rt) = max(mx(rt),val); sum(rt) += val;</span><br><span class="line">    <span class="keyword">if</span>(l == r) <span class="keyword">return</span>; <span class="keyword">int</span> mid = l+r&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>(pos &lt;= mid) Add(ls(rt),l,mid,pos,val);</span><br><span class="line">    <span class="keyword">else</span> Add(rs(rt),mid+<span class="number">1</span>,r,pos,val);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Delete</span><span class="params">(<span class="keyword">int</span> rt,<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> pos)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(l == r)&#123;</span><br><span class="line">        sum(rt) = mx(rt) = <span class="number">0</span>; <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> mid = l+r&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>(pos &lt;= mid) Delete(ls(rt),l,mid,pos);</span><br><span class="line">    <span class="keyword">else</span> Delete(rs(rt),mid+<span class="number">1</span>,r,pos);</span><br><span class="line">    sum(rt) = sum(ls(rt)) + sum(rs(rt));</span><br><span class="line">    mx(rt) = max(mx(ls(rt)),mx(rs(rt)));</span><br><span class="line">&#125;</span><br><span class="line">ll mx,sum;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">query</span><span class="params">(<span class="keyword">int</span> rt,<span class="keyword">int</span> L,<span class="keyword">int</span> R,<span class="keyword">int</span> l,<span class="keyword">int</span> r)</span></span>&#123;</span><br><span class="line">  <span class="comment">//  printf("%d %d %d %d %d\n",rt,L,R,l,r);</span></span><br><span class="line">    <span class="keyword">if</span>(!rt) <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">if</span>(l &lt;= L &amp;&amp; R &lt;= r)&#123;</span><br><span class="line">      <span class="comment">//  printf("%d %d\n",mx(rt),sum(rt));</span></span><br><span class="line">        mx = max(mx,mx(rt)); sum += sum(rt); <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> mid = L+R&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>(l &lt;= mid) query(ls(rt),L,mid,l,r);</span><br><span class="line">    <span class="keyword">if</span>(r &gt; mid) query(rs(rt),mid+<span class="number">1</span>,R,l,r);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ask</span><span class="params">(<span class="keyword">int</span> rt,<span class="keyword">int</span> x,<span class="keyword">int</span> y)</span></span>&#123;</span><br><span class="line">    <span class="comment">/*è¿”å›xåˆ°yè·¯å¾„ä¸Šä¿¡ä»°rtçš„è¯„çº§æœ€å¤§å€¼ä»¥åŠæ€»å’Œ*/</span></span><br><span class="line">    <span class="keyword">int</span> fx = top[x],fy = top[y];</span><br><span class="line">    <span class="keyword">while</span>(fx != fy)&#123;</span><br><span class="line">        <span class="keyword">if</span>(deep[fx] &lt; deep[fy]) swap(x,y),swap(fx,fy);</span><br><span class="line">        query(rt,<span class="number">1</span>,seg[<span class="number">0</span>],seg[fx],seg[x]);</span><br><span class="line">        x = par[fx]; fx = top[x];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(deep[x] &gt; deep[y]) swap(x,y);</span><br><span class="line">    query(rt,<span class="number">1</span>,seg[<span class="number">0</span>],seg[x],seg[y]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;n,&amp;m);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++) <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,a+i,c+i);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>,x,y;i &lt; n;i++)&#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;x,&amp;y);</span><br><span class="line">        addEdge(x,y,<span class="number">1</span>); addEdge(y,x,<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    preHandle();</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++)</span><br><span class="line">        Add(root[c[i]],<span class="number">1</span>,seg[<span class="number">0</span>],seg[i],a[i]);</span><br><span class="line">    <span class="keyword">char</span> op[<span class="number">10</span>];</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>,x,y;i &lt;= m;i++)&#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">"%s%d%d"</span>,op,&amp;x,&amp;y);</span><br><span class="line">        <span class="keyword">if</span>(op[<span class="number">1</span>] == <span class="string">'C'</span>)&#123;</span><br><span class="line">            Delete(root[c[x]],<span class="number">1</span>,seg[<span class="number">0</span>],seg[x]);</span><br><span class="line">            Add(root[c[x] = y],<span class="number">1</span>,seg[<span class="number">0</span>],seg[x],a[x]);</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(op[<span class="number">1</span>] == <span class="string">'W'</span>)&#123;</span><br><span class="line">            Delete(root[c[x]],<span class="number">1</span>,seg[<span class="number">0</span>],seg[x]);</span><br><span class="line">            Add(root[c[x]],<span class="number">1</span>,seg[<span class="number">0</span>],seg[x],a[x] = y);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            mx = sum = <span class="number">0</span>;<span class="comment">//ä¸€èµ·æ›´æ–°ï¼Œå°‘å†™ä»£ç ï¼Œç¾æ»‹æ»‹</span></span><br><span class="line">            ask(root[c[x]],x,y);</span><br><span class="line">            <span class="keyword">if</span>(op[<span class="number">1</span>] == <span class="string">'S'</span>) <span class="built_in">printf</span>(<span class="string">"%lld\n"</span>,sum);</span><br><span class="line">            <span class="keyword">else</span> <span class="built_in">printf</span>(<span class="string">"%lld\n"</span>,mx);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;æ ‘é“¾å‰–åˆ†å¸¸ç”¨äºå¤„ç†é™æ€æ ‘ä¸Šæ“ä½œï¼Œæ•ˆç‡å¾ˆé«˜ï¼Œå†™èµ·æ¥ä¹Ÿå°±æ˜¯å›ºå®šçš„è½»é‡è¾¹æ‹†åˆ†+çº¿æ®µæ ‘ï¼Œä½†æ˜¯ä»£ç ä¸€èˆ¬éƒ½æ˜¯100è¡Œ+ï¼Œå®¹æ˜“å‡ºé”™ã€‚&lt;br&gt;æœ¬é¢˜é›†ä¸­çš„æ ‘é“¾å‰–åˆ†ç»ƒä¹ é¢˜ï¼Œåœ¨è§£å†³æ€è·¯ä¸Šæ²¡ä»€ä¹ˆéš¾ç‚¹ï¼Œä¸»è¦æ˜¯å¦‚ä½•è®¾è®¡çº¿æ®µæ ‘ä»¥åŠå¦‚ä½•æ›´æ–°+è¯¢é—®ï¼Œä¹Ÿå°±æ˜¯è¯´è¦æƒ³å¥½æ€ä¹ˆç»´æŠ¤çº¿æ®µæ ‘ï¼Œå…¶å®ƒåœ°æ–¹æ²¡ä»€ä¹ˆå¤ªéš¾çš„ï¼Œä½†æ˜¯ä»£
      
    
    </summary>
    
      <category term="ACMé¢˜è§£" scheme="http://valenshi.top/categories/ACM%E9%A2%98%E8%A7%A3/"/>
    
    
      <category term="æ ‘é“¾å‰–åˆ†" scheme="http://valenshi.top/tags/%E6%A0%91%E9%93%BE%E5%89%96%E5%88%86/"/>
    
  </entry>
  
  <entry>
    <title>æ ‘é“¾å‰–åˆ†ç¬”è®°</title>
    <link href="http://valenshi.top/2019/10/10/lct/"/>
    <id>http://valenshi.top/2019/10/10/lct/</id>
    <published>2019-10-10T05:03:03.000Z</published>
    <updated>2019-10-10T07:58:48.913Z</updated>
    
    <content type="html"><![CDATA[<h4 id="æ‘˜è¦"><a href="#æ‘˜è¦" class="headerlink" title="æ‘˜è¦"></a>æ‘˜è¦</h4><p>æ ‘é“¾å‰–åˆ†æ˜¯ç”¨æ¥ç»´æŠ¤é™æ€æ ‘ä¸Šè·¯å¾„ä¿¡æ¯çš„æ•°æ®ç»“æ„ï¼Œé™æ€å³æ ‘çš„å½¢æ€ä¸èƒ½æ”¹å˜ï¼ˆå¢åˆ ç‚¹æˆ–è€…æ¢æ ¹ï¼Œæ”¹å˜äº†æ„é€ ï¼‰ã€‚<br>å…¶æ€æƒ³æ˜¯å°†æ ‘ä¸Šçš„è·¯å¾„åˆ†ä¸ºé‡è·¯å¾„å’Œè½»è¾¹ï¼Œç„¶åä¸ºæ¯ä¸ªèŠ‚ç‚¹åˆ†é…ä¸€ä¸ªç¼–å·ï¼Œé‡è·¯å¾„ä¸ŠèŠ‚ç‚¹çš„ç¼–å·æ˜¯è¿ç»­çš„ï¼›æ¥ç€å¯¹è¿™äº›ç¼–å·å»ºç«‹ä¸€æ£µçº¿æ®µæ ‘ï¼Œè¿™æ ·å°±å¯ä»¥å°†é‡è·¯å¾„å½“ä½œåŒºé—´æ¥ç»´æŠ¤äº†ï¼›åˆ©ç”¨äº†â€œæ¯ä¸ªç‚¹åˆ°æ ¹çš„è·¯å¾„ä¸Šéƒ½æœ‰ä¸è¶…è¿‡O(logN)æ¡è½»è¾¹å’ŒO(logN)æ¡é‡è·¯å¾„â€ç»“è®ºæ¥ä¿è¯æ—¶é—´å¤æ‚åº¦ã€‚</p><h4 id="ç®—æ³•ç®€ä»‹"><a href="#ç®—æ³•ç®€ä»‹" class="headerlink" title="ç®—æ³•ç®€ä»‹"></a>ç®—æ³•ç®€ä»‹</h4><p>æ ‘é“¾å‰–åˆ†é€šå¸¸ç”¨äºè§£å†³ä¸€ç±»ç»´æŠ¤é™æ€æ ‘ä¸Šè·¯å¾„ä¿¡æ¯çš„é—®é¢˜ï¼Œä¾‹å¦‚ï¼Œç»™å®šä¸€æ£µç‚¹å¸¦æƒçš„æ ‘ï¼Œæ¥ä¸‹æ¥æ¯æ¬¡æ“ä½œä¼šä¿®æ”¹æŸæ¡è·¯å¾„ä¸Šæ‰€æœ‰ç‚¹çš„æƒå€¼ï¼ˆä¿®æ”¹ä¸ºåŒä¸€ä¸ªå€¼æˆ–æ˜¯åŠ ä¸ŠåŒä¸€ä¸ªå€¼ç­‰ï¼‰ï¼Œä»¥åŠè¯¢é—®æŸæ¡è·¯å¾„ä¸Šæ‰€æœ‰ç‚¹çš„æƒå€¼å’Œã€‚</p><p>å½“è¿™æ£µæ ‘æ˜¯ä¸€æ¡é“¾æ—¶ï¼Œè¿™ä¸ªé—®é¢˜å®é™…ä¸Šå°±æ˜¯ä¸€ä¸ªåºåˆ—ä¸ŠåŒºé—´ä¿®æ”¹ã€åŒºé—´è¯¢é—®çš„é—®é¢˜ï¼Œå¯ä»¥ç”¨çº¿æ®µæ ‘ç­‰æ•°æ®ç»“æ„è§£å†³ã€‚</p><p>å¯¹äºå…¶ä»–æƒ…å†µï¼Œç”±äºæ ‘çš„å½¢æ€æ˜¯ä¸å˜çš„ï¼Œå› æ­¤æ ‘é“¾å‰–åˆ†çš„ç­–ç•¥æ˜¯å°†è¿™äº›ç‚¹æŒ‰æŸç§æ–¹å¼ç»„ç»‡èµ·æ¥ï¼Œå‰–åˆ†æˆè‹¥å¹²æ¡é“¾ï¼Œæ¯æ¡é“¾å°±ç›¸å½“äºä¸€ä¸ªåºåˆ—ã€‚è¿™æ ·ï¼Œæ“ä½œçš„è·¯å¾„å¯ä»¥æ‹†åˆ†ä¸ºæŸå‡ æ¡é“¾ï¼Œä¹Ÿå°±æ˜¯è‹¥å¹²ä¸ªå®Œæ•´åºåˆ—æˆ–æ˜¯æŸä¸ªåºåˆ—ä¸Šçš„ä¸€æ®µåŒºé—´ï¼Œæ­¤æ—¶å¯åˆ©ç”¨çº¿æ®µæ ‘ç­‰å¤„ç†åºåˆ—ä¸ŠåŒºé—´æ“ä½œçš„æ•°æ®ç»“æ„è§£å†³é—®é¢˜ã€‚</p><p>æ ‘é“¾å‰–åˆ†çš„æ ¸å¿ƒæ˜¯å¦‚ä½•æ°å½“çš„å°†æ ‘å‰–åˆ†ä¸ºè‹¥å¹²æ¡é“¾ã€‚å½“é“¾çš„åˆ’åˆ†æ–¹å¼ç¡®å®šåï¼Œæˆ‘ä»¬åªè¦å°†å®ƒä»¬çœ‹ä½œæ˜¯ä¸€ä¸ªä¸ªåºåˆ—ï¼Œå°†æ‰€æœ‰åºåˆ—æŒ‰é¡ºåºæ‹¼æ¥èµ·æ¥ï¼Œæ¯æ¡é“¾å°±æˆäº†ä¸€æ®µåŒºé—´ï¼Œè€Œåºåˆ—ä¸Šçš„åŒºé—´é—®é¢˜æ˜¯æˆ‘ä»¬æ‰€ç†Ÿæ‚‰å’Œæ“…é•¿çš„ã€‚</p><h4 id="ç®—æ³•æµç¨‹"><a href="#ç®—æ³•æµç¨‹" class="headerlink" title="ç®—æ³•æµç¨‹"></a>ç®—æ³•æµç¨‹</h4><h5 id="åˆ’åˆ†è½»é‡è¾¹"><a href="#åˆ’åˆ†è½»é‡è¾¹" class="headerlink" title="åˆ’åˆ†è½»é‡è¾¹"></a>åˆ’åˆ†è½»é‡è¾¹</h5><p>ä¸‹é¢ä»¥ç‚¹å¸¦æƒçš„æ ‘ä¸ºä¾‹ï¼Œç»“åˆè·¯å¾„æƒå€¼ä¿®æ”¹ã€è·¯å¾„è¯¢é—®æƒå€¼å’Œé—®é¢˜ï¼Œä»‹ç»å¸¸ç”¨çš„å‰–åˆ†æ–¹æ³•ï¼Œè¯¥æ–¹æ³•æ˜¯è½»ã€é‡è¾¹å‰–åˆ†ã€‚<br>æˆ‘ä»¬å°†æ ‘ä¸­çš„è¾¹åˆ†ä¸ºä¸¤ç§ï¼šè½»è¾¹ å’Œ é‡è¾¹ã€‚å¦‚å›¾1æ‰€ç¤ºï¼Œå›¾ä¸­çº¢è‰²çš„è¾¹æ˜¯é‡è¾¹ï¼Œå…¶ä½™çš„æ˜¯è½»è¾¹ã€‚<br><img src="/2019/10/10/lct/1.png" alt="1"><br>å›¾1ï¼šèŠ‚ç‚¹æ•°å­—ä»£è¡¨å­æ ‘å¤§å°ï¼ˆsizeï¼‰<br>æˆ‘ä»¬å¯ä»¥ä»¥ä»»æ„ç‚¹ä¸ºæ ¹ï¼Œç„¶åè®°size( u )ä¸ºä»¥uä¸ºæ ¹çš„å­æ ‘çš„èŠ‚ç‚¹ä¸ªæ•°ï¼Œä»¤ v ä¸º u æ‰€æœ‰å„¿å­ä¸­ size å€¼æœ€å¤§çš„ä¸€ä¸ªï¼Œåˆ™(u,v)æ˜¯é‡è¾¹ï¼Œv ç§°ä¸º u çš„é‡å„¿å­ã€‚u åˆ°å…¶ä½™å„¿å­çš„è¾¹ä¸ºè½»è¾¹ã€‚</p><h5 id="è½»é‡è¾¹çš„æ€§è´¨"><a href="#è½»é‡è¾¹çš„æ€§è´¨" class="headerlink" title="è½»é‡è¾¹çš„æ€§è´¨"></a>è½»é‡è¾¹çš„æ€§è´¨</h5><p>è½»é‡è¾¹æœ‰å¦‚ä¸‹å‡ ä¸ªæ€§è´¨ï¼š</p><ol><li>å¦‚æœ(u , v)ä¸ºè½»è¾¹ï¼Œåˆ™ size( v ) &lt;= size( u ) / 2ã€‚</li><li>ä»æ ¹åˆ°æŸä¸€ç‚¹vçš„è·¯å¾„ä¸Šçš„è½»è¾¹ä¸ªæ•°ä¸å¤šäºO(logN)ã€‚</li><li>æˆ‘ä»¬ç§°æŸæ¡è·¯å¾„ä¸ºé‡è·¯å¾„ï¼ˆé“¾ï¼‰ï¼Œå½“ä¸”ä»…å½“å®ƒå…¨éƒ¨ç”±é‡è¾¹ç»„æˆï¼ˆç‰¹æ®Šåœ°ï¼Œä¸€ä¸ªç‚¹ä¹Ÿç®—ä¸€æ¡é‡è·¯å¾„ï¼‰ã€‚é‚£ä¹ˆå¯¹äºæ¯ä¸ªç‚¹åˆ°æ ¹çš„è·¯å¾„ä¸Šéƒ½æœ‰ä¸è¶…è¿‡O(logN)æ¡è½»è¾¹å’ŒO(logN)æ¡é‡è·¯å¾„ã€‚</li></ol><p>åŒæ—¶æˆ‘ä»¬ä¹Ÿå®¹æ˜“å‘ç°ï¼Œä¸€ä¸ªç‚¹åœ¨ä¸”åªåœ¨ä¸€æ¡é‡è·¯å¾„ä¸Šï¼Œè€Œæ¯æ¡é‡è·¯å¾„ä¸€å®šæ˜¯ä¸€æ¡ä»æ ¹èŠ‚ç‚¹æ–¹å‘å‘å¶èŠ‚ç‚¹æ–¹å‘å»¶ç”³çš„æ·±åº¦é€’å¢çš„è·¯å¾„ï¼ˆå› ä¸ºä¸€ä¸ªéå¶èŠ‚ç‚¹æœ‰ä¸”åªæœ‰ä¸€ä¸ªé‡å„¿å­ï¼‰ã€‚</p><h5 id="å¦‚ä½•å¤„ç†æ ‘ä¸Šçš„è·¯å¾„"><a href="#å¦‚ä½•å¤„ç†æ ‘ä¸Šçš„è·¯å¾„" class="headerlink" title="å¦‚ä½•å¤„ç†æ ‘ä¸Šçš„è·¯å¾„"></a>å¦‚ä½•å¤„ç†æ ‘ä¸Šçš„è·¯å¾„</h5><p>å¯¹æ ‘è¿›è¡Œè½»ã€é‡è¾¹å‰–åˆ†åï¼Œæ“ä½œæ‰€è¦å¤„ç†çš„è·¯å¾„ï¼ˆu , vï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥åˆ†åˆ«å¤„ç†uï¼Œvä¸¤ä¸ªç‚¹åˆ°å…¶æœ€è¿‘å…¬å…±ç¥–å…ˆçš„è·¯å¾„ã€‚æ ¹æ®æ€§è´¨3ï¼Œè·¯å¾„å¯ä»¥åˆ†è§£ä¸ºæœ€å¤šO(logN)æ¡çš„é‡è·¯å¾„å’Œæœ€å¤šO(logN)çš„è½»è¾¹ï¼Œé‚£ä¹ˆç°åœ¨æˆ‘ä»¬<strong>åªè€ƒè™‘å¦‚ä½•ç»´æŠ¤è¿™ä¸¤ç§å¯¹è±¡ã€‚</strong></p><p>å¯¹äºé‡è·¯å¾„ï¼Œå®ƒä»¬æ­¤æ—¶ç›¸å½“äºä¸€ä¸ªåºåˆ—ï¼Œå› æ­¤æˆ‘ä»¬åªéœ€è¦ç”¨çº¿æ®µæ ‘ç»´æŠ¤ã€‚è€Œå¯¹äºè½»è¾¹ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥è·³è¿‡ï¼Œè®¿é—®ä¸‹ä¸€æ¡é‡è·¯å¾„ï¼Œå› ä¸ºè½»è¾¹çš„ä¸¤ç«¯ç‚¹ä¸€å®šåœ¨æŸä¸¤æ¡é‡è·¯å¾„ä¸Šã€‚è¿™ä¸¤ç§æ“ä½œçš„æ—¶é—´å¤æ‚åº¦åˆ†åˆ«ä¸º$O(log^2N)$å’ŒO(logN)ï¼Œå› æ­¤æ€»çš„æ—¶é—´å¤æ‚åº¦ä¸º$O(log^2N)$ã€‚</p><h5 id="å‰–åˆ†æ–¹æ³•"><a href="#å‰–åˆ†æ–¹æ³•" class="headerlink" title="å‰–åˆ†æ–¹æ³•"></a>å‰–åˆ†æ–¹æ³•</h5><p>è½»ã€é‡è¾¹å‰–åˆ†çš„è¿‡ç¨‹å¯ä»¥ç”¨ä¸¤æ¬¡dfså®ç°ï¼Œæœ‰æ—¶ä¸ºäº†é˜²æ­¢é€’å½’è¿‡æ·±è€Œå¯¼è‡´æ ˆæº¢å‡ºï¼Œä¹Ÿå¯ä»¥ç”¨bfså®ç°ã€‚<br><strong>å‰–åˆ†è¿‡ç¨‹ä¸­ä¸»è¦è®¡ç®—å¦‚ä¸‹7ä¸ªå€¼ï¼š</strong><br>par[x] : xåœ¨æ ‘ä¸­çš„çˆ¶äº²ã€‚<br>deep[x]ï¼šxåœ¨æ ‘ä¸­çš„æ·±åº¦ã€‚<br>size[x]ï¼šxçš„å­æ ‘èŠ‚ç‚¹æ•°ï¼ˆå­æ ‘å¤§å°ï¼‰ã€‚<br>son[x]ï¼šxçš„é‡å„¿å­ï¼Œå³u-&gt;son[u]ä¸ºé‡è¾¹ã€‚<br>top[x]ï¼šxæ‰€åœ¨é‡è·¯å¾„çš„é¡¶éƒ¨èŠ‚ç‚¹ï¼ˆæ·±åº¦æœ€å°ï¼‰ã€‚<br>seg[x]ï¼šxæ‰€åœ¨çº¿æ®µæ ‘ä¸­çš„ä½ç½®ï¼ˆä¸‹æ ‡ï¼‰ã€‚<br>rev[x]ï¼šçº¿æ®µæ ‘ä¸­ç¬¬xä¸ªä½ç½®å¯¹åº”çš„æ ‘ä¸­èŠ‚ç‚¹ç¼–å·ï¼Œå³rev[seg[x] ] = xã€‚</p><p>ç¬¬ä¸€é dfs æ—¶å¯ä»¥è®¡ç®—å‰ 4 ä¸ªå€¼ï¼Œç¬¬äºŒé dfs å¯ä»¥è®¡ç®—å 3 ä¸ªå€¼ã€‚è€Œè®¡ç®— seg æ—¶ï¼ŒåŒä¸€æ¡é‡è·¯å¾„ä¸Šçš„ç‚¹éœ€è¦æŒ‰é¡ºåºæ’åœ¨è¿ç»­çš„ä¸€æ®µä½ç½®ï¼Œä¹Ÿå°±æ˜¯ä¸€æ®µåŒºé—´ã€‚</p><p>å°†ä¸€æ¡è·¯å¾„(u ,v)æ‹†åˆ†ä¸ºè‹¥å¹²æ¡é‡è·¯å¾„çš„è¿‡ç¨‹ï¼Œå®é™…ä¸Šå°±æ˜¯ä¸€ä¸ªå¯»æ‰¾æœ€è¿‘å…¬å…±ç¥–å…ˆçš„è¿‡ç¨‹ã€‚è€ƒè™‘â€œæš´åŠ›â€çš„åšæ³•ï¼Œæˆ‘ä»¬ä¼šé€‰æ‹©uï¼Œvä¸­æ·±åº¦è¾ƒå¤§çš„ç‚¹å‘ä¸Šèµ°ä¸€æ­¥ï¼Œç›´åˆ°u = vã€‚ç°åœ¨æœ‰äº†é‡è·¯å¾„ï¼Œç”±äºæˆ‘ä»¬è®°å½•äº†é‡è·¯å¾„çš„é¡¶éƒ¨èŠ‚ç‚¹top[x]ï¼Œè¿˜è®°å½•äº†æ¯ä¸ªç‚¹åœ¨åºåˆ—ä¸­çš„ä½ç½®ï¼Œå› æ­¤æˆ‘ä»¬ä¸éœ€è¦ä¸€æ­¥æ­¥èµ°ã€‚å‡å®štop[u]å’Œtop[v]ä¸åŒï¼Œé‚£ä¹ˆå®ƒä»¬çš„æœ€è¿‘å…¬å…±ç¥–å…ˆå¯èƒ½åœ¨å…¶ä¸­ä¸€æ¡é‡è·¯å¾„ä¸Šï¼Œä¹Ÿå¯èƒ½åœ¨å…¶ä»–çš„é‡è·¯å¾„ä¸Šï¼Œå› ä¸ºLCAæ˜¾ç„¶ä¸å¯èƒ½åœ¨topæ·±åº¦è¾ƒå¤§çš„é‚£æ¡é‡è·¯å¾„ä¸Šï¼Œæ‰€ä»¥æˆ‘ä»¬å…ˆå¤„ç†topæ·±åº¦è¾ƒå¤§çš„ã€‚å‡è®¾uæ˜¯æ·±åº¦è¾ƒå¤§çš„ï¼Œåˆ™å¯ä»¥ç›´æ¥æ¡åˆ°par[top[u]]å¤„ï¼Œä¸”è·³è¿‡çš„è¿™ä¸€æ®µï¼Œåœ¨çº¿æ®µæ ‘ä¸­æ˜¯ä¸€æ®µåŒºé—´ï¼Œè‹¥æˆ‘ä»¬æŒ‰ç…§æ·±åº¦ä»å°åˆ°å¤§æ¥å­˜å‚¨ç‚¹ï¼Œåˆ™è¿™æ®µåŒºé—´ä¸ºï¼š[seg[top[x]] , seg[x]]ã€‚å½“uï¼Œvçš„topç›¸åŒæ—¶ï¼Œè¯´æ˜å®ƒä»¬èµ°åˆ°äº†åŒä¸€æ¡é‡è·¯å¾„ä¸Šï¼Œè¿™æ—¶å®ƒä»¬ä¹‹é—´çš„è·¯å¾„ä¹Ÿæ˜¯åºåˆ—ä¸Šçš„ä¸€æ®µåŒºé—´ï¼Œä¸”uï¼Œvä¸­æ·±åº¦è¾ƒå°çš„é‚£ç‚¹æ˜¯åŸè·¯å¾„çš„LCAã€‚</p><p>è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥å°†ç»™å‡ºçš„ä»»æ„è·¯å¾„æ‹†åˆ†æˆè‹¥å¹²æ¡é‡è·¯å¾„ï¼Œä¹Ÿå°±æ˜¯è‹¥å¹²ä¸ªåŒºé—´ï¼Œå¹¶ç”¨çº¿æ®µæ ‘ç­‰æ•°æ®ç»“æ„å¤„ç†æ“ä½œã€‚</p><h4 id="ä¾‹é¢˜æ¨¡æ¿"><a href="#ä¾‹é¢˜æ¨¡æ¿" class="headerlink" title="ä¾‹é¢˜æ¨¡æ¿"></a>ä¾‹é¢˜æ¨¡æ¿</h4><p>åŸé¢˜æ¥è‡ªï¼šZJOI 2008</p><p>ä¸€æ ‘ä¸Šæœ‰ n ä¸ªèŠ‚ç‚¹ï¼Œç¼–å·åˆ†åˆ«ä¸º 1 åˆ° nï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰ä¸€ä¸ªæƒå€¼ wã€‚æˆ‘ä»¬å°†ä»¥ä¸‹é¢çš„å½¢å¼æ¥è¦æ±‚ä½ å¯¹è¿™æ£µæ ‘å®Œæˆä¸€äº›æ“ä½œï¼š<br>1.CHANGE u t ï¼šæŠŠèŠ‚ç‚¹ u æƒå€¼æ”¹ä¸º tï¼›<br>2.QMAX u v ï¼šè¯¢é—®ç‚¹ u åˆ°ç‚¹ v è·¯å¾„ä¸Šçš„èŠ‚ç‚¹çš„æœ€å¤§æƒå€¼ï¼›<br>3.QSUM u v ï¼šè¯¢é—®ç‚¹ u åˆ°ç‚¹ v è·¯å¾„ä¸Šçš„èŠ‚ç‚¹çš„æƒå€¼å’Œã€‚<br>æ³¨æ„ï¼šä»ç‚¹ u åˆ°ç‚¹ v è·¯å¾„ä¸Šçš„èŠ‚ç‚¹åŒ…æ‹¬ u å’Œ v æœ¬èº«ã€‚</p><p>æ¨¡æ¿ä½¿ç”¨è¯´æ˜ï¼š</p><ul><li>å°†æ ‘æ‹†åˆ†æˆè‹¥å¹²æ¡é“¾ï¼Œä¸ºæ ‘ä¸Šæ¯ä¸ªç‚¹åˆ†é…ä¸€ä¸ªç¼–å·ï¼ŒåŒä¸€æ¡é“¾ä¸Šçš„ç¼–å·è¿ç»­ï¼Œç„¶ååœ¨è¿™äº›ç¼–å·ä¸Šå»ºç«‹çº¿æ®µæ ‘ç»´æŠ¤ã€‚seg[x]æ˜¯æ ‘ä¸Šçš„èŠ‚ç‚¹xåœ¨çº¿æ®µæ ‘çš„ä¸‹æ ‡ï¼Œrev[y]æ˜¯çº¿æ®µæ ‘ä¸‹æ ‡ä¸º y èŠ‚ç‚¹åœ¨æ ‘ä¸­çš„ç¼–å·ã€‚</li><li>æ ‘çš„èŠ‚ç‚¹ç¼–å·è¦ä»1å¼€å§‹ï¼Œä¸èƒ½ä»0ã€‚</li><li>å­æ ‘åœ¨çº¿æ®µæ ‘ä¸­çš„ä¸‹æ ‡æ˜¯è¿ç»­çš„ï¼Œä»¥ x ä¸ºæ ¹çš„å­æ ‘èµ·ç‚¹ä¸‹æ ‡æ˜¯seg[x]ï¼Œç»ˆç‚¹æ˜¯seg[x]+size[x]-1ã€‚</li></ul><p><strong>ä»£ç æ¨¡æ¿</strong><br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span>Â <span class="keyword">namespace</span>Â <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">typedef</span>Â <span class="keyword">long</span>Â <span class="keyword">long</span>Â ll;</span><br><span class="line"><span class="keyword">const</span>Â llÂ INFÂ =Â <span class="number">1e18</span>;</span><br><span class="line"><span class="keyword">const</span>Â <span class="keyword">int</span>Â NÂ =Â <span class="number">3e4</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span>Â <span class="keyword">int</span>Â MÂ =Â <span class="number">2</span>*N;</span><br><span class="line"><span class="keyword">int</span>Â head[N],ver[M],edge[M],nex[M],totÂ =Â <span class="number">1</span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span>Â <span class="title">addEdge</span><span class="params">(<span class="keyword">int</span>Â x,<span class="keyword">int</span>Â y,<span class="keyword">int</span>Â z)</span></span>&#123;</span><br><span class="line">Â Â Â Â ver[++tot]Â =Â y,Â edge[tot]Â =Â z;</span><br><span class="line">Â Â Â Â nex[tot]Â =Â head[x],Â head[x]Â =Â tot;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span>Â n,q,a[N];</span><br><span class="line"><span class="comment">/*çˆ¶äº²,æ·±åº¦,å­æ ‘å¤§å°,é‡å„¿å­,é‡è·¯å¾„é¡¶éƒ¨èŠ‚ç‚¹,</span></span><br><span class="line"><span class="comment">Â Â Â Â æ ‘ä¸­èŠ‚ç‚¹åœ¨çº¿æ®µæ ‘ä¸­ä¸‹æ ‡,çº¿æ®µæ ‘ä¸­èŠ‚ç‚¹å¯¹åº”æ ‘ä¸­ä½ç½®*/</span></span><br><span class="line"><span class="keyword">int</span>Â par[N],deep[N],size[N],son[N],top[N],seg[N],rev[N];</span><br><span class="line"><span class="keyword">int</span>Â vis[N];</span><br><span class="line"><span class="function"><span class="keyword">void</span>Â <span class="title">dfs1</span><span class="params">(<span class="keyword">int</span>Â x,<span class="keyword">int</span>Â fa)</span></span>&#123;</span><br><span class="line">Â Â Â Â <span class="comment">/*åˆ©ç”¨æ·±æœæ›´æ–°par,size,deep,sonæ•°ç»„*/</span></span><br><span class="line">Â Â Â Â vis[x]Â =Â <span class="literal">true</span>;Â size[x]Â =Â <span class="number">1</span>;</span><br><span class="line">Â Â Â Â par[x]Â =Â fa;Â deep[x]Â =Â deep[fa]+<span class="number">1</span>;</span><br><span class="line">Â Â Â Â <span class="keyword">for</span>(<span class="keyword">int</span>Â iÂ =Â head[x];iÂ ;iÂ =Â nex[i])&#123;</span><br><span class="line">Â Â Â Â Â Â Â Â <span class="keyword">int</span>Â yÂ =Â ver[i],Â zÂ =Â edge[i];</span><br><span class="line">Â Â Â Â Â Â Â Â <span class="keyword">if</span>(yÂ ==Â faÂ ||Â vis[y])Â <span class="keyword">continue</span>;</span><br><span class="line">Â Â Â Â Â Â Â Â dfs1(y,x);</span><br><span class="line">Â Â Â Â Â Â Â Â size[x]Â +=Â size[y];Â <span class="comment">//ç´¯åŠ å­æ ‘å¤§å°</span></span><br><span class="line">Â Â Â Â Â Â Â Â <span class="keyword">if</span>(size[y]Â &gt;Â size[son[x]])Â son[x]Â =Â y;<span class="comment">//æ±‚é‡å„¿å­</span></span><br><span class="line">Â Â Â Â &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span>Â <span class="title">dfs2</span><span class="params">(<span class="keyword">int</span>Â x,<span class="keyword">int</span>Â fa)</span></span>&#123;</span><br><span class="line">Â Â Â Â <span class="keyword">if</span>(son[x])&#123;Â <span class="comment">//å…ˆèµ°é‡å„¿å­,ä½¿å¾—é‡è·¯å¾„åœ¨çº¿æ®µæ ‘ä¸­è¿ç»­</span></span><br><span class="line">Â Â Â Â Â Â Â Â seg[son[x]]Â =Â ++seg[<span class="number">0</span>];<span class="comment">//0ä½ç½®ç”¨ä¸åˆ°,åˆ©ç”¨æ¥è®¡æ•°</span></span><br><span class="line">Â Â Â Â Â Â Â Â top[son[x]]Â =Â top[x];</span><br><span class="line">Â Â Â Â Â Â Â Â rev[seg[<span class="number">0</span>]]Â =Â son[x];</span><br><span class="line">Â Â Â Â Â Â Â Â dfs2(son[x],x);</span><br><span class="line">Â Â Â Â &#125;</span><br><span class="line">Â Â Â Â <span class="keyword">for</span>(<span class="keyword">int</span>Â iÂ =Â head[x];i;iÂ =Â nex[i])&#123;</span><br><span class="line">Â Â Â Â Â Â Â Â <span class="keyword">int</span>Â yÂ =Â ver[i],Â zÂ =Â edge[i];</span><br><span class="line">Â Â Â Â Â Â Â Â <span class="keyword">if</span>(top[y])Â <span class="keyword">continue</span>;</span><br><span class="line">Â Â Â Â Â Â Â Â <span class="comment">/*è‹¥yæ²¡æœ‰è¢«éå†è¿‡,å³yä¸æ˜¯xçš„é‡å„¿å­æˆ–è€…çˆ¶äº²*/</span></span><br><span class="line">Â Â Â Â Â Â Â Â seg[y]Â =Â ++seg[<span class="number">0</span>];Â rev[seg[<span class="number">0</span>]]Â =Â y;</span><br><span class="line">Â Â Â Â Â Â Â Â top[y]Â =Â y;Â dfs2(y,x);</span><br><span class="line">Â Â Â Â Â Â Â Â <span class="comment">/*å¦‚æœx--&gt;yæ˜¯è½»è¾¹,é‚£ä¹ˆyå°±æ˜¯å…¶æ‰€åœ¨é‡è·¯å¾„é¡¶éƒ¨èŠ‚ç‚¹*/</span></span><br><span class="line">Â Â Â Â &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">struct</span>Â <span class="title">SegmentTree</span>&#123;</span></span><br><span class="line">Â Â Â Â <span class="keyword">int</span>Â l,r;</span><br><span class="line">Â Â Â Â llÂ mx,Â sum;</span><br><span class="line">Â Â Â Â <span class="meta">#<span class="meta-keyword">define</span>Â l(x)Â t[x].l</span></span><br><span class="line">Â Â Â Â <span class="meta">#<span class="meta-keyword">define</span>Â r(x)Â t[x].r</span></span><br><span class="line">Â Â Â Â <span class="meta">#<span class="meta-keyword">define</span>Â mx(x)Â t[x].mx</span></span><br><span class="line">Â Â Â Â <span class="meta">#<span class="meta-keyword">define</span>Â sum(x)Â t[x].sum</span></span><br><span class="line">&#125;t[N*<span class="number">4</span>];</span><br><span class="line"><span class="function"><span class="keyword">void</span>Â <span class="title">BuildTree</span><span class="params">(<span class="keyword">int</span>Â rt,<span class="keyword">int</span>Â l,<span class="keyword">int</span>Â r)</span></span>&#123;</span><br><span class="line">Â Â Â Â l(rt)Â =Â l,Â r(rt)Â =Â r;</span><br><span class="line">Â Â Â Â <span class="keyword">if</span>(lÂ ==Â r)&#123;</span><br><span class="line">Â Â Â Â Â Â Â Â mx(rt)Â =Â sum(rt)Â =Â a[rev[l]];Â <span class="comment">//çº¿æ®µæ ‘ä¸ŠlèŠ‚ç‚¹å¯¹åº”ç€æ ‘ä¸Šrev[l]ç‚¹</span></span><br><span class="line">Â Â Â Â Â Â Â Â <span class="keyword">return</span>;</span><br><span class="line">Â Â Â Â &#125;</span><br><span class="line">Â Â Â Â <span class="keyword">int</span>Â midÂ =Â l+r&gt;&gt;<span class="number">1</span>;</span><br><span class="line">Â Â Â Â BuildTree(rt*<span class="number">2</span>,l,mid);Â BuildTree(rt*<span class="number">2</span>+<span class="number">1</span>,mid+<span class="number">1</span>,r);</span><br><span class="line">Â Â Â Â mx(rt)Â =Â max(mx(rt&lt;&lt;<span class="number">1</span>),mx(rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>));</span><br><span class="line">Â Â Â Â sum(rt)Â =Â sum(rt&lt;&lt;<span class="number">1</span>)Â +Â sum(rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span>Â <span class="title">preHandle</span><span class="params">()</span></span>&#123;</span><br><span class="line">Â Â Â Â dfs1(<span class="number">1</span>,<span class="number">0</span>);Â <span class="comment">//æˆ‘ä»¬ä»¥1å·èŠ‚ç‚¹ä¸ºæ ¹</span></span><br><span class="line">Â Â Â Â <span class="comment">/*æ ¹èŠ‚ç‚¹æ‰€åœ¨é‡è·¯å¾„çš„é¡¶éƒ¨èŠ‚ç‚¹ä¹Ÿæ˜¯æ ¹èŠ‚ç‚¹,èµ‹åˆå€¼*/</span></span><br><span class="line">Â Â Â Â seg[<span class="number">0</span>]Â =Â seg[<span class="number">1</span>]Â =Â top[<span class="number">1</span>]Â =Â rev[<span class="number">1</span>]Â =Â <span class="number">1</span>;</span><br><span class="line">Â Â Â Â dfs2(<span class="number">1</span>,<span class="number">0</span>);</span><br><span class="line">Â Â Â Â BuildTree(<span class="number">1</span>,<span class="number">1</span>,seg[<span class="number">0</span>]);</span><br><span class="line">&#125;</span><br><span class="line">llÂ tmx,tsum;<span class="comment">//åˆ©ç”¨å…¨å±€å˜é‡åŒæ—¶ç»Ÿè®¡2ä¸ªç­”æ¡ˆ</span></span><br><span class="line"><span class="function"><span class="keyword">void</span>Â <span class="title">query</span><span class="params">(<span class="keyword">int</span>Â rt,<span class="keyword">int</span>Â l,<span class="keyword">int</span>Â r)</span></span>&#123;</span><br><span class="line">Â Â Â Â <span class="comment">/*å°†ä»¥rtä¸ºæ ¹çš„åŒºé—´å†…å±äº[l,r]éƒ¨åˆ†çš„å’Œç´¯åŠ åˆ°tsumä¸Š,å¹¶æ›´æ–°tmx*/</span></span><br><span class="line">Â Â Â Â <span class="keyword">if</span>(lÂ &lt;=Â l(rt)Â &amp;&amp;Â r(rt)Â &lt;=Â r)&#123;</span><br><span class="line">Â Â Â Â Â Â Â Â tsumÂ +=Â sum(rt);Â tmxÂ =Â max(tmx,mx(rt));</span><br><span class="line">Â Â Â Â Â Â Â Â <span class="keyword">return</span>Â ;</span><br><span class="line">Â Â Â Â &#125;</span><br><span class="line">Â Â Â Â <span class="keyword">int</span>Â midÂ =Â l(rt)+r(rt)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">Â Â Â Â <span class="keyword">if</span>(lÂ &lt;=Â mid)Â query(rt&lt;&lt;<span class="number">1</span>,l,r);</span><br><span class="line">Â Â Â Â <span class="keyword">if</span>(rÂ &gt;Â mid)Â query(rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>,l,r);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span>Â <span class="title">ask</span><span class="params">(<span class="keyword">int</span>Â x,<span class="keyword">int</span>Â y)</span></span>&#123;</span><br><span class="line">Â Â Â Â <span class="comment">/*è¿”å›xä¸yä¹‹é—´è·¯å¾„ä¸Šæƒå€¼æœ€å¤§ç‚¹çš„æƒå€¼*/</span></span><br><span class="line">Â Â Â Â <span class="keyword">int</span>Â fxÂ =Â top[x]Â ,Â fyÂ =Â top[y];</span><br><span class="line">Â Â Â Â <span class="keyword">while</span>(fxÂ !=Â fy)&#123;<span class="comment">//å…ˆå°†xå’Œyæ¡æ•´åˆ°åŒä¸€ä¸ªé‡é“¾ä¸Š</span></span><br><span class="line">Â Â Â Â Â Â Â Â <span class="keyword">if</span>(deep[fx]Â &lt;Â deep[fy])Â swap(x,y),swap(fx,fy);</span><br><span class="line">Â Â Â Â Â Â Â Â query(<span class="number">1</span>,seg[fx],seg[x]);</span><br><span class="line">Â Â Â Â Â Â Â Â xÂ =Â par[fx];Â fxÂ =Â top[x];</span><br><span class="line">Â Â Â Â &#125;</span><br><span class="line">Â Â Â Â <span class="keyword">if</span>(deep[x]Â &gt;Â deep[y])Â swap(x,y);<span class="comment">//è·¯å¾„æµ…çš„ç¼–å·å°</span></span><br><span class="line">Â Â Â Â query(<span class="number">1</span>,seg[x],seg[y]);Â <span class="comment">//å†æ›´æ–°ä¸€æ¬¡</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span>Â <span class="title">change</span><span class="params">(<span class="keyword">int</span>Â rt,<span class="keyword">int</span>Â x,<span class="keyword">int</span>Â val)</span></span>&#123;</span><br><span class="line">Â Â Â Â <span class="comment">/*æŠŠçº¿æ®µæ ‘èŠ‚ç‚¹xçš„æƒå€¼æ”¹ä¸ºval*/</span></span><br><span class="line">Â Â Â Â <span class="keyword">if</span>(l(rt)Â ==Â r(rt))&#123;</span><br><span class="line">Â Â Â Â Â Â Â Â mx(rt)Â =Â sum(rt)Â =Â val;</span><br><span class="line">Â Â Â Â Â Â Â Â <span class="keyword">return</span>;</span><br><span class="line">Â Â Â Â &#125;</span><br><span class="line">Â Â Â Â <span class="keyword">int</span>Â midÂ =Â l(rt)Â +Â r(rt)Â &gt;&gt;Â <span class="number">1</span>;</span><br><span class="line">Â Â Â Â <span class="keyword">if</span>(xÂ &gt;Â mid)Â change(rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>,x,val);</span><br><span class="line">Â Â Â Â <span class="keyword">else</span>Â change(rt&lt;&lt;<span class="number">1</span>,x,val);</span><br><span class="line">Â Â Â Â mx(rt)Â =Â max(mx(rt&lt;&lt;<span class="number">1</span>),mx(rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>));</span><br><span class="line">Â Â Â Â sum(rt)Â =Â sum(rt&lt;&lt;<span class="number">1</span>)Â +Â sum(rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span>Â <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">Â Â Â Â <span class="meta">#<span class="meta-keyword">ifdef</span>Â LOCAL</span></span><br><span class="line">Â Â Â Â Â Â Â Â freopen(<span class="string">"123.txt"</span>,<span class="string">"r"</span>,<span class="built_in">stdin</span>);</span><br><span class="line">Â Â Â Â Â Â Â Â freopen(<span class="string">"222.txt"</span>,<span class="string">"w"</span>,<span class="built_in">stdout</span>);</span><br><span class="line">Â Â Â Â <span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">Â Â Â Â <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;n);</span><br><span class="line">Â Â Â Â <span class="keyword">for</span>(<span class="keyword">int</span>Â iÂ =Â <span class="number">1</span>,x,y;iÂ &lt;Â n;i++)&#123;</span><br><span class="line">Â Â Â Â Â Â Â Â <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;x,&amp;y);</span><br><span class="line">Â Â Â Â Â Â Â Â addEdge(x,y,<span class="number">1</span>);Â addEdge(y,x,<span class="number">1</span>);</span><br><span class="line">Â Â Â Â &#125;</span><br><span class="line">Â Â Â Â <span class="keyword">for</span>(<span class="keyword">int</span>Â iÂ =Â <span class="number">1</span>;iÂ &lt;=Â n;i++)Â <span class="built_in">scanf</span>(<span class="string">"%d"</span>,a+i);</span><br><span class="line">Â Â Â Â <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;q);</span><br><span class="line">Â Â Â Â preHandle();<span class="comment">//æ ‘é“¾å‰–åˆ†é¢„å¤„ç†</span></span><br><span class="line">Â Â Â Â <span class="keyword">char</span>Â op[<span class="number">20</span>];</span><br><span class="line">Â Â Â Â <span class="keyword">for</span>(<span class="keyword">int</span>Â iÂ =Â <span class="number">1</span>,x,y;iÂ &lt;=Â q;i++)&#123;</span><br><span class="line">Â Â Â Â Â Â Â Â <span class="built_in">scanf</span>(<span class="string">"%s%d%d"</span>,op,&amp;x,&amp;y);</span><br><span class="line">Â Â Â Â Â Â Â Â <span class="keyword">if</span>(op[<span class="number">0</span>]Â ==Â <span class="string">'C'</span>)Â change(<span class="number">1</span>,seg[x],y);</span><br><span class="line">Â Â Â Â Â Â Â Â <span class="keyword">else</span>&#123;</span><br><span class="line">Â Â Â Â Â Â Â Â Â Â Â Â tmxÂ =Â -INF;Â tsumÂ =Â <span class="number">0</span>;</span><br><span class="line">Â Â Â Â Â Â Â Â Â Â Â Â ask(x,y);<span class="comment">//åŒæ—¶æ›´æ–°æœ€å¤§å€¼ä¸è·¯å¾„å’Œ</span></span><br><span class="line">Â Â Â Â Â Â Â Â Â Â Â Â <span class="keyword">if</span>(op[<span class="number">1</span>]Â ==Â <span class="string">'M'</span>)Â <span class="built_in">printf</span>(<span class="string">"%lld\n"</span>,tmx);</span><br><span class="line">Â Â Â Â Â Â Â Â Â Â Â Â <span class="keyword">else</span>Â <span class="built_in">printf</span>(<span class="string">"%lld\n"</span>,tsum);</span><br><span class="line">Â Â Â Â Â Â Â Â &#125;</span><br><span class="line">Â Â Â Â &#125;</span><br><span class="line">Â Â Â Â <span class="keyword">return</span>Â <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h4 id=&quot;æ‘˜è¦&quot;&gt;&lt;a href=&quot;#æ‘˜è¦&quot; class=&quot;headerlink&quot; title=&quot;æ‘˜è¦&quot;&gt;&lt;/a&gt;æ‘˜è¦&lt;/h4&gt;&lt;p&gt;æ ‘é“¾å‰–åˆ†æ˜¯ç”¨æ¥ç»´æŠ¤é™æ€æ ‘ä¸Šè·¯å¾„ä¿¡æ¯çš„æ•°æ®ç»“æ„ï¼Œé™æ€å³æ ‘çš„å½¢æ€ä¸èƒ½æ”¹å˜ï¼ˆå¢åˆ ç‚¹æˆ–è€…æ¢æ ¹ï¼Œæ”¹å˜äº†æ„é€ ï¼‰ã€‚&lt;br&gt;å…¶æ€æƒ³æ˜¯å°†æ ‘ä¸Šçš„è·¯å¾„åˆ†ä¸ºé‡è·¯å¾„å’Œ
      
    
    </summary>
    
      <category term="ACMå­¦ä¹ ç¬”è®°" scheme="http://valenshi.top/categories/ACM%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
    
      <category term="ç®—æ³•æ¨¡æ¿" scheme="http://valenshi.top/tags/%E7%AE%97%E6%B3%95%E6%A8%A1%E6%9D%BF/"/>
    
      <category term="æ•°æ®ç»“æ„ä¸ç®—æ³•" scheme="http://valenshi.top/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/"/>
    
      <category term="æ ‘é“¾å‰–åˆ†" scheme="http://valenshi.top/tags/%E6%A0%91%E9%93%BE%E5%89%96%E5%88%86/"/>
    
  </entry>
  
  <entry>
    <title>æ ‘ä¸Šå€å¢LCAé¢˜é›†</title>
    <link href="http://valenshi.top/2019/10/09/lca-problems/"/>
    <id>http://valenshi.top/2019/10/09/lca-problems/</id>
    <published>2019-10-09T12:04:00.000Z</published>
    <updated>2019-10-09T12:16:10.691Z</updated>
    
    <content type="html"><![CDATA[<p>æ ‘ä¸Šå€å¢æ³•å¯ä»¥ç”¨äºæ±‚LCAï¼Œå½“ç„¶åœ¨å…¶å®ƒåœºåˆä¹Ÿæœ‰åº”ç”¨ï¼Œåœ¨å¾ˆå¤šæ—¶å€™çœ‹ä¼¼ä¸æ˜¯æ ‘å½¢çš„é—®é¢˜ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡è½¬åŒ–æˆæ ‘å½¢ç»“æ„ï¼Œç„¶ååœ¨æ ‘ä¸­è¿›è¡Œæ“ä½œï¼Œè¿™ç§æ“ä½œå¯ä»¥æ˜¯æ±‚äºŒè€…ä¹‹é—´çš„æœ€è¿‘çŠ¶æ€ï¼Œæˆ–è€…æ˜¯äºŒè€…ä¹‹é—´çš„è·ç¦»ï¼Œå¦‚æœ€åä¸€é¢˜ã€‚<br>å¦å¤–å…³äºæ ‘çš„é¢˜å‹ï¼Œæœ€å¥½è¿˜æ˜¯æ ¹æ®æ ·ä¾‹ç”»å›¾æ€è€ƒï¼Œå¾€å¾€å¯ä»¥æ¯”ç©ºæƒ³è·å¾—æ›´å¤šæ€è·¯ã€‚</p><h4 id="ç‚¹çš„è·ç¦»"><a href="#ç‚¹çš„è·ç¦»" class="headerlink" title="ç‚¹çš„è·ç¦»"></a>ç‚¹çš„è·ç¦»</h4><p><strong>é¢˜æ„ç®€è¿°</strong><br>ç»™å®šä¸€æ£µ n ä¸ªç‚¹çš„æ ‘ï¼ŒQ ä¸ªè¯¢é—®ï¼Œæ¯æ¬¡è¯¢é—®ç‚¹ x åˆ°ç‚¹ y ä¸¤ç‚¹ä¹‹é—´çš„è·ç¦»ã€‚<br><strong>è§£é¢˜æ€è·¯</strong><br>æ¨¡æ¿é¢˜ï¼Œç”¨æ ‘ä¸Šå€å¢æ³•ï¼Œåˆå§‹åŒ–æ—¶é—´ä¸ºO(NlogN)ï¼ŒæŸ¥è¯¢æ—¶é—´O(logN)ã€‚</p><p><strong>ä»£ç ç¤ºä¾‹</strong><br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1e5</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> M = <span class="number">2e5</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">int</span> head[N],ver[M],nex[M],tot = <span class="number">1</span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">addEdge</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> y)</span></span>&#123;</span><br><span class="line">ver[++tot] = y; nex[tot] = head[x]; head[x] = tot;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> n,q;</span><br><span class="line"><span class="comment">//anc[x][i]è¡¨ç¤ºxå¾€ä¸Šèµ°2^iæ­¥çš„ç¥–å…ˆç¼–å· </span></span><br><span class="line"><span class="keyword">int</span> anc[N][<span class="number">25</span>], deep[N],dis[N];</span><br><span class="line"><span class="keyword">int</span> root = <span class="number">1</span>;<span class="comment">//è¿™æ£µæ ‘çš„æ ¹,æ— ç‰¹æ®Šè¯´æ˜å¯ä»¥ä¸º1 </span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= <span class="number">22</span>;i++)</span><br><span class="line">anc[x][i] = anc[anc[x][i<span class="number">-1</span>]][i<span class="number">-1</span>];</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = head[x];i ;i = nex[i])&#123;</span><br><span class="line"><span class="keyword">int</span> y = ver[i] , z = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">if</span>(dis[y] || y == root) <span class="keyword">continue</span>;</span><br><span class="line">deep[y] = deep[x]+<span class="number">1</span>;</span><br><span class="line">dis[y] = dis[x] + z;</span><br><span class="line">anc[y][<span class="number">0</span>] = x; dfs(y);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">Lca</span><span class="params">(<span class="keyword">int</span> u,<span class="keyword">int</span> v)</span></span>&#123;</span><br><span class="line"><span class="keyword">if</span>(deep[u] &lt; deep[v]) swap(u,v);</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">22</span>;i &gt;= <span class="number">0</span>;i--)</span><br><span class="line"><span class="keyword">if</span>(deep[anc[u][i]] &gt;= deep[v]) u = anc[u][i];</span><br><span class="line"><span class="keyword">if</span>(u == v) <span class="keyword">return</span> u;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">22</span>;i &gt;= <span class="number">0</span>;i--)</span><br><span class="line"><span class="keyword">if</span>(anc[u][i] != anc[v][i])&#123;</span><br><span class="line">u = anc[u][i]; v= anc[v][i];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> anc[u][<span class="number">0</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">ask</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> y)</span></span>&#123;</span><br><span class="line"><span class="comment">/*logNæ—¶é—´å†…è¿”å›xä¸yä¹‹é—´çš„è·ç¦»,æ³¨æ„æ˜¯å¦ä¼šçˆ†int*/</span> </span><br><span class="line"><span class="keyword">return</span> dis[x] + dis[y] - <span class="number">2</span>*dis[Lca(x,y)];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;n);</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>,x,y;i &lt; n;i++)&#123;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;x,&amp;y);</span><br><span class="line">addEdge(x,y); addEdge(y,x);<span class="comment">//åŒå‘è¾¹ </span></span><br><span class="line">&#125;</span><br><span class="line">deep[<span class="number">0</span>] = <span class="number">-1</span>; dfs(root);<span class="comment">//å®Œæˆé¢„å¤„ç† </span></span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;q);</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>,x,y;i &lt;= q;i++)&#123;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;x,&amp;y);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%d\n"</span>,ask(x,y));</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h4 id="æš—çš„é”é“¾"><a href="#æš—çš„é”é“¾" class="headerlink" title="æš—çš„é”é“¾*"></a>æš—çš„é”é“¾*</h4><p><strong>é¢˜æ„ç®€è¿°</strong><br>åŸé¢˜æ¥è‡ªï¼šPOJ 3417</p><p>Dark æ˜¯ä¸€å¼ æ— å‘å›¾ï¼Œå›¾ä¸­æœ‰ N ä¸ªèŠ‚ç‚¹å’Œä¸¤ç±»è¾¹ï¼Œä¸€ç±»è¾¹è¢«ç§°ä¸ºä¸»è¦è¾¹ï¼Œè€Œå¦ä¸€ç±»è¢«ç§°ä¸ºé™„åŠ è¾¹ã€‚Dark æœ‰ Nâ€“1 æ¡ä¸»è¦è¾¹ï¼Œå¹¶ä¸” Dark çš„ä»»æ„ä¸¤ä¸ªèŠ‚ç‚¹ä¹‹é—´éƒ½å­˜åœ¨ä¸€æ¡åªç”±ä¸»è¦è¾¹æ„æˆçš„è·¯å¾„ã€‚å¦å¤–ï¼ŒDark è¿˜æœ‰ M æ¡é™„åŠ è¾¹ã€‚</p><p>ä½ çš„ä»»åŠ¡æ˜¯æŠŠ Dark æ–©ä¸ºä¸è¿é€šçš„ä¸¤éƒ¨åˆ†ã€‚ä¸€å¼€å§‹ Dark çš„é™„åŠ è¾¹éƒ½å¤„äºæ— æ•ŒçŠ¶æ€ï¼Œä½ åªèƒ½é€‰æ‹©ä¸€æ¡ä¸»è¦è¾¹åˆ‡æ–­ã€‚ä¸€æ—¦ä½ åˆ‡æ–­äº†ä¸€æ¡ä¸»è¦è¾¹ï¼ŒDark å°±ä¼šè¿›å…¥é˜²å¾¡æ¨¡å¼ï¼Œä¸»è¦è¾¹ä¼šå˜ä¸ºæ— æ•Œçš„è€Œé™„åŠ è¾¹å¯ä»¥è¢«åˆ‡æ–­ã€‚ä½†æ˜¯ä½ çš„èƒ½åŠ›åªèƒ½å†åˆ‡æ–­ Dark çš„ä¸€æ¡é™„åŠ è¾¹ã€‚</p><p>ç°åœ¨ä½ æƒ³è¦çŸ¥é“ï¼Œä¸€å…±æœ‰å¤šå°‘ç§æ–¹æ¡ˆå¯ä»¥å‡»è´¥ Darkã€‚æ³¨æ„ï¼Œå°±ç®—ä½ ç¬¬ä¸€æ­¥åˆ‡æ–­ä¸»è¦è¾¹ä¹‹åå°±å·²ç»æŠŠ Dark æ–©ä¸ºä¸¤æˆªï¼Œä½ ä¹Ÿéœ€è¦åˆ‡æ–­ä¸€æ¡é™„åŠ è¾¹æ‰ç®—å‡»è´¥äº† Darkã€‚</p><p><strong>è§£é¢˜æ€è·¯</strong><br>è¿™æ˜¯ä¸€é“éœ€è¦è§‚å¯Ÿå’Œè½¬åŒ–é¢˜æ„çš„é—®é¢˜ã€‚<br>åœ¨æ ‘ä¸Šå¦‚æœæœ‰ä¸€æ¡é™„åŠ è¾¹ï¼Œå°±å½¢æˆäº†ä¸€ä¸ªç¯ï¼Œå¯çŸ¥æ¯ä¸ªç¯å†…æœ€å¤šæœ‰ä¸€æ¡é™„åŠ è¾¹ã€‚å¦‚æœä¸€æ¡ä¸»è¦è¾¹åœ¨ç¯ä¸­ï¼Œåˆ™ç§°è¯¥ä¸»è¦è¾¹è¢«<strong>è¦†ç›–</strong> ï¼Œå®ƒåœ¨å‡ ä¸ªç¯å†…ï¼Œå°±è¢«è¦†ç›–äº†å‡ æ¬¡ã€‚å¯çŸ¥ä¸€ä¸ªä¸»è¦è¾¹æœ€å¤šè¢«è¦†ç›–2æ¬¡ã€‚<br>å¦‚æœä¸€æ¡ä¸»è¦è¾¹è¢«è¦†ç›–äº† 2 æ¬¡ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ— è®ºæ€ä¹ˆåˆ‡éƒ½åˆ‡ä¸æ–­ Darkï¼Œå› ä¸ºåˆ‡æ–­äº†ä¸»è¦è¾¹åï¼Œè¿˜æ˜¯ä¸€ä¸ªç¯ï¼Œè€Œåˆ‡æ–­ä¸€ä¸ªç¯éœ€è¦åˆ‡æ–­ä¸¤æ¡è¾¹ã€‚å¦‚æœä¸€æ¡ä¸»è¦è¾¹è¢«è¦†ç›–äº† 1 æ¬¡ï¼Œé‚£ä¹ˆæˆ‘ä»¬åˆ‡æ–­è¯¥ä¸»è¦è¾¹åï¼Œå†åˆ‡æ–­å®ƒçš„é™„åŠ è¾¹å³å¯ï¼Œå³åªæœ‰ä¸€ç§æ–¹æ¡ˆã€‚å¦‚æœä¸€æ¡ä¸»è¦è¾¹è¢«è¦†ç›–0æ¬¡ï¼Œé‚£ä¹ˆæˆ‘ä»¬åˆ‡å®Œè¯¥ä¸»è¦è¾¹åï¼Œå¯ä»¥ä»»æ„åˆ‡ä¸€æ¡é™„åŠ è¾¹ï¼Œå…± m ä¸­æ–¹æ¡ˆï¼ˆm æ˜¯é™„åŠ è¾¹çš„æ¡æ•°ï¼‰ã€‚ç»¼ä¸Šæ‰€è¿°ï¼Œæˆ‘ä»¬åªéœ€è¦æ±‚å‡ºæ¯æ¡ä¸»è¦è¾¹è¢«é™„åŠ è¾¹è¦†ç›–æ¬¡æ•°å³å¯ï¼Œæˆ‘ä»¬è®¾ f[x] ä¸º x åˆ°å…¶çˆ¶èŠ‚ç‚¹çš„ä¸»è¦è¾¹è¢«è¦†ç›–çš„æ¬¡æ•°ã€‚</p><p>æˆ‘ä»¬å¯ä»¥åˆ©ç”¨<strong>æ ‘ä¸Šå·®åˆ†</strong>æ¥æ±‚ f æ•°ç»„ï¼Œæ ‘ä¸Šå·®åˆ†çš„æ€æƒ³å°±ä¸é¢å¤–ä»‹ç»äº†ï¼Œå…·ä½“åšæ³•æ˜¯å¦‚æœæœ‰ä¸€æ¡é™„åŠ è¾¹(x, y)ï¼Œé‚£ä¹ˆf[x]++ ,f[y]++ï¼ŒåŒæ—¶ f[ Lca(x, y) ] -= 2ï¼Œè¿™æ ·å½“æˆ‘ä»¬æ·»åŠ å®Œé™„åŠ è¾¹åï¼Œå°† f æ•°ç»„ä»å¶å­èŠ‚ç‚¹å‘ä¸Šç´¯åŠ ï¼Œå³å¯æ›´æ–°å®Œæ¯• f æ•°ç»„ã€‚</p><p><strong>ä»£ç ç¤ºä¾‹</strong><br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1e5</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> M = <span class="number">2e5</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">int</span> head[N],ver[M],nex[M], tot = <span class="number">1</span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">addEdge</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> y)</span></span>&#123;</span><br><span class="line">ver[++tot] = y; nex[tot] = head[x];head[x] = tot;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> n,m,f[N];</span><br><span class="line"><span class="keyword">int</span> dis[N],deep[N],anc[N][<span class="number">24</span>];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= <span class="number">22</span>;i++) </span><br><span class="line">anc[x][i] = anc[anc[x][i<span class="number">-1</span>]][i<span class="number">-1</span>];</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = head[x];i ;i = nex[i])&#123;</span><br><span class="line"><span class="keyword">int</span> y = ver[i], z = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">if</span>(dis[y] || y == <span class="number">1</span>) <span class="keyword">continue</span>;</span><br><span class="line">deep[y] = deep[x] + <span class="number">1</span>;</span><br><span class="line">dis[y] = dis[x] + z;</span><br><span class="line">anc[y][<span class="number">0</span>] = x; dfs(y);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">Lca</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> y)</span></span>&#123;</span><br><span class="line"><span class="keyword">if</span>(deep[x] &lt; deep[y]) swap(x,y);</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">22</span>;i &gt;= <span class="number">0</span>;i--)</span><br><span class="line"><span class="keyword">if</span>(deep[anc[x][i]] &gt;= deep[y]) x = anc[x][i];</span><br><span class="line"><span class="keyword">if</span>(x == y) <span class="keyword">return</span> x;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">22</span>;i &gt;= <span class="number">0</span>;i--)</span><br><span class="line"><span class="keyword">if</span>(anc[x][i] != anc[y][i])&#123;</span><br><span class="line">x = anc[x][i]; y = anc[y][i];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> anc[x][<span class="number">0</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> vis[N];</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">dfs2</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">vis[x] = <span class="literal">true</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = head[x];i;i = nex[i])&#123;</span><br><span class="line"><span class="keyword">int</span> y = ver[i];</span><br><span class="line"><span class="keyword">if</span>(vis[y]) <span class="keyword">continue</span>;</span><br><span class="line">f[x] += dfs2(y);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> f[x];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;n,&amp;m);</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>,x,y;i &lt; n;i++)&#123;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;x,&amp;y);</span><br><span class="line">addEdge(x,y); addEdge(y,x);</span><br><span class="line">&#125;</span><br><span class="line">dfs(<span class="number">1</span>);</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>,x,y;i &lt;= m;i++)&#123;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;x,&amp;y);</span><br><span class="line">f[x]++; f[y]++; f[Lca(x,y)] -= <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line">dfs2(<span class="number">1</span>); <span class="keyword">int</span> ans = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">2</span>;i &lt;= n;i++)</span><br><span class="line"><span class="keyword">if</span>(!f[i]) ans += m;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span>(f[i] == <span class="number">1</span>) ans++;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%d\n"</span>,ans);</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h4 id="å¼‚è±¡çŸ³"><a href="#å¼‚è±¡çŸ³" class="headerlink" title="å¼‚è±¡çŸ³*"></a>å¼‚è±¡çŸ³*</h4><p><strong>é¢˜æ„ç®€è¿°</strong><br>åŸé¢˜æ¥è‡ªï¼šContest Hunter Round #56</p><p>åœ¨ Adera çš„å¼‚æ—¶ç©ºä¸­æœ‰ä¸€å¼ åœ°å›¾ã€‚è¿™å¼ åœ°å›¾ä¸Šæœ‰ N ä¸ªç‚¹ï¼Œæœ‰ Nâˆ’1 æ¡åŒå‘è¾¹æŠŠå®ƒä»¬è¿é€šèµ·æ¥ã€‚èµ·åˆåœ°å›¾ä¸Šæ²¡æœ‰ä»»ä½•å¼‚è±¡çŸ³ï¼Œåœ¨æ¥ä¸‹æ¥çš„ M ä¸ªæ—¶åˆ»ä¸­ï¼Œæ¯ä¸ªæ—¶åˆ»ä¼šå‘ç”Ÿä»¥ä¸‹ä¸‰ç§ç±»å‹çš„äº‹ä»¶ä¹‹ä¸€ï¼š</p><p>åœ°å›¾çš„æŸä¸ªç‚¹ä¸Šå‡ºç°äº†å¼‚è±¡çŸ³ï¼ˆå·²ç»å‡ºç°çš„ä¸ä¼šå†æ¬¡å‡ºç°ï¼‰ï¼›</p><p>åœ°å›¾æŸä¸ªç‚¹ä¸Šçš„å¼‚è±¡çŸ³è¢«æ‘§æ¯ï¼ˆä¸ä¼šæ‘§æ¯æ²¡æœ‰å¼‚è±¡çŸ³çš„ç‚¹ï¼‰ï¼›</p><p>å‘ç©å®¶è¯¢é—®ä½¿æ‰€æœ‰å¼‚è±¡çŸ³æ‰€åœ¨çš„ç‚¹è¿é€šçš„è¾¹é›†çš„æ€»é•¿åº¦æœ€å°æ˜¯å¤šå°‘ã€‚</p><p>è¯·ä½ ä½œä¸ºç©å®¶å›ç­”è¿™äº›é—®é¢˜ã€‚ä¸‹å›¾æ˜¯ä¸€ä¸ªä¾‹å­ï¼Œç°è‰²èŠ‚ç‚¹è¡¨ç¤ºå‡ºç°äº†å¼‚è±¡çŸ³ï¼ŒåŠ ç²—çš„è¾¹è¡¨ç¤ºè¢«é€‰ä¸ºè¿é€šå¼‚è±¡çŸ³çš„è¾¹é›†ã€‚</p><p><strong>è§£é¢˜æ€è·¯</strong><br>æˆ‘ä¹Ÿä¸å¤ªèƒ½ç†è§£è¿™é¢˜çš„æ€è·¯æ˜¯æ€ä¹ˆå‘ç°çš„ã€‚<br>å¾ˆè‡ªç„¶çš„æƒ³æ³•å°±æ˜¯æ±‚æ‰€æœ‰ k ä¸ªå¼‚è±¡çŸ³ä¸¤ä¸¤ä¹‹é—´çš„è·ç¦»å’Œï¼Œç„¶å / (k-1) å³ä¸ºç­”æ¡ˆï¼Œä½†æ˜¾ç„¶ä¼šè¶…æ—¶ã€‚<br>æ­£è§£æ˜¯åˆ©ç”¨ä¸€ä¸ªç»“è®ºï¼Œè¯¥ç»“è®ºé¢˜è§£æ²¡ç»™å‡ºè¯æ˜ï¼Œææ‡‚äº†å†è¡¥ä¸Šã€‚<br>å¯¹è¿™é¢—æ ‘å…ˆè¿›è¡Œdfséå†ï¼Œç»™æ¯ä¸ªèŠ‚ç‚¹æ‰“ä¸Šä¸€ä¸ªæ—¶é—´æˆ³ï¼Œè®¾èŠ‚ç‚¹ x çš„æ—¶é—´æˆ³ä¸º dfn[x]ï¼›è®¾å·²å­˜åœ¨çš„å¼‚è±¡çŸ³ä¸­ï¼Œdfnåºæ˜¯ x å‰é©±çš„èŠ‚ç‚¹ç¼–å·ä¸º preï¼Œåç»§èŠ‚ç‚¹ç¼–å·ä¸º nexï¼Œé‚£ä¹ˆåœ¨ x å¤„æ’å…¥å¼‚è±¡çŸ³åï¼Œ ans += Dis(pre , x) + Dis(x, nex) - Dis(pre, nex)ã€‚<br>åˆ é™¤ä¸€ä¸ªå¼‚è±¡çŸ³åŒç†ï¼Œå‡å»å°±å¥½ã€‚<br>è¯æ˜æš‚æ—¶æ²¡æœ‰ï¼Œå¦å¤–è¿™ä¸ªè¦åšæ³•è®°ä½ï¼Œæ˜¯ç”¨æ¥æ±‚æ ‘ä¸Šå¤šä¸ªèŠ‚ç‚¹ä¹‹é—´çš„æœ€çŸ­æ€»è·¯å¾„ç”¨çš„ã€‚</p><p>è¿˜è¦æ³¨æ„setçš„ç”¨æ³•ï¼Œå¦‚æœsetä¸ºç©ºï¼Œé‚£ä¹ˆbegin() = end()ï¼Œæ­¤æ—¶å¦‚æœç”¨æŒ‡å‘end()çš„è¿­ä»£å™¨è‡ªå¢æˆ–è‡ªå‡éƒ½æ˜¯ä¸åˆæ³•çš„ã€‚</p><p><strong>ä»£ç ç¤ºä¾‹</strong></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1e5</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> M = <span class="number">2e5</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">int</span> head[N],ver[M],nex[M], tot = <span class="number">1</span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">addEdge</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> y)</span></span>&#123;</span><br><span class="line">ver[++tot] = y; nex[tot] = head[x];head[x] = tot;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> n,m,f[N];</span><br><span class="line"><span class="keyword">int</span> dis[N],deep[N],anc[N][<span class="number">24</span>];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= <span class="number">22</span>;i++) </span><br><span class="line">anc[x][i] = anc[anc[x][i<span class="number">-1</span>]][i<span class="number">-1</span>];</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = head[x];i ;i = nex[i])&#123;</span><br><span class="line"><span class="keyword">int</span> y = ver[i], z = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">if</span>(dis[y] || y == <span class="number">1</span>) <span class="keyword">continue</span>;</span><br><span class="line">deep[y] = deep[x] + <span class="number">1</span>;</span><br><span class="line">dis[y] = dis[x] + z;</span><br><span class="line">anc[y][<span class="number">0</span>] = x; dfs(y);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">Lca</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> y)</span></span>&#123;</span><br><span class="line"><span class="keyword">if</span>(deep[x] &lt; deep[y]) swap(x,y);</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">22</span>;i &gt;= <span class="number">0</span>;i--)</span><br><span class="line"><span class="keyword">if</span>(deep[anc[x][i]] &gt;= deep[y]) x = anc[x][i];</span><br><span class="line"><span class="keyword">if</span>(x == y) <span class="keyword">return</span> x;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">22</span>;i &gt;= <span class="number">0</span>;i--)</span><br><span class="line"><span class="keyword">if</span>(anc[x][i] != anc[y][i])&#123;</span><br><span class="line">x = anc[x][i]; y = anc[y][i];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> anc[x][<span class="number">0</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> vis[N];</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">dfs2</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">vis[x] = <span class="literal">true</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = head[x];i;i = nex[i])&#123;</span><br><span class="line"><span class="keyword">int</span> y = ver[i];</span><br><span class="line"><span class="keyword">if</span>(vis[y]) <span class="keyword">continue</span>;</span><br><span class="line">f[x] += dfs2(y);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> f[x];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;n,&amp;m);</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>,x,y;i &lt; n;i++)&#123;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;x,&amp;y);</span><br><span class="line">addEdge(x,y); addEdge(y,x);</span><br><span class="line">&#125;</span><br><span class="line">dfs(<span class="number">1</span>);</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>,x,y;i &lt;= m;i++)&#123;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;x,&amp;y);</span><br><span class="line">f[x]++; f[y]++; f[Lca(x,y)] -= <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line">dfs2(<span class="number">1</span>); <span class="keyword">int</span> ans = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">2</span>;i &lt;= n;i++)</span><br><span class="line"><span class="keyword">if</span>(!f[i]) ans += m;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span>(f[i] == <span class="number">1</span>) ans++;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%d\n"</span>,ans);</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æ¬¡å°ç”Ÿæˆæ ‘"><a href="#æ¬¡å°ç”Ÿæˆæ ‘" class="headerlink" title="æ¬¡å°ç”Ÿæˆæ ‘*"></a>æ¬¡å°ç”Ÿæˆæ ‘*</h4><p>è¿™æ˜¯é˜³å“¥å“¥è´Ÿè´£çš„é¢˜å‹ï¼Œæˆ‘å°±ä¸è¶Šç•Œäº†ã€‚</p><h4 id="Dis"><a href="#Dis" class="headerlink" title="Dis"></a>Dis</h4><p><strong>é¢˜æ„ç®€è¿°</strong><br>ç»™å‡º n ä¸ªç‚¹çš„ä¸€æ£µæ ‘ï¼Œå¤šæ¬¡è¯¢é—®ä¸¤ç‚¹ä¹‹é—´çš„æœ€çŸ­è·ç¦»ã€‚<br>æ³¨æ„ï¼šè¾¹æ˜¯åŒå‘çš„ã€‚<br><strong>è§£é¢˜æ€è·¯</strong><br>è¿™ä¸ªå°±æ˜¯æ ‡å‡†çš„æ¨¡æ¿é¢˜äº†ï¼Œå’Œç¬¬ä¸€é¢˜ä¸€æ ·ï¼Œæ³¨æ„ä¸€ä¸‹ç»†èŠ‚å³å¯ã€‚</p><p><strong>ä»£ç ç¤ºä¾‹</strong><br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1e5</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> M = <span class="number">2e5</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">int</span> head[N],ver[M],nex[M],edge[M],tot = <span class="number">1</span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">addEdge</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> y,<span class="keyword">int</span> z)</span></span>&#123;</span><br><span class="line">ver[++tot] = y; nex[tot] = head[x];</span><br><span class="line">edge[tot] = z; head[x] = tot;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> n,q;</span><br><span class="line"><span class="keyword">int</span> anc[N][<span class="number">25</span>], deep[N],dis[N];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= <span class="number">22</span>;i++)</span><br><span class="line">anc[x][i] = anc[anc[x][i<span class="number">-1</span>]][i<span class="number">-1</span>];</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = head[x];i ;i = nex[i])&#123;</span><br><span class="line"><span class="keyword">int</span> y = ver[i] , z = edge[i];</span><br><span class="line"><span class="keyword">if</span>(dis[y] || y == <span class="number">1</span>) <span class="keyword">continue</span>;</span><br><span class="line">deep[y] = deep[x]+<span class="number">1</span>;</span><br><span class="line">dis[y] = dis[x] + z;</span><br><span class="line">anc[y][<span class="number">0</span>] = x; dfs(y);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">Lca</span><span class="params">(<span class="keyword">int</span> u,<span class="keyword">int</span> v)</span></span>&#123;</span><br><span class="line"><span class="keyword">if</span>(deep[u] &lt; deep[v]) swap(u,v);</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">22</span>;i &gt;= <span class="number">0</span>;i--)</span><br><span class="line"><span class="keyword">if</span>(deep[anc[u][i]] &gt;= deep[v]) u = anc[u][i];</span><br><span class="line"><span class="keyword">if</span>(u == v) <span class="keyword">return</span> u;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">22</span>;i &gt;= <span class="number">0</span>;i--)</span><br><span class="line"><span class="keyword">if</span>(anc[u][i] != anc[v][i])&#123;</span><br><span class="line">u = anc[u][i]; v= anc[v][i];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> anc[u][<span class="number">0</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">ask</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> y)</span></span>&#123;</span><br><span class="line"><span class="keyword">return</span> dis[x] + dis[y] - <span class="number">2</span>*dis[Lca(x,y)];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;n,&amp;q);</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>,x,y,z;i &lt; n;i++)&#123;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d%d%d"</span>,&amp;x,&amp;y,&amp;z);</span><br><span class="line">addEdge(x,y,z); addEdge(y,x,z);</span><br><span class="line">&#125;</span><br><span class="line">dfs(<span class="number">1</span>);<span class="comment">//å®Œæˆé¢„å¤„ç†</span></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>,x,y;i &lt;= q;i++)&#123;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;x,&amp;y);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%d\n"</span>,ask(x,y));</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h4 id="ç¥–å­™è¯¢é—®"><a href="#ç¥–å­™è¯¢é—®" class="headerlink" title="ç¥–å­™è¯¢é—®"></a>ç¥–å­™è¯¢é—®</h4><p><strong>é¢˜æ„ç®€è¿°</strong><br>å·²çŸ¥ä¸€æ£µ n ä¸ªèŠ‚ç‚¹çš„æœ‰æ ¹æ ‘ã€‚æœ‰ m ä¸ªè¯¢é—®ï¼Œæ¯ä¸ªè¯¢é—®ç»™å‡ºäº†ä¸€å¯¹èŠ‚ç‚¹çš„ç¼–å· x å’Œ yï¼Œè¯¢é—® x ä¸ y çš„ç¥–å­™å…³ç³»ã€‚<br><strong>è§£é¢˜æ€è·¯</strong><br>ç®€å•çš„æ¨¡æ¿é¢˜ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯å¦‚æœ x == yï¼Œé‚£ä¹ˆæ˜¯å±äº<strong>å…¶å®ƒæƒ…å†µ</strong>å“¦ã€‚<br>å¦å¤–è¿˜éœ€è¦æ³¨æ„ä¸€ä¸‹ï¼Œdeep[0] = -1ï¼Œå¦åˆ™ä¼šå’Œæ ¹èŠ‚ç‚¹æ•°å€¼ç›¸ç­‰è€Œå‡ºé”™ã€‚</p><p><strong>ä»£ç ç¤ºä¾‹</strong><br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">int</span> n,m;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1e5</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> M = <span class="number">2e5</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">int</span> head[N],ver[M],edge[M],nex[M],tot = <span class="number">1</span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">addEdge</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> y,<span class="keyword">int</span> z)</span></span>&#123;</span><br><span class="line">ver[++tot] = y; edge[tot] = z;</span><br><span class="line">nex[tot] = head[x]; head[x] = tot;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> anc[N][<span class="number">25</span>], dis[N],deep[N];</span><br><span class="line"><span class="keyword">int</span> root;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= <span class="number">22</span>;i++)</span><br><span class="line">anc[x][i] = anc[anc[x][i<span class="number">-1</span>]][i<span class="number">-1</span>];</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = head[x];i ;i = nex[i])&#123;</span><br><span class="line"><span class="keyword">int</span> y = ver[i], z = edge[i];</span><br><span class="line"><span class="keyword">if</span>(dis[y] || y == root) <span class="keyword">continue</span>;</span><br><span class="line">deep[y] = deep[x]+<span class="number">1</span>;</span><br><span class="line">dis[y] = dis[x] + <span class="number">1</span>;</span><br><span class="line">anc[y][<span class="number">0</span>] = x; dfs(y);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">Lca</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> y)</span></span>&#123;</span><br><span class="line"><span class="keyword">if</span>(deep[x] &lt; deep[y]) swap(x,y);</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">22</span>;i &gt;= <span class="number">0</span>;i--)</span><br><span class="line"><span class="keyword">if</span>(deep[anc[x][i]] &gt;= deep[y]) x = anc[x][i];</span><br><span class="line"><span class="keyword">if</span>(x == y) <span class="keyword">return</span> x;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">22</span>;i &gt;= <span class="number">0</span>;i--)</span><br><span class="line"><span class="keyword">if</span>(anc[x][i] != anc[y][i])&#123;</span><br><span class="line">x = anc[x][i]; y = anc[y][i];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> anc[x][<span class="number">0</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;n);</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>,x,y;i &lt;= n;i++)&#123;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;x,&amp;y);</span><br><span class="line"><span class="keyword">if</span>(y == <span class="number">-1</span>) root = x;</span><br><span class="line"><span class="keyword">else</span> addEdge(x,y,<span class="number">1</span>), addEdge(y,x,<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* å› ä¸ºdeep[root] = 0,å¦‚æœdeep[0] = 0,åˆ™ä¼šè®¤ä¸º 0 å·èŠ‚ç‚¹ä¹Ÿæ˜¯æ ¹ */</span></span><br><span class="line">deep[<span class="number">0</span>] = <span class="number">-1</span>; dfs(root);</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;m);</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>,x,y;i &lt;= m;i++)&#123;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;x,&amp;y);</span><br><span class="line"><span class="keyword">int</span> par = Lca(x,y);</span><br><span class="line"><span class="keyword">if</span>(x == y) <span class="built_in">puts</span>(<span class="string">"0"</span>);</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span>(par == x) <span class="built_in">puts</span>(<span class="string">"1"</span>);</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span>(par == y) <span class="built_in">puts</span>(<span class="string">"2"</span>);</span><br><span class="line"><span class="keyword">else</span> <span class="built_in">puts</span>(<span class="string">"0"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h4 id="èšä¼š"><a href="#èšä¼š" class="headerlink" title="èšä¼š*"></a>èšä¼š*</h4><p><strong>é¢˜æ„ç®€è¿°</strong><br>åŸé¢˜æ¥è‡ªï¼šAHOI 2008</p><p>Y å²›é£æ™¯ç¾ä¸½å®œäººï¼Œæ°”å€™æ¸©å’Œï¼Œç‰©äº§ä¸°å¯Œã€‚Y å²›ä¸Šæœ‰ N ä¸ªåŸå¸‚ï¼Œæœ‰ Nâˆ’1 æ¡åŸå¸‚é—´çš„é“è·¯è¿æ¥ç€å®ƒä»¬ã€‚æ¯ä¸€æ¡é“è·¯éƒ½è¿æ¥æŸä¸¤ä¸ªåŸå¸‚ã€‚å¹¸è¿çš„æ˜¯ï¼Œå°å¯å¯é€šè¿‡è¿™äº›é“è·¯å¯ä»¥èµ°é Y å²›çš„æ‰€æœ‰åŸå¸‚ã€‚ç¥å¥‡çš„æ˜¯ï¼Œä¹˜è½¦ç»è¿‡æ¯æ¡é“è·¯æ‰€éœ€è¦çš„è´¹ç”¨éƒ½æ˜¯ä¸€æ ·çš„ã€‚</p><p>å°å¯å¯ï¼Œå°å¡å¡å’Œå° YY ç»å¸¸æƒ³èšä¼šï¼Œæ¯æ¬¡èšä¼šï¼Œä»–ä»¬éƒ½ä¼šé€‰æ‹©ä¸€ä¸ªåŸå¸‚ï¼Œä½¿å¾—ä¸‰ä¸ªäººåˆ°è¾¾è¿™ä¸ªåŸå¸‚çš„æ€»è´¹ç”¨æœ€å°ã€‚</p><p>ç”±äºä»–ä»¬è®¡åˆ’ä¸­è¿˜ä¼šæœ‰å¾ˆå¤šæ¬¡èšä¼šï¼Œæ¯æ¬¡éƒ½é€‰æ‹©ä¸€ä¸ªåœ°ç‚¹æ˜¯å¾ˆçƒ¦äººçš„äº‹æƒ…ï¼Œæ‰€ä»¥ä»–ä»¬å†³å®šæŠŠè¿™ä»¶äº‹æƒ…äº¤ç»™ä½ æ¥å®Œæˆã€‚ä»–ä»¬ä¼šæä¾›ç»™ä½ åœ°å›¾ä»¥åŠè‹¥å¹²æ¬¡èšä¼šå‰ä»–ä»¬æ‰€å¤„çš„ä½ç½®ï¼Œå¸Œæœ›ä½ ä¸ºä»–ä»¬çš„æ¯ä¸€æ¬¡èšä¼šé€‰æ‹©ä¸€ä¸ªåˆé€‚çš„åœ°ç‚¹ã€‚</p><p><strong>è§£é¢˜æ€è·¯</strong><br>åœ¨ä¸€æ£µæ ‘ä¸Šæ±‚ä¸‰ä¸ªç‚¹ (x, y ,z) ä¹‹é—´çš„æœ€çŸ­è·¯å¾„ï¼Œæˆ‘ä»¬æ±‚å‡ºdis[x, y] + dis[x , z] + dis[y , z]ï¼Œç”»å›¾å°±ä¼šå‘ç°æ¯ä¸€æ®µè·¯å¾„éƒ½è¢«é‡å¤è®¡ç®—äº† 2 æ¬¡ï¼Œäºæ˜¯æˆ‘ä»¬å†å°†ç­”æ¡ˆ / 2å°±å¾—åˆ°äº†ä¸‰ä¸ªç‚¹ä¹‹é—´çš„è·¯å¾„ã€‚<br>å‡è®¾è¿™ä¸ªèšä¼šç‚¹ä¸º p ï¼Œé‚£ä¹ˆæ˜¾ç„¶ p æ˜¯ä¸‰æ¡è·¯å¾„çš„äº¤æ±‡ç‚¹ï¼Œå¦åˆ™è·¯å¾„å’Œè‚¯å®šä¸ä¼šæ˜¯æœ€çŸ­ã€‚ä¸‹ä¸€æ­¥çš„ç›®æ ‡å°±æ˜¯æ±‚å‡ºè¿™ä¸ªäº¤æ±‡ç‚¹çš„åæ ‡ã€‚</p><p>å¦‚æœæˆ‘ä»¬ä»¥æŸä¸ªç‚¹ä¸ºæ ¹ï¼Œä¸ºæ¯ä¸ªèŠ‚ç‚¹æ›´æ–°æ·±åº¦deepï¼ˆå°±åƒæˆ‘ä»¬åœ¨æ±‚LCAæ—¶ä¸€æ ·ï¼‰ï¼Œé‚£ä¹ˆæ˜¾ç„¶ p ç‚¹å°±æ˜¯ Lca[x, y] , Lca[x , z] , Lca[y , z] ä¸‰è€…ä¸­deepæœ€å¤§ï¼ˆæœ€æ·±ï¼‰çš„ç‚¹ï¼Œè¿™ä¹Ÿå¯ä»¥é€šè¿‡ç”»å›¾è§‚å¯Ÿå‡ºæ¥ï¼Œä¹Ÿå¾ˆå®¹æ˜“è¯æ˜ã€‚</p><p>äºæ˜¯æˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨æ ‘ä¸Šå€å¢æ³•æ±‚å‡ºLcaï¼Œåœ¨O(NlogN)æ—¶é—´å†…è§£å†³è¯¥é¢˜ï¼Œä½†æ˜¯å¸¸æ•°ä¸å¤ªä¼˜ç§€ï¼Œæé™æ•°æ®è¿˜æ˜¯ä¼šè¢«å¡æ‰ï¼Œå¦‚æœæƒ³æ»¡åˆ†éœ€è¦ç”¨æ ‘é“¾å‰–åˆ†ï¼Œä¸è¿‡è¯¥æ€è·¯å·²ç»å¯ä»¥é€šè¿‡ä¸€æœ¬é€šojä¸Šçš„æ•°æ®äº†ã€‚<br><strong>ä»£ç ç¤ºä¾‹</strong><br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">5e5</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> M = <span class="number">1e6</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">int</span> head[N],ver[M],edge[M],nex[M], tot = <span class="number">1</span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">addEdge</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> y,<span class="keyword">int</span> z)</span></span>&#123;</span><br><span class="line">ver[++tot] = y, edge[tot] = z;</span><br><span class="line">nex[tot] = head[x] , head[x] = tot;</span><br><span class="line">&#125; </span><br><span class="line"><span class="keyword">int</span> n,m;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">getInt</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">int</span> res = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">bool</span> neg = <span class="literal">false</span>;</span><br><span class="line"><span class="keyword">char</span> c = getchar();</span><br><span class="line"><span class="keyword">while</span>(c != <span class="string">'-'</span> &amp;&amp; (c &lt; <span class="string">'0'</span> || c &gt; <span class="string">'9'</span>)) c = getchar();</span><br><span class="line"><span class="keyword">if</span>(c == <span class="string">'-'</span>) neg = <span class="literal">true</span>,c = getchar();</span><br><span class="line"><span class="keyword">while</span>(c &gt;= <span class="string">'0'</span> &amp;&amp; c &lt;= <span class="string">'9'</span>) </span><br><span class="line">res = res*<span class="number">10</span>+c-<span class="string">'0'</span>, c = getchar();</span><br><span class="line"><span class="keyword">return</span> neg?-res:res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> root = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">int</span> deep[N],anc[N][<span class="number">24</span>],dis[N];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= <span class="number">22</span>;i++)</span><br><span class="line">anc[x][i] = anc[anc[x][i<span class="number">-1</span>]][i<span class="number">-1</span>];</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = head[x];i ;i = nex[i])&#123;</span><br><span class="line"><span class="keyword">int</span> y = ver[i], z = edge[i];</span><br><span class="line"><span class="keyword">if</span>(dis[y] || y == root) <span class="keyword">continue</span>;</span><br><span class="line">deep[y] = deep[x] + <span class="number">1</span>;</span><br><span class="line">dis[y] = dis[x] + <span class="number">1</span>;</span><br><span class="line">anc[y][<span class="number">0</span>] = x; dfs(y);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">Lca</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> y)</span></span>&#123;</span><br><span class="line"><span class="keyword">if</span>(deep[x] &lt; deep[y]) swap(x,y);</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">22</span>;i &gt;= <span class="number">0</span>;i--)</span><br><span class="line"><span class="keyword">if</span>(deep[anc[x][i]] &gt;= deep[y]) x = anc[x][i];</span><br><span class="line"><span class="keyword">if</span>(x == y) <span class="keyword">return</span> x;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">22</span>;i &gt;= <span class="number">0</span>;i--)</span><br><span class="line"><span class="keyword">if</span>(anc[x][i] != anc[y][i])&#123;</span><br><span class="line">x = anc[x][i]; y = anc[y][i];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> anc[x][<span class="number">0</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">Dis</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> y)</span></span>&#123;</span><br><span class="line"><span class="keyword">return</span> dis[x] + dis[y] - <span class="number">2</span>*dis[Lca(x,y)];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">print</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line"><span class="keyword">if</span>(!x) <span class="keyword">return</span>;</span><br><span class="line">print(x/<span class="number">10</span>);</span><br><span class="line"><span class="built_in">putchar</span>(x%<span class="number">10</span>+<span class="string">'0'</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">n = getInt(); m = getInt();</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>,x,y;i &lt; n;i++)&#123;</span><br><span class="line">x = getInt(); y = getInt();</span><br><span class="line">addEdge(x,y,<span class="number">1</span>); addEdge(y,x,<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line">deep[<span class="number">0</span>] = <span class="number">-1</span>; dfs(root);</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>,x,y,z;i &lt;= m;i++)&#123;</span><br><span class="line">x = getInt(); y = getInt(); z = getInt();</span><br><span class="line"><span class="keyword">int</span> par = Lca(x,y); </span><br><span class="line"><span class="keyword">int</span> p2 = Lca(x,z) , p3 = Lca(y,z);</span><br><span class="line"><span class="keyword">if</span>(deep[par] &lt; deep[p2]) par = p2;</span><br><span class="line"><span class="keyword">if</span>(deep[par] &lt; deep[p3]) par = p3;</span><br><span class="line"><span class="keyword">int</span> res = Dis(x,y) + Dis(x,z) + Dis(y,z) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">print(par); <span class="built_in">putchar</span>(<span class="string">' '</span>); print(res); <span class="built_in">puts</span>(<span class="string">""</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h4 id="è·³è·³æ£‹"><a href="#è·³è·³æ£‹" class="headerlink" title="è·³è·³æ£‹**"></a>è·³è·³æ£‹**</h4><p><strong>é¢˜æ„ç®€è¿°</strong><br>åŸé¢˜æ¥è‡ªï¼šBZOJ 2144</p><p>è·³è·³æ£‹æ˜¯åœ¨ä¸€æ¡æ•°è½´ä¸Šè¿›è¡Œçš„ã€‚æ£‹å­åªèƒ½æ‘†åœ¨æ•´ç‚¹ä¸Šã€‚æ¯ä¸ªç‚¹ä¸èƒ½æ‘†è¶…è¿‡ä¸€ä¸ªæ£‹å­ã€‚æˆ‘ä»¬ç”¨è·³è·³æ£‹æ¥åšä¸€ä¸ªç®€å•çš„æ¸¸æˆï¼šæ£‹ç›˜ä¸Šæœ‰ä¸‰é¢—æ£‹å­ï¼Œåˆ†åˆ«åœ¨ a,b,c è¿™ä¸‰ä¸ªä½ç½®ã€‚æˆ‘ä»¬è¦é€šè¿‡æœ€å°‘çš„è·³åŠ¨æŠŠä»–ä»¬çš„ä½ç½®ç§»åŠ¨æˆ x,y,zï¼ˆæ³¨æ„ï¼šæ£‹å­æ˜¯æ²¡æœ‰åŒºåˆ«çš„ï¼‰ã€‚</p><p>è·³åŠ¨çš„è§„åˆ™å¾ˆç®€å•ï¼Œä»»æ„é€‰ä¸€é¢—æ£‹å­ï¼Œå¯¹ä¸€é¢—ä¸­è½´æ£‹å­è·³åŠ¨ã€‚è·³åŠ¨åä¸¤é¢—æ£‹å­è·ç¦»ä¸å˜ã€‚ä¸€æ¬¡åªå…è®¸è·³è¿‡ä¸€é¢—æ£‹å­ã€‚</p><p>å†™ä¸€ä¸ªç¨‹åºï¼Œé¦–å…ˆåˆ¤æ–­æ˜¯å¦å¯ä»¥å®Œæˆä»»åŠ¡ã€‚å¦‚æœå¯ä»¥ï¼Œè¾“å‡ºæœ€å°‘éœ€è¦çš„è·³åŠ¨æ¬¡æ•°ã€‚<br><img src="/2019/10/09/lca-problems/1.png" alt="1"><br><strong>è§£é¢˜æ€è·¯</strong><br>è¿™é¢˜æœ‰å¥½å‡ ä¸ªéš¾ç‚¹ï¼Œæ€è·¯ä¹Ÿä¸æ˜¯é‚£ä¹ˆå®¹æ˜“æƒ³åˆ°ã€‚</p><p>é¦–å…ˆæ¯”è¾ƒå®¹æ˜“æƒ³åˆ°çš„æ˜¯ï¼Œæœ‰å“ªäº›ç‚¹æ˜¯å¯ä»¥è¾¾åˆ°çš„ï¼›è®¾a,b,cå‡åºï¼Œl1 = b-a, l2 = c-bï¼Œé‚£ä¹ˆ(l1, l2)å¯ä»¥è½¬ç§»åˆ° (l1, l2-l1) å’Œ (l1-l2 , l2)ã€‚<br>é‚£ä¹ˆæ¯æ¬¡è½¬ç§»äº†å¤šå°‘é•¿åº¦ï¼Œå‘å“ªä¸ªæ–¹å‘è½¬ç§»çš„æˆ‘ä»¬éƒ½çŸ¥é“äº†ï¼Œè‡ªç„¶å°±å¯ä»¥å¾—åˆ°ç‚¹çš„è½¬ç§»ã€‚å°±æ¯”å¦‚ (l1 , l2)  â€”&gt; (l1 , l2 - l1) ï¼Œå°±å¯¹åº”ç€(a ,b ,c)â€”&gt;(b, 2b-a, c)ã€‚</p><p>æ—¢ç„¶æˆ‘ä»¬çŸ¥é“ç‚¹å¦‚ä½•è½¬ç§»ï¼Œé‚£ä¹ˆé—®é¢˜å°±å˜æˆäº†åˆ¤æ–­ (a , b, c) å’Œ (x , y , z) æ˜¯å¦å¯ä»¥è½¬ç§»åˆ°åŒä¸€ä¸ªçŠ¶æ€ã€‚</p><p>æˆ‘ä»¬ä¸Šé¢åªè®¨è®ºäº†ä¸¤ç«¯èŠ‚ç‚¹å‘ä¸­é—´è·³ï¼ˆå¯¹åº”ç€åˆæ³•é•¿åº¦çš„ç›¸å‡ï¼Œaè·³åˆ°bã€cä¸­é—´ï¼Œcè·³åˆ°aã€bä¸­é—´ï¼‰ï¼Œæ²¡è€ƒè™‘ä¸­é—´èŠ‚ç‚¹å‘ä¸¤è¾¹è·³ï¼ˆaå…³äºcè·³ï¼Œæˆ–cå…³äºaè·³ï¼Œæˆ–bå…³äºaã€cè·³ï¼Œå¯¹åº”ç€åˆæ³•é•¿åº¦çš„ç›¸åŠ ï¼‰ï¼Œå®é™…ä¸Šä¸¤è€…éƒ½æˆç«‹ï¼Œæ¯”å¦‚(l1 , l2)â€”&gt;(l1, l1+l2)å¯¹åº”ç€(a ,b ,c) â€”&gt; (b , a , c) ï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬å°†å…¶ä¸­ä¸¤ç‚¹ä¹‹é—´çš„è·ç¦»ä¸æ–­å˜å¤§ï¼Œä¼šç»ˆæ­¢äºæ­£æ— ç©·ï¼Œä½†å¦‚æœä¸æ–­ç¼©å°ï¼Œå°±ä¼šç»ˆæ­¢äºæŸä¸€ä¸ªéè´Ÿæ•´æ•°ï¼›åŸºäºæ­¤æˆ‘ä»¬åªè€ƒè™‘â€œä¸¤è¾¹çš„ç‚¹å‘ä¸­é—´è·³â€è¿™ç§æƒ…å†µï¼Œè¿™å¯¹åº”ç€å¼€å§‹ä»‹ç»çš„ä¸¤ä¸ªå‡æ³•è½¬ç§»ã€‚</p><p>åˆ°æ­¤å°±æœ‰äº›æ˜æœ—äº†ï¼Œæ¯ä¸ªçŠ¶æ€çœ‹ä½œä¸€ä¸ªèŠ‚ç‚¹ï¼Œè½¬ç§»ä¸€æ¬¡å°±çœ‹ä½œå‘ä¸Šèµ°ä¸€æ­¥ï¼Œæœ€ç»ˆä¸€å®šä¼šç»ˆæ­¢äºæŸä¸€ä¸ªçŠ¶æ€ï¼Œè¿™ä¸ªçŠ¶æ€å°±å¯ä»¥çœ‹ä½œæ ¹èŠ‚ç‚¹ï¼›æˆ‘ä»¬å°†(a ,b ,c) ä¸ (x, y , z)åŒæ—¶â€œå‘ä¸Šâ€è½¬ç§»ï¼Œå¦‚æœå®ƒä»¬ç»ˆæ­¢äºåŒä¸€ä¸ªçŠ¶æ€ï¼Œå°±è¯´æ˜å®ƒä»¬å¯ä»¥äº’ç›¸æŠµè¾¾ï¼Œå¦åˆ™åˆ™ä¸èƒ½ã€‚</p><p>æ¥ä¸‹æ¥å°±æ˜¯è¦åˆ¤æ–­æœ€å°çš„æ­¥æ•°ï¼Œå³(a ,b ,c) åˆ° (x , y , z) çš„æœ€å°‘è½¬ç§»æ¬¡æ•°ã€‚è¿™å°±ç›¸å½“äºæ±‚äºŒè€…çš„LCAï¼Œå› ä¸ºå®ƒä»¬æœ‰å…±åŒçš„â€œæ ¹èŠ‚ç‚¹â€ï¼Œå¹¶ä¸”æœ‰ç€åˆ°æ ¹èŠ‚ç‚¹çš„å”¯ä¸€è·¯å¾„ï¼Œæ‰€ä»¥å¯ä»¥å°†å®ƒä»¬çš„è½¬ç§»çœ‹ä½œä¸€æ£µæ ‘ï¼Œè¾¹æƒä¸º1ï¼Œæ±‚ç€ä¸¤ä¸ªçŠ¶æ€ä¹‹é—´çš„è·ç¦»ã€‚</p><p>ç”±äºæˆ‘ä»¬åˆ©ç”¨çš„æ˜¯åˆæ³•é•¿åº¦çš„è½¬ç§»æ¥å¯¹åº”ç€ç‚¹çš„çŠ¶æ€çš„è½¬ç§»ï¼Œå³(l1, l2) â€”&gt; (l1 , l2-l1)æˆ–(l1-l2, l2)ã€‚è¿™å’Œæ›´ç›¸å‡æŸæœ¯ gcd(a, b) = gcd(a, b-a) = gcd(a-b, a)ç›¸åŒï¼Œè€Œæ¬§å‡ é‡Œå¾—åˆå‘Šè¯‰æˆ‘ä»¬ gcd(a ,b) = gcd(b ,a%b)ï¼Œäºæ˜¯æœ¬æ¥ O(N) çš„å‡æ³•å˜æˆäº† O(log N)çš„é™¤æ³•ï¼ˆå–æ¨¡ï¼‰ã€‚</p><p>æˆ‘ä»¬å¯ä»¥åœ¨O(logN)çš„æ—¶é—´å†…è½¬ç§»åˆ°ä»»æ„ä¸€ä¸ªçˆ¶çŠ¶æ€ï¼Œä½†æ˜¯æˆ‘ä»¬ä¸çŸ¥é“è¯¥å‘ä¸Šè½¬ç§»å‡ æ­¥æ‰æ˜¯æœ€å°‘æ­¥æ•°ï¼Œäºæ˜¯æˆ‘ä»¬è¦å…ˆå°†äºŒè€…çš„<strong>æ·±åº¦</strong>è°ƒåˆ°ç›¸åŒï¼Œç„¶ååŒæ—¶å‘ä¸Šèµ° k æ­¥ï¼Œè¿™å¯ä»¥ç”¨å€å¢å®ç°ï¼Œä¹Ÿå¯ä»¥ç”¨äºŒåˆ†æœç´¢å®ç°ã€‚æ±‚æ·±åº¦æˆ‘ä»¬å¯ä»¥åœ¨æ±‚ç¬¬ä¸€é—®æ—¶é¡ºä¾¿æ±‚è§£ï¼ŒåŒæ—¶æ·±åº¦ä¹Ÿæ˜¯æœ€é•¿è·¯å¾„ï¼Œç”¨äºäºŒåˆ†ã€‚</p><p><strong>ä»£ç ç¤ºä¾‹</strong></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> INF = <span class="number">0x3f3f3f3f</span>;</span><br><span class="line"><span class="keyword">int</span> a[<span class="number">5</span>],b[<span class="number">5</span>];</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Node</span>&#123;</span></span><br><span class="line"><span class="keyword">int</span> x,y,z;</span><br><span class="line">Node()&#123;&#125;</span><br><span class="line">Node(<span class="keyword">int</span> x,<span class="keyword">int</span> y,<span class="keyword">int</span> z):x(x),y(y),z(z)&#123;&#125;</span><br><span class="line"><span class="keyword">bool</span> <span class="keyword">operator</span> != (<span class="keyword">const</span> Node&amp; B) <span class="keyword">const</span>&#123;</span><br><span class="line"><span class="keyword">return</span> !(x == B.x &amp;&amp; y == B.y &amp;&amp; z == B.z);</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">int</span> deep;</span><br><span class="line"><span class="function">Node <span class="title">jump</span><span class="params">(Node h, <span class="keyword">int</span> step)</span></span>&#123;</span><br><span class="line"><span class="comment">/*è¿”å›ä»ä½ç½®hå‘ä¸Šè·³stepæ­¥åçš„çŠ¶æ€,é¡ºä¾¿è®°å½•ä¸€ä¸‹å½“å‰æ·±åº¦(è·æ ¹è·ç¦»)*/</span></span><br><span class="line">Node res = h;</span><br><span class="line"><span class="keyword">int</span> t1 = h.y-h.x, t2 = h.z - h.y;</span><br><span class="line"><span class="keyword">if</span>(t1 == t2) <span class="keyword">return</span> res; </span><br><span class="line"><span class="keyword">if</span>(t1 &lt; t2)&#123;</span><br><span class="line"><span class="keyword">int</span> t = min(step,(t2<span class="number">-1</span>)/t1);<span class="comment">//ç”¨é™¤æ³•ä¼˜åŒ– </span></span><br><span class="line">step -= t; deep += t;<span class="comment">//è®°å½•ä¸€ä¸‹æ·±åº¦ </span></span><br><span class="line">res.y += t*t1; res.x += t*t1;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"><span class="keyword">int</span> t = min(step,(t1<span class="number">-1</span>)/t2);</span><br><span class="line">step -= t; deep += t;</span><br><span class="line">res.y -= t*t2; res.z -= t*t2;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(step) <span class="keyword">return</span> jump(res,step);</span><br><span class="line"><span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">check</span><span class="params">(<span class="keyword">int</span> x,Node h1,Node h2)</span></span>&#123;</span><br><span class="line"><span class="keyword">return</span> !(jump(h1,x) != jump(h2,x));</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= <span class="number">3</span>;i++) <span class="built_in">scanf</span>(<span class="string">"%d"</span>,a+i);</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= <span class="number">3</span>;i++) <span class="built_in">scanf</span>(<span class="string">"%d"</span>,b+i);</span><br><span class="line">sort(a+<span class="number">1</span>,a+<span class="number">4</span>); sort(b+<span class="number">1</span>,b+<span class="number">4</span>);</span><br><span class="line">Node h1(a[1],a[2],a[3]) , h2(b[1],b[2],b[3]);</span><br><span class="line">Node aa = jump(h1,INF); <span class="keyword">int</span> d1 = deep; deep = <span class="number">0</span>;</span><br><span class="line">Node bb = jump(h2,INF); <span class="keyword">int</span> d2 = deep; deep = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">if</span>(aa != bb)&#123;</span><br><span class="line"><span class="built_in">puts</span>(<span class="string">"NO"</span>); <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">puts</span>(<span class="string">"YES"</span>);</span><br><span class="line"><span class="comment">/*è®¡ç®—æ­¥æ•°ï¼šå…ˆè°ƒæ•´åˆ°åŒä¸€æ·±åº¦,å†äºŒåˆ†ä¸€èµ·è·³*/</span></span><br><span class="line"><span class="keyword">if</span>(d1 &lt; d2) swap(d1,d2),swap(h1,h2);</span><br><span class="line">h1 = jump(h1,d1-d2);</span><br><span class="line"><span class="keyword">int</span> l = <span class="number">0</span>, r = d1;</span><br><span class="line"><span class="keyword">while</span>(l &lt;= r)&#123;</span><br><span class="line"><span class="keyword">int</span> mid = l+r&gt;&gt;<span class="number">1</span>;</span><br><span class="line"><span class="keyword">if</span>(check(mid,h1,h2)) r = mid<span class="number">-1</span>;</span><br><span class="line"><span class="keyword">else</span> l = mid+<span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%d\n"</span>,<span class="number">2</span>*l+d1-d2);</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;æ ‘ä¸Šå€å¢æ³•å¯ä»¥ç”¨äºæ±‚LCAï¼Œå½“ç„¶åœ¨å…¶å®ƒåœºåˆä¹Ÿæœ‰åº”ç”¨ï¼Œåœ¨å¾ˆå¤šæ—¶å€™çœ‹ä¼¼ä¸æ˜¯æ ‘å½¢çš„é—®é¢˜ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡è½¬åŒ–æˆæ ‘å½¢ç»“æ„ï¼Œç„¶ååœ¨æ ‘ä¸­è¿›è¡Œæ“ä½œï¼Œè¿™ç§æ“ä½œå¯ä»¥æ˜¯æ±‚äºŒè€…ä¹‹é—´çš„æœ€è¿‘çŠ¶æ€ï¼Œæˆ–è€…æ˜¯äºŒè€…ä¹‹é—´çš„è·ç¦»ï¼Œå¦‚æœ€åä¸€é¢˜ã€‚&lt;br&gt;å¦å¤–å…³äºæ ‘çš„é¢˜å‹ï¼Œæœ€å¥½è¿˜æ˜¯æ ¹æ®æ ·ä¾‹ç”»å›¾æ€è€ƒï¼Œå¾€å¾€å¯ä»¥æ¯”ç©ºæƒ³è·å¾—æ›´
      
    
    </summary>
    
      <category term="ACMé¢˜è§£" scheme="http://valenshi.top/categories/ACM%E9%A2%98%E8%A7%A3/"/>
    
    
      <category term="lca" scheme="http://valenshi.top/tags/lca/"/>
    
      <category term="æ ‘ä¸Šå€å¢" scheme="http://valenshi.top/tags/%E6%A0%91%E4%B8%8A%E5%80%8D%E5%A2%9E/"/>
    
  </entry>
  
  <entry>
    <title>æœ€å°ç”Ÿæˆæ ‘ç›¸å…³é—®é¢˜</title>
    <link href="http://valenshi.top/2019/10/09/MSTs/"/>
    <id>http://valenshi.top/2019/10/09/MSTs/</id>
    <published>2019-10-09T10:47:52.000Z</published>
    <updated>2019-10-09T10:48:57.678Z</updated>
    
    <content type="html"><![CDATA[<p><strong>æ‘˜è¦ï¼š</strong><br>åœ¨å¯¹æœ€å°ç”Ÿæˆæ ‘ç®—æ³•æœ‰ä¸€å®šç†è§£åï¼Œæˆ‘ä»¬å¯¹å…¸å‹çš„æœ€å°ç”Ÿæˆæ ‘é¢˜å‹åº”è¯¥ä¸éš¾è§£å†³ï¼Œä½†æ˜¯å¯¹äºç”±æœ€å°ç”Ÿæˆæ ‘æ¨¡å‹å˜å½¢è€Œæ¥çš„å‡ ç§æ¨¡å‹ï¼Œæˆ‘ä»¬ä»éœ€åšä¸€æ¬¡æ€»ç»“ä¸è®°å½•ã€‚<br>é¦–å…ˆæˆ‘ä»¬éœ€è¦æå‡ºæœ€å°ç”Ÿæˆæ ‘å‡ ä¸ªæ€§è´¨ï¼Œä¾¿äºæ¨å¯¼ç®—æ³•ï¼›ç„¶åæˆ‘ä»¬å°†ä»‹ç»6ç§æœ€å°ç”Ÿæˆæ ‘ç›¸å…³é—®é¢˜æ¨¡å‹ï¼Œå¹¶è®¨è®ºä¸€èˆ¬è§£æ³•ä¸æ›´ä¼˜è§£æ³•ï¼›å…¶ä¸­æœ‰çš„è§£æ³•æ˜¾è€Œæ˜“è§ï¼Œæ¥å—èµ·æ¥ä¹Ÿå¾ˆç®€å•ï¼Œä½†æœ‰çš„è§£æ³•å´éœ€è¦ä»ç†è®ºä¸Šé€»è¾‘ä¸¥å¯†çš„è¿›è¡Œæ¨å¯¼ï¼Œæ„é€ ç®—æ³•å¹¶è¯æ˜ç®—æ³•çš„æ­£ç¡®æ€§ï¼Œè¿™éƒ¨åˆ†éš¾åº¦ç¨å¤§ã€‚<br>è¿™6ä¸ªç›¸å…³é—®é¢˜åˆ†åˆ«æ˜¯ï¼šå¢é‡æœ€å°ç”Ÿæˆæ ‘ï¼Œæœ€å°ç“¶é¢ˆç”Ÿæˆæ ‘ï¼Œæœ€å°ç“¶é¢ˆè·¯ï¼Œæ¯å¯¹èŠ‚ç‚¹çš„æœ€å°ç“¶é¢ˆè·¯ï¼Œæ¬¡å°ç”Ÿæˆæ ‘ï¼Œæœ€å°æœ‰å‘ç”Ÿæˆæ ‘ã€‚</p><h4 id="å›¾è®ºä¸­çš„2ä¸ªæ€§è´¨ï¼š"><a href="#å›¾è®ºä¸­çš„2ä¸ªæ€§è´¨ï¼š" class="headerlink" title="å›¾è®ºä¸­çš„2ä¸ªæ€§è´¨ï¼š"></a>å›¾è®ºä¸­çš„2ä¸ªæ€§è´¨ï¼š</h4><ul><li><strong>åˆ‡å‰²æ€§è´¨ï¼š</strong> å‡å®šæ‰€æœ‰è¾¹æƒå‡ä¸ç›¸åŒã€‚è®¾Sä¸ºæ—¢éç©ºé›†ä¹Ÿéå…¨é›†çš„Vçš„å­é›†ï¼Œè¾¹eæ˜¯æ»¡è¶³ä¸€ä¸ªç«¯ç‚¹åœ¨Så†…ï¼Œå¦ä¸€ä¸ªç«¯ç‚¹ä¸åœ¨Så†…çš„æ‰€æœ‰è¾¹ä¸­æƒå€¼æœ€å°çš„ä¸€ä¸ªï¼Œåˆ™å›¾Gçš„æ‰€æœ‰ç”Ÿæˆæ ‘å‡åŒ…å«eã€‚</li><li><strong>å›è·¯æ€§è´¨ï¼š</strong> å‡å®šæ‰€æœ‰è¾¹æƒå€¼å‡ä¸ç›¸åŒã€‚è®¾Cæ˜¯å›¾Gä¸­ä»»æ„å›è·¯ï¼Œè¾¹eæ˜¯Cä¸Šæƒå€¼æœ€å¤§çš„è¾¹ï¼Œåˆ™å›¾Gçš„æ‰€æœ‰ç”Ÿæˆæ ‘å‡ä¸åŒ…å«eã€‚</li></ul><p>åœ¨æ­¤ä¸ç»™å‡ºè¯æ˜ã€‚</p><h4 id="å¢é‡æœ€å°ç”Ÿæˆæ ‘"><a href="#å¢é‡æœ€å°ç”Ÿæˆæ ‘" class="headerlink" title="å¢é‡æœ€å°ç”Ÿæˆæ ‘"></a>å¢é‡æœ€å°ç”Ÿæˆæ ‘</h4><p><strong>é—®é¢˜æè¿°ï¼š</strong><br>ä»åŒ…å«nä¸ªç‚¹çš„ç©ºå›¾å¼€å§‹ï¼Œä¾æ¬¡åŠ å…¥mæ¡å¸¦æƒè¾¹ã€‚æ¯åŠ å…¥ä¸€æ¡è¾¹ï¼Œè¾“å‡ºå½“å‰å›¾ä¸­çš„æœ€å°ç”Ÿæˆæ ‘æƒå€¼ï¼ˆå¦‚æœå½“å‰å›¾ä¸è¿é€šï¼Œåˆ™è¾“å‡ºæ— è§£ï¼‰ã€‚<br><strong>è§£é¢˜æ€è·¯ï¼š</strong><br>å¦‚æœæ¯æ¬¡é‡æ–°æ±‚å®Œæ•´çš„æœ€å°ç”Ÿæˆæ ‘é—®é¢˜ï¼Œæ€»æ—¶é—´å¤æ‚åº¦é«˜è¾¾O(m^2 log n)ã€‚æ ¹æ®å›è·¯çš„æ€§è´¨ï¼Œå¯ä»¥å¾—åˆ°å¦‚ä¸‹æ”¹è¿›ç®—æ³•ï¼š</p><blockquote><p>æ¯æ¬¡æ±‚å‡ºæ–°çš„æœ€å°ç”Ÿæˆæ ‘åï¼ŒæŠŠå…¶å®ƒçš„è¾¹åˆ é™¤ã€‚ç”±äºæ¯æ¬¡åªéœ€è®¡ç®—ä¸€ä¸ªnæ¡è¾¹ï¼ˆåŸç”Ÿæˆæ ‘æœ‰ n - 1æ¡ï¼Œæ–°åŠ å…¥ä¸€æ¡ï¼‰çš„å›¾çš„æœ€å°ç”Ÿæˆæ ‘ï¼ŒKruskalç®—æ³•çš„æ—¶é—´å¤æ‚åº¦é™ä¸ºO(n log n)ï¼Œæ€»æ—¶é—´å¤æ‚åº¦ä¸ºO(nm log n)ã€‚</p></blockquote><p>è¿™ä¸ªç®—æ³•å¯ä»¥è¿›ä¸€æ­¥æ”¹è¿›:</p><blockquote><p>åŠ å…¥ä¸€æ¡è¾¹e = (u, v)ä¹‹åï¼Œå›¾ä¸­æ°å¥½åŒ…å«ä¸€ä¸ªç¯ã€‚æ ¹æ®å›è·¯æ€§è´¨ï¼Œåˆ é™¤è¯¥å›è·¯ä¸Šæƒå€¼æœ€å¤§çš„è¾¹å³å¯ï¼Œå› æ­¤åªéœ€åœ¨åŠ è¾¹ä¹‹å‰çš„MSTä¸Šæ‰¾åˆ°uåˆ°vçš„å”¯ä¸€è·¯å¾„ä¸Šçš„æƒå€¼æœ€å¤§çš„è¾¹ï¼Œå†å’Œeæ¯”è¾ƒï¼Œåˆ é™¤æƒå€¼è¾ƒå¤§çš„ä¸€æ¡ã€‚ç”±äºè·¯å¾„å”¯ä¸€ï¼Œå¯ä»¥ç”¨DFSæˆ–BFSæ‰¾åˆ°è¿™æ¡uåˆ°vçš„è·¯å¾„ï¼Œæ€»æ—¶é—´å¤æ‚åº¦ä¸ºO(nm)ã€‚</p></blockquote><h4 id="æœ€å°ç“¶é¢ˆç”Ÿæˆæ ‘"><a href="#æœ€å°ç“¶é¢ˆç”Ÿæˆæ ‘" class="headerlink" title="æœ€å°ç“¶é¢ˆç”Ÿæˆæ ‘"></a>æœ€å°ç“¶é¢ˆç”Ÿæˆæ ‘</h4><p><strong>é—®é¢˜æè¿°ï¼š</strong><br>ç»™å‡ºåŠ æƒæ— å‘å›¾ï¼Œæ±‚ä¸€æ£µç”Ÿæˆæ ‘ï¼Œä½¿å¾—æœ€å¤§è¾¹æƒå€¼å°½é‡å°ã€‚</p><p><strong>è§£é¢˜æ€è·¯ï¼š</strong><br>ç”±äºåªå…³å¿ƒæœ€å¤§è¾¹æƒå€¼ï¼Œæˆ‘ä»¬å¯ä»¥ä»ä¸€ä¸ªç©ºå›¾å¼€å§‹ï¼ŒæŒ‰ç…§æƒå€¼ä»å°åˆ°å¤§çš„é¡ºåºä¾æ¬¡åŠ å…¥å„æ¡è¾¹ï¼Œåˆ™å›¾ç¬¬ä¸€æ¬¡è¿é€šæ—¶ï¼Œè¯¥å›¾çš„æœ€å°ç”Ÿæˆæ ‘å°±æ˜¯åŸå›¾çš„æœ€å°ç“¶é¢ˆç”Ÿæˆæ ‘ã€‚å¯ä»¥å‘ç°ï¼ŒåŸå›¾çš„æœ€å°ç”Ÿæˆæ ‘å°±æ˜¯ä¸€æ£µæœ€å°ç“¶é¢ˆç”Ÿæˆæ ‘ï¼ˆä½†ä¸æ˜¯æ¯æ£µæœ€å°ç“¶é¢ˆç”Ÿæˆæ ‘éƒ½æ˜¯æœ€å°ç”Ÿæˆæ ‘ï¼‰ã€‚</p><h4 id="æœ€å°ç“¶é¢ˆè·¯"><a href="#æœ€å°ç“¶é¢ˆè·¯" class="headerlink" title="æœ€å°ç“¶é¢ˆè·¯"></a>æœ€å°ç“¶é¢ˆè·¯</h4><p><strong>é—®é¢˜æè¿°ï¼š</strong><br>ç»™å®šåŠ æƒæ— å‘å›¾çš„ä¸¤ä¸ªèŠ‚ç‚¹uå’Œvï¼Œæ±‚å‡ºä»uåˆ°vçš„ä¸€æ¡è·¯å¾„ï¼Œä½¿å¾—è·¯å¾„ä¸Šæœ€é•¿è¾¹å°½é‡çŸ­ã€‚</p><p><strong>è§£é¢˜æ€è·¯ï¼š</strong><br>è¿™ä¸ªé—®é¢˜å¯ä»¥ç”¨äºŒåˆ†æ³•+BFSè§£å†³ï¼Œä½†æˆ‘ä»¬æœ‰æ›´å¥½çš„ç®—æ³•ã€‚å…ˆæ±‚å‡ºè¿™ä¸ªå›¾çš„æœ€å°ç”Ÿæˆæ ‘ï¼Œåˆ™èµ·ç‚¹å’Œç»ˆç‚¹åœ¨æ ‘ä¸Šçš„å”¯ä¸€è·¯å¾„å°±æ˜¯æˆ‘ä»¬è¦æ‰¾çš„è·¯å¾„ï¼Œè¿™æ¡è·¯å¾„ä¸Šçš„æœ€é•¿è¾¹å°±æ˜¯é—®é¢˜çš„ç­”æ¡ˆã€‚</p><h4 id="æ¯å¯¹ç»“ç‚¹é—´çš„æœ€å°ç“¶é¢ˆè·¯"><a href="#æ¯å¯¹ç»“ç‚¹é—´çš„æœ€å°ç“¶é¢ˆè·¯" class="headerlink" title="æ¯å¯¹ç»“ç‚¹é—´çš„æœ€å°ç“¶é¢ˆè·¯"></a>æ¯å¯¹ç»“ç‚¹é—´çš„æœ€å°ç“¶é¢ˆè·¯</h4><p><strong>é—®é¢˜æè¿°ï¼š</strong><br>ç»™å‡ºåŠ æƒæ— å‘å›¾ï¼Œæ±‚æ¯ä¸¤ä¸ªèŠ‚ç‚¹uå’Œvä¹‹é—´çš„æœ€å°ç“¶é¢ˆè·¯çš„æœ€å¤§è¾¹é•¿f(u,v)ã€‚</p><p><strong>è§£é¢˜æ€è·¯ï¼š</strong></p><blockquote><p>å…ˆæ±‚æœ€å°ç”Ÿæˆæ ‘ã€‚æ¥ä¸‹æ¥ï¼Œç”¨DFSæŠŠæœ€å°ç”Ÿæˆæ ‘å˜æˆæœ‰æ ¹æ ‘ï¼ŒåŒæ—¶è®¡ç®—f(u,v)ï¼Œå½“æ–°è®¿é—®ä¸€ä¸ªèŠ‚ç‚¹uæ—¶ï¼Œè€ƒè™‘æ‰€æœ‰å·²ç»è®¿é—®è¿‡çš„è€èŠ‚ç‚¹xï¼Œæ›´æ–°f(x,u) = max(f(x,v) , w(u,v))ï¼Œå…¶ä¸­væ˜¯uçš„çˆ¶èŠ‚ç‚¹ã€‚æ¯ä¸ªf(u,v)åªéœ€ç»è¿‡å¸¸æ•°æ—¶é—´è®¡ç®—ï¼Œå› æ­¤æ˜¯æ—¶é—´å¤æ‚åº¦ä¸ºO(n^2)ã€‚</p></blockquote><h4 id="æ¬¡å°ç”Ÿæˆæ ‘"><a href="#æ¬¡å°ç”Ÿæˆæ ‘" class="headerlink" title="æ¬¡å°ç”Ÿæˆæ ‘"></a>æ¬¡å°ç”Ÿæˆæ ‘</h4><p><strong>é—®é¢˜æè¿°ï¼š</strong><br>æŠŠæ‰€æœ‰ç”Ÿæˆæ ‘æŒ‰ç…§æƒå€¼ä¹‹å’Œä»å¤§åˆ°å°çš„é¡ºåºæ’åˆ—ï¼Œæ±‚æ’åœ¨ç¬¬äºŒä½çš„ç”Ÿæˆæ ‘ã€‚æ³¨æ„ï¼Œå¦‚æœæœ€å°ç”Ÿæˆæ ‘ä¸å”¯ä¸€ï¼Œæ¬¡å°ç”Ÿæˆæ ‘çš„æƒå€¼ä¸æœ€å°ç”Ÿæˆæ ‘ç›¸åŒã€‚</p><p><strong>è§£é¢˜æ€è·¯ï¼š</strong> </p><blockquote><p>æ¬¡å°ç”Ÿæˆæ ‘ä¸ä¼šä¸æœ€å°ç”Ÿæˆæ ‘å®Œå…¨ç›¸åŒï¼Œå› æ­¤å¯ä»¥æšä¸¾æœ€å°ç”Ÿæˆæ ‘ä¸­ä¸åœ¨æ¬¡å°ç”Ÿæˆæ ‘ä¸­å‡ºç°çš„è¾¹ã€‚æ³¨æ„æœ€å°ç”Ÿæˆæ ‘åªæœ‰n-1æ¡è¾¹ï¼Œæ‰€ä»¥åªéœ€æšä¸¾n-1æ¬¡ã€‚æ¯æ¬¡åœ¨å‰©ä¸‹çš„è¾¹é‡Œæ±‚ä¸€æ¬¡æœ€å°ç”Ÿæˆæ ‘ï¼Œåˆ™è¿™n-1æ£µâ€œç¼ºä¸€æ¡è¾¹çš„å›¾â€çš„æœ€å°ç”Ÿæˆæ ‘ä¸­æƒæœ€å°çš„å°±æ˜¯åŸå›¾çš„æ¬¡å°ç”Ÿæˆæ ‘ã€‚</p></blockquote><p>è¿˜æœ‰ä¸€ç§æ›´å¥½çš„æ–¹æ³•ï¼š</p><blockquote><p>æšä¸¾è¦åŠ å…¥å“ªæ¡æ–°è¾¹ã€‚åœ¨æœ€å°ç”Ÿæˆæ ‘ä¸ŠåŠ ä¸€æ¡è¾¹u-vä¹‹åï¼Œå›¾ä¸Šä¼šå‡ºç°ä¸€æ¡å›è·¯ï¼Œå› æ­¤åˆ é™¤çš„è¾¹å¿…é¡»åœ¨æœ€å°ç”Ÿæˆæ ‘ä¸Šuåˆ°vçš„è·¯å¾„ä¸Šï¼Œä¸”æ˜¯è¿™æ¡è·¯å¾„ä¸Šçš„æœ€é•¿è¾¹ã€‚å¯ä»¥è¯æ˜ï¼Œæ¬¡å°ç”Ÿæˆæ ‘ä¸€å®šå¯ä»¥ç”±æœ€å°ç”Ÿæˆæ ‘åŠ ä¸€æ¡è¾¹å†åˆ ä¸€æ¡è¾¹å¾—åˆ°ï¼ˆç§°ä¸ºè¾¹äº¤æ¢ï¼‰ï¼Œå› æ­¤åªéœ€æŒ‰ç…§â€œæ¯å¯¹èŠ‚ç‚¹ä¹‹é—´çš„æœ€å°ç“¶é¢ˆè·¯â€çš„æ–¹æ³•æ±‚å‡ºæ¯å¯¹èŠ‚ç‚¹uå’Œvåœ¨æœ€å°ç”Ÿæˆæ ‘ä¸­å”¯ä¸€è·¯å¾„çš„æœ€å¤§è¾¹æƒmaxcost[u][v]ï¼Œåˆ™å‰©ä¸‹çš„éƒ¨åˆ†åªéœ€è¦O(m)æ—¶é—´ï¼ˆæšä¸¾æ‰€æœ‰m-n+1æ¡è¾¹è¿›è¡Œäº¤æ¢ï¼Œæ¯æ¬¡èŠ±O(1)æ—¶é—´æ±‚å‡ºæ–°ç”Ÿæˆæ ‘çš„æƒå€¼ï¼‰ã€‚æ€»æ—¶é—´å¤æ‚åº¦ä¸ºO(n^2)ã€‚</p></blockquote><h4 id="æœ€å°æœ‰å‘ç”Ÿæˆæ ‘"><a href="#æœ€å°æœ‰å‘ç”Ÿæˆæ ‘" class="headerlink" title="æœ€å°æœ‰å‘ç”Ÿæˆæ ‘"></a>æœ€å°æœ‰å‘ç”Ÿæˆæ ‘</h4><p><strong>é—®é¢˜æè¿°ï¼š</strong><br>ç»™å®šä¸€ä¸ªæœ‰å‘å¸¦æƒå›¾Gå’Œå…¶ä¸­ä¸€ä¸ªèŠ‚ç‚¹uï¼Œæ‰¾å‡ºä¸€ä¸ªä»¥uä¸ºæ ¹èŠ‚ç‚¹ï¼Œæƒå’Œæœ€å°çš„æœ‰å‘ç”Ÿæˆæ ‘ã€‚æœ‰å‘ç”Ÿæˆæ ‘ï¼ˆdirected spanning treeï¼‰ä¹Ÿå«æ ‘å½¢å›¾ï¼ˆarborescenceï¼‰ï¼Œæ˜¯æŒ‡ä¸€ä¸ªç±»ä¼¼æ ‘çš„æœ‰å‘å›¾ï¼Œæ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼š</p><ul><li>æ°å¥½æœ‰ä¸€ä¸ªå…¥åº¦ä¸º0çš„ç‚¹ï¼Œç§°ä¸ºæ ¹èŠ‚ç‚¹</li><li>å…¶å®ƒèŠ‚ç‚¹çš„å…¥åº¦å‡ä¸º1</li><li>å¯ä»¥ä»æ ¹èŠ‚ç‚¹åˆ°è¾¾å…¶å®ƒæ‰€æœ‰èŠ‚ç‚¹</li></ul><p>ä¸éš¾å‘ç°ï¼Œå¦‚æœæ ‘å½¢å›¾çš„èŠ‚ç‚¹æ•°ä¸ºnï¼Œå®ƒçš„è¾¹æ•°ä¸€å®šä¸ºn-1ï¼Œä¸”æ ‘å½¢å›¾ä¸­ä¸å­˜åœ¨æœ‰å‘ç¯ã€‚</p><p><strong>è§£é¢˜æ€è·¯ï¼š</strong><br>å›ºå®šæ ¹çš„æœ€å°æ ‘å½¢å›¾å¯ä»¥ç”¨æœ±-åˆ˜ç®—æ³•è§£å†³ã€‚</p><blockquote><p>é¦–å…ˆæ˜¯é¢„å¤„ç†ï¼Œåˆ é™¤è‡ªç¯å¹¶åˆ¤æ–­æ ¹èŠ‚ç‚¹æ˜¯å¦å¯ä»¥åˆ°è¾¾å…¶å®ƒæ‰€æœ‰èŠ‚ç‚¹ã€‚å¦‚æœä¸æ˜¯ï¼Œè¾“å‡ºæ— è§£å¹¶ç»ˆæ­¢ç¨‹åºã€‚<br>æ¥ä¸‹æ¥æ˜¯ç®—æ³•çš„ä¸»è¿‡ç¨‹ï¼š<br>é¦–å…ˆï¼Œç»™æ‰€æœ‰éæ ¹èŠ‚ç‚¹é€‰æ‹©ä¸€æ¡æƒæœ€å°çš„å…¥è¾¹ã€‚å¦‚æœé€‰å‡ºæ¥çš„n-1æ¡è¾¹ä¸æ„æˆåœˆï¼Œåˆ™å¯ä»¥è¯æ˜è¿™äº›è¾¹å°±å½¢æˆäº†ä¸€ä¸ªæœ€å°æ ‘å½¢å›¾ï¼Œå¦åˆ™æŠŠæ¯ä¸ªåœˆå„æ”¶ç¼©æˆä¸€ä¸ªç‚¹ï¼Œç»§ç»­ä¸Šè¿°è¿‡ç¨‹ã€‚<br>ç¼©åœˆä¹‹åï¼Œåœˆä¸Šæ‰€æœ‰è¾¹éƒ½æ¶ˆå¤±äº†ï¼Œå› æ­¤åœ¨æœ€ç»ˆç­”æ¡ˆé‡Œéœ€è¦åŠ ä¸Šè¿™äº›è¾¹æƒä¹‹å’Œã€‚ä½†è¿™æ ·åšæœ‰ä¸ªé—®é¢˜ï¼šå‡è®¾åœ¨ç®—æ³•çš„æŸæ¬¡è¿­ä»£ä¸­ï¼ŒæŠŠåœˆCæ”¶ç¼©ä¸ºäººå·¥èŠ‚ç‚¹vï¼Œåˆ™åœ¨ä¸‹ä¸€æ¬¡è¿­ä»£ä¸­ï¼Œç»™vé€‰æ‹©çš„å…¥å¼§å°†ä¸åœ¨åœˆCä¸­çš„å…¥å¼§å‘ç”Ÿå†²çªã€‚ï¼ˆå‡è®¾Xåœ¨åœˆä¸­å·²ç»æœ‰äº†å…¥å¼§Y-&gt;Xï¼‰å› æ­¤å¦‚æœæ”¶ç¼©ä¹‹ååˆé€‰äº†ä¸€ä¸ªå…¥å¼§Z-&gt;Xï¼Œå¿…é¡»æŠŠå¼§Y-&gt;Xä»æœ€å°æ ‘å½¢å›¾ä¸­åˆ é™¤ã€‚è¿™ç­‰ä»·äºæŠŠå¼§Z-&gt;Xçš„æƒå€¼å‡å°‘äº†Y-&gt;Xçš„æƒå€¼ã€‚</p></blockquote><h5 id="å‚è€ƒä¹¦ç›®"><a href="#å‚è€ƒä¹¦ç›®" class="headerlink" title="å‚è€ƒä¹¦ç›®"></a>å‚è€ƒä¹¦ç›®</h5><ul><li>åˆ˜æ±ä½³ï¼Œç®—æ³•ç«èµ›å…¥é—¨ç»å…¸è®­ç»ƒæŒ‡å—ï¼ŒåŒ—äº¬ï¼šæ¸…åå¤§å­¦å‡ºç‰ˆç¤¾ï¼Œ2012ï¼Œ343-344</li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;strong&gt;æ‘˜è¦ï¼š&lt;/strong&gt;&lt;br&gt;åœ¨å¯¹æœ€å°ç”Ÿæˆæ ‘ç®—æ³•æœ‰ä¸€å®šç†è§£åï¼Œæˆ‘ä»¬å¯¹å…¸å‹çš„æœ€å°ç”Ÿæˆæ ‘é¢˜å‹åº”è¯¥ä¸éš¾è§£å†³ï¼Œä½†æ˜¯å¯¹äºç”±æœ€å°ç”Ÿæˆæ ‘æ¨¡å‹å˜å½¢è€Œæ¥çš„å‡ ç§æ¨¡å‹ï¼Œæˆ‘ä»¬ä»éœ€åšä¸€æ¬¡æ€»ç»“ä¸è®°å½•ã€‚&lt;br&gt;é¦–å…ˆæˆ‘ä»¬éœ€è¦æå‡ºæœ€å°ç”Ÿæˆæ ‘å‡ ä¸ªæ€§è´¨ï¼Œä¾¿äºæ¨å¯¼ç®—æ³•ï¼›ç„¶åæˆ‘ä»¬å°†ä»‹ç»6ç§æœ€å°ç”Ÿæˆ
      
    
    </summary>
    
      <category term="ACMå­¦ä¹ ç¬”è®°" scheme="http://valenshi.top/categories/ACM%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
    
      <category term="æ•°æ®ç»“æ„ä¸ç®—æ³•" scheme="http://valenshi.top/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/"/>
    
  </entry>
  
  <entry>
    <title>çº¿æ®µæ ‘é¢˜é›†</title>
    <link href="http://valenshi.top/2019/10/07/segmentTree-problems/"/>
    <id>http://valenshi.top/2019/10/07/segmentTree-problems/</id>
    <published>2019-10-07T09:47:28.000Z</published>
    <updated>2019-10-07T09:51:23.835Z</updated>
    
    <content type="html"><![CDATA[<h4 id="åŒºé—´å’Œ"><a href="#åŒºé—´å’Œ" class="headerlink" title="åŒºé—´å’Œ"></a>åŒºé—´å’Œ</h4><p><strong>é¢˜æ„ç®€è¿°</strong><br>ç»™å®šä¸€æ•°åˆ—ï¼Œè§„å®šæœ‰ä¸¤ç§æ“ä½œï¼Œä¸€æ˜¯ä¿®æ”¹æŸä¸ªå…ƒç´ ï¼ŒäºŒæ˜¯æ±‚åŒºé—´çš„è¿ç»­å’Œã€‚<br><strong>è§£é¢˜æ€è·¯</strong><br>çº¿æ®µæ ‘å•ç‚¹ä¿®æ”¹ï¼ŒåŒºé—´æŸ¥è¯¢çš„æ¨¡æ¿ã€‚</p><p><strong>ä»£ç ç¤ºä¾‹</strong><br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1e5</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">SegmentTree</span>&#123;</span></span><br><span class="line"><span class="keyword">int</span> l,r;</span><br><span class="line">ll dat;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> l(x) t[x].l</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> r(x) t[x].r</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> dat(x) t[x].dat</span></span><br><span class="line">&#125;t[N*<span class="number">4</span>];</span><br><span class="line"><span class="keyword">int</span> n,m;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">BuildTree</span><span class="params">(<span class="keyword">int</span> rt,<span class="keyword">int</span> l,<span class="keyword">int</span> r)</span></span>&#123;</span><br><span class="line"><span class="comment">/*ä¸ºåŒºé—´[l,r]å»ºç«‹ä»¥rtä¸ºæ ¹èŠ‚ç‚¹çš„å­æ ‘*/</span></span><br><span class="line">l(rt) = l, r(rt) = r,dat(rt) = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">if</span>(l &gt;= r) <span class="keyword">return</span>;</span><br><span class="line"><span class="keyword">int</span> mid = l+r&gt;&gt;<span class="number">1</span>;</span><br><span class="line">BuildTree(rt*<span class="number">2</span>,l,mid);</span><br><span class="line">BuildTree(rt*<span class="number">2</span>+<span class="number">1</span>,mid+<span class="number">1</span>,r);</span><br><span class="line">&#125; </span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Add</span><span class="params">(<span class="keyword">int</span> rt,<span class="keyword">int</span> p,<span class="keyword">int</span> val)</span></span>&#123;</span><br><span class="line"><span class="keyword">if</span>(l(rt) == r(rt))&#123;</span><br><span class="line">dat(rt) += val; <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> mid = l(rt) + r(rt) &gt;&gt; <span class="number">1</span>;</span><br><span class="line"><span class="keyword">if</span>(p &lt;= mid) Add(rt*<span class="number">2</span>,p,val);</span><br><span class="line"><span class="keyword">else</span> Add(rt*<span class="number">2</span>+<span class="number">1</span>,p,val);</span><br><span class="line">dat(rt) = dat(rt*<span class="number">2</span>) + dat(rt*<span class="number">2</span>+<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">ll <span class="title">ask</span><span class="params">(<span class="keyword">int</span> rt,<span class="keyword">int</span> l,<span class="keyword">int</span> r)</span></span>&#123;</span><br><span class="line"><span class="keyword">if</span>(l(rt) == l &amp;&amp; r(rt) == r) <span class="keyword">return</span> dat(rt);</span><br><span class="line"><span class="keyword">int</span> mid = l(rt) + r(rt)&gt;&gt;<span class="number">1</span>;</span><br><span class="line"><span class="keyword">if</span>(l &gt; mid) <span class="keyword">return</span> ask(rt*<span class="number">2</span>+<span class="number">1</span>,l,r);</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span>(r &lt;= mid) <span class="keyword">return</span> ask(rt*<span class="number">2</span>,l,r);</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line"><span class="keyword">return</span> ask(rt*<span class="number">2</span>,l,mid)+ask(rt*<span class="number">2</span>+<span class="number">1</span>,mid+<span class="number">1</span>,r);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="comment">//freopen("123.txt","r",stdin);</span></span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;n,&amp;m);</span><br><span class="line">BuildTree(<span class="number">1</span>,<span class="number">1</span>,n);</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>,k,a,b;i &lt;= m;i++)&#123;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d%d%d"</span>,&amp;k,&amp;a,&amp;b);</span><br><span class="line"><span class="keyword">if</span>(k) <span class="built_in">printf</span>(<span class="string">"%lld\n"</span>,ask(<span class="number">1</span>,a,b));</span><br><span class="line"><span class="keyword">else</span> Add(<span class="number">1</span>,a,b);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h4 id="A-Simple-Problem-with-Integers"><a href="#A-Simple-Problem-with-Integers" class="headerlink" title="A Simple Problem with Integers"></a>A Simple Problem with Integers</h4><p><strong>é¢˜æ„ç®€è¿°</strong><br>è¿™æ˜¯ä¸€é“æ¨¡æ¿é¢˜ã€‚</p><p>ç»™å®šæ•°åˆ— a[1],a[2],â€¦,a[n]ï¼Œä½ éœ€è¦ä¾æ¬¡è¿›è¡Œ q ä¸ªæ“ä½œï¼Œæ“ä½œæœ‰ä¸¤ç±»ï¼š</p><p>C l r xï¼šç»™å®š l,r,xï¼Œå¯¹äºæ‰€æœ‰ iâˆˆ[l,r]ï¼Œå°† a[i] åŠ ä¸Š xï¼ˆæ¢è¨€ä¹‹ï¼Œå°† a[l],a[l+1],â€¦,a[r] åˆ†åˆ«åŠ ä¸Š xï¼‰ï¼›</p><p>Q l rï¼šç»™å®š l,rï¼Œæ±‚ âˆ‘ri=la[i] çš„å€¼ï¼ˆæ¢è¨€ä¹‹ï¼Œæ±‚ a[l]+a[l+1]+â‹¯+a[r] çš„å€¼ï¼‰ã€‚<br><strong>è§£é¢˜æ€è·¯</strong><br>è¿™é¢˜ä¹Ÿæ˜¯POJ3468ã€‚å¯ä»¥ç”¨å¾ˆå¤šç§æ–¹æ³•è§£å†³ï¼Œæ˜¯ä¸ªç»ƒæ‰‹çš„æ¨¡æ¿é¢˜ã€‚çº¿æ®µæ ‘åŒºé—´ä¿®æ”¹+åŒºé—´æŸ¥è¯¢ï¼Œå»¶è¿Ÿæ ‡è®°çš„ç®€å•ä½¿ç”¨ã€‚</p><p><strong>ä»£ç ç¤ºä¾‹</strong><br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1e6</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">SegmentTree</span>&#123;</span></span><br><span class="line"><span class="keyword">int</span> l,r;</span><br><span class="line">ll sum,add;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> l(x) t[x].l</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> r(x) t[x].r</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> sum(x) t[x].sum</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> add(x) t[x].add</span></span><br><span class="line">&#125;t[N*<span class="number">4</span>];</span><br><span class="line"><span class="keyword">int</span> n,m,a[N];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">BuildTree</span><span class="params">(<span class="keyword">int</span> rt,<span class="keyword">int</span> l,<span class="keyword">int</span> r)</span></span>&#123;</span><br><span class="line">l(rt) = l, r(rt) = r;</span><br><span class="line"><span class="keyword">if</span>(l == r)&#123;</span><br><span class="line">sum(rt) = a[l]; <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> mid = l+r&gt;&gt;<span class="number">1</span>;</span><br><span class="line">BuildTree(rt*<span class="number">2</span>,l,mid); BuildTree(rt*<span class="number">2</span>+<span class="number">1</span>,mid+<span class="number">1</span>,r);</span><br><span class="line">sum(rt) = sum(rt*<span class="number">2</span>) + sum(rt*<span class="number">2</span>+<span class="number">1</span>);</span><br><span class="line">&#125; </span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">spread</span><span class="params">(<span class="keyword">int</span> p)</span></span>&#123;</span><br><span class="line"><span class="comment">/*å°†å»¶è¿Ÿæ ‡è®°å‘ä¸‹ä¼ ä¸€å±‚*/</span></span><br><span class="line"><span class="keyword">if</span>(!add(p)) <span class="keyword">return</span>;</span><br><span class="line">sum(p*<span class="number">2</span>) += (r(p*<span class="number">2</span>)-l(p*<span class="number">2</span>)+<span class="number">1</span>)*add(p);</span><br><span class="line">sum(p*<span class="number">2</span>+<span class="number">1</span>) += (r(p*<span class="number">2</span>+<span class="number">1</span>)-l(p*<span class="number">2</span>+<span class="number">1</span>)+<span class="number">1</span>)*add(p);</span><br><span class="line">add(p*<span class="number">2</span>) += add(p); add(p*<span class="number">2</span>+<span class="number">1</span>) += add(p);</span><br><span class="line">add(p) = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">change</span><span class="params">(<span class="keyword">int</span> rt,<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> val)</span></span>&#123;</span><br><span class="line"><span class="comment">/*[l,r]å†…æ‰€æœ‰ä½ç½®ä¸Šå…ƒç´ éƒ½+val*/</span> </span><br><span class="line"><span class="keyword">if</span>(l &lt;= l(rt) &amp;&amp; r(rt) &lt;= r)&#123;</span><br><span class="line">sum(rt) += (r(rt)-l(rt)+<span class="number">1</span>)*val;</span><br><span class="line">add(rt) += val; <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line">spread(rt);</span><br><span class="line"><span class="keyword">int</span> mid = l(rt)+r(rt)&gt;&gt;<span class="number">1</span>;</span><br><span class="line"><span class="keyword">if</span>(l &lt;= mid) change(rt*<span class="number">2</span>,l,r,val);</span><br><span class="line"><span class="keyword">if</span>(r &gt; mid) change(rt*<span class="number">2</span>+<span class="number">1</span>,l,r,val);</span><br><span class="line">sum(rt) = sum(rt*<span class="number">2</span>) + sum(rt*<span class="number">2</span>+<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">ll <span class="title">ask</span><span class="params">(<span class="keyword">int</span> rt,<span class="keyword">int</span> l,<span class="keyword">int</span> r)</span></span>&#123;</span><br><span class="line"><span class="comment">/*å›ç­”[l,r]åŒºé—´å’Œ*/</span> </span><br><span class="line"><span class="keyword">if</span>(l &lt;= l(rt) &amp;&amp; r(rt) &lt;= r) <span class="keyword">return</span> sum(rt);</span><br><span class="line">spread(rt); ll res = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">int</span> mid = l(rt)+r(rt)&gt;&gt;<span class="number">1</span>;</span><br><span class="line"><span class="keyword">if</span>(l &lt;= mid) res += ask(rt*<span class="number">2</span>,l,r);</span><br><span class="line"><span class="keyword">if</span>(r &gt; mid) res += ask(rt*<span class="number">2</span>+<span class="number">1</span>,l,r);</span><br><span class="line"><span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">getInt</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">int</span> ans = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">bool</span> neg = <span class="literal">false</span>;</span><br><span class="line"><span class="keyword">char</span> c = getchar();</span><br><span class="line"><span class="keyword">while</span>(c != <span class="string">'-'</span> &amp;&amp; (c &lt; <span class="string">'0'</span> || c &gt; <span class="string">'9'</span>)) c = getchar();</span><br><span class="line"><span class="keyword">if</span>(c == <span class="string">'-'</span>) neg = <span class="literal">true</span>, c = getchar();</span><br><span class="line"><span class="keyword">while</span>(c &gt;= <span class="string">'0'</span> &amp;&amp; c &lt;= <span class="string">'9'</span>) ans = ans*<span class="number">10</span>+c-<span class="string">'0'</span>, c = getchar();</span><br><span class="line"><span class="keyword">return</span> neg?-ans:ans;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="comment">//freopen("123.txt","r",stdin);</span></span><br><span class="line">n = getInt(); m = getInt();</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++) a[i] = getInt();</span><br><span class="line">BuildTree(<span class="number">1</span>,<span class="number">1</span>,n);</span><br><span class="line"><span class="keyword">char</span> op[<span class="number">4</span>];</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>,l,r,x;i &lt;= m;i++)&#123;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%s"</span>,op);</span><br><span class="line"><span class="keyword">if</span>(op[<span class="number">0</span>] == <span class="string">'C'</span>)&#123;</span><br><span class="line">l = getInt(); r = getInt(); x = getInt();</span><br><span class="line">change(<span class="number">1</span>,l,r,x);</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">l = getInt(); r = getInt();</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%lld\n"</span>,ask(<span class="number">1</span>,l,r));</span><br><span class="line">&#125;</span><br><span class="line">&#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h4 id="æœ€å¤§æ•°"><a href="#æœ€å¤§æ•°" class="headerlink" title="æœ€å¤§æ•°"></a>æœ€å¤§æ•°</h4><p><strong>é¢˜æ„ç®€è¿°</strong><br>åŸé¢˜æ¥è‡ªï¼šJSOI 2008</p><p>ç»™å®šä¸€ä¸ªæ­£æ•´æ•°æ•°åˆ— a1,a2,a3,â‹¯,an ï¼Œæ¯ä¸€ä¸ªæ•°éƒ½åœ¨ 0âˆ¼pâ€“1 ä¹‹é—´ã€‚å¯ä»¥å¯¹è¿™åˆ—æ•°è¿›è¡Œä¸¤ç§æ“ä½œï¼š</p><p>æ·»åŠ æ“ä½œï¼šå‘åºåˆ—åæ·»åŠ ä¸€ä¸ªæ•°ï¼Œåºåˆ—é•¿åº¦å˜æˆ n+1ï¼›</p><p>è¯¢é—®æ“ä½œï¼šè¯¢é—®è¿™ä¸ªåºåˆ—ä¸­æœ€å L ä¸ªæ•°ä¸­æœ€å¤§çš„æ•°æ˜¯å¤šå°‘ã€‚</p><p>ç¨‹åºè¿è¡Œçš„æœ€å¼€å§‹ï¼Œæ•´æ•°åºåˆ—ä¸ºç©ºã€‚å†™ä¸€ä¸ªç¨‹åºï¼Œè¯»å…¥æ“ä½œçš„åºåˆ—ï¼Œå¹¶è¾“å‡ºè¯¢é—®æ“ä½œçš„ç­”æ¡ˆã€‚<br><strong>è§£é¢˜æ€è·¯</strong><br>å› ä¸ºæœ€å¤šæœ‰Nä¸ªæ•°ï¼Œé‚£ä¹ˆå…ˆæ ¹æ®[1 , N]å»ºç«‹çº¿æ®µæ ‘ï¼Œæå‰æŠŠä½ç½®ç©ºå‡ºæ¥å°±å¥½äº†ï¼ŒnowæŒ‡é’ˆè®°å½•æœ€åä¸€ä¸ªä½ç½®ï¼Œæ¯æ¬¡æŠŠæ–°åŠ å…¥çš„å…ƒç´ æ’å…¥++nowï¼Œè€Œè¯¢é—®æœ€åLä¸ªæ•°çš„æœ€å¤§å€¼ï¼Œåˆ™ç”¨ask(now - L , now)æ¥æŸ¥è¯¢å³å¯ï¼Œå…¶å®ƒçš„å°±æ˜¯çº¿æ®µæ ‘ä¸Šç»´æŠ¤åŒºé—´æœ€å¤§å€¼ã€‚</p><p><strong>ä»£ç ç¤ºä¾‹</strong><br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">2e5</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">SegmentTree</span>&#123;</span></span><br><span class="line"><span class="keyword">int</span> l,r;</span><br><span class="line">ll mx;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> l(x) t[x].l</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> r(x) t[x].r</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> mx(x) t[x].mx</span></span><br><span class="line">&#125;t[N*<span class="number">4</span>];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">BuildTree</span><span class="params">(<span class="keyword">int</span> rt,<span class="keyword">int</span> l,<span class="keyword">int</span> r)</span></span>&#123;</span><br><span class="line">l(rt) = l, r(rt) = r, mx(rt) = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">if</span>(l == r) <span class="keyword">return</span>;</span><br><span class="line"><span class="keyword">int</span> mid = l+r&gt;&gt;<span class="number">1</span>;</span><br><span class="line">BuildTree(rt*<span class="number">2</span>,l,mid); BuildTree(rt*<span class="number">2</span>+<span class="number">1</span>,mid+<span class="number">1</span>,r);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">change</span><span class="params">(<span class="keyword">int</span> rt,<span class="keyword">int</span> p,<span class="keyword">int</span> val)</span></span>&#123;</span><br><span class="line"><span class="keyword">if</span>(l(rt) == r(rt))&#123;</span><br><span class="line">mx(rt) = val; <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> mid = l(rt)+r(rt)&gt;&gt;<span class="number">1</span>;</span><br><span class="line"><span class="keyword">if</span>(p &gt; mid) change(rt*<span class="number">2</span>+<span class="number">1</span>,p,val);</span><br><span class="line"><span class="keyword">else</span> change(rt*<span class="number">2</span>,p,val);</span><br><span class="line">mx(rt) = max(mx(rt*<span class="number">2</span>),mx(rt*<span class="number">2</span>+<span class="number">1</span>));</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">ask</span><span class="params">(<span class="keyword">int</span> rt,<span class="keyword">int</span> l,<span class="keyword">int</span> r)</span></span>&#123;</span><br><span class="line"><span class="keyword">if</span>(l &lt;= l(rt) &amp;&amp; r(rt) &lt;= r) <span class="keyword">return</span> mx(rt);</span><br><span class="line"><span class="keyword">int</span> mid = l(rt) + r(rt)&gt;&gt;<span class="number">1</span> , res = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">if</span>(l &lt;= mid) res = ask(rt*<span class="number">2</span>,l,r);</span><br><span class="line"><span class="keyword">if</span>(r &gt; mid) res = max(res,ask(rt*<span class="number">2</span>+<span class="number">1</span>,l,r));</span><br><span class="line"><span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> m,p,ans,now;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="comment">//freopen("123.txt","r",stdin);</span></span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;m,&amp;p);</span><br><span class="line">BuildTree(<span class="number">1</span>,<span class="number">1</span>,N<span class="number">-1</span>);</span><br><span class="line"><span class="keyword">char</span> op[<span class="number">4</span>];</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>,x;i &lt;= m;i++)&#123;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%s%d"</span>,op,&amp;x);</span><br><span class="line"><span class="keyword">if</span>(op[<span class="number">0</span>] == <span class="string">'A'</span>) change(<span class="number">1</span>,++now,(x*<span class="number">1l</span>l+ans)%p);</span><br><span class="line"><span class="keyword">else</span> <span class="built_in">printf</span>(<span class="string">"%lld\n"</span>,ans = ask(<span class="number">1</span>,now-x+<span class="number">1</span>,now));</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h4 id="èŠ±ç¥æ¸¸å†å„å›½"><a href="#èŠ±ç¥æ¸¸å†å„å›½" class="headerlink" title="èŠ±ç¥æ¸¸å†å„å›½*"></a>èŠ±ç¥æ¸¸å†å„å›½*</h4><p><strong>é¢˜æ„ç®€è¿°</strong><br>åŸé¢˜æ¥è‡ªï¼šBZOJ 3211</p><p>èŠ±ç¥å–œæ¬¢æ­¥è¡Œæ¸¸å†å„å›½ï¼Œé¡ºä¾¿è™çˆ†å„åœ°ç«èµ›ã€‚èŠ±ç¥æœ‰ä¸€æ¡æ¸¸è§ˆè·¯çº¿ï¼Œå®ƒæ˜¯çº¿å‹çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ‰€æœ‰æ¸¸å†å›½å®¶å‘ˆä¸€æ¡çº¿çš„å½¢çŠ¶æ’åˆ—ï¼ŒèŠ±ç¥å¯¹æ¯ä¸ªå›½å®¶éƒ½æœ‰ä¸€ä¸ªå–œæ¬¢ç¨‹åº¦ï¼ˆå½“ç„¶èŠ±ç¥å¹¶ä¸ä¸€å®šå–œæ¬¢æ‰€æœ‰å›½å®¶ï¼‰ã€‚</p><p>æ¯ä¸€æ¬¡æ—…è¡Œä¸­ï¼ŒèŠ±ç¥ä¼šé€‰æ‹©ä¸€æ¡æ—…æ¸¸è·¯çº¿ï¼Œå®ƒåœ¨é‚£ä¸€ä¸²å›½å®¶ä¸­æ˜¯è¿ç»­çš„ä¸€æ®µï¼Œè¿™æ¬¡æ—…è¡Œå¸¦æ¥çš„å¼€å¿ƒå€¼æ˜¯è¿™äº›å›½å®¶çš„å–œæ¬¢åº¦çš„æ€»å’Œï¼Œå½“ç„¶èŠ±ç¥å¯¹è¿™äº›å›½å®¶çš„å–œæ¬¢ç¨‹åºå¹¶ä¸æ˜¯æ’å®šçš„ï¼Œæœ‰æ—¶ä¼šçªç„¶å¯¹æŸäº›å›½å®¶äº§ç”Ÿåæ„Ÿï¼Œä½¿ä»–å¯¹è¿™äº›å›½å®¶çš„å–œæ¬¢åº¦ Î´ å˜ä¸º $\sqrtÎ´$ï¼ˆå¯èƒ½æ˜¯èŠ±ç¥è™çˆ†äº†é‚£äº›å›½å®¶çš„ OIï¼Œä»è€Œæ„Ÿåˆ°ä¹å‘³ï¼‰ã€‚</p><p>ç°åœ¨ç»™å‡ºèŠ±ç¥æ¯æ¬¡çš„æ—…è¡Œè·¯çº¿ï¼Œä»¥åŠå¼€å¿ƒåº¦çš„å˜åŒ–ï¼Œè¯·æ±‚å‡ºèŠ±ç¥æ¯æ¬¡æ—…è¡Œçš„å¼€å¿ƒå€¼ã€‚</p><p><strong>è§£é¢˜æ€è·¯</strong><br>æˆ‘åˆšå¼€å§‹æƒ³çš„æ˜¯å¦‚ä½•æŠŠä¿®æ”¹å»¶è¿Ÿï¼Œä½†æ˜¯åæ¥å‘ç°ä¸å¤ªå®¹æ˜“å®ç°ã€‚å¾ˆå®¹æ˜“çš„å‘ç°çš„å°±æ˜¯1e9å¼€æ ¹10æ¬¡åå°±æ˜¯1äº†ï¼ˆå½“ç„¶è¿˜æœ‰ä¸‹å–æ•´ï¼‰ï¼Œæ‰€ä»¥é¢˜ç›®èŒƒå›´å†…æ‰€æœ‰æ•°æœ€å¤šå¼€æ ¹10æ¬¡å°±ä¼šå˜æˆ1æˆ–0ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬å¯ä»¥è®°å½•æ¯ä¸ªç‚¹è¢«ä¿®æ”¹äº†å¤šå°‘æ¬¡ï¼Œå¦‚æœå·²ç»ä¿®æ”¹äº†10æ¬¡ä»¥ä¸Šï¼Œé‚£ä¹ˆå†ä¿®æ”¹ä¹Ÿæ— æ„ä¹‰äº†ã€‚<br>äºæ˜¯æˆ‘ä»¬å¯ä»¥æ¯æ¬¡ä¿®æ”¹éƒ½ä¿®æ”¹åˆ°å¶å­èŠ‚ç‚¹ï¼ˆå› ä¸ºæ— æ³•å»¶è¿Ÿæˆ–æ•´æ®µä¿®æ”¹ï¼‰ï¼ŒåŒæ—¶è®°å½•æ¯ä¸ªèŠ‚ç‚¹è¢«ä¿®æ”¹äº†å¤šå°‘æ¬¡ï¼Œå¦‚æœä¸€æ®µåŒºé—´ä¿®æ”¹æ¬¡æ•°æœ€å°çš„èŠ‚ç‚¹éƒ½ä¿®æ”¹äº†10æ¬¡ï¼Œé‚£ä¹ˆè¿™ä¸€æ®µåŒºé—´å°±éƒ½ä¸ç”¨ä¿®æ”¹äº†ï¼›è¿™å°±ä¼šå¤§å¤§é™ä½æ—¶é—´å¤æ‚åº¦ï¼Œå› ä¸ºæ¯ä¸€ä¸ªèŠ‚ç‚¹æœ€å¤šè¢«ä¿®æ”¹10æ¬¡ï¼ŒO(10NlogN)ã€‚</p><p><strong>ä»£ç ç¤ºä¾‹</strong><br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1e5</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">SegmentTree</span>&#123;</span></span><br><span class="line"><span class="keyword">int</span> l,r,mi;</span><br><span class="line">ll sum;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> l(x) t[x].l</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> r(x) t[x].r</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> mi(x) t[x].mi</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> sum(x) t[x].sum</span></span><br><span class="line">&#125;t[N*<span class="number">4</span>];</span><br><span class="line"><span class="keyword">int</span> n,m,a[N];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">BuildTree</span><span class="params">(<span class="keyword">int</span> rt,<span class="keyword">int</span> l,<span class="keyword">int</span> r)</span></span>&#123;</span><br><span class="line">l(rt) = l,r(rt) = r,mi(rt) = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">if</span>(l == r)&#123;</span><br><span class="line">sum(rt) = a[l]; <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> mid = l+r&gt;&gt;<span class="number">1</span>;</span><br><span class="line">BuildTree(rt*<span class="number">2</span>,l,mid); BuildTree(rt*<span class="number">2</span>+<span class="number">1</span>,mid+<span class="number">1</span>,r);</span><br><span class="line">sum(rt) = sum(rt*<span class="number">2</span>) + sum(rt*<span class="number">2</span>+<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">change</span><span class="params">(<span class="keyword">int</span> rt,<span class="keyword">int</span> l,<span class="keyword">int</span> r)</span></span>&#123;</span><br><span class="line"><span class="keyword">if</span>(mi(rt) &gt; <span class="number">10</span>) <span class="keyword">return</span>;</span><br><span class="line"><span class="keyword">if</span>(l(rt) == r(rt))&#123;</span><br><span class="line">sum(rt) = a[l(rt)] = <span class="built_in">sqrt</span>(a[l(rt)]); </span><br><span class="line">mi(rt)++; <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> mid = l(rt) + r(rt) &gt;&gt; <span class="number">1</span>;</span><br><span class="line"><span class="keyword">if</span>(l &lt;= mid) change(rt*<span class="number">2</span>,l,r);</span><br><span class="line"><span class="keyword">if</span>(r &gt; mid) change(rt*<span class="number">2</span>+<span class="number">1</span>,l,r);</span><br><span class="line">sum(rt) = sum(rt*<span class="number">2</span>) + sum(rt*<span class="number">2</span>+<span class="number">1</span>);</span><br><span class="line">mi(rt) = min(mi(rt*<span class="number">2</span>),mi(rt*<span class="number">2</span>+<span class="number">1</span>));</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">ll <span class="title">ask</span><span class="params">(<span class="keyword">int</span> rt,<span class="keyword">int</span> l,<span class="keyword">int</span> r)</span></span>&#123;</span><br><span class="line"><span class="keyword">if</span>(l &lt;= l(rt) &amp;&amp; r(rt) &lt;= r) <span class="keyword">return</span> sum(rt);</span><br><span class="line"><span class="keyword">int</span> mid = l(rt)+r(rt)&gt;&gt;<span class="number">1</span>; ll res = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">if</span>(l &lt;= mid) res += ask(rt*<span class="number">2</span>,l,r);</span><br><span class="line"><span class="keyword">if</span>(r &gt; mid) res += ask(rt*<span class="number">2</span>+<span class="number">1</span>,l,r);</span><br><span class="line"><span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="comment">//freopen("123.txt","r",stdin);</span></span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;n);</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++) <span class="built_in">scanf</span>(<span class="string">"%d"</span>,a+i);</span><br><span class="line">BuildTree(<span class="number">1</span>,<span class="number">1</span>,n);</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;m);</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>,op,l,r;i &lt;= m;i++)&#123;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d%d%d"</span>,&amp;op,&amp;l,&amp;r);</span><br><span class="line"><span class="keyword">if</span>(op == <span class="number">1</span>) <span class="built_in">printf</span>(<span class="string">"%lld\n"</span>,ask(<span class="number">1</span>,l,r));</span><br><span class="line"><span class="keyword">else</span> change(<span class="number">1</span>,l,r);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h4 id="ç»´æŠ¤åºåˆ—"><a href="#ç»´æŠ¤åºåˆ—" class="headerlink" title="ç»´æŠ¤åºåˆ—*"></a>ç»´æŠ¤åºåˆ—*</h4><p><strong>é¢˜æ„ç®€è¿°</strong><br>åŸé¢˜æ¥è‡ªï¼šAHOI 2009</p><p>è€å¸ˆäº¤ç»™å°å¯å¯ä¸€ä¸ªç»´æŠ¤æ•°åˆ—çš„ä»»åŠ¡ï¼Œç°åœ¨å°å¯å¯å¸Œæœ›ä½ æ¥å¸®ä»–å®Œæˆã€‚</p><p>æœ‰é•¿ä¸º n çš„æ•°åˆ—ï¼Œä¸å¦¨è®¾ä¸º a1,a2,â‹¯,an ã€‚æœ‰å¦‚ä¸‹ä¸‰ç§æ“ä½œå½¢å¼ï¼š</p><p>æŠŠæ•°åˆ—ä¸­çš„ä¸€æ®µæ•°å…¨éƒ¨ä¹˜ä¸€ä¸ªå€¼ï¼›</p><p>æŠŠæ•°åˆ—ä¸­çš„ä¸€æ®µæ•°å…¨éƒ¨åŠ ä¸€ä¸ªå€¼ï¼›</p><p>è¯¢é—®æ•°åˆ—ä¸­çš„ä¸€æ®µæ•°çš„å’Œï¼Œç”±äºç­”æ¡ˆå¯èƒ½å¾ˆå¤§ï¼Œä½ åªéœ€è¾“å‡ºè¿™ä¸ªæ•°æ¨¡ P çš„å€¼ã€‚</p><p><strong>è§£é¢˜æ€è·¯</strong><br>è¿™ä¸ªå¦‚æœä¿®æ”¹æ“ä½œåªæœ‰ 2 æˆ– 1ï¼Œé‚£ä¹ˆå°±æ˜¯ä¸€ä¸ªåŒºé—´ä¿®æ”¹-å»¶è¿Ÿæ ‡è®°çš„æ¨¡æ¿é¢˜ï¼Œä½†æ˜¯å®ƒæŠŠâ€œä¹˜â€å’Œâ€œåŠ â€æ“ä½œæ”¾åœ¨äº†ä¸€èµ·ï¼Œå½“ç„¶è¿˜æ˜¯éœ€è¦ç”¨å»¶è¿Ÿæ ‡è®°æ¥åšï¼Œaddè¡¨ç¤ºå¾…åŠ ä¸Šçš„å€¼ï¼Œmulè¡¨ç¤ºå¾…ä¹˜çš„å€¼ã€‚<br>æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯æˆ‘ä»¬åœ¨å‘ä¸‹ä¼ é€’å»¶è¿Ÿæ ‡è®°æ—¶ï¼Œæ˜¯å…ˆä¼ é€’åŠ æ³•å‘¢ï¼Œè¿˜æ˜¯ä¹˜æ³•å‘¢ï¼Ÿå…¶å®é—®é¢˜çš„æ ¹æºä¸åœ¨è¿™ï¼Œè€Œåœ¨äºæˆ‘ä»¬åœ¨åšä¹˜æ³•æ—¶ï¼Œå¯¹åŠ æ³•çš„å»¶è¿Ÿæ ‡è®°ä¹Ÿè¦ä¹˜ valï¼Œå³ add = add * valï¼Œå› ä¸ºæ»¡è¶³ç»“åˆå¾‹ã€‚æå®Œè¿™ç‚¹å‰©ä¸‹å°±æ˜¯å†™èµ·æ¥æ¯”è¾ƒéº»çƒ¦è€Œå·²ï¼Œæ²¡åˆ«çš„éš¾ç‚¹äº†</p><p><strong>ä»£ç ç¤ºä¾‹</strong><br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1e5</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">SegmentTree</span>&#123;</span></span><br><span class="line"><span class="keyword">int</span> l,r;</span><br><span class="line">ll add,mul,sum;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> l(x) t[x].l</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> r(x) t[x].r</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> mul(x) t[x].mul</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> add(x) t[x].add</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> sum(x) t[x].sum</span></span><br><span class="line">&#125;t[N*<span class="number">4</span>];</span><br><span class="line"><span class="keyword">int</span> n,m,P;</span><br><span class="line">ll a[N];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">BuildTree</span><span class="params">(<span class="keyword">int</span> rt,<span class="keyword">int</span> l,<span class="keyword">int</span> r)</span></span>&#123;</span><br><span class="line">l(rt) = l, r(rt) = r, add(rt) = <span class="number">0</span>, mul(rt) = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">if</span>(l == r)&#123;</span><br><span class="line">sum(rt) = a[l]; <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> mid = l+r&gt;&gt;<span class="number">1</span>;</span><br><span class="line">BuildTree(rt*<span class="number">2</span>,l,mid); BuildTree(rt*<span class="number">2</span>+<span class="number">1</span>,mid+<span class="number">1</span>,r);</span><br><span class="line">sum(rt) = sum(rt*<span class="number">2</span>) + sum(rt*<span class="number">2</span>+<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">spread_add</span><span class="params">(<span class="keyword">int</span> p)</span></span>&#123;</span><br><span class="line"><span class="comment">/*å°†ç´¯åŠ æ ‡è®°å‘ä¸‹ä¼ ä¸€å±‚*/</span></span><br><span class="line"><span class="keyword">if</span>(!add(p)) <span class="keyword">return</span>;</span><br><span class="line">sum(p*<span class="number">2</span>) = (sum(p*<span class="number">2</span>) + (r(p*<span class="number">2</span>) - l(p*<span class="number">2</span>)+<span class="number">1</span>)*add(p)%P)%P;</span><br><span class="line">sum(p*<span class="number">2</span>+<span class="number">1</span>) = (sum(p*<span class="number">2</span>+<span class="number">1</span>) + (r(p*<span class="number">2</span>+<span class="number">1</span>) - l(p*<span class="number">2</span>+<span class="number">1</span>)+<span class="number">1</span>)*add(p)%P)%P;</span><br><span class="line">add(p*<span class="number">2</span>) = (add(p*<span class="number">2</span>) + add(p))%P; </span><br><span class="line">add(p*<span class="number">2</span>+<span class="number">1</span>) = (add(p*<span class="number">2</span>+<span class="number">1</span>)+add(p))%P; </span><br><span class="line">add(p) = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">spread_mul</span><span class="params">(<span class="keyword">int</span> p)</span></span>&#123;</span><br><span class="line"><span class="comment">/*å°†ç´¯ä¹˜æ ‡è®°å‘ä¸‹ä¼ ä¸€å±‚,ç´¯ä¹˜æ ‡è®°å¯¹ç´¯åŠ æ ‡è®°ä¹Ÿæœ‰å½±å“*/</span> </span><br><span class="line"><span class="keyword">if</span>(mul(p) == <span class="number">1</span>) <span class="keyword">return</span>;</span><br><span class="line">sum(p*<span class="number">2</span>) = sum(p*<span class="number">2</span>)*mul(p)%P;</span><br><span class="line">sum(p*<span class="number">2</span>+<span class="number">1</span>) = sum(p*<span class="number">2</span>+<span class="number">1</span>)*mul(p)%P;</span><br><span class="line">mul(p*<span class="number">2</span>) = mul(p*<span class="number">2</span>)*mul(p)%P;</span><br><span class="line">mul(p*<span class="number">2</span>+<span class="number">1</span>) = mul(p*<span class="number">2</span>+<span class="number">1</span>)*mul(p)%P;</span><br><span class="line"><span class="comment">/*æ›´æ–°addæ ‡è®°*/</span> </span><br><span class="line">add(p*<span class="number">2</span>) = add(p*<span class="number">2</span>)*mul(p)%P;</span><br><span class="line">add(p*<span class="number">2</span>+<span class="number">1</span>) = add(p*<span class="number">2</span>+<span class="number">1</span>)*mul(p)%P; </span><br><span class="line">mul(p) = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Mul</span><span class="params">(<span class="keyword">int</span> rt,<span class="keyword">int</span> l,<span class="keyword">int</span> r,ll val)</span></span>&#123;</span><br><span class="line"><span class="keyword">if</span>(l &lt;= l(rt) &amp;&amp; r(rt) &lt;= r)&#123;</span><br><span class="line">add(rt) = add(rt)*val%P;<span class="comment">//æ›´æ–°addæ ‡è®°ï¼ </span></span><br><span class="line">sum(rt) = sum(rt)*val%P;</span><br><span class="line">mul(rt) = mul(rt)*val%P;</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line">spread_mul(rt);spread_add(rt); </span><br><span class="line"><span class="keyword">int</span> mid = l(rt)+r(rt)&gt;&gt;<span class="number">1</span>;</span><br><span class="line"><span class="keyword">if</span>(l &lt;= mid) Mul(rt*<span class="number">2</span>,l,r,val);</span><br><span class="line"><span class="keyword">if</span>(r &gt; mid) Mul(rt*<span class="number">2</span>+<span class="number">1</span>,l,r,val);</span><br><span class="line">sum(rt) = (sum(rt*<span class="number">2</span>) + sum(rt*<span class="number">2</span>+<span class="number">1</span>))%P;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Add</span><span class="params">(<span class="keyword">int</span> rt,<span class="keyword">int</span> l,<span class="keyword">int</span> r,ll val)</span></span>&#123;</span><br><span class="line"><span class="keyword">if</span>(l &lt;= l(rt) &amp;&amp; r(rt) &lt;= r)&#123;</span><br><span class="line">sum(rt) = (sum(rt) + (r(rt)-l(rt)+<span class="number">1</span>)*val % P)%P;</span><br><span class="line">add(rt) = (add(rt)+val)%P; <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line">spread_mul(rt); spread_add(rt);</span><br><span class="line"><span class="keyword">int</span> mid = l(rt)+r(rt)&gt;&gt;<span class="number">1</span>;</span><br><span class="line"><span class="keyword">if</span>(l &lt;= mid) Add(rt*<span class="number">2</span>,l,r,val);</span><br><span class="line"><span class="keyword">if</span>(r &gt; mid) Add(rt*<span class="number">2</span>+<span class="number">1</span>,l,r,val);</span><br><span class="line">sum(rt) = (sum(rt*<span class="number">2</span>) + sum(rt*<span class="number">2</span>+<span class="number">1</span>))%P;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">ll <span class="title">ask</span><span class="params">(<span class="keyword">int</span> rt,<span class="keyword">int</span> l,<span class="keyword">int</span> r)</span></span>&#123;</span><br><span class="line"><span class="keyword">if</span>(l &lt;= l(rt) &amp;&amp; r(rt) &lt;= r) <span class="keyword">return</span> sum(rt)%P;</span><br><span class="line">spread_mul(rt); spread_add(rt) ;</span><br><span class="line">ll res = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">int</span> mid = l(rt)+r(rt)&gt;&gt;<span class="number">1</span>;</span><br><span class="line"><span class="keyword">if</span>(l &lt;= mid) res += ask(rt*<span class="number">2</span>,l,r);</span><br><span class="line"><span class="keyword">if</span>(r &gt; mid) res += ask(rt*<span class="number">2</span>+<span class="number">1</span>,l,r);</span><br><span class="line"><span class="keyword">return</span> res%P;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;n,&amp;P);</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++) <span class="built_in">scanf</span>(<span class="string">"%lld"</span>,a+i), a[i] %= P;</span><br><span class="line">BuildTree(<span class="number">1</span>,<span class="number">1</span>,n);</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;m);</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>,op,t,g,c;i &lt;= m;i++)&#123;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;op);</span><br><span class="line"><span class="keyword">if</span>(op == <span class="number">1</span>)&#123;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d%d%d"</span>,&amp;t,&amp;g,&amp;c);</span><br><span class="line">Mul(<span class="number">1</span>,t,g,c);</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(op == <span class="number">2</span>)&#123;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d%d%d"</span>,&amp;t,&amp;g,&amp;c);</span><br><span class="line">Add(<span class="number">1</span>,t,g,c);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;t,&amp;g);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%lld\n"</span>,ask(<span class="number">1</span>,t,g));</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h4 id=&quot;åŒºé—´å’Œ&quot;&gt;&lt;a href=&quot;#åŒºé—´å’Œ&quot; class=&quot;headerlink&quot; title=&quot;åŒºé—´å’Œ&quot;&gt;&lt;/a&gt;åŒºé—´å’Œ&lt;/h4&gt;&lt;p&gt;&lt;strong&gt;é¢˜æ„ç®€è¿°&lt;/strong&gt;&lt;br&gt;ç»™å®šä¸€æ•°åˆ—ï¼Œè§„å®šæœ‰ä¸¤ç§æ“ä½œï¼Œä¸€æ˜¯ä¿®æ”¹æŸä¸ªå…ƒç´ ï¼ŒäºŒæ˜¯æ±‚åŒºé—´çš„è¿ç»­å’Œã€‚&lt;br&gt;&lt;str
      
    
    </summary>
    
      <category term="ACMé¢˜è§£" scheme="http://valenshi.top/categories/ACM%E9%A2%98%E8%A7%A3/"/>
    
    
      <category term="çº¿æ®µæ ‘" scheme="http://valenshi.top/tags/%E7%BA%BF%E6%AE%B5%E6%A0%91/"/>
    
  </entry>
  
  <entry>
    <title>ä¸€ç»´RMQé—®é¢˜é¢˜é›†</title>
    <link href="http://valenshi.top/2019/10/07/st-problems/"/>
    <id>http://valenshi.top/2019/10/07/st-problems/</id>
    <published>2019-10-07T05:10:12.000Z</published>
    <updated>2019-10-07T05:13:59.758Z</updated>
    
    <content type="html"><![CDATA[<p><a href="http://ybt.ssoier.cn:8088/index.php" target="_blank" rel="noopener">ä¹¦æœ¬é…å¥—OJ</a><br><a href="http://www.mfstem.org/" target="_blank" rel="noopener">æœ¬æ ¡OJ</a></p><p>STè¡¨ä½¿ç”¨è¯´æ˜ï¼š</p><ul><li>å¸¸ç”¨äºç¦»çº¿é—®é¢˜ï¼Œæˆ–å½“ä½œè¾…åŠ©æ•°æ®ç»“æ„ï¼ŒæŸ¥è¯¢æ—¶é—´éå¸¸ä¼˜ç§€ï¼ŒO(1)</li><li>äºŒç»´stè¡¨ä¹Ÿå¾ˆå¥½å®ç°ï¼Œä¸è¿‡æœ¬é¢˜é›†ä¸­æœªæ¶‰åŠ</li><li>stè¡¨å†…ä¹Ÿå¯ä»¥ç»´æŠ¤çš„æ˜¯ä¸‹æ ‡è€Œéå€¼ï¼Œåœ¨æŸäº›æ—¶å€™å¾ˆæœ‰ç”¨</li></ul><h4 id="æ•°åˆ—åŒºé—´æœ€å¤§å€¼"><a href="#æ•°åˆ—åŒºé—´æœ€å¤§å€¼" class="headerlink" title="æ•°åˆ—åŒºé—´æœ€å¤§å€¼"></a>æ•°åˆ—åŒºé—´æœ€å¤§å€¼</h4><p><strong>é¢˜æ„ç®€è¿°</strong><br>è¾“å…¥ä¸€ä¸²æ•°å­—ï¼Œç»™ä½  M ä¸ªè¯¢é—®ï¼Œæ¯æ¬¡è¯¢é—®å°±ç»™ä½ ä¸¤ä¸ªæ•°å­— X,Yï¼Œè¦æ±‚ä½ è¯´å‡º X åˆ° Y è¿™æ®µåŒºé—´å†…çš„æœ€å¤§æ•°ã€‚<br><strong>è§£é¢˜æ€è·¯</strong><br>stè¡¨æ¨¡æ¿é¢˜ã€‚<br><strong>ä»£ç ç¤ºä¾‹</strong><br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">int</span> n,m;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1e5</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">int</span> st[N][<span class="number">22</span>] ,Log[N];</span><br><span class="line"><span class="keyword">int</span> a[N];</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">getInt</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">int</span> ans = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">bool</span> neg = <span class="literal">false</span>;</span><br><span class="line"><span class="keyword">char</span> c = getchar();</span><br><span class="line"><span class="keyword">while</span>(c!=<span class="string">'-'</span> &amp;&amp; (c &lt;<span class="string">'0'</span> || c &gt; <span class="string">'9'</span>)) c = getchar();</span><br><span class="line"><span class="keyword">if</span>(c == <span class="string">'-'</span>) neg = <span class="literal">true</span>,c = getchar();</span><br><span class="line"><span class="keyword">while</span>(c &gt;= <span class="string">'0'</span> &amp;&amp; c &lt;= <span class="string">'9'</span>) ans = ans*<span class="number">10</span>+c-<span class="string">'0'</span>,c = getchar();</span><br><span class="line"><span class="keyword">return</span> neg?-ans:ans;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">2</span>;i &lt;= n+<span class="number">1</span>;i++) Log[i]= Log[i/<span class="number">2</span>]+<span class="number">1</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++) st[i][<span class="number">0</span>] = a[i];</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">1</span>;(<span class="number">1</span>&lt;&lt;j) &lt;= n;j++)&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i + (<span class="number">1</span>&lt;&lt;j<span class="number">-1</span>) &lt;= n;i++)&#123;</span><br><span class="line">st[i][j] = max(st[i][j<span class="number">-1</span>],st[i+(<span class="number">1</span>&lt;&lt;j<span class="number">-1</span>)][j<span class="number">-1</span>]);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">ask</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r)</span></span>&#123;</span><br><span class="line"><span class="keyword">int</span> k = Log[r-l+<span class="number">1</span>];</span><br><span class="line"><span class="keyword">return</span> max(st[l][k],st[r-(<span class="number">1</span>&lt;&lt;k)+<span class="number">1</span>][k]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="comment">//freopen("123.txt","r",stdin);</span></span><br><span class="line">n = getInt(); m = getInt();</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++) a[i] = getInt();</span><br><span class="line">init();</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>,x,y;i &lt;= m;i++)&#123;</span><br><span class="line">x = getInt(); y = getInt();</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%d\n"</span>,ask(x,y));</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h4 id="æœ€æ•æ·çš„æœºå™¨äºº"><a href="#æœ€æ•æ·çš„æœºå™¨äºº" class="headerlink" title="æœ€æ•æ·çš„æœºå™¨äºº"></a>æœ€æ•æ·çš„æœºå™¨äºº</h4><p><strong>é¢˜æ„ç®€è¿°</strong><br>Wind è®¾è®¡äº†å¾ˆå¤šæœºå™¨äººã€‚ä½†æ˜¯å®ƒä»¬éƒ½è®¤ä¸ºè‡ªå·±æ˜¯æœ€å¼ºçš„ï¼Œäºæ˜¯ï¼Œä¸€åœºæ¯”èµ›å¼€å§‹äº†â€¦â€¦</p><p>æœºå™¨äººä»¬éƒ½æƒ³çŸ¥é“è°æ˜¯æœ€æ•æ·çš„ï¼Œäºæ˜¯å®ƒä»¬è¿›è¡Œäº†å¦‚ä¸‹ä¸€ä¸ªæ¯”èµ›ã€‚é¦–å…ˆï¼Œä»–ä»¬é¢å‰ä¼šæœ‰ä¸€æ’å…± n ä¸ªæ•°ï¼Œå®ƒä»¬æ¯”èµ›çœ‹è°èƒ½æœ€å…ˆæŠŠæ¯è¿ç»­ k ä¸ªæ•°ä¸­æœ€å¤§å’Œæœ€å°å€¼å†™ä¸‹æ¥ï¼Œå½“ç„¶ï¼Œè¿™äº›æœºå™¨äººè¿ç®—é€Ÿåº¦éƒ½å¾ˆå¿«ï¼Œå®ƒä»¬æ¯”èµ›çš„æ˜¯è°å†™å¾—å¿«ã€‚</p><p>ä½†æ˜¯ Wind ä¹Ÿæƒ³çŸ¥é“ç­”æ¡ˆï¼Œä½ èƒ½å¸®åŠ©ä»–å—ï¼Ÿ<br><strong>è§£é¢˜æ€è·¯</strong><br>stè¡¨æ¨¡æ¿é¢˜ï¼Œä¸è¿‡è¿˜è¦ç»´æŠ¤ä¸€ä¸‹æœ€å°å€¼ï¼Œå¤šå¼€ä¸€ä¸ªæ•°ç»„å³å¯ã€‚</p><p><strong>ä»£ç ç¤ºä¾‹</strong><br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">int</span> n,m;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1e5</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">int</span> st[N][<span class="number">22</span>] ,Log[N], st2[N][<span class="number">22</span>];</span><br><span class="line"><span class="keyword">int</span> a[N];</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">getInt</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">int</span> ans = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">bool</span> neg = <span class="literal">false</span>;</span><br><span class="line"><span class="keyword">char</span> c = getchar();</span><br><span class="line"><span class="keyword">while</span>(c!=<span class="string">'-'</span> &amp;&amp; (c &lt;<span class="string">'0'</span> || c &gt; <span class="string">'9'</span>)) c = getchar();</span><br><span class="line"><span class="keyword">if</span>(c == <span class="string">'-'</span>) neg = <span class="literal">true</span>,c = getchar();</span><br><span class="line"><span class="keyword">while</span>(c &gt;= <span class="string">'0'</span> &amp;&amp; c &lt;= <span class="string">'9'</span>) ans = ans*<span class="number">10</span>+c-<span class="string">'0'</span>,c = getchar();</span><br><span class="line"><span class="keyword">return</span> neg?-ans:ans;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">2</span>;i &lt;= n+<span class="number">1</span>;i++) Log[i]= Log[i/<span class="number">2</span>]+<span class="number">1</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++) st2[i][<span class="number">0</span>] = st[i][<span class="number">0</span>] = a[i];</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">1</span>;(<span class="number">1</span>&lt;&lt;j) &lt;= n;j++)&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i + (<span class="number">1</span>&lt;&lt;j<span class="number">-1</span>) &lt;= n;i++)&#123;</span><br><span class="line">st[i][j] = max(st[i][j<span class="number">-1</span>],st[i+(<span class="number">1</span>&lt;&lt;j<span class="number">-1</span>)][j<span class="number">-1</span>]);</span><br><span class="line">st2[i][j] = min(st2[i][j<span class="number">-1</span>],st2[i+(<span class="number">1</span>&lt;&lt;j<span class="number">-1</span>)][j<span class="number">-1</span>]);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ask</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r)</span></span>&#123;</span><br><span class="line"><span class="keyword">int</span> k = Log[r-l+<span class="number">1</span>];</span><br><span class="line"><span class="keyword">int</span> mx = max(st[l][k],st[r-(<span class="number">1</span>&lt;&lt;k)+<span class="number">1</span>][k]);</span><br><span class="line"><span class="keyword">int</span> mi = min(st2[l][k],st2[r-(<span class="number">1</span>&lt;&lt;k)+<span class="number">1</span>][k]);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%d %d\n"</span>,mx,mi);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="comment">//freopen("123.txt","r",stdin);</span></span><br><span class="line">n = getInt(); m = getInt();</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++) a[i] = getInt();</span><br><span class="line">init();</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n-m+<span class="number">1</span>;i++) ask(i,i+m<span class="number">-1</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h4 id="ä¸ä¼—ä¸åŒ"><a href="#ä¸ä¼—ä¸åŒ" class="headerlink" title="ä¸ä¼—ä¸åŒ*"></a>ä¸ä¼—ä¸åŒ*</h4><p><strong>é¢˜æ„ç®€è¿°</strong><br>A æ˜¯æŸå…¬å¸çš„ CEOï¼Œæ¯ä¸ªæœˆéƒ½ä¼šæœ‰å‘˜å·¥æŠŠå…¬å¸çš„ç›ˆåˆ©æ•°æ®é€ç»™ Aï¼ŒA æ˜¯ä¸ªä¸ä¼—ä¸åŒçš„æ€ªäººï¼ŒA ä¸æ³¨é‡ç›ˆåˆ©è¿˜æ˜¯äºæœ¬ï¼Œè€Œæ˜¯å–œæ¬¢ç ”ç©¶ã€Œå®Œç¾åºåˆ—ã€ï¼šä¸€æ®µè¿ç»­çš„åºåˆ—æ»¡è¶³åºåˆ—ä¸­çš„æ•°äº’ä¸ç›¸åŒã€‚<br>A æƒ³çŸ¥é“åŒºé—´ [L,R] ä¹‹é—´æœ€é•¿çš„å®Œç¾åºåˆ—é•¿åº¦ã€‚</p><p><strong>è§£é¢˜æ€è·¯</strong><br>æˆ‘ä»¬å¯ä»¥é€šè¿‡æ ‡è®°æ•°ç»„åœ¨O(N)æ—¶é—´å†…æ±‚å‡ºæ¯ä¸ªä½ç½®â€œä½œä¸ºç»“æŸä½ç½®â€æ—¶çš„æœ€é•¿å®Œç¾åºåˆ—é•¿åº¦ï¼Œä»¥åŠå®ƒçš„èµ·ç‚¹ã€‚<br>è®¾last[ x ] è¡¨ç¤º x ä¸Šæ¬¡å‡ºç°çš„ä½ç½®ï¼›bgn[ p ]è¡¨ç¤ºä»¥ä½ç½® p ä¸ºæœ«å°¾çš„å®Œç¾åºåˆ—çš„èµ·ç‚¹ä½ç½®ï¼›len[p] è¡¨ç¤ºä»¥ä½ç½® p ä¸ºæœ«å°¾çš„å®Œç¾åºåˆ—çš„é•¿åº¦ã€‚æ˜¾ç„¶æˆ‘ä»¬å¯ä»¥åœ¨ä¸€æ¬¡éå†å†…æ›´æ–°å®Œæ¯•ä¸Šè¿°ä¸‰ä¸ªæ•°ç»„ï¼ŒO(N)ã€‚<br>é‚£ä¹ˆå¯¹äºä»»æ„åŒºé—´[ L , R ]ï¼Œå…¶å†…çš„æœ€é•¿å®Œç¾åºåˆ—é•¿åº¦ä»…æœ‰ 2 ç§å¯èƒ½ï¼Œä¸€ç§æ˜¯ç»ˆç‚¹åœ¨åŒºé—´å†…ï¼Œèµ·ç‚¹ä¸åœ¨ï¼›å¦ä¸€ç§æ˜¯èµ·ç‚¹å’Œç»ˆç‚¹éƒ½åœ¨åŒºé—´å†…ã€‚æ­¤æ—¶æˆ‘ä»¬å·²ç»å¯ä»¥é€šè¿‡ä¸€æ¬¡éå†æ¥æ±‚ç­”æ¡ˆäº†ï¼Œä½†æ˜¯å¤æ‚åº¦æœ€å·®O(N)ï¼Œä¸å¯å–ã€‚ç”±äºbgn[]æ˜¯å•è°ƒé€’å¢çš„ï¼Œæ‰€ä»¥å¯¹äºæŸä¸ªä½ç½® posï¼Œ[ L , pos-1] æ‰€æœ‰ä½ç½®ä¸Šçš„èµ·ç‚¹éƒ½å°äº Lï¼Œ[pos , R]ä¸Šæ‰€æœ‰ä½ç½®ä¸Šçš„èµ·ç‚¹éƒ½å¤§äºLï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥é€šè¿‡STè¡¨ç»´æŠ¤ [pos ,R] ä¸Šçš„æœ€å¤§çš„ len å€¼ï¼Œåœ¨O(1)æ—¶é—´å†…æ±‚å‡ºï¼Œé‚£ä¹ˆç­”æ¡ˆå°±æ˜¯max(pos-L , ask(pos , R) )ã€‚</p><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡äºŒåˆ†æœç´¢æ¥æŸ¥æ‰¾ pos ,å¤æ‚åº¦ O(log N)ï¼Œæ ¹æ®lenæ•°ç»„æ„é€ stè¡¨ï¼ŒO(NlogN)ï¼Œæ€»æ—¶é—´å¤æ‚åº¦O( (N+M)logN )ã€‚</p><p><strong>ä»£ç ç¤ºä¾‹</strong><br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">int</span> n,m;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">2e5</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> SZ = <span class="number">2e6</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> B = <span class="number">1e6</span>;</span><br><span class="line"><span class="comment">/*last[x]ä¸ºxä¸Šä¸€æ¬¡å‡ºç°çš„ä½ç½®;</span></span><br><span class="line"><span class="comment">bgn[p]ä¸ºä»¥ä½ç½®pç»“å°¾çš„èµ·ç‚¹ä½ç½®;len[p]ä¸ºä»¥pç»“å°¾çš„å®Œç¾åºåˆ—é•¿åº¦*/</span></span><br><span class="line"><span class="keyword">int</span> last[SZ],bgn[N],len[N];</span><br><span class="line"><span class="keyword">int</span> a[N],Log[N],st[N][<span class="number">22</span>];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">init_st</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">2</span>;i &lt;= n+<span class="number">1</span>;i++) Log[i] = Log[i/<span class="number">2</span>]+<span class="number">1</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++) st[i][<span class="number">0</span>] = len[i];</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">1</span>;<span class="number">1</span>&lt;&lt;j &lt;= n;j++)</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i + (<span class="number">1</span>&lt;&lt;j<span class="number">-1</span>) &lt;= n;i++)</span><br><span class="line">st[i][j] = max(st[i][j<span class="number">-1</span>],st[i+(<span class="number">1</span>&lt;&lt;j<span class="number">-1</span>)][j<span class="number">-1</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">ask</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r)</span></span>&#123;</span><br><span class="line"><span class="keyword">int</span> k = Log[r-l+<span class="number">1</span>];</span><br><span class="line"><span class="keyword">return</span> max(st[l][k],st[r-(<span class="number">1</span>&lt;&lt;k)+<span class="number">1</span>][k]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">bsearch</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line"><span class="keyword">while</span>(l &lt;= r)&#123;</span><br><span class="line"><span class="keyword">int</span> mid = l+r&gt;&gt;<span class="number">1</span>;</span><br><span class="line"><span class="keyword">if</span>(bgn[mid] &gt;= x) r = mid<span class="number">-1</span>;</span><br><span class="line"><span class="keyword">else</span> l = mid+<span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> l;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++)&#123;</span><br><span class="line">bgn[i] = max(bgn[i<span class="number">-1</span>],last[a[i]+B]+<span class="number">1</span>);<span class="comment">//èµ·å§‹ä½ç½®å¿…é¡»åˆæ³• </span></span><br><span class="line">len[i] = i - bgn[i] + <span class="number">1</span>;</span><br><span class="line">last[a[i]+B] = i;</span><br><span class="line">&#125;</span><br><span class="line">init_st();<span class="comment">//å»ºç«‹lenæ•°ç»„çš„stè¡¨ </span></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>,x,y,p,res;i &lt;= m;i++)&#123;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;x,&amp;y);x++,y++; </span><br><span class="line">p = bsearch(x,y,x);<span class="comment">//æ‰¾åˆ°[x,y]å†…ç¬¬ä¸€ä¸ªbgnå¤§äºç­‰äºxçš„ä½ç½® </span></span><br><span class="line"><span class="keyword">if</span>(p &lt;= y) res = max(p-x,ask(p,y));</span><br><span class="line"><span class="keyword">else</span> res = p-x;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%d\n"</span>,res);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="comment">//freopen("123.txt","r",stdin);</span></span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;n,&amp;m);</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++) <span class="built_in">scanf</span>(<span class="string">"%d"</span>,a+i);</span><br><span class="line">solve();</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h4 id="å¤©æ‰çš„è®°å¿†"><a href="#å¤©æ‰çš„è®°å¿†" class="headerlink" title="å¤©æ‰çš„è®°å¿†"></a>å¤©æ‰çš„è®°å¿†</h4><p><strong>ä»£ç ç¤ºä¾‹ï¼š</strong> æ¨¡æ¿æ¨¡æ¿ï¼Œé¢˜é¢å’Œæ€è·¯ä¸è¯´äº†ã€‚<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">int</span> n,m;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">2e5</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">int</span> st[N][<span class="number">22</span>] ,Log[N];</span><br><span class="line"><span class="keyword">int</span> a[N];</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">getInt</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">int</span> ans = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">bool</span> neg = <span class="literal">false</span>;</span><br><span class="line"><span class="keyword">char</span> c = getchar();</span><br><span class="line"><span class="keyword">while</span>(c!=<span class="string">'-'</span> &amp;&amp; (c &lt;<span class="string">'0'</span> || c &gt; <span class="string">'9'</span>)) c = getchar();</span><br><span class="line"><span class="keyword">if</span>(c == <span class="string">'-'</span>) neg = <span class="literal">true</span>,c = getchar();</span><br><span class="line"><span class="keyword">while</span>(c &gt;= <span class="string">'0'</span> &amp;&amp; c &lt;= <span class="string">'9'</span>) ans = ans*<span class="number">10</span>+c-<span class="string">'0'</span>,c = getchar();</span><br><span class="line"><span class="keyword">return</span> neg?-ans:ans;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">2</span>;i &lt;= n+<span class="number">1</span>;i++) Log[i]= Log[i/<span class="number">2</span>]+<span class="number">1</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++) st[i][<span class="number">0</span>] = a[i];</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">1</span>;(<span class="number">1</span>&lt;&lt;j) &lt;= n;j++)&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i + (<span class="number">1</span>&lt;&lt;j<span class="number">-1</span>) &lt;= n;i++)&#123;</span><br><span class="line">st[i][j] = max(st[i][j<span class="number">-1</span>],st[i+(<span class="number">1</span>&lt;&lt;j<span class="number">-1</span>)][j<span class="number">-1</span>]);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">ask</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r)</span></span>&#123;</span><br><span class="line"><span class="keyword">int</span> k = Log[r-l+<span class="number">1</span>];</span><br><span class="line"><span class="keyword">return</span> max(st[l][k],st[r-(<span class="number">1</span>&lt;&lt;k)+<span class="number">1</span>][k]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="comment">//freopen("123.txt","r",stdin);</span></span><br><span class="line">n = getInt();;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++) a[i] = getInt();</span><br><span class="line">init(); m = getInt();</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>,x,y;i &lt;= m;i++)&#123;</span><br><span class="line">x = getInt(); y = getInt();</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%d\n"</span>,ask(x,y));</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h4 id="Balanced-Lineup"><a href="#Balanced-Lineup" class="headerlink" title="Balanced Lineup"></a>Balanced Lineup</h4><p><strong>ä»£ç ç¤ºä¾‹ï¼š</strong> å’Œâ€œæ•æ·çš„æœºå™¨äººâ€ä¸€æ ·ï¼Œéƒ½æ˜¯è¦ç»´æŠ¤æœ€å¤§ä»¥åŠæœ€å°å€¼ã€‚<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">int</span> n,m;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1e5</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">int</span> st[N][<span class="number">22</span>] ,Log[N], st2[N][<span class="number">22</span>];</span><br><span class="line"><span class="keyword">int</span> a[N];</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">getInt</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">int</span> ans = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">bool</span> neg = <span class="literal">false</span>;</span><br><span class="line"><span class="keyword">char</span> c = getchar();</span><br><span class="line"><span class="keyword">while</span>(c!=<span class="string">'-'</span> &amp;&amp; (c &lt;<span class="string">'0'</span> || c &gt; <span class="string">'9'</span>)) c = getchar();</span><br><span class="line"><span class="keyword">if</span>(c == <span class="string">'-'</span>) neg = <span class="literal">true</span>,c = getchar();</span><br><span class="line"><span class="keyword">while</span>(c &gt;= <span class="string">'0'</span> &amp;&amp; c &lt;= <span class="string">'9'</span>) ans = ans*<span class="number">10</span>+c-<span class="string">'0'</span>,c = getchar();</span><br><span class="line"><span class="keyword">return</span> neg?-ans:ans;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">2</span>;i &lt;= n+<span class="number">1</span>;i++) Log[i]= Log[i/<span class="number">2</span>]+<span class="number">1</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++) st2[i][<span class="number">0</span>] = st[i][<span class="number">0</span>] = a[i];</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">1</span>;(<span class="number">1</span>&lt;&lt;j) &lt;= n;j++)&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i + (<span class="number">1</span>&lt;&lt;j<span class="number">-1</span>) &lt;= n;i++)&#123;</span><br><span class="line">st[i][j] = max(st[i][j<span class="number">-1</span>],st[i+(<span class="number">1</span>&lt;&lt;j<span class="number">-1</span>)][j<span class="number">-1</span>]);</span><br><span class="line">st2[i][j] = min(st2[i][j<span class="number">-1</span>],st2[i+(<span class="number">1</span>&lt;&lt;j<span class="number">-1</span>)][j<span class="number">-1</span>]);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ask</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r)</span></span>&#123;</span><br><span class="line"><span class="keyword">int</span> k = Log[r-l+<span class="number">1</span>];</span><br><span class="line"><span class="keyword">int</span> mx = max(st[l][k],st[r-(<span class="number">1</span>&lt;&lt;k)+<span class="number">1</span>][k]);</span><br><span class="line"><span class="keyword">int</span> mi = min(st2[l][k],st2[r-(<span class="number">1</span>&lt;&lt;k)+<span class="number">1</span>][k]);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%d\n"</span>,mx-mi);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="comment">//freopen("123.txt","r",stdin);</span></span><br><span class="line">n = getInt(); m = getInt();</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++) a[i] = getInt();</span><br><span class="line">init();</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>,x,y;i &lt;= m;i++)&#123;</span><br><span class="line">x = getInt(); y = getInt();</span><br><span class="line">ask(x,y);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h4 id="é€‰æ‹©å®¢æ ˆ"><a href="#é€‰æ‹©å®¢æ ˆ" class="headerlink" title="é€‰æ‹©å®¢æ ˆ*"></a>é€‰æ‹©å®¢æ ˆ*</h4><p><strong>é¢˜æ„æè¿°</strong><br>ä¸½æ±Ÿæ²³è¾¹æœ‰ n å®¶å¾ˆæœ‰ç‰¹è‰²çš„å®¢æ ˆï¼Œå®¢æ ˆæŒ‰ç…§å…¶ä½ç½®é¡ºåºä» 1 åˆ° n ç¼–å·ã€‚</p><p>æ¯å®¶å®¢æ ˆéƒ½æŒ‰ç…§æŸä¸€ç§è‰²è°ƒè¿›è¡Œè£…é¥°ï¼ˆæ€»å…± k ç§ï¼Œç”¨æ•´æ•° 0 kâˆ’1 è¡¨ç¤ºï¼‰ï¼Œä¸”æ¯å®¶å®¢æ ˆéƒ½è®¾æœ‰ä¸€å®¶å’–å•¡åº—ï¼Œæ¯å®¶å’–å•¡åº—å‡æœ‰å„è‡ªçš„æœ€ä½æ¶ˆè´¹ã€‚</p><p>ä¸¤ä½æ¸¸å®¢ä¸€èµ·å»ä¸½æ±Ÿæ—…æ¸¸ï¼Œä»–ä»¬å–œæ¬¢ç›¸åŒçš„è‰²è°ƒï¼Œåˆæƒ³å°è¯•ä¸¤ä¸ªä¸åŒçš„å®¢æ ˆï¼Œå› æ­¤å†³å®šåˆ†åˆ«ä½åœ¨è‰²è°ƒç›¸åŒçš„ä¸¤å®¶å®¢æ ˆä¸­ã€‚</p><p>æ™šä¸Šï¼Œä»–ä»¬æ‰“ç®—é€‰æ‹©ä¸€å®¶å’–å•¡åº—å–å’–å•¡ï¼Œè¦æ±‚å’–å•¡åº—ä½äºä¸¤äººä½çš„ä¸¤å®¶å®¢æ ˆä¹‹é—´ï¼ˆåŒ…æ‹¬ä»–ä»¬ä½çš„å®¢æ ˆï¼‰ï¼Œä¸”å’–å•¡åº—çš„æœ€ä½æ¶ˆè´¹ä¸è¶…è¿‡ p ã€‚</p><p>ä»–ä»¬æƒ³çŸ¥é“æ€»å…±æœ‰å¤šå°‘ç§é€‰æ‹©ä½å®¿çš„æ–¹æ¡ˆï¼Œä¿è¯æ™šä¸Šå¯ä»¥æ‰¾åˆ°ä¸€å®¶æœ€ä½æ¶ˆè´¹ä¸è¶…è¿‡ p å…ƒçš„å’–å•¡åº—å°èšã€‚</p><p><strong>è§£é¢˜æ€è·¯</strong><br>æ²¡çœ‹æ­£è§£æ˜¯å•¥ï¼Œæˆ‘æ²¡ç”¨åˆ°stè¡¨ï¼Œä¸è¿‡å€’æ˜¯ç”¨åˆ°äº†æ±‚RMQçš„æ­¥éª¤ã€‚<br>å…±ä¸‰ä¸ªè¾…åŠ©æ•°ç»„ï¼Œcol[k] è¡¨ç¤ºå½“å‰ç¬¬kç§é¢œè‰²å®¢æ ˆçš„æ•°é‡ï¼›val[x]è¡¨ç¤ºå®¢æ ˆxçš„æœ€ä½æ¶ˆè´¹ï¼›mip[x]è¡¨ç¤º [x, n] å†…ç¬¬ä¸€ä¸ªæœ€ä½æ¶ˆè´¹å°äºç­‰äº p å…ƒçš„å®¢æ ˆä½ç½®ã€‚<br>å¦‚æœç¬¬ä¸€ä¸ªäººå…¥ä½å®¢æ ˆxï¼Œç¬¬äºŒä¸ªäººèƒ½å¤Ÿå…¥ä½çš„æ—…åº—çš„ä½ç½®ä¸€å®šæ˜¯å¤§äºç­‰äºmip[x]çš„ï¼Œå¹¶ä¸”è¦é¢œè‰²å’Œ x ç›¸åŒï¼Œå³col[ a[i] ]ç§é€‰æ‹©æ–¹æ¡ˆã€‚æ‰€ä»¥æˆ‘ä»¬åªéœ€è¦ä»å‰å¾€åé¡ºåºéå†ä¸€éå¹¶ç»Ÿè®¡ç­”æ¡ˆå³å¯ï¼Œå¤æ‚åº¦O(N)ã€‚</p><p><strong>ä»£ç ç¤ºä¾‹</strong><br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">2e6</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> K = <span class="number">1e4</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll;</span><br><span class="line"><span class="keyword">int</span> col[K];</span><br><span class="line"><span class="keyword">int</span> n,m,p;</span><br><span class="line"><span class="keyword">int</span> a[N],val[N];</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">getInt</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">int</span> ans = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">bool</span> neg = <span class="literal">false</span>;</span><br><span class="line"><span class="keyword">char</span> c = getchar();</span><br><span class="line"><span class="keyword">while</span>(c!=<span class="string">'-'</span> &amp;&amp; (c &lt;<span class="string">'0'</span> || c &gt; <span class="string">'9'</span>)) c = getchar();</span><br><span class="line"><span class="keyword">if</span>(c == <span class="string">'-'</span>) neg = <span class="literal">true</span>,c = getchar();</span><br><span class="line"><span class="keyword">while</span>(c &gt;= <span class="string">'0'</span> &amp;&amp; c &lt;= <span class="string">'9'</span>) ans = ans*<span class="number">10</span>+c-<span class="string">'0'</span>,c = getchar();</span><br><span class="line"><span class="keyword">return</span> neg?-ans:ans;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> mip[N];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span></span>&#123;</span><br><span class="line">mip[n+<span class="number">1</span>] = n+<span class="number">1</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = n;i &gt; <span class="number">0</span>;i--)&#123;</span><br><span class="line"><span class="keyword">if</span>(val[i] &gt; p) mip[i] = mip[i+<span class="number">1</span>];</span><br><span class="line"><span class="keyword">else</span> mip[i] = i;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> pre = <span class="number">1</span>; ll ans = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++)&#123;</span><br><span class="line"><span class="keyword">int</span> now = mip[i];</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> j = pre;j &lt; now;j++) col[a[j]]--;</span><br><span class="line"><span class="comment">//printf("%d %d %d\n",pre,now,col[a[i]]);</span></span><br><span class="line">ans += col[a[i]]; pre = now;</span><br><span class="line"><span class="keyword">if</span>(now == i) ans--;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%lld\n"</span>,ans);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="comment">//freopen("123.txt","r",stdin);</span></span><br><span class="line">n = getInt(); m = getInt(); p = getInt();</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>,x;i &lt;= n;i++)&#123;</span><br><span class="line">a[i] = getInt(); val[i] = getInt(); </span><br><span class="line">col[a[i]]++;</span><br><span class="line">&#125;</span><br><span class="line">solve();</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;a href=&quot;http://ybt.ssoier.cn:8088/index.php&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;ä¹¦æœ¬é…å¥—OJ&lt;/a&gt;&lt;br&gt;&lt;a href=&quot;http://www.mfstem.org/&quot; target=&quot;_blan
      
    
    </summary>
    
      <category term="ACMé¢˜è§£" scheme="http://valenshi.top/categories/ACM%E9%A2%98%E8%A7%A3/"/>
    
    
      <category term="stè¡¨" scheme="http://valenshi.top/tags/st%E8%A1%A8/"/>
    
      <category term="RMQé—®é¢˜" scheme="http://valenshi.top/tags/RMQ%E9%97%AE%E9%A2%98/"/>
    
  </entry>
  
  <entry>
    <title>æ ‘çŠ¶æ•°ç»„é¢˜é›†</title>
    <link href="http://valenshi.top/2019/10/06/BIT-problems/"/>
    <id>http://valenshi.top/2019/10/06/BIT-problems/</id>
    <published>2019-10-06T12:46:38.000Z</published>
    <updated>2019-10-07T11:19:59.049Z</updated>
    
    <content type="html"><![CDATA[<p><a href="http://ybt.ssoier.cn:8088/index.php" target="_blank" rel="noopener">ä¹¦æœ¬é…å¥—OJ</a><br><a href="http://www.mfstem.org/contests" target="_blank" rel="noopener">æˆ‘æ ¡OJ</a><br><strong>æ ‘çŠ¶æ•°ç»„çŸ¥è¯†ç‚¹ï¼š</strong></p><ul><li>å•ç‚¹ä¿®æ”¹ï¼ŒåŒºé—´æ±‚å’Œï¼ŒO(logN)ã€‚</li><li>åŒºé—´ä¿®æ”¹ï¼ŒåŒºé—´æ±‚å’Œï¼ŒO(logN)ã€‚</li><li>äºŒç»´æ ‘çŠ¶æ•°ç»„å•ç‚¹ä¿®æ”¹ï¼Œå­çŸ©é˜µæ±‚å’Œï¼Œæ—¶é—´å¤æ‚åº¦O(logN * logN)ï¼Œç©ºé—´O(N^2)ã€‚</li></ul><p>ä¸çº¿æ®µæ ‘ç›¸æ¯”åŠŸèƒ½æ¯”è¾ƒå•ä¸€ï¼Œä¸å¤Ÿçµæ´»ï¼Œä½†èƒœåœ¨ç®€çŸ­æ˜“å†™ï¼Œå¯ä»¥ç”¨æ¥æ‰“è¾…åŠ©ã€‚</p><p><strong>æ³¨æ„äº‹é¡¹</strong></p><ul><li>æ ‘çŠ¶æ•°ç»„ä¿®æ”¹çš„ä¸‹æ ‡ä¸èƒ½ä¸º0ï¼Œå› ä¸º lowbit(0) = 0ï¼Œè¿™å°±æ­»å¾ªç¯äº†ã€‚</li><li>æ³¨æ„æ ‘çŠ¶æ•°ç»„çš„ç©ºé—´ï¼Œè¿™æ˜¯ç”±å€¼åŸŸæ¥å†³å®šçš„ï¼Œè€Œä¸æ˜¯å®šä¹‰åŸŸã€‚</li></ul><h4 id="æ•°åˆ—æ“ä½œ"><a href="#æ•°åˆ—æ“ä½œ" class="headerlink" title="æ•°åˆ—æ“ä½œ"></a>æ•°åˆ—æ“ä½œ</h4><p><strong>é¢˜ç›®æè¿°</strong><br>ç»™å®šnä¸ªæ•°åˆ—,è§„å®šæœ‰ä¸¤ç§æ“ä½œï¼Œä¸€æ˜¯ä¿®æ”¹æŸä¸ªå…ƒç´ ï¼ŒäºŒæ˜¯æ±‚å­æ•°åˆ—[a,b]çš„è¿ç»­å’Œã€‚æ•°åˆ—å…ƒç´ ä¸ªæ•°æœ€å¤š10ä¸‡ä¸ªï¼Œè¯¢é—®æ“ä½œæœ€å¤š10ä¸‡æ¬¡ã€‚<br><strong>è§£é¢˜æ€è·¯</strong><br>æ¨¡æ¿é¢˜ã€‚<br><strong>ä»£ç ç¤ºä¾‹</strong><br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1e5</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll;</span><br><span class="line"><span class="keyword">int</span> n,m; </span><br><span class="line">ll A[N],c[N];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Add</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> y)</span></span>&#123;</span><br><span class="line"><span class="comment">/*æŠŠç¬¬xä½ç½®ä¸Šçš„æ•°+y*/</span></span><br><span class="line"><span class="keyword">for</span>(;x &lt;= n;x += x&amp;-x) c[x] += y;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">ll <span class="title">ask</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line"><span class="comment">/*è¿”å›[1,x]å…ƒç´ å’Œ*/</span></span><br><span class="line">ll res = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span>(;x;x -= x&amp;-x) res += c[x];</span><br><span class="line"><span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;n,&amp;m);</span><br><span class="line"><span class="keyword">int</span> k,a,b;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++) <span class="built_in">scanf</span>(<span class="string">"%lld"</span>,A+i);</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++) Add(i,A[i]);</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= m;i++)&#123;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d%d%d"</span>,&amp;k,&amp;a,&amp;b);</span><br><span class="line"><span class="keyword">if</span>(k) Add(a,b);</span><br><span class="line"><span class="keyword">else</span> <span class="built_in">printf</span>(<span class="string">"%lld\n"</span>,ask(b)-ask(a<span class="number">-1</span>));</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h4 id="æ•°æ˜Ÿæ˜Ÿ-Stars"><a href="#æ•°æ˜Ÿæ˜Ÿ-Stars" class="headerlink" title="æ•°æ˜Ÿæ˜Ÿ Stars"></a>æ•°æ˜Ÿæ˜Ÿ Stars</h4><p><strong>é¢˜æ„ç®€è¿°</strong><br>ç»™å®š n ä¸ªç‚¹ï¼Œå®šä¹‰æ¯ä¸ªç‚¹çš„ç­‰çº§æ˜¯åœ¨è¯¥ç‚¹å·¦ä¸‹æ–¹ï¼ˆå«æ­£å·¦ã€æ­£ä¸‹ï¼‰çš„ç‚¹çš„æ•°ç›®ï¼Œè¯•ç»Ÿè®¡æ¯ä¸ªç­‰çº§æœ‰å¤šå°‘ä¸ªç‚¹ã€‚<br>(è¯¦ç»†æè¿°è§åŸé¢˜é¢)</p><p><strong>è§£é¢˜æ€è·¯</strong><br>ç”±äºyæ˜¯å‡åºçš„ï¼Œæˆ‘ä»¬åªéœ€è¦è®°å½•æ¯”å½“å‰xå°çš„staræœ‰å¤šå°‘ä¸ªå³å¯å¾—çŸ¥å…¶ç­‰çº§ x ï¼Œç„¶åç”¨num[x]è¡¨ç¤ºç­‰çº§ä¸ºxçš„æ˜Ÿæ˜Ÿä¸ªæ•°ï¼Œæœ€ç»ˆç­”æ¡ˆå°±æ˜¯numæ•°ç»„ã€‚<br>CDQåˆ†æ²»ä¹Ÿå¯ä»¥å†™ï¼Œéƒ½æ˜¯å…ˆå°†ä¸€ç»´ç»™å˜çš„æœ‰åºï¼Œå†ç»Ÿè®¡å¦ä¸€ç»´åº¦ã€‚<br><strong>ä»£ç ç¤ºä¾‹</strong><br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">4e4</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">int</span> c[N],n;</span><br><span class="line"><span class="keyword">int</span> ans[N];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Add</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> y)</span></span>&#123; <span class="comment">//è‹¥x=0åˆ™æ­»å¾ªç¯ </span></span><br><span class="line"><span class="keyword">for</span>(;x &lt; N;x += x&amp;-x) c[x] += y;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">ask</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line"><span class="keyword">int</span> res = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span>(;x;x -= x&amp;-x) res += c[x];</span><br><span class="line"><span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="comment">//freopen("123.txt","r",stdin);</span></span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;n);</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>,x,y;i &lt;= n;i++)&#123;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;x,&amp;y);</span><br><span class="line">ans[ask(x+<span class="number">1</span>)]++;<span class="comment">//è¦æ³¨æ„x = 0è¿™ç§æƒ…å†µ </span></span><br><span class="line">Add(x+<span class="number">1</span>,<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; n;i++) <span class="built_in">printf</span>(<span class="string">"%d\n"</span>,ans[i]);</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h4 id="æ ¡é—¨å¤–çš„æ ‘"><a href="#æ ¡é—¨å¤–çš„æ ‘" class="headerlink" title="æ ¡é—¨å¤–çš„æ ‘*"></a>æ ¡é—¨å¤–çš„æ ‘*</h4><p><strong>é¢˜æ„ç®€è¿°</strong></p><p>åŸé¢˜æ¥è‡ªï¼šVijos P1448<br>æ ¡é—¨å¤–æœ‰å¾ˆå¤šæ ‘ï¼Œå­¦æ ¡å†³å®šåœ¨æŸä¸ªæ—¶åˆ»åœ¨æŸä¸€æ®µç§ä¸Šä¸€ç§æ ‘ï¼Œä¿è¯ä»»ä¸€æ—¶åˆ»ä¸ä¼šå‡ºç°ä¸¤æ®µç›¸åŒç§ç±»çš„æ ‘ï¼Œç°æœ‰ä¸¤ç§æ“ä½œï¼š</p><ul><li>K=1ï¼Œè¯»å…¥ l,r è¡¨ç¤ºåœ¨ l åˆ° r ä¹‹é—´ç§ä¸Šä¸€ç§æ ‘ï¼Œæ¯æ¬¡æ“ä½œç§çš„æ ‘çš„ç§ç±»éƒ½ä¸åŒï¼›</li><li>K=2ï¼Œè¯»å…¥ l,r è¡¨ç¤ºè¯¢é—® l åˆ° r ä¹‹é—´æœ‰å¤šå°‘ç§æ ‘ã€‚</li></ul><p><strong>è§£é¢˜æ€è·¯</strong><br>åˆšå¼€å§‹ä»¥ä¸ºæ˜¯åŒºé—´ä¿®æ”¹çš„é¢˜ï¼Œåæ¥å‘ç°ä¸æ˜¯ã€‚è¿™é¢˜åˆ©ç”¨äº†å·®åˆ†æ•°ç»„çš„æ€æƒ³ã€‚å¦‚æœæˆ‘ä»¬å‡è®¾c0[ x ] å­˜æ”¾ [1, x] çš„å·¦ç«¯ç‚¹æ•°é‡ï¼Œc1[]å­˜æ”¾å³ç«¯ç‚¹æ•°é‡ï¼›å¦‚æœæ‰€æ±‚åŒºé—´ä¸º[l , r]ï¼Œé‚£ä¹ˆä¸€å…±åªå¯èƒ½æœ‰ 6 ç§ä¸åŒçš„çº¿æ®µï¼š</p><ul><li>ç¬¬ä¸€ç§æ˜¯å…¨åœ¨rå³ä¾§ï¼›</li><li>ç¬¬äºŒç§æ˜¯å·¦ç«¯ç‚¹åœ¨ [l ,r] å†…ï¼Œå³ç«¯ç‚¹åœ¨rå³ä¾§ï¼›</li><li>ç¬¬ä¸‰ç§æ˜¯å·¦å³ç«¯ç‚¹éƒ½åœ¨[l ,r] å†…ï¼›</li><li>ç¬¬å››ç§æ˜¯å³ç«¯ç‚¹åœ¨[l ,r]å†…ï¼Œå·¦ç«¯ç‚¹åœ¨ l å·¦ä¾§ï¼›</li><li>ç¬¬äº”ç§æ˜¯å·¦å³ç«¯ç‚¹å…¨åœ¨ l å·¦ä¾§ï¼›</li><li>ç¬¬å…­ç§æ˜¯å·¦ç«¯ç‚¹åœ¨ l å·¦ä¾§ï¼Œå³ç«¯ç‚¹åœ¨ r å³ä¾§ã€‚</li></ul><p>é‚£ä¹ˆæˆ‘ä»¬ç”¨ l å³ä¾§æ‰€æœ‰çš„å³ç«¯ç‚¹çš„æ•°é‡ï¼Œå‡å» r å³ä¾§å·¦ç«¯ç‚¹çš„æ•°é‡ï¼Œå¯ä»¥ç”»å›¾ç†è§£ï¼Œç®€å•ã€‚</p><p><strong>ä»£ç ç¤ºä¾‹</strong><br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1e5</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll;</span><br><span class="line"><span class="keyword">int</span> n,m; </span><br><span class="line">ll A[N],c[<span class="number">2</span>][N];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Add</span><span class="params">(<span class="keyword">int</span> ty,<span class="keyword">int</span> x,<span class="keyword">int</span> y)</span></span>&#123;</span><br><span class="line"><span class="comment">/*æŠŠç¬¬xä½ç½®ä¸Šçš„æ•°+y*/</span></span><br><span class="line"><span class="keyword">for</span>(;x &lt; N;x += x&amp;-x) c[ty][x] += y;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">ll <span class="title">ask</span><span class="params">(<span class="keyword">int</span> ty,<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line"><span class="comment">/*è¿”å›[1,x]å…ƒç´ å’Œ*/</span></span><br><span class="line">ll res = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span>(;x;x -= x&amp;-x) res += c[ty][x];</span><br><span class="line"><span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;n,&amp;m);</span><br><span class="line"><span class="keyword">int</span> k,a,b;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= m;i++)&#123;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d%d%d"</span>,&amp;k,&amp;a,&amp;b);</span><br><span class="line"><span class="keyword">if</span>(k == <span class="number">1</span>)&#123;</span><br><span class="line">Add(<span class="number">0</span>,a,<span class="number">1</span>); Add(<span class="number">1</span>,b,<span class="number">1</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"><span class="comment">/*åˆ†ç±»è®¨è®º,æ‰€æœ‰çº¿æ®µå…±6ç§æƒ…å†µ */</span> </span><br><span class="line"><span class="keyword">int</span> t1 = ask(<span class="number">1</span>,N<span class="number">-1</span>) - ask(<span class="number">1</span>,a<span class="number">-1</span>); </span><br><span class="line"><span class="keyword">int</span> t2 = ask(<span class="number">0</span>,N<span class="number">-1</span>) - ask(<span class="number">0</span>,b);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%d\n"</span>,t1-t2);</span><br><span class="line">&#125; </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h4 id="æ¸…ç‚¹äººæ•°"><a href="#æ¸…ç‚¹äººæ•°" class="headerlink" title="æ¸…ç‚¹äººæ•°"></a>æ¸…ç‚¹äººæ•°</h4><p><strong>é¢˜æ„ç®€è¿°</strong><br>NK ä¸­å­¦ç»„ç»‡åŒå­¦ä»¬å»äº”äº‘å±±å¯¨å‚åŠ ç¤¾ä¼šå®è·µæ´»åŠ¨ï¼ŒæŒ‰æƒ¯ä¾‹è¦ä¹˜åç«è½¦å»ã€‚ç”±äº NK ä¸­å­¦çš„å­¦ç”Ÿå¾ˆå¤šï¼Œåœ¨ç«è½¦å¼€ä¹‹å‰å¿…é¡»æ¸…ç‚¹å¥½äººæ•°ã€‚<br>åˆå§‹æ—¶ï¼Œç«è½¦ä¸Šæ²¡æœ‰å­¦ç”Ÿã€‚å½“åŒå­¦ä»¬å¼€å§‹ä¸Šç«è½¦æ—¶ï¼Œå¹´çº§ä¸»ä»»ä»ç¬¬ä¸€èŠ‚è½¦å¢å‡ºå‘èµ°åˆ°æœ€åä¸€èŠ‚è½¦å¢ï¼Œæ¯èŠ‚è½¦å¢éšæ—¶éƒ½æœ‰å¯èƒ½æœ‰åŒå­¦ä¸Šä¸‹ã€‚å¹´çº§ä¸»ä»»èµ°åˆ°ç¬¬ m èŠ‚è½¦å¢æ—¶ï¼Œä»–æƒ³çŸ¥é“å‰ m èŠ‚è½¦å¢ä¸Šä¸€å…±æœ‰å¤šå°‘å­¦ç”Ÿï¼Œä½†æ˜¯ä»–æ²¡æœ‰è°ƒå¤´å¾€å›èµ°çš„ä¹ æƒ¯ã€‚ä¹Ÿå°±æ˜¯è¯´æ¯æ¬¡å½“ä»–æé—®æ—¶ï¼Œm æ€»ä¼šæ¯”å‰ä¸€æ¬¡å¤§ã€‚<br><strong>è§£é¢˜æ€è·¯</strong><br>ä¹Ÿæ˜¯æ¨¡æ¿é¢˜ã€‚<br><strong>ä»£ç ç¤ºä¾‹</strong><br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">5e5</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">int</span> c[N] ,n,k;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Add</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> y)</span></span>&#123;</span><br><span class="line"><span class="keyword">for</span>(;x &lt; N;x += x&amp;-x) c[x] += y;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">ask</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line"><span class="keyword">int</span> res = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span>(;x;x -= x&amp;-x) res += c[x];</span><br><span class="line"><span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="comment">//freopen("123.txt","r",stdin);</span></span><br><span class="line"><span class="keyword">char</span> op[<span class="number">5</span>];</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;n,&amp;k);</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>,x,y;i &lt;= k;i++)&#123;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%s"</span>,op);</span><br><span class="line"><span class="keyword">if</span>(op[<span class="number">0</span>] == <span class="string">'A'</span>)&#123;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;x); <span class="built_in">printf</span>(<span class="string">"%d\n"</span>,ask(x));</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(op[<span class="number">0</span>] == <span class="string">'B'</span>)&#123;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;x,&amp;y); Add(x,y);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;x,&amp;y); Add(x,-y);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h4 id="ç®€å•é¢˜"><a href="#ç®€å•é¢˜" class="headerlink" title="ç®€å•é¢˜"></a>ç®€å•é¢˜</h4><p><strong>é¢˜æ„ç®€è¿°</strong><br>é¢˜ç›®æ¥æºï¼šCQOI 2006<br>æœ‰ä¸€ä¸ª n ä¸ªå…ƒç´ çš„æ•°ç»„ï¼Œæ¯ä¸ªå…ƒç´ åˆå§‹å‡ä¸º 0ã€‚æœ‰ m æ¡æŒ‡ä»¤ï¼Œè¦ä¹ˆè®©å…¶ä¸­ä¸€æ®µè¿ç»­åºåˆ—æ•°å­—åè½¬â€”â€”0 å˜ 1ï¼Œ1 å˜ 0ï¼ˆæ“ä½œ 1ï¼‰ï¼Œè¦ä¹ˆè¯¢é—®æŸä¸ªå…ƒç´ çš„å€¼ï¼ˆæ“ä½œ 2ï¼‰ã€‚</p><p><strong>è§£é¢˜æ€è·¯</strong><br>ä¸€ä¸ªä½ç½®å¦‚æœåè½¬å¶æ•°æ¬¡ï¼Œé‚£ä¹ˆå®ƒè¿˜æ˜¯0ï¼Œå¦åˆ™æ˜¯1ï¼Œå› æ­¤æˆ‘ä»¬åªéœ€è¦ç»Ÿè®¡æ¯ä¸ªä½ç½®è¢«åè½¬äº†å‡ æ¬¡å³å¯ï¼Œç”¨åˆ°äº†æ ‘çŠ¶æ•°ç»„åŒºé—´ä¿®æ”¹å•ç‚¹æŸ¥è¯¢ã€‚æ ‘çŠ¶æ•°ç»„åŒºé—´ä¿®æ”¹çš„æ¨å¯¼å°±ä¸å†™äº†ï¼Œä¹¦ä¸Šæœ‰ã€‚</p><p><strong>ä»£ç ç¤ºä¾‹</strong><br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1e5</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">int</span> c[<span class="number">2</span>][N],n,m ,num[N];</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">getInt</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">int</span> ans = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">bool</span> neg = <span class="literal">false</span>;</span><br><span class="line"><span class="keyword">char</span> c = getchar();</span><br><span class="line"><span class="keyword">while</span> (c!=<span class="string">'-'</span> &amp;&amp; (c&lt;<span class="string">'0'</span> || c&gt;<span class="string">'9'</span>)) c = getchar();</span><br><span class="line"><span class="keyword">if</span> (c == <span class="string">'-'</span>) neg = <span class="literal">true</span>, c = getchar();</span><br><span class="line"><span class="keyword">while</span> (c&gt;=<span class="string">'0'</span> &amp;&amp; c&lt;=<span class="string">'9'</span>)</span><br><span class="line">ans = ans*<span class="number">10</span> + c-<span class="string">'0'</span>, c = getchar();</span><br><span class="line"><span class="keyword">return</span> neg ? -ans : ans; </span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Add</span><span class="params">(<span class="keyword">int</span> ty,<span class="keyword">int</span> x,<span class="keyword">int</span> y)</span></span>&#123;</span><br><span class="line"><span class="keyword">for</span>(;x &lt;= n;x += x&amp;-x) c[ty][x] += y;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">ask</span><span class="params">(<span class="keyword">int</span> ty,<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line"><span class="keyword">int</span> res = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span>(;x;x -= x&amp;-x) res += c[ty][x];</span><br><span class="line"><span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="comment">//freopen("123.txt","r",stdin); </span></span><br><span class="line">n = getInt(); m = getInt();</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>,x,y,z;i &lt;= m;i++)&#123;</span><br><span class="line">z = getInt();</span><br><span class="line"><span class="keyword">if</span>(z == <span class="number">1</span>)&#123;</span><br><span class="line">x = getInt(); y = getInt();</span><br><span class="line">Add(<span class="number">0</span>,x,<span class="number">1</span>); Add(<span class="number">0</span>,y+<span class="number">1</span>,<span class="number">-1</span>);</span><br><span class="line">Add(<span class="number">1</span>,x,x); Add(<span class="number">1</span>,y+<span class="number">1</span>,-y<span class="number">-1</span>);</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">y = getInt(); x = y;</span><br><span class="line"><span class="keyword">int</span> res = (y+<span class="number">1</span>)*ask(<span class="number">0</span>,y) - ask(<span class="number">1</span>,y) - x*ask(<span class="number">0</span>,x<span class="number">-1</span>) + ask(<span class="number">1</span>,x<span class="number">-1</span>);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%d\n"</span>,res&amp;<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h4 id="æ‰“é¼¹é¼ "><a href="#æ‰“é¼¹é¼ " class="headerlink" title="æ‰“é¼¹é¼ *"></a>æ‰“é¼¹é¼ *</h4><p><strong>é¢˜æ„ç®€è¿°</strong><br>è¿™æ˜¯ä¸€é“æ¨¡æ¿é¢˜ã€‚<br>ç»™å‡ºä¸€ä¸ª nÃ—m çš„é›¶çŸ©é˜µ Aï¼Œä½ éœ€è¦å®Œæˆå¦‚ä¸‹æ“ä½œï¼š<br>1 x y kï¼šè¡¨ç¤ºå…ƒç´  Ax,yè‡ªå¢ kï¼›<br>2 a b c dï¼šè¡¨ç¤ºè¯¢é—®å·¦ä¸Šè§’ä¸º (a,b)ï¼Œå³ä¸‹è§’ä¸º (c,d) çš„å­çŸ©é˜µå†…æ‰€æœ‰æ•°çš„å’Œã€‚</p><p><strong>è§£é¢˜æ€è·¯</strong><br>æ˜¯äºŒç»´æ ‘çŠ¶æ•°ç»„æ¨¡æ¿é¢˜ï¼Œä½†æ˜¯ç©ºé—´å¡çš„å¾ˆç´§ï¼Œå¼€åˆ°N = 5000å°±é™©è¿‡ï¼Œå¼€åˆ°N = (1&lt;&lt;12)+10å°±å¥½äº†ä¸€ç‚¹ã€‚<br>å’Œvijosé‚£ä¸ªåŸé¢˜ä¸åŒï¼Œæ•°æ®ä¸ä¸€æ ·ï¼ŒèŒƒå›´ä¹Ÿä¸ä¸€æ ·ï¼Œè¿™é¢˜ä¸ä¼šå‡ºç°ä¸‹æ ‡ä¸º0çš„æƒ…å†µã€‚å°±æ³¨æ„ä¸€ä¸‹äºŒç»´æ›´æ–°å’ŒæŸ¥è¯¢æ—¶ï¼Œæ¯æ¬¡çš„yéœ€è¦æ¢å¤åŸå€¼å³å¯ï¼Œå› æ­¤éœ€è¦ç”¨ä¸ªå˜é‡å­˜æ”¾ä¸€ä¸‹yåˆå€¼ã€‚</p><p><strong>ä»£ç ç¤ºä¾‹</strong><br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = (<span class="number">1</span>&lt;&lt;<span class="number">12</span>)+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll;</span><br><span class="line">ll c[N][N]; </span><br><span class="line"><span class="keyword">int</span> n ,m;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">getInt</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">int</span> ans = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">bool</span> neg = <span class="literal">false</span>;</span><br><span class="line"><span class="keyword">char</span> c = getchar();</span><br><span class="line"><span class="keyword">while</span> (c!=<span class="string">'-'</span> &amp;&amp; (c&lt;<span class="string">'0'</span> || c&gt;<span class="string">'9'</span>)) c = getchar();</span><br><span class="line"><span class="keyword">if</span> (c == <span class="string">'-'</span>) neg = <span class="literal">true</span>, c = getchar();</span><br><span class="line"><span class="keyword">while</span> (c&gt;=<span class="string">'0'</span> &amp;&amp; c&lt;=<span class="string">'9'</span>)</span><br><span class="line">ans = ans*<span class="number">10</span> + c-<span class="string">'0'</span>, c = getchar();</span><br><span class="line"><span class="keyword">return</span> neg ? -ans : ans; </span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Add</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> y,<span class="keyword">int</span> z)</span></span>&#123;</span><br><span class="line"><span class="comment">//printf("%d %d %d\n",x,y,z);</span></span><br><span class="line"><span class="keyword">for</span>(;x &lt;= n;x += x&amp;-x)</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> ty = y;ty &lt;= m;ty += ty&amp;-ty) c[x][ty] += z;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">ll <span class="title">ask</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> y)</span></span>&#123;</span><br><span class="line">ll res = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span>(;x;x -= x&amp;-x)</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> ty = y;ty;ty -= ty&amp;-ty) res += c[x][ty];</span><br><span class="line"><span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">int</span> a,b,c,d,x,y,k,op;</span><br><span class="line"><span class="comment">//freopen("123.txt","r",stdin);</span></span><br><span class="line">n = getInt(); m = getInt();</span><br><span class="line"><span class="keyword">while</span>(<span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;op) != EOF)&#123;</span><br><span class="line"><span class="keyword">if</span>(op == <span class="number">1</span>)&#123;</span><br><span class="line">x = getInt(); y = getInt(); k = getInt();</span><br><span class="line">Add(x,y,k);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">a = getInt(); b = getInt(); c = getInt();d = getInt();</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%lld\n"</span>,ask(c,d)-ask(c,b<span class="number">-1</span>)-ask(a<span class="number">-1</span>,d)+ask(a<span class="number">-1</span>,b<span class="number">-1</span>));</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;a href=&quot;http://ybt.ssoier.cn:8088/index.php&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;ä¹¦æœ¬é…å¥—OJ&lt;/a&gt;&lt;br&gt;&lt;a href=&quot;http://www.mfstem.org/contests&quot; targe
      
    
    </summary>
    
      <category term="ACMé¢˜è§£" scheme="http://valenshi.top/categories/ACM%E9%A2%98%E8%A7%A3/"/>
    
    
      <category term="æ ‘çŠ¶æ•°ç»„" scheme="http://valenshi.top/tags/%E6%A0%91%E7%8A%B6%E6%95%B0%E7%BB%84/"/>
    
      <category term="äºŒç»´æ ‘çŠ¶æ•°ç»„" scheme="http://valenshi.top/tags/%E4%BA%8C%E7%BB%B4%E6%A0%91%E7%8A%B6%E6%95%B0%E7%BB%84/"/>
    
      <category term="æ ‘çŠ¶æ•°ç»„åŒºé—´ä¿®æ”¹" scheme="http://valenshi.top/tags/%E6%A0%91%E7%8A%B6%E6%95%B0%E7%BB%84%E5%8C%BA%E9%97%B4%E4%BF%AE%E6%94%B9/"/>
    
  </entry>
  
  <entry>
    <title>ACè‡ªåŠ¨æœºé¢˜é›†</title>
    <link href="http://valenshi.top/2019/10/06/ac-problems/"/>
    <id>http://valenshi.top/2019/10/06/ac-problems/</id>
    <published>2019-10-06T03:21:35.000Z</published>
    <updated>2019-10-06T03:22:54.780Z</updated>
    
    <content type="html"><![CDATA[<h4 id="Keywords-Search"><a href="#Keywords-Search" class="headerlink" title="Keywords Search"></a>Keywords Search</h4><p><strong>é¢˜æ„æè¿°</strong><br>åŸé¢˜æ¥è‡ªï¼šHDU 2222<br>ç»™å®š n ä¸ªé•¿åº¦ä¸è¶…è¿‡ 50 çš„ç”±å°å†™è‹±æ–‡å­—æ¯ç»„æˆçš„å•è¯å‡†å¤‡æŸ¥è¯¢ï¼Œä»¥åŠä¸€ç¯‡é•¿ä¸º m çš„æ–‡ç« ï¼Œé—®ï¼šæ–‡ä¸­å‡ºç°äº†å¤šå°‘ä¸ªå¾…æŸ¥è¯¢çš„å•è¯ã€‚å¤šç»„æ•°æ®ã€‚<br><strong>è§£é¢˜æ€è·¯</strong><br>æ¨¡æ¿é¢˜<br><strong>ä»£ç ç¤ºä¾‹</strong></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1e4</span>+<span class="number">10</span>;<span class="comment">//æ¨¡å¼ä¸²ä¸ªæ•° </span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> M = <span class="number">1e6</span>+<span class="number">10</span>;<span class="comment">//æ–‡æœ¬ä¸²é•¿åº¦ </span></span><br><span class="line"></span><br><span class="line"><span class="keyword">char</span> str[N][<span class="number">50</span>],s[M];</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> SZ = <span class="number">50</span>*N;<span class="comment">//trieèŠ‚ç‚¹æ•° </span></span><br><span class="line"><span class="keyword">int</span> trie[SZ][<span class="number">30</span>],End[SZ],tot ;</span><br><span class="line"><span class="keyword">int</span> fail[SZ];<span class="comment">//å¤±é…æŒ‡é’ˆ,ç±»ä¼¼äºnex</span></span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="built_in">memset</span>(trie,<span class="number">0</span>,<span class="keyword">sizeof</span> trie);</span><br><span class="line"><span class="built_in">memset</span>(End,<span class="number">0</span>,<span class="keyword">sizeof</span> End); tot = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Insert</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span>* s)</span></span>&#123;</span><br><span class="line"><span class="comment">/* å‘trieæ ‘ä¸­æ’å…¥å­—ç¬¦ä¸²s */</span> </span><br><span class="line"><span class="keyword">int</span> len = <span class="built_in">strlen</span>(s), p = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; len;i++)&#123;</span><br><span class="line"><span class="keyword">int</span> ch = s[i]-<span class="string">'a'</span>;</span><br><span class="line"><span class="keyword">if</span>(!trie[p][ch]) trie[p][ch] = ++tot;</span><br><span class="line">p = trie[p][ch];</span><br><span class="line">&#125;</span><br><span class="line">End[p]++;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">queue</span>&lt;<span class="keyword">int</span>&gt; q;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">getFail</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="comment">/*åˆ©ç”¨bfsæ›´æ–°failæ•°ç»„*/</span> </span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; <span class="number">26</span>;i++) trie[<span class="number">0</span>][i] = <span class="number">1</span>;</span><br><span class="line">q.push(<span class="number">1</span>); fail[<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span>(!q.empty())&#123;</span><br><span class="line"><span class="keyword">int</span> p = q.front(); q.pop();</span><br><span class="line"><span class="comment">//printf("%d\n",q.size());</span></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; <span class="number">26</span>;i++)&#123;</span><br><span class="line"><span class="keyword">if</span>(!trie[p][i]) trie[p][i] = trie[fail[p]][i];</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">q.push(trie[p][i]);</span><br><span class="line">fail[trie[p][i]] = trie[fail[p]][i];</span><br><span class="line">&#125; </span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> ans = <span class="number">0</span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ask</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> *s)</span></span>&#123;</span><br><span class="line"><span class="comment">/* ç»Ÿè®¡åŒ¹é…æˆåŠŸçš„æ¨¡å¼ä¸²ä¸ªæ•°å¹¶ç´¯åŠ åˆ°ansä¸Š */</span> </span><br><span class="line"><span class="keyword">int</span> len = <span class="built_in">strlen</span>(s), p = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; len;i++)&#123;</span><br><span class="line"><span class="keyword">int</span> ch = s[i]-<span class="string">'a'</span>;</span><br><span class="line"><span class="keyword">int</span> k = trie[p][ch];</span><br><span class="line"><span class="keyword">while</span>(k &gt; <span class="number">1</span>)&#123;</span><br><span class="line">ans += End[k]; End[k] = <span class="number">0</span>;</span><br><span class="line">k = fail[k];</span><br><span class="line">&#125;</span><br><span class="line">p = trie[p][ch];</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> t,n;<span class="comment">//æ•°ç»„ç»„æ•°, æ¨¡å¼ä¸²ä¸ªæ•° </span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++) Insert(str[i]);</span><br><span class="line">getFail(); ans = <span class="number">0</span>;</span><br><span class="line">ask(s);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%d\n"</span>,ans);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;t);</span><br><span class="line"><span class="keyword">while</span>(t--)&#123;</span><br><span class="line">init();<span class="comment">//å¤šç»„æ•°æ®ä¸è¦å¿˜äº†åˆå§‹åŒ–ï¼ </span></span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;n);</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++) <span class="built_in">scanf</span>(<span class="string">"%s"</span>,str[i]);</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%s"</span>,s);</span><br><span class="line">solve();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ç„æ­¦å¯†ç "><a href="#ç„æ­¦å¯†ç " class="headerlink" title="ç„æ­¦å¯†ç "></a>ç„æ­¦å¯†ç </h4><p><strong>é¢˜æ„æè¿°</strong></p><p>åŸé¢˜æ¥è‡ªï¼šJSOI 2012<br>åœ¨ç¾ä¸½çš„ç„æ­¦æ¹–ç•”ï¼Œé¸¡é¸£å¯ºè¾¹ï¼Œé¸¡ç¬¼å±±å‰ï¼Œæœ‰ä¸€å—å¯Œé¥¶è€Œç§€ç¾çš„åœŸåœ°ï¼Œäººä»¬å”¤ä½œè¿›é¦™æ²³ã€‚ç›¸ä¼ ä¸€æ—¥ï¼Œä¸€ç¼•ç´«æ°”ä»å¤©è€Œè‡³ï¼Œåªä¸€ç¬é—´ä¾¿æ¶ˆå¤±åœ¨äº†è¿›é¦™æ²³ä¸­ã€‚è€äººä»¬è¯´ï¼Œè¿™æ˜¯ç„æ­¦ç¥çµå°†å¤©ä¹¦è—åŒ¿åœ¨æ­¤ã€‚å¾ˆå¤šå¹´åï¼Œäººä»¬ç»ˆäºåœ¨è¿›é¦™æ²³åœ°åŒºå‘ç°äº†å¸¦æœ‰ç„æ­¦å¯†ç çš„æ–‡å­—ã€‚æ›´åŠ ç¥å¥‡çš„æ˜¯ï¼Œè¿™ä»½å¸¦æœ‰ç„æ­¦å¯†ç çš„æ–‡å­—ï¼Œä¸ç„æ­¦æ¹–å—å²¸å°åŸçš„ç»“æ„æœ‰å¾®å¦™çš„å…³è”ã€‚äºæ˜¯ï¼Œæ¼«é•¿çš„ç ´è¯‘å·¥ä½œå¼€å§‹äº†ã€‚<br>ç»è¿‡åˆ†æï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ä¸œå—è¥¿åŒ—å››ä¸ªæ–¹å‘æ¥æè¿°å°åŸåŸç –çš„æ‘†æ”¾ï¼Œä¸å¦¨ç”¨ä¸€ä¸ªé•¿åº¦ä¸º N çš„åºåˆ—æ¥æè¿°ï¼Œåºåˆ—ä¸­çš„å…ƒç´ åˆ†åˆ«æ˜¯ Eï¼ŒSï¼ŒWï¼ŒNï¼Œä»£è¡¨äº†ä¸œå—è¥¿åŒ—å››å‘ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºæ¯ä¸²ã€‚è€Œç¥ç§˜çš„ç„æ­¦å¯†ç æ˜¯ç”±å››è±¡çš„å›¾æ¡ˆæè¿°è€Œæˆçš„ M æ®µæ–‡å­—ã€‚<br>ç°åœ¨ï¼Œè€ƒå¤å·¥ä½œè€…é‡åˆ°äº†ä¸€ä¸ªéš¾é¢˜ã€‚å¯¹äºæ¯ä¸€æ®µæ–‡å­—ï¼Œå…¶å‰ç¼€åœ¨æ¯ä¸²ä¸Šçš„æœ€å¤§åŒ¹é…é•¿åº¦æ˜¯å¤šå°‘å‘¢ï¼Ÿ</p><p><strong>è§£é¢˜æ€è·¯</strong><br>æ±‚æ¯ä¸ªå­ä¸²åœ¨æ¯ä¸²ä¸Šçš„æœ€å¤§åŒ¹é…é•¿åº¦ã€‚å¦‚æœæŒ¨ä¸ªç”¨å­ä¸²æ¥åŒ¹é…æ¯ä¸²ï¼Œå¤æ‚åº¦å¤ªé«˜ï¼Œæ‰€ä»¥è¦ç”¨ACè‡ªåŠ¨æœºï¼Œä»¥æ¯ä¸²æ¥åŒ¹é…å­ä¸²ã€‚<br>å°†æ¯ä¸²åœ¨å»ºç«‹å¥½çš„ACè‡ªåŠ¨æœºä¸Šè¿›è¡ŒåŒ¹é…ï¼Œé‚£ä¹ˆå…¶æ‰€èƒ½åˆ°è¾¾çš„èŠ‚ç‚¹ï¼Œå°±æ˜¯å¯ä»¥å’Œæ¯ä¸²åŒ¹é…çš„é•¿åº¦ï¼Œæ‰€ä»¥æˆ‘ä»¬æ¯åˆ°ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå°±å¯¹å…¶è¿›è¡Œæ ‡è®°ï¼Œé¡ºä¾¿ä¹Ÿå¯¹å…¶failæŒ‡é’ˆæ‰€æŒ‡å‘çš„èŠ‚ç‚¹æ ‡è®°ï¼Œé‚£ä¹ˆæœ€åä¸€ä¸ªè¢«æ ‡è®°çš„èŠ‚ç‚¹ï¼Œå°±æ˜¯è¯¥å­ä¸²æ‰€èƒ½åŒ¹é…çš„æœ€å¤§é•¿åº¦ã€‚</p><p>é‚£ä¹ˆæˆ‘ä»¬å¦‚ä½•æ‰¾åˆ°æœ€åä¸€ä¸ªè¢«æ ‡è®°çš„èŠ‚ç‚¹å‘¢ï¼Ÿé€šè¿‡paræ•°ç»„ï¼Œpar[x]å­˜æ”¾xçš„çˆ¶äº²èŠ‚ç‚¹çš„ç¼–å·ï¼Œå¦‚æ­¤å°±å¯ä»¥ä»åå‘å‰éå†äº†ï¼ˆä¸‹è¿°ä»£ç ä¸­æ˜¯nexæ•°ç»„ï¼‰ã€‚</p><p>æ‰€ä»¥å…·ä½“æ­¥éª¤æœ‰ä¸‰æ­¥ï¼š</p><ul><li>æ ¹æ®æ‰€æœ‰å­ä¸²å»ºç«‹ACè‡ªåŠ¨æœºï¼ŒåŒæ—¶æ›´æ–°paræ•°ç»„(ä»£ç ä¸­æ˜¯nexæ•°ç»„)</li><li>åˆ©ç”¨æ¯ä¸²å¯¹è‡ªåŠ¨æœºä¸ŠèŠ‚ç‚¹è¿›è¡Œæ ‡è®°</li><li>åˆ©ç”¨paræ•°ç»„è‡ªåº•å‘ä¸ŠæŸ¥æ‰¾æœ€åä¸€ä¸ªè¢«æ ‡è®°çš„èŠ‚ç‚¹ï¼Œè¯¥èŠ‚ç‚¹åˆ°æ ¹èŠ‚ç‚¹çš„è·¯å¾„é•¿åº¦å°±æ˜¯ä¸æ¯ä¸²æœ€å¤§åŒ¹é…ï¼Œä¸ºæ­¤æˆ‘ä»¬è¿˜éœ€è¦è®°å½•æ¯ä¸ªå­—ä¸²ç»“æŸæ—¶çš„èŠ‚ç‚¹ç¼–å·End[id]ï¼Œä»¥åŠé•¿åº¦Len[id]</li></ul><p><strong>ä»£ç ç¤ºä¾‹</strong><br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1e7</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> M = <span class="number">1e5</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">char</span> s[N],str[M][<span class="number">110</span>];</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> SZ = M*<span class="number">10</span>;</span><br><span class="line"><span class="keyword">int</span> trie[SZ][<span class="number">5</span>], tot = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">int</span> fail[SZ],vis[SZ],End[SZ],nex[SZ];</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">getIdx</span><span class="params">(<span class="keyword">char</span> ch)</span></span>&#123;</span><br><span class="line"><span class="keyword">if</span>(ch == <span class="string">'E'</span>) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span>(ch == <span class="string">'S'</span>) <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span>(ch == <span class="string">'W'</span>) <span class="keyword">return</span> <span class="number">3</span>;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">Insert</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span>* s)</span></span>&#123;</span><br><span class="line"><span class="keyword">int</span> len = <span class="built_in">strlen</span>(s), p = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; len;i++)&#123;</span><br><span class="line"><span class="keyword">int</span> ch = getIdx(s[i]);</span><br><span class="line"><span class="keyword">if</span>(!trie[p][ch]) trie[p][ch] = ++tot,nex[tot] = p;</span><br><span class="line">p = trie[p][ch];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> p;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">queue</span>&lt;<span class="keyword">int</span>&gt; q;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">getFail</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; <span class="number">4</span>;i++) trie[<span class="number">0</span>][i] = <span class="number">1</span>;</span><br><span class="line">q.push(<span class="number">1</span>); fail[<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span>(!q.empty())&#123;</span><br><span class="line"><span class="keyword">int</span> p = q.front(); q.pop();</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; <span class="number">4</span>;i++)&#123;</span><br><span class="line"><span class="keyword">if</span>(!trie[p][i]) trie[p][i] = trie[fail[p]][i];</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">q.push(trie[p][i]);</span><br><span class="line">fail[trie[p][i]] = trie[fail[p]][i];</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Mark</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> *s)</span></span>&#123;</span><br><span class="line"><span class="keyword">int</span> len = <span class="built_in">strlen</span>(s), p = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; len;i++)&#123;</span><br><span class="line"><span class="keyword">int</span> ch = getIdx(s[i]);</span><br><span class="line"><span class="keyword">int</span> k = trie[p][ch];</span><br><span class="line"><span class="keyword">while</span>(k &gt; <span class="number">1</span>)&#123;</span><br><span class="line"><span class="keyword">if</span>(vis[k]) <span class="keyword">break</span>;</span><br><span class="line">vis[k] = <span class="number">1</span>; k = fail[k];</span><br><span class="line">&#125;</span><br><span class="line">p = trie[p][ch];</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> n,m;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">search</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line"><span class="keyword">int</span> len = <span class="built_in">strlen</span>(str[x]);</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = End[x];i &gt; <span class="number">1</span>;i = nex[i],len--) <span class="keyword">if</span>(vis[i]) <span class="keyword">break</span>;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%d\n"</span>,len);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= m;i++) End[i] = Insert(str[i]);</span><br><span class="line">getFail();</span><br><span class="line">Mark(s);</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= m;i++) search(i);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;n,&amp;m);</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%s"</span>,s);</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= m;i++) <span class="built_in">scanf</span>(<span class="string">"%s"</span>,str[i]);</span><br><span class="line">solve();</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h4 id="Censoring"><a href="#Censoring" class="headerlink" title="Censoring"></a>Censoring</h4><p><strong>é¢˜æ„ç®€è¿°</strong><br>åŸé¢˜æ¥è‡ªï¼šUSACO 2015 Feb. Gold<br>æœ‰ä¸€ä¸ªé•¿åº¦ä¸è¶…è¿‡ 105 çš„å­—ç¬¦ä¸² Sã€‚Farmer John å¸Œæœ›åœ¨ S ä¸­åˆ æ‰ n ä¸ªå±è”½è¯ï¼ˆä¸€ä¸ªå±è”½è¯å¯èƒ½å‡ºç°å¤šæ¬¡ï¼‰ï¼Œè¿™äº›è¯è®°ä¸º t1âˆ¼tnã€‚FJ åœ¨ S ä¸­ä»å¤´å¼€å§‹å¯»æ‰¾å±è”½è¯ï¼Œä¸€æ—¦æ‰¾åˆ°ä¸€ä¸ªå±è”½è¯ï¼ŒFJ å°±åˆ é™¤å®ƒï¼Œç„¶ååˆä»å¤´å¼€å§‹å¯»æ‰¾ï¼ˆè€Œä¸æ˜¯æ¥ç€å¾€ä¸‹æ‰¾ï¼‰ã€‚<br>FJ ä¼šé‡å¤è¿™ä¸€è¿‡ç¨‹ï¼Œç›´åˆ° S ä¸­æ²¡æœ‰å±è”½è¯ä¸ºæ­¢ã€‚æ³¨æ„åˆ é™¤ä¸€ä¸ªå•è¯åå¯èƒ½ä¼šå¯¼è‡´ S ä¸­å‡ºç°å¦ä¸€ä¸ªå±è”½è¯ã€‚<br>è¿™ n ä¸ªå±è”½è¯ä¸ä¼šå‡ºç°ä¸€ä¸ªå•è¯æ˜¯å¦ä¸€ä¸ªå•è¯å­ä¸²çš„æƒ…å†µï¼Œè¿™æ„å‘³ç€æ¯ä¸ªå±è”½è¯åœ¨ S ä¸­å‡ºç°çš„å¼€å§‹ä½ç½®æ˜¯äº’ä¸ç›¸åŒçš„ï¼Œè¯·å¸®åŠ© FJ å®Œæˆè¿™äº›æ“ä½œå¹¶è¾“å‡ºæœ€åçš„ Sã€‚<br><strong>è§£é¢˜æ€è·¯</strong><br>å¯ä»¥ç”¨KM+æ ˆæ¥è§£å†³ï¼Œè¿™é‡Œç”¨ACè‡ªåŠ¨æœºè§£å†³ã€‚<br>å¾ˆå®¹æ˜“æƒ³åˆ°çš„ä¸€ä¸ªæ€è·¯å°±æ˜¯ï¼Œå»ºç«‹å¥½ACè‡ªåŠ¨æœºåï¼Œä»æ ¹èŠ‚ç‚¹å¼€å§‹åŒ¹é…ï¼Œå¦‚æœåŒ¹é…åˆ°å¶å­èŠ‚ç‚¹ï¼Œå³æœ‰Endæ ‡è®°çš„èŠ‚ç‚¹ï¼Œå°±è¯´æ˜å½“å‰å­—ä¸²æ˜¯å±è”½è¯ï¼Œåˆ æ‰å®ƒï¼Œå‡è®¾è¯¥å­ä¸²é•¿ä¸º len ï¼Œé‚£å°±å°†æŒ‡é’ˆ p å›é€€åˆ° len æ­¥ä¹‹å‰ï¼Œç»§ç»­åŒ¹é…ã€‚<br>å¦‚æ­¤ä¸€æ¥æˆ‘ä»¬éœ€è¦è®°å½•æ¯ä¸ªæ—¶åˆ»çš„pæŒ‡é’ˆï¼Œä»¥åŠæ¯ä¸²ä¸­ä¿ç•™çš„å­—ç¬¦ï¼Œç”¨æ ˆå°±å¯ä»¥å¾ˆå¥½çš„ç»´æŠ¤ã€‚å¦‚æœå±è”½è¯åŒ¹é…æˆåŠŸï¼Œé•¿åº¦ä¸º lenï¼Œé‚£ä¹ˆæ¯ä¸²ä¸­ä¿ç•™çš„å­—ç¬¦ä»æ ˆé¡¶å¼¹å‡º len ä¸ªï¼ŒåŒæ—¶ä¿å­˜ p çš„æ ˆä¹Ÿå¼¹å‡º len ä¸ªå…ƒç´ ï¼Œæ ˆé¡¶å…ƒç´ å°±æ˜¯ len æ­¥ä¹‹å‰çš„æŒ‡é’ˆã€‚</p><p><strong>ä»£ç ç¤ºä¾‹</strong></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1e5</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> SZ = <span class="number">1e6</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">char</span> str[N], s[N];</span><br><span class="line"><span class="keyword">int</span> n, fail[SZ];</span><br><span class="line"><span class="keyword">int</span> trie[SZ][<span class="number">30</span>],tot = <span class="number">1</span>,End[SZ];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Insert</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span>* s)</span></span>&#123;</span><br><span class="line"><span class="keyword">int</span> len = <span class="built_in">strlen</span>(s), p = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; len;i++)&#123;</span><br><span class="line"><span class="keyword">int</span> ch = s[i]-<span class="string">'a'</span>;</span><br><span class="line"><span class="keyword">if</span>(!trie[p][ch]) trie[p][ch] = ++tot;</span><br><span class="line">p = trie[p][ch];</span><br><span class="line">&#125;</span><br><span class="line">End[p] = len;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">queue</span>&lt;<span class="keyword">int</span>&gt; q;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">getFail</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; <span class="number">26</span>;i++) trie[<span class="number">0</span>][i] = <span class="number">1</span>;</span><br><span class="line">q.push(<span class="number">1</span>); fail[<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span>(!q.empty())&#123;</span><br><span class="line"><span class="keyword">int</span> p = q.front(); q.pop();</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; <span class="number">26</span>;i++)&#123;</span><br><span class="line"><span class="keyword">if</span>(!trie[p][i]) trie[p][i] = trie[fail[p]][i];</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">q.push(trie[p][i]); </span><br><span class="line">fail[trie[p][i]] = trie[fail[p]][i];</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">char</span> path[N];</span><br><span class="line"><span class="keyword">int</span> top = <span class="number">0</span>,Stack[N];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span></span>&#123;</span><br><span class="line">getFail();<span class="comment">//ä¸ºä»€ä¹ˆéè¦æ›´æ–°Failæ•°ç»„å‘¢ </span></span><br><span class="line"><span class="keyword">int</span> len = <span class="built_in">strlen</span>(str);</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>,p = <span class="number">1</span>;i &lt; len;i++)&#123;</span><br><span class="line"><span class="keyword">int</span> ch = str[i]-<span class="string">'a'</span>;</span><br><span class="line">p = trie[p][ch];</span><br><span class="line">Stack[++top] = p; path[top] = str[i];</span><br><span class="line"><span class="keyword">if</span>(End[p]) top -= End[p], p = Stack[top];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= top;i++) <span class="built_in">putchar</span>(path[i]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%s"</span>,str);</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;n);</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++)&#123;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%s"</span>,s); Insert(s);</span><br><span class="line">&#125;</span><br><span class="line">solve();</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="å•è¯"><a href="#å•è¯" class="headerlink" title="å•è¯"></a>å•è¯</h4><p><strong>é¢˜æ„ç®€è¿°</strong><br>åŸé¢˜æ¥è‡ªï¼šTJOI 2013<br>æŸäººè¯»è®ºæ–‡ï¼Œä¸€ç¯‡è®ºæ–‡æ˜¯ç”±è®¸å¤šå•è¯ç»„æˆã€‚ä½†ä»–å‘ç°ä¸€ä¸ªå•è¯ä¼šåœ¨è®ºæ–‡ä¸­å‡ºç°å¾ˆå¤šæ¬¡ï¼Œç°åœ¨æƒ³çŸ¥é“æ¯ä¸ªå•è¯åˆ†åˆ«åœ¨è®ºæ–‡ä¸­å‡ºç°å¤šå°‘æ¬¡ã€‚<br><strong>è§£é¢˜æ€è·¯</strong><br>è¿™ä¸ªæ–‡ç« æ˜¯ç”±è¿™ n ä¸ªå•è¯ç»„æˆçš„ï¼Œç°åœ¨é—®æ¯ä¸ªå•è¯å‡ºç°å¤šå°‘æ¬¡ã€‚ç›´æ¥ç”¨æ¯ä¸²åœ¨failæ ‘ä¸ŠåŒ¹é…ç»Ÿè®¡ç›¸åŒå‰ç¼€ä¸ªæ•°æ˜¯ä¸å¯¹çš„ï¼Œå› ä¸ºè¿™æ ·å¯èƒ½å‡ºç°ä¸¤ä¸ªå­ä¸²çš„é‡å ã€‚æ ¹æ®ACè‡ªåŠ¨æœºçš„ç‰¹ç‚¹å•Šï¼Œå¦‚æœæœ‰ä¸ªèŠ‚ç‚¹ x çš„ fail æŒ‡é’ˆæŒ‡å‘ yï¼Œé‚£ä¹ˆè¯´æ˜ y æ˜¯ x çš„å‰ç¼€ï¼Œå³ y æ˜¯ x çš„å­ä¸²ï¼Œé‚£ä¹ˆè‡ªç„¶æœ‰å¤šå°‘ä¸ª fail æŒ‡é’ˆæŒ‡å‘ yï¼Œyå°±å‡ºç°äº†å¤šå°‘æ¬¡ï¼Œè€Œè¿™ä¸ªæ¬¡æ•°å°±æ˜¯æˆ‘ä»¬è¦æ±‚çš„å•è¯å‡ºç°çš„æ¬¡æ•°ã€‚</p><p>é‚£ä¹ˆé¦–å…ˆè¦è®°å½•ACè‡ªåŠ¨æœºä¸Šæ¯ä¸ªèŠ‚ç‚¹å‡ºç°çš„æ¬¡æ•°ï¼Œå› ä¸ºå•è¯å¯èƒ½å‡ºç°é‡å¤ã€‚ç„¶åè¦è®°å½•ç»“æŸæ—¶è¯¥å­ä¸²å¯¹åº”çš„èŠ‚ç‚¹ç¼–å·ï¼ŒEnd[id] = pï¼›ç”±äºæˆ‘ä»¬ fail æŒ‡é’ˆæ˜¯ä»ä¸Šåˆ°ä¸‹æ›´æ–°çš„ï¼Œè€Œæˆ‘ä»¬è¦ç»Ÿè®¡æ¬¡æ•°éœ€è¦ä»ä¸‹åˆ°ä¸Šè½¬ç§»ï¼Œäºæ˜¯åˆ©ç”¨æ ˆæ¥å­˜å‚¨ fail æŒ‡é’ˆè½¬ç§»æ—¶çš„èŠ‚ç‚¹ç¼–å·ï¼Œè€Œåå†æ›´æ–° num æ•°ç»„å³å¯ã€‚<br><strong>ä»£ç ç¤ºä¾‹</strong></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">220</span>;</span><br><span class="line"><span class="built_in">string</span> str[N], s;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> SZ = <span class="number">1e6</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">int</span> trie[SZ][<span class="number">30</span>],End[SZ],tot = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">int</span> num[SZ];<span class="comment">// num[x] ä¸ºç»è¿‡èŠ‚ç‚¹xçš„æ•°é‡ </span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Insert</span><span class="params">(<span class="keyword">const</span> <span class="built_in">string</span>&amp; s,<span class="keyword">const</span> <span class="keyword">int</span>&amp; id)</span></span>&#123;</span><br><span class="line"><span class="keyword">int</span> len = s.length(), p = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; len;i++)&#123;</span><br><span class="line"><span class="keyword">int</span> ch = s[i]-<span class="string">'a'</span>;</span><br><span class="line"><span class="keyword">if</span>(!trie[p][ch]) trie[p][ch] = ++tot;</span><br><span class="line">p = trie[p][ch];</span><br><span class="line">num[p]++;</span><br><span class="line">&#125;</span><br><span class="line">End[id] = p; </span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">queue</span>&lt;<span class="keyword">int</span>&gt; q;</span><br><span class="line"><span class="keyword">int</span> fail[SZ];</span><br><span class="line"><span class="keyword">int</span> Stack[SZ], top = <span class="number">0</span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">getFail</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; <span class="number">26</span>;i++) trie[<span class="number">0</span>][i] = <span class="number">1</span>;</span><br><span class="line">q.push(<span class="number">1</span>); fail[<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span>(!q.empty())&#123;</span><br><span class="line"><span class="keyword">int</span> p = q.front(); q.pop(); </span><br><span class="line">Stack[++top] = p;<span class="comment">//å€’åºè®°å½•ç¼–å· </span></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; <span class="number">26</span>;i++)&#123;</span><br><span class="line"><span class="keyword">if</span>(!trie[p][i]) trie[p][i] = trie[fail[p]][i];</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">q.push(trie[p][i]);</span><br><span class="line">fail[trie[p][i]] = trie[fail[p]][i];</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> n;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++) Insert(str[i],i);</span><br><span class="line">getFail();</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = top;i &gt; <span class="number">0</span>;--i)&#123;</span><br><span class="line">num[fail[Stack[i]]] += num[Stack[i]];</span><br><span class="line">&#125; </span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++) <span class="built_in">cout</span> &lt;&lt; num[End[i]] &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="comment">//freopen("123.txt","r",stdin);</span></span><br><span class="line"><span class="built_in">cin</span> &gt;&gt; n;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++) <span class="built_in">cin</span> &gt;&gt; str[i];</span><br><span class="line">solve(); </span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æœ€çŸ­æ¯ä¸²"><a href="#æœ€çŸ­æ¯ä¸²" class="headerlink" title="æœ€çŸ­æ¯ä¸²"></a>æœ€çŸ­æ¯ä¸²</h4><p><strong>é¢˜æ„æè¿°</strong><br>åŸé¢˜æ¥è‡ªï¼šHNOI 2006<br>ç»™å®š n ä¸ªå­—ç¬¦ä¸² S1,S2,â‹¯,Snï¼Œè¦æ±‚æ‰¾åˆ°ä¸€ä¸ªæœ€çŸ­çš„å­—ç¬¦ä¸² Tï¼Œä½¿å¾—è¿™ n ä¸ªå­—ç¬¦ä¸²éƒ½æ˜¯ T çš„å­ä¸²ã€‚<br><strong>è§£é¢˜æ€è·¯</strong><br>æ ¹æ®ç»éªŒå®¹æ˜“æƒ³åˆ°ï¼Œæ¯ä¸²è¦èµ°å®ŒACè‡ªåŠ¨æœºä¸Šæ‰€æœ‰ æœ‰ç»“æŸæ ‡è®°ï¼ˆEndæ ‡è®°ï¼‰çš„èŠ‚ç‚¹ï¼Œè€Œæœ¬é¢˜çš„ç­”æ¡ˆå°±æ˜¯æ‰¾åˆ°æœ€çŸ­çš„&amp;å­—å…¸åºæœ€å°çš„æ¯ä¸²ã€‚<br>é‚£æåˆ°ç»“æŸæ ‡è®° Endï¼Œå°±åº”è¯¥æƒ³åˆ° End æ ‡è®°çš„è½¬ç§»ï¼Œæˆ‘ä»¬åœ¨æ±‚failæ•°ç»„æ—¶é¡ºä¾¿è½¬ç§»ã€‚å¦‚æœæ¯ä¸ªç»“æŸæ ‡è®°éƒ½ç”¨ä¸åŒidæ ‡è¯†ï¼Œé‚£ä¹ˆæ¯ä¸²åªè¦èƒ½åŒ…å«æ‰€æœ‰ä¸åŒçš„ç»“æŸæ ‡è®°å³å¯ã€‚</p><p>æ—¢ç„¶åªæœ‰æœ€å¤š12ä¸ªå­ä¸²ï¼Œé‚£ä¹ˆå¯ä»¥è€ƒè™‘ç”¨çŠ¶æ€å‹ç¼©èŠ‚çœç©ºé—´ã€‚æˆ‘ä»¬ç”¨ bfs æ¥æ±‚æœ€çŸ­&amp;å­—å…¸åºæœ€å°æ¯ä¸²ã€‚<br>ç”±äºæ¯ä¸²æœ€é•¿600ï¼Œè€ŒACè‡ªåŠ¨æœºä¸ŠèŠ‚ç‚¹ä¸ªæ•°æœ€å¤š600ï¼Œä½†æ˜¯æ¯ä¸ªèŠ‚ç‚¹çŠ¶æ€æœ‰1&lt;&lt;12ç§ï¼Œå› æ­¤ <code>vis[606][(1&lt;&lt;12)+1]</code> ç”¨äºè¡¨ç¤ºè¯¥èŠ‚ç‚¹çš„å¯¹åº”çŠ¶æ€æ˜¯å¦è¢«è®¿é—®è¿‡ï¼› path[(1&lt;&lt;12)+1]ç”¨äºå­˜æ”¾ç”±ä¸Šä¸€ä¸ªçŠ¶æ€è½¬ç§»è€Œæ¥éœ€è¦æ·»åŠ çš„å­—ç¬¦ï¼›s[606]è‡ªç„¶å°±æ˜¯å­˜æ”¾æœ€ç»ˆæ¯ä¸²ã€‚<br>å½“ç„¶è¿˜éœ€è¦ä¸€äº›è¾…åŠ©æ•°ç»„ï¼Œpar[ ip ]è®°å½• ip çš„ä¸Šä¸€ä¸ªçŠ¶æ€çš„ç¼–å·ï¼Œç”¨äºæŸ¥æ‰¾è·¯å¾„ï¼›å½“ç„¶ç†è®ºä¸Šè®²pathä¹Ÿç®—è¾…åŠ©æ•°ç»„ã€‚<br>æ¥ä¸‹æ¥æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡bfsæ¥å®ç°ä¸åŒçŠ¶æ€é—´çš„è½¬ç§»äº†ï¼Œå®è´¨ä¸Šæ˜¯bfs+çŠ¶æ€å‹ç¼©ï¼Œå®ç°èµ·æ¥è¿˜æ˜¯æœ‰äº›éš¾åº¦çš„ã€‚</p><p><strong>ä»£ç ç¤ºä¾‹</strong><br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">60</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> SZ = <span class="number">600</span>+<span class="number">10</span>;<span class="comment">//ä¸€å®šè¦æƒ³å¥½å¤§å°å•Š </span></span><br><span class="line"><span class="keyword">char</span> str[N];</span><br><span class="line"><span class="keyword">int</span> n, fail[SZ];</span><br><span class="line"><span class="keyword">int</span> trie[SZ][<span class="number">30</span>], End[<span class="number">30</span>], tot = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">bool</span> vis[<span class="number">605</span>][(<span class="number">1</span>&lt;&lt;<span class="number">12</span>)+<span class="number">1</span>]; </span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Insert</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span>* s,<span class="keyword">int</span> id)</span></span>&#123;</span><br><span class="line"><span class="keyword">int</span> len = <span class="built_in">strlen</span>(s), p = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; len;i++)&#123;</span><br><span class="line"><span class="keyword">int</span> ch = s[i]-<span class="string">'A'</span>;</span><br><span class="line"><span class="keyword">if</span>(!trie[p][ch]) trie[p][ch] = ++tot;</span><br><span class="line">p = trie[p][ch]; </span><br><span class="line">&#125;</span><br><span class="line">End[p] |= <span class="number">1</span>&lt;&lt;id;<span class="comment">//çŠ¶å‹å¸¸ç”¨ </span></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">queue</span>&lt;<span class="keyword">int</span>&gt; q;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">getFail</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; <span class="number">26</span>;i++) trie[<span class="number">0</span>][i] = <span class="number">1</span>;</span><br><span class="line">q.push(<span class="number">1</span>); fail[<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span>(!q.empty())&#123;</span><br><span class="line"><span class="keyword">int</span> p = q.front(); q.pop();</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; <span class="number">26</span>;i++)&#123;</span><br><span class="line"><span class="keyword">if</span>(!trie[p][i]) trie[p][i] = trie[fail[p]][i];</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">q.push(trie[p][i]);</span><br><span class="line">fail[trie[p][i]] = trie[fail[p]][i];</span><br><span class="line">End[trie[p][i]] |= End[fail[trie[p][i]]];<span class="comment">//å¸¸ç”¨æŠ€å·§ </span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*ç”¨æ¥bfsè®¡ç®—æœ€çŸ­æ¯ä¸²*/</span></span><br><span class="line"><span class="keyword">char</span> path[<span class="number">606</span>*(<span class="number">1</span>&lt;&lt;<span class="number">12</span>)] ,s[<span class="number">606</span>];</span><br><span class="line"><span class="keyword">int</span> par[<span class="number">606</span>*(<span class="number">1</span>&lt;&lt;<span class="number">12</span>)],len = <span class="number">0</span>;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Node</span>&#123;</span></span><br><span class="line"><span class="comment">/*åˆ†åˆ«æ˜¯èŠ‚ç‚¹ç¼–å·,å½“å‰çŠ¶æ€,å½“å‰å­—ç¬¦ä½ç½® */</span> </span><br><span class="line"><span class="keyword">int</span> p,now,ip;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">queue</span>&lt;Node&gt; q2; </span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">bfs</span><span class="params">()</span></span>&#123;</span><br><span class="line">q2.push(Node&#123;<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>&#125;);</span><br><span class="line"><span class="keyword">int</span> cnt = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span>(!q2.empty())&#123;</span><br><span class="line">Node x = q2.front(); q2.pop();</span><br><span class="line"><span class="keyword">int</span> p = x.p,now = x.now,ip = x.ip;</span><br><span class="line"><span class="keyword">if</span>(now == (<span class="number">1</span>&lt;&lt;n)<span class="number">-1</span>)&#123;</span><br><span class="line"><span class="comment">/*æ‰€æœ‰å­ä¸²éƒ½åŒ…å«äº†,å¯ä»¥è¾“å‡ºç­”æ¡ˆäº†*/</span> </span><br><span class="line"><span class="keyword">for</span>(;ip;ip = par[ip]) s[len++] = path[ip];</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>,nex;i &lt; <span class="number">26</span>;i++)</span><br><span class="line"><span class="keyword">if</span>(!vis[trie[p][i]][nex = now|End[trie[p][i]]])&#123;</span><br><span class="line"><span class="comment">/*å½“å‰èŠ‚ç‚¹çš„ç¬¬iä¸ªå­—ç¬¦çš„ nex çŠ¶æ€æœªè¢«è®¿é—®è¿‡,è®¿é—®å¹¶å‹å…¥é˜Ÿåˆ—*/</span> </span><br><span class="line">vis[trie[p][i]][nex] = <span class="number">1</span>;</span><br><span class="line">path[++cnt] = i+<span class="string">'A'</span>, par[cnt] = ip;</span><br><span class="line"><span class="comment">/*å‹å…¥ä¸‹ä¸€ä¸ªèŠ‚ç‚¹çš„ç¼–å·,çŠ¶æ€,å­—ç¬¦ç»“æŸä½ç½®*/</span> </span><br><span class="line">q2.push(Node&#123;trie[p][i],nex,cnt&#125;);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span></span>&#123;</span><br><span class="line">getFail(); bfs();</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = len<span class="number">-1</span>;i &gt;= <span class="number">0</span>;i--) <span class="built_in">putchar</span>(s[i]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;n);</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++)&#123;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%s"</span>,str); Insert(str,i<span class="number">-1</span>); </span><br><span class="line">&#125;</span><br><span class="line">solve();</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h4 id="POI-2000-ç—…æ¯’"><a href="#POI-2000-ç—…æ¯’" class="headerlink" title="POI 2000 ç—…æ¯’"></a>POI 2000 ç—…æ¯’</h4><p><strong>é¢˜æ„ç®€è¿°</strong></p><p>äºŒè¿›åˆ¶ç—…æ¯’å®¡æŸ¥å§”å‘˜ä¼šæœ€è¿‘å‘ç°äº†å¦‚ä¸‹çš„è§„å¾‹ï¼šæŸäº›ç¡®å®šçš„äºŒè¿›åˆ¶ä¸²æ˜¯ç—…æ¯’çš„ä»£ç ã€‚å¦‚æœæŸæ®µä»£ç ä¸­ä¸å­˜åœ¨ä»»ä½•ä¸€æ®µç—…æ¯’ä»£ç ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±ç§°è¿™æ®µä»£ç æ˜¯å®‰å…¨çš„ã€‚ç°åœ¨å§”å‘˜ä¼šå·²ç»æ‰¾å‡ºäº†æ‰€æœ‰çš„ç—…æ¯’ä»£ç æ®µï¼Œè¯•é—®ï¼Œæ˜¯å¦å­˜åœ¨ä¸€ä¸ªæ— é™é•¿çš„å®‰å…¨çš„äºŒè¿›åˆ¶ä»£ç ã€‚<br>ç¤ºä¾‹ï¼šä¾‹å¦‚å¦‚æœ {011,11,00000} ä¸ºç—…æ¯’ä»£ç æ®µï¼Œé‚£ä¹ˆä¸€ä¸ªå¯èƒ½çš„æ— é™é•¿å®‰å…¨ä»£ç å°±æ˜¯ 010101â‹¯ã€‚å¦‚æœ {01,11,000000} ä¸ºç—…æ¯’ä»£ç æ®µï¼Œé‚£ä¹ˆå°±ä¸å­˜åœ¨ä¸€ä¸ªæ— é™é•¿çš„å®‰å…¨ä»£ç ã€‚<br>è¯·å†™ä¸€ä¸ªç¨‹åºï¼Œè¯»å…¥ç—…æ¯’ä»£ç ï¼Œåˆ¤æ–­æ˜¯å¦å­˜åœ¨ä¸€ä¸ªæ— é™é•¿çš„å®‰å…¨ä»£ç ï¼Œå°†ç»“æœè¾“å‡ºã€‚</p><p><strong>è§£é¢˜æ€è·¯</strong><br>æœ¬é¢˜è¦æ±‚æ‰¾å‡ºä¸€ä¸ªæ— é™é•¿çš„å®‰å…¨çš„ä»£ç ï¼Œæ— é™é•¿ï¼Œå½“ä¸”ä»…å½“æˆ‘ä»¬æœ‰ä¸€ä¸ªå®‰å…¨çš„å­ä¸²å¯ä»¥å¾ªç¯ä½¿ç”¨æ—¶æ‰èƒ½æ„æˆã€‚æˆ‘ä»¬å°†ACè‡ªåŠ¨æœºçœ‹ä½œæ ‘ï¼Œä»æ ¹å‡ºå‘ï¼Œé‚£ä¹ˆå¶å­èŠ‚ç‚¹ï¼Œå³æœ‰Endæ ‡è®°çš„èŠ‚ç‚¹æ˜¯ä¸èƒ½èµ°çš„ï¼Œå› ä¸ºè¯¥è·¯å¾„æ„æˆäº†ç—…æ¯’ã€‚åŒæ ·çš„é“ç†ï¼Œå¦‚æœå½“å‰èŠ‚ç‚¹failæŒ‡é’ˆæ‰€æŒ‡å‘çš„èŠ‚ç‚¹æœ‰Endæ ‡è®°ï¼Œé‚£ä¹ˆå½“å‰èŠ‚ç‚¹ä¹Ÿä¸èƒ½èµ°ï¼Œå› ä¸ºå®ƒçš„å­ä¸²æ˜¯ç—…æ¯’ä¸²ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨æ›´æ–°failæŒ‡é’ˆæ—¶é¡ºä¾¿è½¬ç§»Endæ ‡è®°ï¼ˆå¸¸ç”¨æŠ€å·§ï¼‰ã€‚<br>æ‰€ä»¥å¦‚æœæœ‰ä¸€æ¡è·¯å¾„ï¼Œå®ƒä¸Šé¢çš„æ‰€æœ‰èŠ‚ç‚¹éƒ½æ²¡æœ‰Endæ ‡è®°ï¼Œä¸”è¯¥è·¯å¾„æ„æˆç¯ï¼Œé‚£ä¹ˆå®ƒå°±å¯ä»¥æ„æˆä¸€ä¸ªæ— é™é•¿çš„å®‰å…¨å­—ç¬¦ä¸²ã€‚</p><p>äºæ˜¯æˆ‘ä»¬å°±åªéœ€è¦åœ¨ACè‡ªåŠ¨æœºä¸Šé€šè¿‡dfsæ¥æ‰¾æ˜¯å¦å­˜åœ¨æ»¡è¶³æ¡ä»¶çš„ç¯å³å¯ï¼Œè€Œç”¨æ‹“æ‰‘æ’åºä¸å¤ªå¥½å†™ã€‚<br><strong>ä»£ç ç¤ºä¾‹</strong><br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">2100</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> SZ = <span class="number">1e5</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">int</span> n;</span><br><span class="line"><span class="built_in">string</span> str[N];</span><br><span class="line"><span class="keyword">int</span> trie[SZ][<span class="number">3</span>],End[SZ],fail[SZ],tot = <span class="number">1</span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Insert</span><span class="params">(<span class="keyword">const</span> <span class="built_in">string</span> &amp;s)</span></span>&#123;</span><br><span class="line"><span class="keyword">int</span> len = s.length(), p = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; len;i++)&#123;</span><br><span class="line"><span class="keyword">int</span> ch = s[i]-<span class="string">'0'</span>;</span><br><span class="line"><span class="keyword">if</span>(!trie[p][ch]) trie[p][ch] = ++tot;</span><br><span class="line">p = trie[p][ch];</span><br><span class="line">&#125;</span><br><span class="line">End[p]++;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">queue</span>&lt;<span class="keyword">int</span>&gt; q;</span><br><span class="line"><span class="keyword">bool</span> f[SZ];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">getFail</span><span class="params">()</span></span>&#123;</span><br><span class="line">trie[<span class="number">0</span>][<span class="number">0</span>] = trie[<span class="number">0</span>][<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">q.push(<span class="number">1</span>); fail[<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span>(!q.empty())&#123;</span><br><span class="line"><span class="keyword">int</span> p = q.front(); q.pop();</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; <span class="number">2</span>;i++)&#123;</span><br><span class="line"><span class="keyword">if</span>(!trie[p][i]) trie[p][i] = trie[fail[p]][i];</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">q.push(trie[p][i]);</span><br><span class="line">fail[trie[p][i]] = trie[fail[p]][i];</span><br><span class="line">End[trie[p][i]] |= End[trie[fail[p]][i]];<span class="comment">//è½¬ç§»æ ‡è®°</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">bool</span> flag = <span class="literal">false</span>;</span><br><span class="line"><span class="keyword">int</span> vis[SZ],ins[SZ];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> p)</span></span>&#123;</span><br><span class="line">vis[p] = ins[p] = <span class="number">1</span>;    <span class="comment">//insåˆ¤æ–­ç¯,visè®¿é—®æ ‡è®°</span></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; <span class="number">2</span>;i++)&#123;</span><br><span class="line"><span class="keyword">int</span> k = trie[p][i];</span><br><span class="line"><span class="keyword">if</span>(ins[k]) flag = <span class="literal">true</span>;<span class="comment">//æ„æˆç¯äº†,è¿™é‡Œä¹Ÿå¯ä»¥return</span></span><br><span class="line"><span class="keyword">if</span>(!End[k] &amp;&amp; !vis[k]) dfs(k);<span class="comment">//ä¸‹ä¸€ä¸ªæ»¡è¶³æ¡ä»¶çš„èŠ‚ç‚¹,é€’å½’è®¿é—®å®ƒ</span></span><br><span class="line">&#125;</span><br><span class="line">ins[p] = <span class="number">0</span>;<span class="comment">//é‡Šæ”¾pèŠ‚ç‚¹çš„æ ‡è®°</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++) Insert(str[i]);</span><br><span class="line">getFail();</span><br><span class="line">dfs(<span class="number">1</span>);</span><br><span class="line"><span class="keyword">if</span>(flag) <span class="built_in">cout</span> &lt;&lt; <span class="string">"TAK"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"><span class="keyword">else</span> <span class="built_in">cout</span> &lt;&lt; <span class="string">"NIE"</span> &lt;&lt; <span class="built_in">endl</span>; </span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="comment">//freopen("123.txt","r",stdin);</span></span><br><span class="line"><span class="built_in">cin</span> &gt;&gt; n;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++) <span class="built_in">cin</span> &gt;&gt; str[i];</span><br><span class="line">solve();</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h4 id="æ–‡æœ¬ç”Ÿæˆå™¨"><a href="#æ–‡æœ¬ç”Ÿæˆå™¨" class="headerlink" title="æ–‡æœ¬ç”Ÿæˆå™¨"></a>æ–‡æœ¬ç”Ÿæˆå™¨</h4><p><strong>é¢˜æ„ç®€è¿°</strong></p><p>åŸé¢˜æ¥è‡ªï¼šJSOI 2007JSOI<br>äº¤ç»™é˜Ÿå‘˜ ZYX ä¸€ä¸ªä»»åŠ¡ï¼Œç¼–åˆ¶ä¸€ä¸ªç§°ä¹‹ä¸ºã€Œæ–‡æœ¬ç”Ÿæˆå™¨ã€çš„ç”µè„‘è½¯ä»¶ï¼šè¯¥è½¯ä»¶çš„ä½¿ç”¨è€…æ˜¯ä¸€äº›ä½å¹¼äººç¾¤ï¼Œä»–ä»¬ç°åœ¨ä½¿ç”¨çš„æ˜¯ GW æ–‡æœ¬ç”Ÿæˆå™¨ v6 ç‰ˆã€‚è¯¥è½¯ä»¶å¯ä»¥éšæœºç”Ÿæˆä¸€äº›æ–‡ç« â€•â€•æ€»æ˜¯ç”Ÿæˆä¸€ç¯‡é•¿åº¦å›ºå®šä¸”å®Œå…¨éšæœºçš„æ–‡ç« â€”â€”ä¹Ÿå°±æ˜¯è¯´ï¼Œç”Ÿæˆçš„æ–‡ç« ä¸­æ¯ä¸ªå­—èŠ‚éƒ½æ˜¯å®Œå…¨éšæœºçš„ã€‚<br>å¦‚æœä¸€ç¯‡æ–‡ç« ä¸­è‡³å°‘åŒ…å«ä½¿ç”¨è€…ä»¬äº†è§£çš„ä¸€ä¸ªå•è¯ï¼Œé‚£ä¹ˆæˆ‘ä»¬è¯´è¿™ç¯‡æ–‡ç« æ˜¯å¯è¯»çš„ï¼ˆæˆ‘ä»¬ç§°æ–‡ç«  a åŒ…å«å•è¯ bï¼Œå½“ä¸”ä»…å½“å•è¯ b æ˜¯æ–‡ç«  a çš„å­ä¸²ï¼‰ã€‚ä½†æ˜¯ï¼Œå³ä½¿æŒ‰ç…§è¿™æ ·çš„æ ‡å‡†ï¼Œä½¿ç”¨è€…ç°åœ¨ä½¿ç”¨çš„ GW æ–‡æœ¬ç”Ÿæˆå™¨ v6 ç‰ˆæ‰€ç”Ÿæˆçš„æ–‡ç« ä¹Ÿæ˜¯å‡ ä¹å®Œå…¨ä¸å¯è¯»çš„ã€‚<br>ZYX éœ€è¦æŒ‡å‡º GW æ–‡æœ¬ç”Ÿæˆå™¨ v6 ç”Ÿæˆçš„æ‰€æœ‰æ–‡æœ¬ä¸­å¯è¯»æ–‡æœ¬çš„æ•°é‡ï¼Œä»¥ä¾¿èƒ½å¤ŸæˆåŠŸè·å¾— v7 æ›´æ–°ç‰ˆã€‚ä½ èƒ½å¸®åŠ©ä»–å—ï¼Ÿ</p><p><strong>è§£é¢˜æ€è·¯</strong><br>é¦–å…ˆæ˜“å¾—æ‰€æœ‰ä¸åŒçš„æ–‡æœ¬æ€»æ•°ä¸º$26^m$ç§ï¼Œæˆ‘ä»¬æœ‰ä¸¤ç§å®¹æ˜“æƒ³åˆ°çš„æ€è·¯æ¥æ±‚è§£ï¼Œä¸€ä¸ªæ˜¯åˆ©ç”¨å®¹æ–¥åŸç†ç›´æ¥è®¡ç®—å¯è¯»çš„æ–‡ç« æ€»æ•°ï¼Œå¦ä¸€ç§æ˜¯æƒ³åŠæ³•è®¡ç®—ä¸å¯è¯»çš„æ–‡ç« æ•°ï¼Œå†ç”¨ä¸åŒçš„æ–‡ç« æ€»æ•°å‡å»å®ƒã€‚ç¬¬ä¸€ç§æ€è·¯å¾ˆéš¾å®ç°ï¼Œä¸»è¦æ¥çœ‹ç¬¬äºŒç§æ€è·¯å¦‚ä½•å®ç°ã€‚<br>ç±»ä¼¼ä¸Šä¸€é¢˜ï¼Œå¦‚æœä¸€ä¸ªæ–‡ç« æ˜¯ä¸å¯è¯»çš„ï¼Œé‚£ä¹ˆä»æ ¹å‡ºå‘ï¼Œå®ƒä¸èƒ½ç»è¿‡æœ‰Endæ ‡è®°çš„èŠ‚ç‚¹ï¼Œä¹Ÿä¸èƒ½ç»è¿‡â€œfailæŒ‡é’ˆæŒ‡å‘çš„èŠ‚ç‚¹æœ‰Endæ ‡è®°â€çš„èŠ‚ç‚¹ã€‚æ‰€ä»¥ä¸å¯è¯»çš„æ–‡ç« æ€»æ•°å°±ç­‰äºé•¿åº¦ä¸ºmçš„<strong>åˆæ³•è·¯å¾„</strong>æ•°ã€‚æ‰€è°“çš„åˆæ³•è·¯å¾„å°±æ˜¯ä¸Šé¢æåˆ°çš„ï¼Œè·¯å¾„ä¸Šæ‰€æœ‰èŠ‚ç‚¹éƒ½æ²¡æœ‰Endæ ‡è®°ï¼Œä¸”å…¶failæŒ‡é’ˆæŒ‡å‘çš„èŠ‚ç‚¹ä¹Ÿæ²¡Endæ ‡è®°ã€‚<br>æˆ‘ä»¬é€šè¿‡åŠ¨æ€è§„åˆ’æ¥æ±‚<strong>æ–¹æ¡ˆæ€»æ•°</strong>ï¼Œè®¾f(i,j)è¡¨ç¤ºä»æ ¹èŠ‚ç‚¹å‡ºå‘ï¼Œèµ°äº† i æ­¥åˆ°è¾¾èŠ‚ç‚¹ j æ—¶çš„åˆæ³•æ–¹æ¡ˆæ€»æ•°ï¼Œé‚£ä¹ˆæ˜¾ç„¶ f(0 , 1) = 1ï¼Œå› ä¸ºèŠ‚ç‚¹ 1 æ˜¯ACè‡ªåŠ¨æœºçš„æ ¹èŠ‚ç‚¹ã€‚<br>çŠ¶æ€è½¬ç§»æ–¹ç¨‹è¯·ç»“åˆä»£ç ç†è§£ã€‚<br><strong>ä»£ç ç¤ºä¾‹</strong><br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> P = <span class="number">1e4</span>+<span class="number">7</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> SZ = <span class="number">6000</span>*<span class="number">30</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">65</span>;</span><br><span class="line"><span class="keyword">int</span> n,m;</span><br><span class="line"><span class="keyword">char</span> str[N][<span class="number">110</span>];</span><br><span class="line"><span class="keyword">int</span> trie[SZ][<span class="number">30</span>],End[SZ],fail[SZ],tot = <span class="number">1</span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Insert</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> *s)</span></span>&#123;</span><br><span class="line"><span class="keyword">int</span> len = <span class="built_in">strlen</span>(s), p = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; len;i++)&#123;</span><br><span class="line"><span class="keyword">int</span> ch = s[i]-<span class="string">'A'</span>;</span><br><span class="line"><span class="keyword">if</span>(!trie[p][ch]) trie[p][ch] = ++tot;</span><br><span class="line">p = trie[p][ch];</span><br><span class="line">&#125;</span><br><span class="line">End[p]++;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">queue</span>&lt;<span class="keyword">int</span>&gt; q;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">getFail</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; <span class="number">26</span>;i++) trie[<span class="number">0</span>][i] = <span class="number">1</span>;</span><br><span class="line">q.push(<span class="number">1</span>); fail[<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span>(!q.empty())&#123;</span><br><span class="line"><span class="keyword">int</span> p = q.front(); q.pop();</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; <span class="number">26</span>;i++)&#123;</span><br><span class="line"><span class="keyword">if</span>(!trie[p][i]) trie[p][i] = trie[fail[p]][i];</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">q.push(trie[p][i]);</span><br><span class="line">fail[trie[p][i]] = trie[fail[p]][i];</span><br><span class="line">End[trie[p][i]] |= End[trie[fail[p]][i]];<span class="comment">//æ ‡è®°è½¬ç§» </span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> f[<span class="number">110</span>][SZ] ,ans ;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">getAns</span><span class="params">()</span></span>&#123;</span><br><span class="line">f[<span class="number">0</span>][<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= m;i++)&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">1</span>;j &lt;= tot;j++)&#123;</span><br><span class="line"><span class="keyword">if</span>(End[j]) <span class="keyword">continue</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> k = <span class="number">0</span>;k &lt; <span class="number">26</span>;k++)&#123;</span><br><span class="line"><span class="comment">/*f[i][trie[j][k]]çš„æ–¹æ¡ˆæ€»æ•°æ˜¾ç„¶ç­‰äºå®ƒæ‰€æœ‰çˆ¶äº²çš„æ–¹æ¡ˆæ€»æ•°çš„å’Œ*/</span></span><br><span class="line">f[i][trie[j][k]] = (f[i][trie[j][k]]+f[i<span class="number">-1</span>][j])%P;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> res = <span class="number">0</span>,tmp = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= tot;i++) </span><br><span class="line"><span class="keyword">if</span>(!End[i]) res = (res+f[m][i])%P;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= m;i++) tmp = tmp*<span class="number">26</span>%P;</span><br><span class="line">ans = (tmp-res+P)%P;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++) Insert(str[i]);</span><br><span class="line">getFail();</span><br><span class="line">getAns();</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%d\n"</span>,ans);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;n,&amp;m);</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++) <span class="built_in">scanf</span>(<span class="string">"%s"</span>,str[i]);</span><br><span class="line">solve();</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h4 id=&quot;Keywords-Search&quot;&gt;&lt;a href=&quot;#Keywords-Search&quot; class=&quot;headerlink&quot; title=&quot;Keywords Search&quot;&gt;&lt;/a&gt;Keywords Search&lt;/h4&gt;&lt;p&gt;&lt;strong&gt;é¢˜æ„æè¿°&lt;/stro
      
    
    </summary>
    
      <category term="ACMé¢˜è§£" scheme="http://valenshi.top/categories/ACM%E9%A2%98%E8%A7%A3/"/>
    
    
      <category term="ACè‡ªåŠ¨æœº" scheme="http://valenshi.top/tags/AC%E8%87%AA%E5%8A%A8%E6%9C%BA/"/>
    
      <category term="çŠ¶æ€å‹ç¼©" scheme="http://valenshi.top/tags/%E7%8A%B6%E6%80%81%E5%8E%8B%E7%BC%A9/"/>
    
  </entry>
  
  <entry>
    <title>ACè‡ªåŠ¨æœºæ¨¡æ¿</title>
    <link href="http://valenshi.top/2019/10/02/acji/"/>
    <id>http://valenshi.top/2019/10/02/acji/</id>
    <published>2019-10-02T03:06:43.000Z</published>
    <updated>2019-10-02T03:07:41.832Z</updated>
    
    <content type="html"><![CDATA[<h4 id="ACè‡ªåŠ¨æœº"><a href="#ACè‡ªåŠ¨æœº" class="headerlink" title="ACè‡ªåŠ¨æœº"></a>ACè‡ªåŠ¨æœº</h4><p>ACè‡ªåŠ¨æœºæ˜¯ç”¨æ¥å¤„ç†å­—ç¬¦ä¸²åŒ¹é…é—®é¢˜ã€‚KMPæ˜¯å¤„ç†å•æ¨¡å¼ä¸²åŒ¹é…é—®é¢˜ï¼Œè€ŒACè‡ªåŠ¨æœºæ˜¯ç”¨äºå¤„ç†å¤šæ¨¡å¼ä¸²åŒ¹é…é—®é¢˜ï¼Œä¾‹å¦‚ï¼šç»™å‡º n ä¸ªå•è¯ï¼Œå†ç»™å‡ºä¸€æ®µåŒ…å« m ä¸ªå­—ç¬¦çš„æ–‡ç« ï¼Œé—®æœ‰å¤šå°‘ä¸ªå•è¯åœ¨æ–‡ç« ä¸­å‡ºç°è¿‡ï¼Ÿä»¥ä¸‹æ¨¡æ¿å°±æ˜¯æ ¹æ®è¯¥é—®é¢˜æ•´ç†ã€‚</p><p><strong>ä½¿ç”¨è¯´æ˜</strong><br>å…¶ä¸­çš„trieæ ‘ç¼–å·æ˜¯ä» 1 å¼€å§‹ï¼Œæ¯æ¬¡ä½¿ç”¨å‰éƒ½è¦åˆå§‹åŒ– tot = 1ï¼Œä»¥åŠtrieæ•°ç»„ã€Endæ•°ç»„éƒ½è¦åˆå§‹åŒ–ã€‚<br>SZè®¾è®¡è¦åˆç†ï¼ŒSZè¡¨ç¤ºå­—å…¸æ ‘ä¸­çš„èŠ‚ç‚¹æ•°ç›®ä¸Šé™ï¼Œå¤ªå¤šæˆ–å¤ªå°‘éƒ½ä¼šè¿è¡Œé”™è¯¯ã€‚<br>æœ¬æ–‡åˆ©ç”¨queueæ¥å®ç°bfsï¼Œå«Œæ…¢å¯ä»¥æ‰‹å†™æ¨¡æ‹Ÿï¼Œä¸ä¼šéº»çƒ¦å¤šå°‘ã€‚</p><p><strong>ä»£ç ç¤ºä¾‹</strong><br><a href="http://ybt.ssoier.cn:8088/problem_show.php?pid=1479" target="_blank" rel="noopener">Keywords Search</a><br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1e4</span>+<span class="number">10</span>;<span class="comment">//æ¨¡å¼ä¸²ä¸ªæ•° </span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> M = <span class="number">1e6</span>+<span class="number">10</span>;<span class="comment">//æ–‡æœ¬ä¸²é•¿åº¦ </span></span><br><span class="line"></span><br><span class="line"><span class="keyword">char</span> str[N][<span class="number">50</span>],s[M];</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> SZ = <span class="number">50</span>*N;<span class="comment">//trieèŠ‚ç‚¹æ•° </span></span><br><span class="line"><span class="keyword">int</span> trie[SZ][<span class="number">30</span>],End[SZ],tot ;</span><br><span class="line"><span class="keyword">int</span> fail[SZ];<span class="comment">//å¤±é…æŒ‡é’ˆ,ç±»ä¼¼äºnex</span></span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="built_in">memset</span>(trie,<span class="number">0</span>,<span class="keyword">sizeof</span> trie);</span><br><span class="line"><span class="built_in">memset</span>(End,<span class="number">0</span>,<span class="keyword">sizeof</span> End); tot = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Insert</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span>* s)</span></span>&#123;</span><br><span class="line"><span class="comment">/* å‘trieæ ‘ä¸­æ’å…¥å­—ç¬¦ä¸²s */</span> </span><br><span class="line"><span class="keyword">int</span> len = <span class="built_in">strlen</span>(s), p = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; len;i++)&#123;</span><br><span class="line"><span class="keyword">int</span> ch = s[i]-<span class="string">'a'</span>;</span><br><span class="line"><span class="keyword">if</span>(!trie[p][ch]) trie[p][ch] = ++tot;</span><br><span class="line">p = trie[p][ch];</span><br><span class="line">&#125;</span><br><span class="line">End[p]++;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">queue</span>&lt;<span class="keyword">int</span>&gt; q;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">getFail</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="comment">/*åˆ©ç”¨bfsæ›´æ–°failæ•°ç»„*/</span> </span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; <span class="number">26</span>;i++) trie[<span class="number">0</span>][i] = <span class="number">1</span>;</span><br><span class="line">q.push(<span class="number">1</span>); fail[<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span>(!q.empty())&#123;</span><br><span class="line"><span class="keyword">int</span> p = q.front(); q.pop();</span><br><span class="line"><span class="comment">//printf("%d\n",q.size());</span></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; <span class="number">26</span>;i++)&#123;</span><br><span class="line"><span class="keyword">if</span>(!trie[p][i]) trie[p][i] = trie[fail[p]][i];</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">q.push(trie[p][i]);</span><br><span class="line">fail[trie[p][i]] = trie[fail[p]][i];</span><br><span class="line">&#125; </span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> ans = <span class="number">0</span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ask</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> *s)</span></span>&#123;</span><br><span class="line"><span class="comment">/* ç»Ÿè®¡åŒ¹é…æˆåŠŸçš„æ¨¡å¼ä¸²ä¸ªæ•°å¹¶ç´¯åŠ åˆ°ansä¸Š */</span> </span><br><span class="line"><span class="keyword">int</span> len = <span class="built_in">strlen</span>(s), p = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; len;i++)&#123;</span><br><span class="line"><span class="keyword">int</span> ch = s[i]-<span class="string">'a'</span>;</span><br><span class="line"><span class="keyword">int</span> k = trie[p][ch];</span><br><span class="line"><span class="keyword">while</span>(k &gt; <span class="number">1</span>)&#123;</span><br><span class="line">ans += End[k]; End[k] = <span class="number">0</span>;</span><br><span class="line">k = fail[k];</span><br><span class="line">&#125;</span><br><span class="line">p = trie[p][ch];</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> t,n;<span class="comment">//æ•°ç»„ç»„æ•°, æ¨¡å¼ä¸²ä¸ªæ•° </span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++) Insert(str[i]);</span><br><span class="line">getFail(); ans = <span class="number">0</span>;</span><br><span class="line">ask(s);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%d\n"</span>,ans);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;t);</span><br><span class="line"><span class="keyword">while</span>(t--)&#123;</span><br><span class="line">init();<span class="comment">//å¤šç»„æ•°æ®ä¸è¦å¿˜äº†åˆå§‹åŒ–ï¼ </span></span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;n);</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++) <span class="built_in">scanf</span>(<span class="string">"%s"</span>,str[i]);</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%s"</span>,s);</span><br><span class="line">solve();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h5 id="å¯¹getFail-å‡½æ•°çš„ä¸€äº›è§£é‡Š"><a href="#å¯¹getFail-å‡½æ•°çš„ä¸€äº›è§£é‡Š" class="headerlink" title="å¯¹getFail()å‡½æ•°çš„ä¸€äº›è§£é‡Š"></a>å¯¹getFail()å‡½æ•°çš„ä¸€äº›è§£é‡Š</h5><p>fail æ•°ç»„å°±åƒæ˜¯ kmp ç®—æ³•ä¸­çš„ nex æ•°ç»„ä¸€æ ·ï¼Œæ˜¯åœ¨å¤±é…æ—¶è½¬ç§»æŒ‡é’ˆç”¨çš„ï¼Œåˆ©ç”¨å®ƒå¯ä»¥ä½¿å¾—æ—¶é—´æ§åˆ¶åœ¨O(N)ã€‚<br>å°±ä¸Šè¿°ä»£ç è€Œè¨€ï¼Œæˆ‘ä»¬æ˜¯å¦‚ä½•æ›´æ–°failæ•°ç»„çš„å‘¢ï¼Ÿ</p><ul><li>é¦–å…ˆæ ¹èŠ‚ç‚¹è‹¥å¤±é…ï¼Œåˆ™æ— æ³•åŒ¹é…å­—ç¬¦ï¼Œå³ fail[1] = 0ã€‚</li><li>è‹¥å½“å‰ä½ç½®æœ‰å­—ç¬¦ï¼Œåˆ™å®ƒçš„å¤±é…æŒ‡é’ˆæŒ‡å‘â€œå®ƒçˆ¶äº²èŠ‚ç‚¹å¤±é…æŒ‡é’ˆæ‰€æŒ‡å‘èŠ‚ç‚¹ çš„ ä¸‹ä¸€ä¸ªèŠ‚ç‚¹â€ï¼Œå³ <code>fail[ trie[p][i] ]  = fail[ fail[p] ][i]</code>ï¼Œå…¶æ€æƒ³ç±»ä¼¼kmpä¸­nexè½¬ç§»ã€‚</li><li>è‹¥å½“å‰ä½ç½®æ— å­—ç¬¦ï¼Œå³<code>trie[p][i] = 0</code>ï¼Œé‚£ä¹ˆå°±è®©å½“å‰èŠ‚ç‚¹æŒ‡å‘å…¶å¤±é…æŒ‡é’ˆçš„å­èŠ‚ç‚¹ï¼Œå³<code>trie[p][i] = trie[ fail[p] ][i]</code>ã€‚</li></ul><p>ç¬¬ 3 æ­¥ç ´åäº† trie çš„ç»“æ„ï¼Œä½†è¿™æ ·å¯ä»¥ä¼˜åŒ–æ—¶é—´ã€‚è‹¥ä¸å­˜åœ¨<code>trie[p][i]</code> çš„è½¬ç§»è¾¹åˆ™æŒ‡å‘ <code>trie[ fail[p] ][i]</code>ï¼Œå› ä¸ºåœ¨å…·ä½“é—®é¢˜ä¸­ï¼Œè‹¥ä¸å­˜åœ¨<code>trie[p][i]</code> åˆ™éœ€è¦æ²¿ç€ p çš„å‰ç¼€æŒ‡é’ˆèµ°åˆ°ç¬¬ä¸€ä¸ªæ»¡è¶³å­˜åœ¨ i å­—ç¬¦çš„è½¬ç§»è¾¹çš„ç‚¹ vï¼Œå¾—åˆ°<code>trie[v][i]</code>ï¼Œé‚£ä¹ˆæˆ‘ä»¬ç›´æ¥ä»¤ <code>trie[p][i] = trie[v][i]</code> å³å¯ä½¿å¾—è¯¥æƒ…å†µå¾—åˆ°ä¼˜åŒ–ï¼Œç±»ä¼¼è®°å¿†åŒ– &amp; è·¯å¾„å‹ç¼©ã€‚<br>ä¹Ÿæ­£æ˜¯è¿™ä¸ªåŸå› ï¼Œæˆ‘ä»¬åœ¨æ„å»º fail æ•°ç»„æ—¶ï¼Œæ²¡æœ‰å¤„ç† v çš„è½¬ç§»è¾¹ i ä¸å­˜åœ¨çš„æƒ…å†µï¼Œè€Œæ˜¯ç›´æ¥<code>fail[ trie[p][i] = trie[v][i]</code>ï¼ˆå…¶ä¸­ <code>trie[v][i]</code> åœ¨ä¹‹å‰å·²ç»å¤„ç†å¥½äº†ï¼‰ã€‚</p><h4 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h4><ul><li>è‘£æ°¸å»ºï¼Œä¿¡æ¯å­¦ç«èµ›ä¸€æœ¬é€šæé«˜ç‰ˆï¼Œç¦å·ï¼šç¦å»ºæ•™è‚²å‡ºç‰ˆç¤¾ï¼Œ2018.6ï¼Œ93-97</li><li><a href="https://bestsort.cn/2019/04/28/402/" target="_blank" rel="noopener">bestsort</a>çš„åšå®¢</li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h4 id=&quot;ACè‡ªåŠ¨æœº&quot;&gt;&lt;a href=&quot;#ACè‡ªåŠ¨æœº&quot; class=&quot;headerlink&quot; title=&quot;ACè‡ªåŠ¨æœº&quot;&gt;&lt;/a&gt;ACè‡ªåŠ¨æœº&lt;/h4&gt;&lt;p&gt;ACè‡ªåŠ¨æœºæ˜¯ç”¨æ¥å¤„ç†å­—ç¬¦ä¸²åŒ¹é…é—®é¢˜ã€‚KMPæ˜¯å¤„ç†å•æ¨¡å¼ä¸²åŒ¹é…é—®é¢˜ï¼Œè€ŒACè‡ªåŠ¨æœºæ˜¯ç”¨äºå¤„ç†å¤šæ¨¡å¼ä¸²åŒ¹é…é—®é¢˜ï¼Œä¾‹å¦‚ï¼šç»™å‡º
      
    
    </summary>
    
      <category term="ACMå­¦ä¹ ç¬”è®°" scheme="http://valenshi.top/categories/ACM%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
    
      <category term="ç®—æ³•æ¨¡æ¿" scheme="http://valenshi.top/tags/%E7%AE%97%E6%B3%95%E6%A8%A1%E6%9D%BF/"/>
    
      <category term="ACè‡ªåŠ¨æœº" scheme="http://valenshi.top/tags/AC%E8%87%AA%E5%8A%A8%E6%9C%BA/"/>
    
  </entry>
  
  <entry>
    <title>Trieå­—å…¸æ ‘ç»ƒä¹ é¢˜é›†</title>
    <link href="http://valenshi.top/2019/09/30/trie-problems/"/>
    <id>http://valenshi.top/2019/09/30/trie-problems/</id>
    <published>2019-09-30T10:37:26.000Z</published>
    <updated>2019-09-30T14:59:47.512Z</updated>
    
    <content type="html"><![CDATA[<p><a href="http://ybt.ssoier.cn:8088/index.php" target="_blank" rel="noopener">æµ‹è¯•åœ°å€</a></p><h4 id="Phone-List"><a href="#Phone-List" class="headerlink" title="Phone List"></a>Phone List</h4><p>åŸé¢˜æ¥è‡ªï¼šPOJ 3630<br>ç»™å®š n ä¸ªé•¿åº¦ä¸è¶…è¿‡ 10 çš„æ•°å­—ä¸²ï¼Œé—®å…¶ä¸­æ˜¯å¦å­˜åœ¨ä¸¤ä¸ªæ•°å­—ä¸² S,Tï¼Œä½¿å¾— S æ˜¯ T çš„å‰ç¼€ï¼Œå¤šç»„æ•°æ®ã€‚</p><p><strong>è§£é¢˜æ€è·¯</strong><br>Trieçš„ç»å…¸åº”ç”¨ï¼Œå¯ä»¥ä½œä¸ºæ¨¡æ¿é¢˜ç»ƒæ‰‹ã€‚</p><p><strong>ä»£ç ç¤ºä¾‹</strong><br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> SZ = <span class="number">1e5</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">int</span> trie[SZ][<span class="number">30</span>], tot;</span><br><span class="line"><span class="keyword">int</span> End[SZ];</span><br><span class="line"><span class="keyword">int</span> n,t;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1e4</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">char</span> str[N][<span class="number">20</span>];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Insert</span><span class="params">(<span class="keyword">char</span> *s)</span></span>&#123;</span><br><span class="line"><span class="comment">/* å°†å­—ä¸²sæ’å…¥trieæ ‘ */</span></span><br><span class="line"><span class="keyword">int</span> len = <span class="built_in">strlen</span>(s) ,p = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; len;i++)&#123;</span><br><span class="line"><span class="keyword">int</span> ch = s[i]-<span class="string">'0'</span>;</span><br><span class="line"><span class="keyword">if</span>(trie[p][ch] == <span class="number">0</span>) trie[p][ch] = ++tot;</span><br><span class="line">p = trie[p][ch];</span><br><span class="line">&#125;</span><br><span class="line">End[p]++;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">search</span><span class="params">(<span class="keyword">char</span> *s)</span></span>&#123;</span><br><span class="line"><span class="comment">/* å­—ä¸²sæ˜¯å¦æœ‰å‰ç¼€ */</span> </span><br><span class="line"><span class="keyword">int</span> len = <span class="built_in">strlen</span>(s), p = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; len;i++)&#123;</span><br><span class="line"><span class="keyword">int</span> ch = s[i]-<span class="string">'0'</span>;</span><br><span class="line"><span class="keyword">if</span>(End[p]) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">p = trie[p][ch];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">solve</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++) Insert(str[i]);</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++)</span><br><span class="line"><span class="keyword">if</span>(search(str[i])) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;t);</span><br><span class="line"><span class="keyword">while</span>(t--)&#123;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;n); </span><br><span class="line"><span class="comment">/* åˆå§‹åŒ–trieç›¸å…³å˜é‡ */</span></span><br><span class="line"><span class="built_in">memset</span>(End,<span class="number">0</span>,<span class="keyword">sizeof</span> End); tot = <span class="number">1</span>;</span><br><span class="line"><span class="built_in">memset</span>(trie,<span class="number">0</span>,<span class="keyword">sizeof</span> trie);</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++) <span class="built_in">scanf</span>(<span class="string">"%s"</span>,str[i]);</span><br><span class="line"><span class="keyword">if</span>(solve()) <span class="built_in">puts</span>(<span class="string">"NO"</span>);</span><br><span class="line"><span class="keyword">else</span> <span class="built_in">puts</span>(<span class="string">"YES"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h4 id="The-XOR-Largest-Pair"><a href="#The-XOR-Largest-Pair" class="headerlink" title="The XOR Largest Pair"></a>The XOR Largest Pair</h4><p><strong>é¢˜æ„ç®€è¿°</strong><br>åœ¨ç»™å®šçš„ N ä¸ªæ•´æ•° A1,A2,â€¦,AN ä¸­é€‰å‡ºä¸¤ä¸ªè¿›è¡Œå¼‚æˆ–è¿ç®—ï¼Œå¾—åˆ°çš„ç»“æœæœ€å¤§æ˜¯å¤šå°‘ï¼Ÿ</p><p><strong>è§£é¢˜æ€è·¯</strong><br>å°±æ˜¯å°†æ¯ä¸ªæ•´æ•°çœ‹ä½œ31ä½çš„01å­—ç¬¦ä¸²ï¼Œç„¶åå…¨éƒ¨æ’å…¥åˆ°Trieä¸Šï¼Œå†åˆ†åˆ«å¯¹æ¯ä¸ªæ•´æ•°ä»é«˜ä½åˆ°ä½ä½ä¼˜å…ˆåœ¨Trieä¸Šèµ°å’Œè¯¥ä½ç›¸åçš„èŠ‚ç‚¹ã€‚01å­—å…¸æ ‘ã€‚</p><p><strong>ä»£ç ç¤ºä¾‹</strong><br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1e5</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> SZ = <span class="number">5e6</span>+<span class="number">10</span>;<span class="comment">//å¤§å°è¦åˆç†ï¼ï¼ï¼ </span></span><br><span class="line"><span class="keyword">int</span> trie[SZ][<span class="number">3</span>], End[SZ], tot = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">int</span> n,a[N],ans = <span class="number">0</span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Insert</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line"><span class="keyword">int</span> p = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">31</span>;i &gt;= <span class="number">0</span>;i--)&#123;</span><br><span class="line"><span class="keyword">int</span> ch = (x&gt;&gt;i)&amp;<span class="number">1</span>;</span><br><span class="line"><span class="keyword">if</span>(trie[p][ch] == <span class="number">0</span>) trie[p][ch] = ++tot;</span><br><span class="line">p = trie[p][ch];</span><br><span class="line">&#125;</span><br><span class="line">End[p]++;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">calc</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line"><span class="keyword">int</span> res = <span class="number">0</span>, p = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">31</span>;i &gt;= <span class="number">0</span>;i--)&#123;</span><br><span class="line"><span class="keyword">int</span> ch = (x&gt;&gt;i)&amp;<span class="number">1</span>;</span><br><span class="line"><span class="keyword">if</span>(trie[p][!ch]) p = trie[p][!ch], res |= <span class="number">1</span>&lt;&lt;i;</span><br><span class="line"><span class="keyword">else</span> p = trie[p][ch];</span><br><span class="line">&#125;</span><br><span class="line">ans = max(ans,res);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++) Insert(a[i]);</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++) calc(a[i]);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%d\n"</span>,ans);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="comment">//freopen("123.txt","r",stdin);</span></span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;n);</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++) <span class="built_in">scanf</span>(<span class="string">"%d"</span>,a+i);</span><br><span class="line">solve();</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h4 id="Codechef-REBXOR"><a href="#Codechef-REBXOR" class="headerlink" title="Codechef REBXOR*"></a>Codechef REBXOR*</h4><p><strong>é¢˜æ„ç®€è¿°</strong><br><img src="/2019/09/30/trie-problems/1.png" alt="trie-problems/1.png"><br><strong>è§£é¢˜æ€è·¯</strong><br>è¿™é¢˜ç”¨çš„æ˜¯ â€œTrieç»´æŠ¤å¼‚æˆ–å‰ç¼€å’Œâ€ï¼Œæ ¹æ®å¼‚æˆ–çš„ç‰¹æ€§ï¼Œæˆ‘ä»¬ä»å·¦åˆ°å³ä¾æ¬¡å°†å…ƒç´ æ’å…¥åï¼Œå†åˆ©ç”¨ x^y^x = y è¿™ä¸ªç‰¹æ€§åœ¨å¸¸æ•°æ—¶é—´åˆ©ç”¨ Trie æ‰¾æœ€å¤§åŒºé—´å¼‚æˆ–å’Œã€‚æœ¬é¢˜è¿˜æ˜¯å¾ˆæœ‰å‚è€ƒæ„ä¹‰çš„ï¼Œå°¤å…¶æ˜¯å¼‚æˆ–å‰ç¼€å’Œè¿™ä¸€æŠ€å·§ã€‚<br>å½“ç„¶ç”±äºOJä¸Šç»™å®šçš„ç©ºé—´è¿‡å°ï¼Œæœ¬ä»£ç æ²¡è¿‡ï¼Œå¾…è§£å†³ã€‚</p><p><strong>ä»£ç ç¤ºä¾‹</strong><br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">4e5</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> SZ = <span class="number">20</span>*N;</span><br><span class="line"><span class="keyword">int</span> trie[SZ][<span class="number">3</span>], tot = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">int</span> n,a[N],lmx[N],rmx[N];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Insert</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line"><span class="keyword">int</span> p = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">32</span>;i &gt;= <span class="number">0</span>;i--)&#123;</span><br><span class="line"><span class="keyword">int</span> ch = (x&gt;&gt;i)&amp;<span class="number">1</span>;</span><br><span class="line"><span class="keyword">if</span>(!trie[p][ch]) trie[p][ch] = ++tot;</span><br><span class="line">p = trie[p][ch];</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">search</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line"><span class="keyword">int</span> p = <span class="number">1</span>, res = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">32</span>;i &gt;= <span class="number">0</span>;i--)&#123;</span><br><span class="line"><span class="keyword">int</span> ch = (x&gt;&gt;i)&amp;<span class="number">1</span>;</span><br><span class="line"><span class="keyword">if</span>(trie[p][!ch]) p = trie[p][!ch],res |= <span class="number">1</span>&lt;&lt;i;</span><br><span class="line"><span class="keyword">else</span> p = trie[p][ch];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">int</span> x = <span class="number">0</span>;Insert(<span class="number">0</span>);</span><br><span class="line"><span class="comment">/* x ç”¨äºç´¯è®¡å¼‚æˆ–å‰ç¼€å’Œ,Trieç”¨äºæ±‚æœ€å¤§å¼‚æˆ–åŒºé—´*/</span></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++)&#123;</span><br><span class="line">x ^= a[i]; Insert(x);</span><br><span class="line">lmx[i] = max(search(x),lmx[i<span class="number">-1</span>]);</span><br><span class="line"><span class="comment">//åŒ…å«xçš„æœ€å¤§åŒºé—´å¼‚æˆ–å’Œ ä¸  ä¸åŒ…å«xçš„åŒºé—´çš„æœ€å¤§å¼‚æˆ–å’Œ </span></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">memset</span>(trie,<span class="number">0</span>,<span class="keyword">sizeof</span> trie); tot = <span class="number">1</span>;</span><br><span class="line">Insert(<span class="number">0</span>); x = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = n;i &gt; <span class="number">0</span>;i--)&#123;</span><br><span class="line">x ^= a[i]; Insert(x);</span><br><span class="line">rmx[i] = max(search(x),rmx[i+<span class="number">1</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> ans = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt;= n;i++) ans = max(ans,lmx[i]+rmx[i+<span class="number">1</span>]);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%d\n"</span>,ans);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">getInt</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">int</span> ans = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">bool</span> neg = <span class="literal">false</span>;</span><br><span class="line"><span class="keyword">char</span> c = getchar();</span><br><span class="line"><span class="keyword">while</span> (c!=<span class="string">'-'</span> &amp;&amp; (c&lt;<span class="string">'0'</span> || c&gt;<span class="string">'9'</span>)) c = getchar();</span><br><span class="line"><span class="keyword">if</span> (c == <span class="string">'-'</span>) neg = <span class="literal">true</span>, c = getchar();</span><br><span class="line"><span class="keyword">while</span> (c&gt;=<span class="string">'0'</span> &amp;&amp; c&lt;=<span class="string">'9'</span>)</span><br><span class="line">ans = ans*<span class="number">10</span> + c-<span class="string">'0'</span>, c = getchar();</span><br><span class="line"><span class="keyword">return</span> neg ? -ans : ans; </span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="comment">//freopen("123.txt","r",stdin);</span></span><br><span class="line">n = getInt();</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++) a[i] = getInt();</span><br><span class="line">solve();</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h4 id="Immediate-Decodability"><a href="#Immediate-Decodability" class="headerlink" title="Immediate Decodability"></a>Immediate Decodability</h4><p><strong>é¢˜æ„ç®€è¿°</strong><br>åŸé¢˜æ¥è‡ªï¼šACM Pacific NW Region 1998<br>ç»™å‡ºä¸€äº›æ•°å­—ä¸²ï¼Œåˆ¤æ–­æ˜¯å¦æœ‰ä¸€ä¸ªæ•°å­—ä¸²æ˜¯å¦ä¸€ä¸ªä¸²çš„å‰ç¼€ã€‚<br><strong>è§£é¢˜æ€è·¯</strong><br>å’Œç¬¬1é¢˜ä¸€æ ·ï¼Œæ¨¡æ¿é¢˜ã€‚<br><strong>ä»£ç ç¤ºä¾‹</strong><br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> SZ = <span class="number">1e5</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">int</span> trie[SZ][<span class="number">30</span>], tot = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">int</span> End[SZ];</span><br><span class="line"><span class="keyword">int</span> n,t,cnt = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1e4</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">char</span> str[N][<span class="number">20</span>];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Insert</span><span class="params">(<span class="keyword">char</span> *s)</span></span>&#123;</span><br><span class="line"><span class="comment">/* å°†å­—ä¸²sæ’å…¥trieæ ‘ */</span></span><br><span class="line"><span class="keyword">int</span> len = <span class="built_in">strlen</span>(s) ,p = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; len;i++)&#123;</span><br><span class="line"><span class="keyword">int</span> ch = s[i]-<span class="string">'0'</span>;</span><br><span class="line"><span class="keyword">if</span>(trie[p][ch] == <span class="number">0</span>) trie[p][ch] = ++tot;</span><br><span class="line">p = trie[p][ch];</span><br><span class="line">&#125;</span><br><span class="line">End[p]++;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">search</span><span class="params">(<span class="keyword">char</span> *s)</span></span>&#123;</span><br><span class="line"><span class="comment">/* å­—ä¸²sæ˜¯å¦æœ‰å‰ç¼€ */</span> </span><br><span class="line"><span class="keyword">int</span> len = <span class="built_in">strlen</span>(s), p = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; len;i++)&#123;</span><br><span class="line"><span class="keyword">int</span> ch = s[i]-<span class="string">'0'</span>;</span><br><span class="line"><span class="keyword">if</span>(End[p]) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">p = trie[p][ch];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">solve</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++) Insert(str[i]);</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++)</span><br><span class="line"><span class="keyword">if</span>(search(str[i])) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">while</span>(<span class="built_in">scanf</span>(<span class="string">"%s"</span>,str[++n]) != EOF)&#123;</span><br><span class="line"><span class="comment">/* åˆå§‹åŒ–trieç›¸å…³å˜é‡ */</span></span><br><span class="line"><span class="keyword">if</span>(<span class="built_in">strlen</span>(str[n]) == <span class="number">1</span> &amp;&amp; str[n][<span class="number">0</span>] == <span class="string">'9'</span>)&#123;</span><br><span class="line"><span class="keyword">if</span>(!solve()) <span class="built_in">printf</span>(<span class="string">"Set %d is immediately decodable\n"</span>,++cnt);</span><br><span class="line"><span class="keyword">else</span> <span class="built_in">printf</span>(<span class="string">"Set %d is not immediately decodable\n"</span>,++cnt);</span><br><span class="line"><span class="built_in">memset</span>(End,<span class="number">0</span>,<span class="keyword">sizeof</span> End); tot = <span class="number">1</span>;</span><br><span class="line"><span class="built_in">memset</span>(trie,<span class="number">0</span>,<span class="keyword">sizeof</span> trie); n = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h4 id="Lè¯­è¨€"><a href="#Lè¯­è¨€" class="headerlink" title="Lè¯­è¨€*"></a>Lè¯­è¨€*</h4><p><strong>é¢˜æ„ç®€è¿°</strong></p><p>åŸé¢˜æ¥è‡ªï¼šHNOI 2004<br>æ ‡ç‚¹ç¬¦å·çš„å‡ºç°æ™šäºæ–‡å­—çš„å‡ºç°ï¼Œæ‰€ä»¥ä»¥å‰çš„è¯­è¨€éƒ½æ˜¯æ²¡æœ‰æ ‡ç‚¹çš„ã€‚ç°åœ¨ä½ è¦å¤„ç†çš„å°±æ˜¯ä¸€æ®µæ²¡æœ‰æ ‡ç‚¹çš„æ–‡ç« ã€‚<br>ä¸€æ®µæ–‡ç«  T æ˜¯ç”±è‹¥å¹²å°å†™å­—æ¯æ„æˆã€‚ä¸€ä¸ªå•è¯ W ä¹Ÿæ˜¯ç”±è‹¥å¹²å°å†™å­—æ¯æ„æˆã€‚ä¸€ä¸ªå­—å…¸ D æ˜¯è‹¥å¹²ä¸ªå•è¯çš„é›†åˆã€‚<br>æˆ‘ä»¬ç§°ä¸€æ®µæ–‡ç«  T åœ¨æŸä¸ªå­—å…¸ D ä¸‹æ˜¯å¯ä»¥è¢«ç†è§£çš„ï¼Œæ˜¯æŒ‡å¦‚æœæ–‡ç«  T å¯ä»¥è¢«åˆ†æˆè‹¥å¹²éƒ¨åˆ†ï¼Œä¸”æ¯ä¸€ä¸ªéƒ¨åˆ†éƒ½æ˜¯å­—å…¸ D ä¸­çš„å•è¯ã€‚ä¾‹å¦‚å­—å…¸ D ä¸­åŒ…æ‹¬å•è¯ is , your , what , name ï¼Œåˆ™æ–‡ç«  whatisyourname æ˜¯åœ¨å­—å…¸ D ä¸‹å¯ä»¥è¢«ç†è§£çš„ï¼Œå› ä¸ºå®ƒå¯ä»¥åˆ†æˆ 4 ä¸ªå•è¯ï¼š what , is , your , name ï¼Œä¸”æ¯ä¸ªå•è¯éƒ½å±äºå­—å…¸ Dï¼Œè€Œæ–‡ç«  whatisyouname åœ¨å­—å…¸ D ä¸‹ä¸èƒ½è¢«ç†è§£ï¼Œä½†å¯ä»¥åœ¨å­—å…¸ Dâ€²=D+you ä¸‹è¢«ç†è§£ã€‚è¿™æ®µæ–‡ç« çš„ä¸€ä¸ªå‰ç¼€ whatis ï¼Œä¹Ÿå¯ä»¥åœ¨å­—å…¸ D ä¸‹è¢«ç†è§£ è€Œä¸”æ˜¯åœ¨å­—å…¸ D ä¸‹èƒ½å¤Ÿè¢«ç†è§£çš„æœ€é•¿çš„å‰ç¼€ã€‚<br>ç»™å®šä¸€ä¸ªå­—å…¸ D ï¼Œä½ çš„ç¨‹åºéœ€è¦åˆ¤æ–­è‹¥å¹²æ®µæ–‡ç« åœ¨å­—å…¸ D ä¸‹æ˜¯å¦èƒ½å¤Ÿè¢«ç†è§£ã€‚ å¹¶ç»™å‡ºå…¶åœ¨å­—å…¸ D ä¸‹èƒ½å¤Ÿè¢«ç†è§£çš„æœ€é•¿å‰ç¼€çš„ä½ç½®ã€‚<br><strong>è§£é¢˜æ€è·¯</strong><br>è¿™é¢˜æœ‰ç‚¹éš¾çš„åœ°æ–¹æ˜¯  æ–‡ç« ä¸­æŸä¸ªå‰ç¼€å¯èƒ½ç”±å¤šä¸ªå•è¯ç»„åˆå‡ºæ¥ï¼Œäºæ˜¯æˆ‘ä»¬éœ€è¦å¯¹æ¯ä¸ªå¯èƒ½æ˜¯å•è¯æœ«å°¾çš„ä½ç½®å†è¿›è¡Œä¸‹ä¸€æ¬¡åŒ¹é…ï¼Œæ£€æŸ¥å…¶åæ˜¯å¦æœ‰å­—å…¸Dä¸­çš„å•è¯ã€‚</p><p>æˆ‘ä»¬é¦–å…ˆå°†æ‰€æœ‰å•è¯æ’å…¥å­—å…¸æ ‘ï¼Œç”±äºå•è¯é•¿åº¦å°äº10ï¼Œæ‰€ä»¥å¯¹äºæ¯ä¸ªå•è¯ï¼Œæˆ‘ä»¬æœ€å¤šæ¯”è¾ƒ10æ¬¡å°±èƒ½çŸ¥é“è¯¥å­—ä¸²æ˜¯å¦ä¸ºå­—å…¸Dä¸­çš„å•è¯ã€‚æ¯æ¬¡åŒ¹é…éƒ½è¦ä»å­—å…¸æ ‘çš„æ ¹å¼€å§‹åŒ¹é…ã€‚<br>æˆ‘ä»¬è®¾f[i]è¡¨ç¤º â€œæ–‡ç« ä¸­ç¬¬ i ä½æ˜¯å¦ä¸ºå¯ä»¥è¢«Dç†è§£çš„æŸä¸ªå‰ç¼€çš„æœ«å°¾â€ï¼›å¦‚æœ f[i] ä¸º 1 ï¼Œé‚£ä¹ˆè¯´æ˜[1, i]éƒ½å¯ä»¥è¢«Dç†è§£ï¼Œæ¥ä¸‹æ¥åªè¦å†ä» i+1 ä½å¼€å§‹å°è¯•åœ¨å­—å…¸æ ‘åŒ¹é…å•è¯å³å¯ã€‚<br>è¿™æ˜¯å­˜åœ¨æ€§DPï¼ŒçŠ¶æ€è½¬ç§»å¾ˆç®€å•ï¼Œåœ¨å­—å…¸æ ‘æŸ¥æ‰¾å•è¯æ—¶ï¼Œè‹¥å½“å‰ä½ç½®æ˜¯æŸä¸ªå•è¯çš„æœ«å°¾ï¼Œå³End[ p ] = 1ï¼Œé‚£ä¹ˆf[ pos ] = 1ï¼ˆposä¸ºå½“å‰å­—ç¬¦ä½ç½®ï¼‰ï¼Œæ—¶é—´å¤æ‚åº¦ä¸ºO(10N)ã€‚</p><p><strong>ä¼˜åŒ–</strong><br>åœ¨ æŸ¥æ‰¾/åŒ¹é… å•è¯æ—¶ï¼Œæˆ‘ä¹ æƒ¯å°†å…¶å°è£…ä¸ºä¸€ä¸ªå‡½æ•°search(char * s)ï¼Œä½†æ˜¯æœ€å·®æƒ…å†µæˆ‘ä»¬ä¼šè°ƒç”¨1e6æ¬¡è¯¥å‡½æ•°ï¼Œè™½ç„¶è¯¥å‡½æ•°å†…æœ€å¤šåªæ¯”è¾ƒ10æ¬¡ï¼Œä½†æ˜¯å‡½æ•°ä¼ å‚ä»¥åŠä¿æŠ¤ç°åœºä»¥åŠæ¢å¤ç­‰æ­¥éª¤è¿˜æ˜¯ä¼šå¤§å¤§å¢åŠ èŠ±è´¹çš„æ—¶é—´ã€‚ç»è¿‡æµ‹è¯•ï¼Œå†™æˆå‡½æ•°è°ƒç”¨å½¢å¼åœ¨1e6æ•°æ®ä¸‹å¤§æ¦‚ä¼šæ¯”ç›´æ¥å±•å¼€æ…¢å‡ åç§’ï¼Œå½“ç„¶è¿˜æ˜¯å¯ä»¥é€šè¿‡ä¸€äº›æ­¥éª¤ä¼˜åŒ–å‡½æ•°è°ƒç”¨çš„ã€‚</p><p><strong>ä»£ç ç¤ºä¾‹</strong><br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">2e6</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> SZ = <span class="number">1e4</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">int</span> trie[SZ][<span class="number">30</span>],End[SZ], tot = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">int</span> n,m;</span><br><span class="line"><span class="keyword">char</span> str[N],s[<span class="number">30</span>];</span><br><span class="line"><span class="keyword">bool</span> f[N];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Insert</span><span class="params">(<span class="keyword">char</span> *s)</span></span>&#123;</span><br><span class="line"><span class="keyword">int</span> len = <span class="built_in">strlen</span>(s), p = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; len;i++)&#123;</span><br><span class="line"><span class="keyword">int</span> ch = s[i]-<span class="string">'a'</span>;</span><br><span class="line"><span class="keyword">if</span>(!trie[p][ch]) trie[p][ch] = ++tot;</span><br><span class="line">p = trie[p][ch];</span><br><span class="line">&#125;</span><br><span class="line">End[p] = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">int</span> len = <span class="built_in">strlen</span>(str)<span class="number">-1</span>, ans;</span><br><span class="line"><span class="built_in">memset</span>(f,<span class="number">0</span>,<span class="keyword">sizeof</span> f); f[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line"><span class="comment">//printf("%d\n",len);</span></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt;= len;i++)&#123;</span><br><span class="line"><span class="keyword">if</span>(!f[i]) <span class="keyword">continue</span>;</span><br><span class="line">ans = i;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> j = i+<span class="number">1</span>,p = <span class="number">1</span>;j &lt;= len;j++)&#123;</span><br><span class="line"><span class="keyword">int</span> ch = str[j]-<span class="string">'a'</span>;</span><br><span class="line">p = trie[p][ch];</span><br><span class="line"><span class="keyword">if</span>(!p) <span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">if</span>(End[p]) f[j] = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%d\n"</span>,ans);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="comment">//freopen("123.txt","r",stdin);</span></span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;n,&amp;m);</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++)&#123;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%s"</span>,s); Insert(s);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= m;i++)&#123;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%s"</span>,str+<span class="number">1</span>);</span><br><span class="line">str[<span class="number">0</span>] = <span class="string">'#'</span>; solve();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h4 id="Secret-Message-ç§˜å¯†ä¿¡æ¯"><a href="#Secret-Message-ç§˜å¯†ä¿¡æ¯" class="headerlink" title="Secret Message ç§˜å¯†ä¿¡æ¯"></a>Secret Message ç§˜å¯†ä¿¡æ¯</h4><p><strong>é¢˜æ„æè¿°</strong><br>åŸé¢˜æ¥è‡ªï¼šUSACO 2008 Dec. Gold<br>è´èŒœæ­£åœ¨é¢†å¯¼å¥¶ç‰›ä»¬é€ƒè·‘ã€‚ä¸ºäº†è”ç»œï¼Œå¥¶ç‰›ä»¬äº’ç›¸å‘é€ç§˜å¯†ä¿¡æ¯ã€‚ä¿¡æ¯æ˜¯äºŒè¿›åˆ¶çš„ï¼Œå…±æœ‰ M æ¡ã€‚åé—´è°èƒ½åŠ›å¾ˆå¼ºçš„çº¦ç¿°å·²ç»éƒ¨åˆ†æ‹¦æˆªäº†è¿™äº›ä¿¡æ¯ï¼ŒçŸ¥é“äº†ç¬¬ i æ¡äºŒè¿›åˆ¶ä¿¡æ¯çš„å‰ bi ä½ã€‚<br>ä»–åŒæ—¶çŸ¥é“ï¼Œå¥¶ç‰›ä½¿ç”¨ N æ¡å¯†ç ã€‚ä½†æ˜¯ï¼Œä»–ä»…ä»…äº†è§£ç¬¬ j æ¡å¯†ç çš„å‰ cjä½ã€‚å¯¹äºæ¯æ¡å¯†ç  j ï¼Œä»–æƒ³çŸ¥é“æœ‰å¤šå°‘æˆªå¾—çš„ä¿¡æ¯èƒ½å¤Ÿå’Œå®ƒåŒ¹é…ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæœ‰å¤šå°‘ä¿¡æ¯å’Œè¿™æ¡å¯†ç æœ‰ç€ç›¸åŒçš„å‰ç¼€ã€‚å½“ç„¶ï¼Œè¿™ä¸ªå‰ç¼€é•¿åº¦å¿…é¡»ç­‰äºå¯†ç å’Œé‚£æ¡ä¿¡æ¯é•¿åº¦çš„è¾ƒå°è€…ã€‚</p><p><strong>è§£é¢˜æ€è·¯</strong><br>æ ¹æ®æ‰€ç»™æ ·ä¾‹å‘¢ï¼Œå¯ä»¥æ›´åŠ æ˜ç¡®é¢˜æ„ã€‚é¦–å…ˆæˆ‘ä»¬å°†Mæ¡ä¿¡æ¯çœ‹ä½œ01å­—ç¬¦ä¸²ï¼ŒåŒç†Næ¡å¯†ç ä¹Ÿçœ‹ä½œ01å­—ç¬¦ä¸²ï¼Œé¢˜æ„é—®çš„å°±æ˜¯å¯¹äºæ¯ä¸ªå¯†ç ï¼Œæœ‰å¤šå°‘æ¡ä¿¡æ¯å¯èƒ½å’Œè¯¥å¯†ç åŒ¹é…ï¼Œå¦‚æœä¸€æ¡ä¿¡æ¯ A å’Œå¯†ç  B åŒ¹é…ï¼Œé‚£ä¹ˆæœ‰ A æ˜¯ B çš„å‰ç¼€æˆ– B æ˜¯ A çš„å‰ç¼€ã€‚<br>äºæ˜¯æˆ‘ä»¬å°±åªéœ€è¦å…ˆæŠŠ01æ•°ç»„è½¬åŒ–ä¸º01å­—ç¬¦ä¸²ï¼Œå†ç”¨trieç»Ÿè®¡å³å¯ï¼Œå½“ç„¶ç”±äºåŒä¸€ä¿¡æ¯å¯èƒ½ä¼šé‡å¤å‡ºç°ï¼Œæ‰€ä»¥ End[p] è®°å½•çš„æ˜¯ä»¥ p ç»“å°¾çš„å­—ä¸²ä¸ªæ•°ã€‚<br>åœ¨æœ¬æœºä¸æ´›è°·ä¸Šéƒ½æ˜¯å¯ä»¥ACçš„ï¼Œå¤æ‚åº¦å¤§æ¦‚O(5e5)ï¼Œä½†æ˜¯åœ¨ä¸€æœ¬é€šOJå°±è¿‡ä¸å»ï¼ŒçŒœæµ‹å¯èƒ½æ˜¯ä¸æ”¯æŒå…³é—­ scanf åŒæ­¥æµï¼Ÿå¾…ä¿®æ”¹ã€‚<br><strong>ä»£ç ç¤ºä¾‹</strong><br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">int</span> n,m;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">5e4</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> SZ = <span class="number">5e5</span>+<span class="number">10</span>;</span><br><span class="line"><span class="built_in">string</span> str[N],s[N];</span><br><span class="line"><span class="keyword">int</span> trie[SZ][<span class="number">2</span>],End[SZ],tot = <span class="number">1</span>,tc[SZ];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Insert</span><span class="params">(<span class="keyword">const</span> <span class="built_in">string</span>&amp; s)</span></span>&#123;</span><br><span class="line"><span class="keyword">int</span> len = s.length(), p = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; len;i++)&#123;</span><br><span class="line"><span class="keyword">int</span> ch = s[i]-<span class="string">'0'</span>;</span><br><span class="line"><span class="keyword">if</span>(!trie[p][ch]) trie[p][ch] = ++tot;</span><br><span class="line">p = trie[p][ch];</span><br><span class="line">tc[p]++;</span><br><span class="line">&#125;</span><br><span class="line">End[p]++;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">search</span><span class="params">(<span class="keyword">const</span> <span class="built_in">string</span>&amp; s)</span></span>&#123;</span><br><span class="line"><span class="comment">//cout &lt;&lt; s &lt;&lt; "-" &lt;&lt; endl;</span></span><br><span class="line"><span class="keyword">int</span> len = s.length(), p = <span class="number">1</span>,res = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; len;i++)&#123;</span><br><span class="line"><span class="keyword">int</span> ch = s[i]-<span class="string">'0'</span>;</span><br><span class="line">p = trie[p][ch];</span><br><span class="line"><span class="keyword">if</span>(!p) <span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">if</span>(End[p] &amp;&amp; i != len<span class="number">-1</span>) res += End[p];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> res + tc[p];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++) Insert(str[i]);</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= m;i++) <span class="built_in">cout</span> &lt;&lt; search(s[i]) &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">ios::sync_with_stdio(<span class="literal">false</span>);</span><br><span class="line"><span class="comment">//freopen("123.txt","r",stdin);</span></span><br><span class="line"><span class="comment">//freopen("222.txt","w",stdout);</span></span><br><span class="line"><span class="built_in">cin</span> &gt;&gt; n &gt;&gt; m;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>,k;i &lt;= n;i++)&#123;</span><br><span class="line"><span class="built_in">cin</span> &gt;&gt; k;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">1</span>,x;j &lt;= k;j++) <span class="built_in">cin</span> &gt;&gt; x, str[i] += x+<span class="string">'0'</span>;</span><br><span class="line"><span class="comment">//cout &lt;&lt; str[i] &lt;&lt; endl;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>,k;i &lt;= m;i++)&#123;</span><br><span class="line"><span class="built_in">cin</span> &gt;&gt; k;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">1</span>,x;j &lt;= k;j++) <span class="built_in">cin</span> &gt;&gt; x, s[i] += x+<span class="string">'0'</span>;</span><br><span class="line"><span class="comment">//cout &lt;&lt; s[i] &lt;&lt; endl;</span></span><br><span class="line">&#125;</span><br><span class="line">solve();</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h4 id="ã€SCOI2016ã€‘èƒŒå•è¯"><a href="#ã€SCOI2016ã€‘èƒŒå•è¯" class="headerlink" title="ã€SCOI2016ã€‘èƒŒå•è¯*"></a>ã€SCOI2016ã€‘èƒŒå•è¯*</h4><p><strong>é¢˜æ„ç®€è¿°</strong><br>Lweb é¢å¯¹å¦‚å±±çš„è‹±è¯­å•è¯ï¼Œé™·å…¥äº†æ·±æ·±çš„æ²‰æ€ï¼Œã€Œæˆ‘æ€ä¹ˆæ ·æ‰èƒ½å¿«ç‚¹å­¦å®Œï¼Œç„¶åå»ç©ä¸‰å›½æ€å‘¢ï¼Ÿã€ã€‚<br>è¿™æ—¶å€™ç¿æ™ºçš„å‡¤è€å¸ˆä»è¿œå¤„é£˜æ¥ï¼Œä»–é€ç»™äº† Lweb ä¸€æœ¬è®¡åˆ’å†Œå’Œä¸€å¤§ç¼¸æ³¡æ¤’ï¼Œç„¶åå‡¤è€å¸ˆå‘Šè¯‰ Lweb ï¼Œæˆ‘çŸ¥é“ä½ è¦å­¦ä¹ çš„å•è¯æ€»å…±æœ‰ n ä¸ªï¼Œç°åœ¨æˆ‘ä»¬ä»ä¸Šå¾€ä¸‹å®Œæˆè®¡åˆ’è¡¨ï¼Œå¯¹äºä¸€ä¸ªåºå·ä¸º x çš„å•è¯ï¼ˆåºå· 1â€¦xâˆ’1 éƒ½å·²ç»è¢«å¡«å…¥ï¼‰ï¼š</p><ul><li>å¦‚æœå­˜åœ¨ä¸€ä¸ªå•è¯æ˜¯å®ƒçš„åç¼€ï¼Œå¹¶ä¸”å½“å‰æ²¡æœ‰è¢«å¡«å…¥è¡¨å†…ï¼Œé‚£ä»–éœ€è¦åƒ nÃ—n é¢—æ³¡æ¤’æ‰èƒ½å­¦ä¼šï¼›</li><li>å½“å®ƒçš„æ‰€æœ‰åç¼€éƒ½è¢«å¡«å…¥è¡¨å†…çš„æƒ…å†µä¸‹ï¼Œå¦‚æœåœ¨ 1â€¦xâˆ’1 çš„ä½ç½®ä¸Šçš„å•è¯éƒ½ä¸æ˜¯å®ƒçš„åç¼€ï¼Œé‚£ä¹ˆä»–åƒ x é¢—æ³¡æ¤’å°±èƒ½è®°ä½å®ƒï¼›</li><li>å½“å®ƒçš„æ‰€æœ‰åç¼€éƒ½è¢«å¡«å…¥è¡¨å†…çš„æƒ…å†µä¸‹ï¼Œå¦‚æœ 1â€¦xâˆ’1 çš„ä½ç½®ä¸Šå­˜åœ¨æ˜¯å®ƒåç¼€çš„å•è¯ï¼Œæ‰€æœ‰æ˜¯å®ƒåç¼€çš„å•è¯ä¸­ï¼Œåºå·æœ€å¤§ä¸º yï¼Œé‚£ä¹ˆä½ åªè¦åƒ xâˆ’y é¢—æ³¡æ¤’å°±èƒ½æŠŠå®ƒè®°ä½ã€‚</li></ul><p>Lweb æ˜¯ä¸€ä¸ªåƒåˆ°è¾£è¾£çš„ä¸œè¥¿ä¼šæš´èµ°çš„å¥‡æ€ªå°æœ‹å‹ï¼Œæ‰€ä»¥è¯·ä½ å¸®åŠ© Lwebï¼Œå¯»æ‰¾ä¸€ç§æœ€ä¼˜çš„å¡«å†™å•è¯æ–¹æ¡ˆï¼Œä½¿å¾—ä»–è®°ä½è¿™  n ä¸ªå•è¯çš„æƒ…å†µä¸‹ï¼Œåƒæœ€å°‘çš„æ³¡æ¤’ã€‚</p><p><strong>è§£é¢˜æ€è·¯</strong><br>é¦–å…ˆæŠŠæ‰€æœ‰å­—ç¬¦ä¸²åè½¬ï¼Œé‚£ä¹ˆåç¼€å°±å˜æˆå‰ç¼€äº†ï¼Œå°±å¯ä»¥ç”¨trieç»´æŠ¤ã€‚<br>åˆšå¼€å§‹æˆ‘æ˜¯æƒ³è®°å½•æ¯ä¸ªå­—ç¬¦ä¸²çš„å‰ç¼€ä¸ªæ•°ï¼Œç„¶åæ ¹æ®ä¸ªæ•°ä»å°åˆ°å¤§åˆ†é…ç¼–å·ï¼Œä½†æ˜¾ç„¶ä¸è¡Œã€‚<br>æ­£è§£æ˜¯å°†æ‰€æœ‰å­—ç¬¦ä¸²æ„æˆä¸€æ£µæ ‘ï¼Œä¸€ä¸ªèŠ‚ç‚¹çš„çˆ¶äº²å°±æ˜¯å®ƒçš„å‰ç¼€ï¼Œè€Œæ²¡æœ‰å‰ç¼€çš„å­—ç¬¦ä¸²çˆ¶äº²ä¸º 0 å·èŠ‚ç‚¹ã€‚æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ trieä¸­çš„ search æ—¶å¡«è¾¹å»ºæ ‘ã€‚<br>è¿™æ ·æˆ‘ä»¬å°±æœ‰ä¸€æ£µæœ‰å‘æ ‘äº†ï¼Œå‡è®¾æˆ‘ä»¬ç»™èŠ‚ç‚¹ x åˆ†é…çš„åºå·æ˜¯ f[x] ï¼Œé‚£ä¹ˆæ˜¾ç„¶ ans += f[x] - f[par[x] ]ï¼Œå…¶ä¸­ par[x] ä»£è¡¨ x çš„çˆ¶äº²èŠ‚ç‚¹ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦è®©æ¯ä¸ªèŠ‚ç‚¹å’Œå®ƒçˆ¶äº²èŠ‚ç‚¹çš„ç¼–å·ç›¸å·®å°½é‡å°ï¼Œé‚£ä¹ˆè‡ªç„¶æ˜¯ä¼˜å…ˆç»™èŠ‚ç‚¹æ•°å°‘çš„å­æ ‘åˆ†é…ç¼–å·å’¯ï¼Œæ‰€ä»¥å¯¹äºæ¯ä¸ªèŠ‚ç‚¹ x ï¼Œæˆ‘ä»¬é€‰æ‹©èŠ‚ç‚¹æœ€å°çš„ä¸€æ£µå­æ ‘ï¼Œä¸ºå®ƒä»¬åˆ†é…ç¼–å·ã€‚</p><p><strong>ä»£ç ç¤ºä¾‹</strong><br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1e5</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> SZ = <span class="number">6e5</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">int</span> tc[N];<span class="comment">//è®°å½•åç¼€ä¸ªæ•°</span></span><br><span class="line"><span class="keyword">int</span> trie[SZ][<span class="number">30</span>],End[SZ], tot = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> par[N], head[N], ver[N], nex[N],tot2 = <span class="number">1</span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">addEdge</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> y)</span></span>&#123;</span><br><span class="line">ver[++tot2] = y, nex[tot2] = head[x], head[x] = tot2;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Insert</span><span class="params">(<span class="keyword">const</span> <span class="built_in">string</span>&amp; s,<span class="keyword">int</span> id)</span></span>&#123;</span><br><span class="line"><span class="comment">//cout &lt;&lt; s &lt;&lt; endl;</span></span><br><span class="line"><span class="keyword">int</span> len = s.length(), p = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; len;i++)&#123;</span><br><span class="line"><span class="keyword">int</span> ch = s[i]-<span class="string">'a'</span>;</span><br><span class="line"><span class="keyword">if</span>(!trie[p][ch]) trie[p][ch] = ++tot;</span><br><span class="line">p = trie[p][ch];</span><br><span class="line">&#125;</span><br><span class="line">End[p] = id;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">search</span><span class="params">(<span class="keyword">const</span> <span class="built_in">string</span>&amp; s,<span class="keyword">int</span> id)</span></span>&#123;</span><br><span class="line"><span class="comment">//cout &lt;&lt; s &lt;&lt; endl;</span></span><br><span class="line"><span class="keyword">int</span> len = s.length(), p = <span class="number">1</span> ,res = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; len;i++)&#123;</span><br><span class="line"><span class="keyword">int</span> ch = s[i]-<span class="string">'a'</span>;</span><br><span class="line">p = trie[p][ch];</span><br><span class="line"><span class="keyword">if</span>(End[p] &amp;&amp; i != len<span class="number">-1</span>) par[id] = End[p];</span><br><span class="line">&#125;</span><br><span class="line">addEdge(par[id],id);<span class="comment">//é¡ºä¾¿å»ºæ ‘å•¦ </span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n;</span><br><span class="line"><span class="built_in">string</span> str[N];</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll;</span><br><span class="line"><span class="keyword">int</span> num[N];<span class="comment">//è®°å½•å­æ ‘xçš„èŠ‚ç‚¹ä¸ªæ•° </span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = head[x];i != <span class="number">-1</span>;i = nex[i])&#123;</span><br><span class="line"><span class="keyword">int</span> y = ver[i];</span><br><span class="line">num[x] += dfs(y);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> num[x]+<span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ll ans = <span class="number">0</span>, cnt = <span class="number">0</span>;</span><br><span class="line">priority_queue&lt; pair&lt;<span class="keyword">int</span>,<span class="keyword">int</span>&gt; &gt; q;</span><br><span class="line"><span class="keyword">int</span> f[N]; <span class="comment">//è®°å½•xç¼–å· </span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">calc</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">ans += cnt - f[par[x]]; f[x] = cnt; </span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = head[x];i != <span class="number">-1</span>;i = nex[i])&#123;</span><br><span class="line"><span class="keyword">int</span> y = ver[i];</span><br><span class="line">q.push(make_pair(-num[y],y));</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> nnex[q.size()],tt = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span>(!q.empty())&#123;</span><br><span class="line"><span class="keyword">int</span> y = q.top().second;q.pop();</span><br><span class="line">nnex[tt++] = y;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; tt;i++) cnt++, calc(nnex[i]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="built_in">memset</span>(head,<span class="number">-1</span>,<span class="keyword">sizeof</span> head);</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++) Insert(str[i],i);</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++) search(str[i],i);</span><br><span class="line">num[<span class="number">0</span>] = dfs(<span class="number">0</span>); calc(<span class="number">0</span>);</span><br><span class="line"><span class="built_in">cout</span> &lt;&lt; ans &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="comment">//freopen("123.txt","r",stdin);</span></span><br><span class="line">ios::sync_with_stdio(<span class="literal">false</span>);</span><br><span class="line"><span class="built_in">cin</span> &gt;&gt; n;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++) <span class="built_in">cin</span> &gt;&gt; str[i];</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++) reverse(str[i].begin(),str[i].end());</span><br><span class="line">solve();</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h4 id="The-xor-longest-Path"><a href="#The-xor-longest-Path" class="headerlink" title="The xor-longest Path*"></a>The xor-longest Path*</h4><p><strong>é¢˜æ„ç®€è¿°</strong><br>åŸé¢˜æ¥è‡ªï¼šPOJ 3764<br>ç»™å®šä¸€æ£µ n ä¸ªç‚¹çš„å¸¦æƒæ ‘ï¼Œæ±‚æ ‘ä¸Šæœ€é•¿çš„å¼‚æˆ–å’Œè·¯å¾„ã€‚</p><p><strong>è§£é¢˜æ€è·¯</strong><br>è®¾ d[x] è¡¨ç¤º x åˆ°æ ¹èŠ‚ç‚¹çš„è·¯å¾„å¼‚æˆ–å’Œï¼Œé‚£ä¹ˆæ˜¾ç„¶ç”±äºå¼‚æˆ–çš„ç‰¹æ€§ï¼Œx^y^x = yï¼Œæˆ‘ä»¬ä»»é€‰ä¸¤ä¸ªç‚¹ x å’Œ y ï¼Œé‚£ä¹ˆd[x] ^ d[y]å°±æ˜¯ x å’Œ y ä¹‹é—´çš„è·¯å¾„å¼‚æˆ–å’Œï¼Œå› ä¸ºä»LCA(x , y)åˆ°æ ¹èŠ‚ç‚¹çš„è·¯å¾„éƒ½è¢«æŠµæ¶ˆäº†ã€‚<br>æ‰€ä»¥åŸé—®é¢˜å°±æˆäº†ä» d[1,n] ä¸­é€‰ä¸¤ä¸ªæ•°ï¼Œä½¿å®ƒä»¬çš„å¼‚æˆ–å’Œæœ€å¤§ã€‚</p><p><strong>ä»£ç ç¤ºä¾‹</strong><br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">2e5</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">int</span> head[N],ver[N],nex[N],edge[N],tot = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">int</span> n,d[N];<span class="comment">//d[x]:xåˆ°æ ¹èŠ‚ç‚¹çš„è·¯å¾„å¼‚æˆ–å’Œ </span></span><br><span class="line"><span class="keyword">bool</span> vis[N];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">addEdge</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> y,<span class="keyword">int</span> z)</span></span>&#123;</span><br><span class="line">ver[++tot] = y, nex[tot] = head[x];</span><br><span class="line">edge[tot] = z, head[x] = tot;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">getInt</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">int</span> ans = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">bool</span> neg = <span class="literal">false</span>;</span><br><span class="line"><span class="keyword">char</span> c = getchar();</span><br><span class="line"><span class="keyword">while</span> (c!=<span class="string">'-'</span> &amp;&amp; (c&lt;<span class="string">'0'</span> || c&gt;<span class="string">'9'</span>)) c = getchar();</span><br><span class="line"><span class="keyword">if</span> (c == <span class="string">'-'</span>) neg = <span class="literal">true</span>, c = getchar();</span><br><span class="line"><span class="keyword">while</span> (c&gt;=<span class="string">'0'</span> &amp;&amp; c&lt;=<span class="string">'9'</span>)</span><br><span class="line">ans = ans*<span class="number">10</span> + c-<span class="string">'0'</span>, c = getchar();</span><br><span class="line"><span class="keyword">return</span> neg ? -ans : ans; </span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">vis[x] = <span class="literal">true</span>; </span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = head[x];i ;i = nex[i])&#123;</span><br><span class="line"><span class="keyword">int</span> y = ver[i], z = edge[i];</span><br><span class="line"><span class="keyword">if</span>(vis[y]) <span class="keyword">continue</span>;</span><br><span class="line"><span class="comment">//printf("%d %d %d\n",x,y,z);</span></span><br><span class="line">d[y] = d[x]^z;</span><br><span class="line">dfs(y);</span><br><span class="line">&#125;</span><br><span class="line">&#125; </span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> SZ = <span class="number">32</span>*N;</span><br><span class="line"><span class="keyword">int</span> trie[SZ][<span class="number">2</span>], tot2 = <span class="number">1</span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Insert</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">31</span>,p = <span class="number">1</span>;i &gt;= <span class="number">0</span>;i--)&#123;</span><br><span class="line"><span class="keyword">int</span> ch = (x&gt;&gt;i)&amp;<span class="number">1</span>;</span><br><span class="line"><span class="keyword">if</span>(!trie[p][ch]) trie[p][ch] = ++tot2;</span><br><span class="line">p = trie[p][ch];</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">search</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line"><span class="comment">/*è¿”å›xä¸é›†åˆä¸­å¼‚æˆ–å’Œæœ€å¤§çš„ ç»“æœ*/</span></span><br><span class="line"><span class="keyword">int</span> res = <span class="number">0</span>,p = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">31</span>;i &gt;= <span class="number">0</span>;i--)&#123;</span><br><span class="line"><span class="keyword">int</span> ch = (x&gt;&gt;i)&amp;<span class="number">1</span>;</span><br><span class="line"><span class="keyword">if</span>(trie[p][!ch]) p = trie[p][!ch],res |= <span class="number">1</span>&lt;&lt;i;</span><br><span class="line"><span class="keyword">else</span> p = trie[p][ch];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="comment">/* è®¡ç®—å¹¶è¾“å‡ºç­”æ¡ˆ */</span></span><br><span class="line">dfs(<span class="number">1</span>); <span class="keyword">int</span> ans = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++) Insert(d[i]);</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++) ans = max(ans,search(d[i]));</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%d\n"</span>,ans);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="comment">//freopen("123.txt","r",stdin);</span></span><br><span class="line">n = getInt();</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>,x,y,z;i &lt; n;i++)&#123;</span><br><span class="line">x = getInt(); y = getInt(); z = getInt();</span><br><span class="line">addEdge(x,y,z); addEdge(y,x,z);</span><br><span class="line">&#125;</span><br><span class="line">solve();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;a href=&quot;http://ybt.ssoier.cn:8088/index.php&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;æµ‹è¯•åœ°å€&lt;/a&gt;&lt;/p&gt;
&lt;h4 id=&quot;Phone-List&quot;&gt;&lt;a href=&quot;#Phone-List&quot; class
      
    
    </summary>
    
      <category term="ACMé¢˜è§£" scheme="http://valenshi.top/categories/ACM%E9%A2%98%E8%A7%A3/"/>
    
    
      <category term="Trie" scheme="http://valenshi.top/tags/Trie/"/>
    
  </entry>
  
  <entry>
    <title>KMPç®—æ³•ç»ƒä¹ é¢˜é›†</title>
    <link href="http://valenshi.top/2019/09/29/kmp-problems/"/>
    <id>http://valenshi.top/2019/09/29/kmp-problems/</id>
    <published>2019-09-29T05:54:36.000Z</published>
    <updated>2019-09-29T06:02:06.919Z</updated>
    
    <content type="html"><![CDATA[<p><a href="http://ybt.ssoier.cn:8088/index.php" target="_blank" rel="noopener">æµ‹è¯•åœ°å€</a></p><h4 id="å‰ªèŠ±å¸ƒæ¡"><a href="#å‰ªèŠ±å¸ƒæ¡" class="headerlink" title="å‰ªèŠ±å¸ƒæ¡"></a>å‰ªèŠ±å¸ƒæ¡</h4><p><strong>é¢˜æ„ç®€è¿°</strong><br>åŸé¢˜æ¥è‡ªï¼šHDU 2087<br>ä¸€å—èŠ±å¸ƒæ¡ï¼Œé‡Œé¢æœ‰äº›å›¾æ¡ˆï¼Œå¦æœ‰ä¸€å—ç›´æ¥å¯ç”¨çš„å°é¥°æ¡ï¼Œé‡Œé¢ä¹Ÿæœ‰ä¸€äº›å›¾æ¡ˆã€‚å¯¹äºç»™å®šçš„èŠ±å¸ƒæ¡å’Œå°é¥°æ¡ï¼Œè®¡ç®—ä¸€ä¸‹èƒ½ä»èŠ±å¸ƒæ¡ä¸­å°½å¯èƒ½å‰ªå‡ºå‡ å—å°é¥°æ¡æ¥å‘¢ï¼Ÿ</p><p><strong>è§£é¢˜æ€è·¯</strong><br>å°±æ˜¯æ™®é€šçš„kmpç®—æ³•ï¼Œåªä¸è¿‡è¿™é‡Œçš„ä¸¤ä¸ªæ¨¡å¼ä¸²ä¸èƒ½é‡å ï¼Œæˆ‘ä»¬åŸºäºè´ªå¿ƒç­–ç•¥é‡åˆ°ä¸€ä¸ªé€‰ä¸€ä¸ªå³å¯ã€‚<br><strong>ä»£ç ç¤ºä¾‹</strong><br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1e3</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">int</span> f[N],nex[N];</span><br><span class="line"><span class="keyword">char</span> S[N],T[N];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">getNex</span><span class="params">(<span class="keyword">char</span> *s)</span></span>&#123;</span><br><span class="line"><span class="built_in">memset</span>(nex,<span class="number">0</span>,<span class="keyword">sizeof</span> nex);</span><br><span class="line"><span class="keyword">int</span> len = <span class="built_in">strlen</span>(s)<span class="number">-1</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">2</span>,j = <span class="number">0</span>;i &lt;= len;i++)&#123;</span><br><span class="line"><span class="keyword">while</span>(j &gt; <span class="number">0</span> &amp;&amp; s[i] != s[j+<span class="number">1</span>]) j = nex[j];</span><br><span class="line"><span class="keyword">if</span>(s[i] == s[j+<span class="number">1</span>]) j++;</span><br><span class="line">nex[i] = j;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">getF</span><span class="params">(<span class="keyword">char</span> *s,<span class="keyword">char</span> *t)</span></span>&#123;</span><br><span class="line"><span class="built_in">memset</span>(f,<span class="number">0</span>,<span class="keyword">sizeof</span> f);</span><br><span class="line"><span class="keyword">int</span> n = <span class="built_in">strlen</span>(s)<span class="number">-1</span>, m = <span class="built_in">strlen</span>(t)<span class="number">-1</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>,j = <span class="number">0</span>;i &lt;= n;i++)&#123;</span><br><span class="line"><span class="keyword">while</span>(j &gt; <span class="number">0</span> &amp;&amp; (j == m || s[i] != t[j+<span class="number">1</span>])) j = nex[j];</span><br><span class="line"><span class="keyword">if</span>(s[i] == t[j+<span class="number">1</span>]) j++;</span><br><span class="line">f[i] = j;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span></span>&#123;</span><br><span class="line">getNex(T);</span><br><span class="line">getF(S,T);</span><br><span class="line"><span class="keyword">int</span> ans = <span class="number">0</span>,r = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">int</span> n = <span class="built_in">strlen</span>(S)<span class="number">-1</span>, m = <span class="built_in">strlen</span>(T)<span class="number">-1</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++)&#123;</span><br><span class="line"><span class="keyword">if</span>(i &gt; r &amp;&amp; f[i] == m) ans++ ,r = i+m<span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%d\n"</span>,ans);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">while</span>(<span class="built_in">scanf</span>(<span class="string">"%s"</span>,S+<span class="number">1</span>) &amp;&amp; S[<span class="number">1</span>] != <span class="string">'#'</span>)&#123;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%s"</span>,T+<span class="number">1</span>); S[<span class="number">0</span>] = T[<span class="number">0</span>] = <span class="string">'#'</span>;</span><br><span class="line">solve();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h4 id="Power-Strings"><a href="#Power-Strings" class="headerlink" title="Power Strings"></a>Power Strings</h4><p>åœ¨ä¹‹å‰çš„å­—ç¬¦ä¸²ä¸Hashé¢˜é›†ä¸­åšè¿‡ï¼Œè€Œä¸”åˆšè¿‡å»ä¸ä¹…ï¼Œä¸æ•´ç†äº†ã€‚</p><h4 id="Radio-Transmission"><a href="#Radio-Transmission" class="headerlink" title="Radio Transmission"></a>Radio Transmission</h4><p><strong>é¢˜æ„ç®€è¿°</strong><br>ç»™ä½ ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå®ƒæ˜¯ç”±æŸä¸ªå­—ç¬¦ä¸²ä¸æ–­è‡ªæˆ‘è¿æ¥å½¢æˆçš„ã€‚ä½†æ˜¯è¿™ä¸ªå­—ç¬¦ä¸²æ˜¯ä¸ç¡®å®šçš„ï¼Œç°åœ¨åªæƒ³çŸ¥é“å®ƒçš„æœ€çŸ­é•¿åº¦æ˜¯å¤šå°‘ã€‚</p><p><strong>è§£é¢˜æ€è·¯</strong><br>æ±‚æœ€çŸ­å¾ªç¯èŠ‚ï¼Œç»™å®šçš„å­—ç¬¦ä¸²å¯èƒ½æ˜¯ç”±å¾ªç¯èŠ‚å¾ªç¯æ„æˆçš„å­—ä¸²çš„ä¸€ä¸ªå­ä¸²ï¼Œæ‰€ä»¥å°±ç›´æ¥ç”¨æ±‚æœ€çŸ­å¾ªç¯èŠ‚å°±å¯ä»¥äº†ï¼Œçœå»ç”¨å­—ç¬¦ä¸²hashåˆ¤æ–­è¯¥ä¸²æ˜¯å¦æ»¡è¶³äº†ã€‚<br><strong>ä»£ç ç¤ºä¾‹</strong><br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1e6</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">char</span> str[N];</span><br><span class="line"><span class="keyword">int</span> n,nex[N];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">getNex</span><span class="params">(<span class="keyword">char</span> *s)</span></span>&#123;</span><br><span class="line"><span class="keyword">int</span> len = <span class="built_in">strlen</span>(s)<span class="number">-1</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">2</span>,j = <span class="number">0</span>;i &lt;= len;i++)&#123;</span><br><span class="line"><span class="keyword">while</span>(j &gt; <span class="number">0</span> &amp;&amp; s[i] != s[j+<span class="number">1</span>]) j = nex[j];</span><br><span class="line"><span class="keyword">if</span>(s[i] == s[j+<span class="number">1</span>]) j++;</span><br><span class="line">nex[i] = j;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span></span>&#123;</span><br><span class="line">getNex(str);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%d\n"</span>,n - nex[n]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;n);</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%s"</span>,str+<span class="number">1</span>);</span><br><span class="line">str[<span class="number">0</span>] = <span class="string">'#'</span>;</span><br><span class="line">solve();</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h4 id="OKR-Periods-of-Words"><a href="#OKR-Periods-of-Words" class="headerlink" title="OKR-Periods of Words"></a>OKR-Periods of Words</h4><p><strong>é¢˜æ„ç®€è¿°</strong></p><p>åŸé¢˜æ¥è‡ªï¼šPOI 2006<br>ä¸²æ˜¯æœ‰é™ä¸ªå°å†™å­—ç¬¦çš„åºåˆ—ï¼Œç‰¹åˆ«çš„ï¼Œä¸€ä¸ªç©ºåºåˆ—ä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªä¸²ã€‚ä¸€ä¸ªä¸² P æ˜¯ä¸² A çš„å‰ç¼€ï¼Œå½“ä¸”ä»…å½“å­˜åœ¨ä¸² Bï¼Œä½¿å¾— A=PBã€‚å¦‚æœPâ‰ Aå¹¶ä¸” P ä¸æ˜¯ä¸€ä¸ªç©ºä¸²ï¼Œé‚£ä¹ˆæˆ‘ä»¬è¯´ P æ˜¯ A çš„ä¸€ä¸ª proper å‰ç¼€ã€‚<br>å®šä¹‰ Q æ˜¯ A çš„å‘¨æœŸï¼Œå½“ä¸”ä»…å½“ Q æ˜¯ A çš„ä¸€ä¸ª proper å‰ç¼€å¹¶ä¸” A æ˜¯ QQ çš„å‰ç¼€ï¼ˆä¸ä¸€å®šè¦æ˜¯ proper å‰ç¼€ï¼‰ã€‚æ¯”å¦‚ä¸² abab å’Œ ababab éƒ½æ˜¯ä¸² abababa çš„å‘¨æœŸã€‚ä¸² A çš„æœ€å¤§å‘¨æœŸå°±æ˜¯å®ƒæœ€é•¿çš„ä¸€ä¸ªå‘¨æœŸæˆ–è€…æ˜¯ä¸€ä¸ªç©ºä¸²ï¼ˆå½“ A æ²¡æœ‰å‘¨æœŸçš„æ—¶å€™ï¼‰ï¼Œæ¯”å¦‚è¯´ï¼Œababab çš„æœ€å¤§å‘¨æœŸæ˜¯ ababã€‚ä¸² abc çš„æœ€å¤§å‘¨æœŸæ˜¯ç©ºä¸²ã€‚<br>ç»™å‡ºä¸€ä¸ªä¸²ï¼Œæ±‚å‡ºå®ƒæ‰€æœ‰å‰ç¼€çš„æœ€å¤§å‘¨æœŸé•¿åº¦ä¹‹å’Œã€‚</p><p><strong>è§£é¢˜æ€è·¯</strong><br>é¢˜æ„æœ‰ä¸€äº›ç»•ï¼Œä½†æ˜¯è¿˜å¥½ç»™çš„æ˜¯ä¸­æ–‡é¢˜é¢ï¼Œå°šå¯ç†è§£ã€‚å°±æ˜¯è¯´Pæ˜¯Açš„ä¸€ä¸ªçœŸå­ä¸²ï¼Œä¸”æ˜¯Açš„å‰ç¼€ï¼Œé‚£ä¹ˆPå°±æ˜¯Açš„properå‰ç¼€ã€‚è‹¥Qæ˜¯Açš„properå‰ç¼€ï¼Œä¸”Aæ˜¯QQï¼ˆä¸¤ä¸ªQæ‹¼æ¥åœ¨ä¸€èµ·ï¼‰çš„å‰ç¼€ï¼ˆå‰ç¼€ä¸å¿…è¦æ˜¯çœŸå­ä¸²ï¼‰ï¼Œé‚£ä¹ˆQå°±æ˜¯Açš„å‘¨æœŸã€‚<br>ç°åœ¨è¦æ±‚çš„æ˜¯Açš„ æ‰€æœ‰å‰ç¼€çš„ æœ€é•¿å‘¨æœŸçš„é•¿åº¦ä¹‹å’Œã€‚</p><p>å¦‚æœè¦æ˜¯æ±‚æœ€çŸ­å‘¨æœŸçš„é•¿åº¦ï¼Œé‚£ä¹ˆç›´æ¥å°±æ˜¯æ±‚æœ€çŸ­å¾ªç¯èŠ‚ï¼Œè·‘ä¸€énexå°±è§£å†³äº†ï¼›ç°åœ¨è¦æ±‚æœ€é•¿å‘¨æœŸçš„é•¿åº¦ï¼Œç›¸å½“äºæ±‚æœ€é•¿çš„å¾ªç¯èŠ‚ï¼ˆè¯¥å¾ªç¯èŠ‚ä¸èƒ½ç­‰äºåŸä¸²ï¼å¦åˆ™å°±ä¸æ˜¯properå‰ç¼€äº†ï¼‰ï¼Œé‚£ä¹ˆå°±ä¸æ–­çš„ä»¤ j = nex[j]ï¼Œæ‰¾åˆ°éé›¶çš„æœ€å° nex[j] ï¼ˆå°†nexæ•°ç»„çœ‹ä½œfatheræ•°ç»„ï¼Œä¸€æ£µfatheræ ‘ï¼‰ï¼Œé‚£ä¹ˆæœ€é•¿å¾ªç¯èŠ‚å°±æ˜¯ i - j äº†ã€‚</p><p>è¿™æ ·ä¼šè¶…æ—¶ï¼Œå› ä¸ºæˆ‘ä»¬æ¯æ¬¡ä»¤j = nex[j]ç›¸å½“äºä»å¶å­èŠ‚ç‚¹èµ°åˆ°æ ¹èŠ‚ç‚¹ï¼Œæœ€åæƒ…å†µæ˜¯O(N)æ‰èƒ½æ‰¾åˆ°æœ€å°çš„éé›¶ nex[j]ï¼Œæ€»æ—¶é—´å¤æ‚åº¦å°±æ˜¯O(N^2)ã€‚</p><p><strong>ä¼˜åŒ–</strong><br>æˆ‘ä»¬ä»¤ f[j] è¡¨ç¤ºæ ¹åˆ° j è·¯å¾„ä¸Šæœ€å°éé›¶çš„å€¼ã€‚ï¼ˆæˆ‘ä»¬æŠŠnexæ•°ç»„çœ‹ä½œä¸€æ£µæ ‘ï¼ï¼ï¼ï¼‰<br>é‚£ä¹ˆå¯¹äºä»»æ„çš„nex[p]ï¼Œè‹¥nex[p] != 0ï¼Œé‚£ä¹ˆæœ€é•¿å‘¨æœŸå°±æ˜¯ p - f[nex[p] ]ã€‚<br>æˆ‘ä»¬åœ¨æ±‚nexæ•°ç»„æ—¶é¡ºä¾¿æ›´æ–° f æ•°ç»„ï¼Œå’Œè®°å¿†åŒ–ç±»ä¼¼ï¼Œæ€è·¯ä¸éš¾ç†è§£ã€‚</p><p><strong>ä»£ç ç¤ºä¾‹</strong><br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1e6</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> INF = <span class="number">0x3f3f3f3f</span>;</span><br><span class="line"><span class="keyword">char</span> str[N];</span><br><span class="line"><span class="keyword">int</span> n,nex[N],f[N];</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">getNex</span><span class="params">(<span class="keyword">char</span> *s)</span></span>&#123;</span><br><span class="line"><span class="keyword">int</span> len = <span class="built_in">strlen</span>(s)<span class="number">-1</span>; f[<span class="number">0</span>] = INF;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">2</span>,j = <span class="number">0</span>;i &lt;= len;i++)&#123;</span><br><span class="line"><span class="keyword">while</span>(j &gt; <span class="number">0</span> &amp;&amp; s[i] != s[j+<span class="number">1</span>]) j = nex[j];</span><br><span class="line"><span class="keyword">if</span>(s[i] == s[j+<span class="number">1</span>]) j++;</span><br><span class="line">nex[i] = j;</span><br><span class="line"><span class="keyword">if</span>(j) f[j] = min(j,f[nex[j]]);</span><br><span class="line"><span class="comment">//printf("%d %d\n",j,f[j]);</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span></span>&#123;</span><br><span class="line">getNex(str);</span><br><span class="line"><span class="keyword">long</span> <span class="keyword">long</span> ans = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++)&#123;</span><br><span class="line"><span class="keyword">if</span>(nex[i]) ans += i - f[nex[i]];</span><br><span class="line"><span class="comment">//printf("%d %c\n",ans,str[i]);</span></span><br><span class="line"><span class="comment">//printf("%d %d\n",nex[i],f[i]);</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%lld\n"</span>,ans);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="comment">//freopen("123.txt","r",stdin);</span></span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;n);</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%s"</span>,str+<span class="number">1</span>);</span><br><span class="line">str[<span class="number">0</span>] = <span class="string">'#'</span>;</span><br><span class="line">solve();</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h4 id="ä¼¼ä¹åœ¨æ¢¦ä¸­è§è¿‡çš„æ ·å­"><a href="#ä¼¼ä¹åœ¨æ¢¦ä¸­è§è¿‡çš„æ ·å­" class="headerlink" title="ä¼¼ä¹åœ¨æ¢¦ä¸­è§è¿‡çš„æ ·å­"></a>ä¼¼ä¹åœ¨æ¢¦ä¸­è§è¿‡çš„æ ·å­</h4><p><strong>é¢˜æ„ç®€è¿°</strong><br>åŸé¢˜æ¥è‡ªï¼š2014 å¹´æ¹–åŒ—çœé˜Ÿäº’æµ‹ Week2<br>ã€ŒMadokaï¼Œä¸è¦ç›¸ä¿¡ QBï¼ã€ä¼´éšç€ Homura çš„å¤±æœ›åœ°å–Šå«ï¼ŒMadoka ä¸ QB ç­¾è®¢äº†å¥‘çº¦ã€‚<br>è¿™æ˜¯ Modoka çš„ä¸€ä¸ªå™©æ¢¦ï¼Œä¹ŸåŒæ—¶æ˜¯ä¸Šä¸ªè½®å›ä¸­æ‰€å‘ç”Ÿçš„äº‹ã€‚ä¸ºäº†ä½¿è¿™ä¸€æ¬¡ Madoka ä¸å†ä¸ QB ç­¾è®¢å¥‘çº¦ï¼ŒHomura å†³å®šåœ¨åˆšåˆ°å­¦æ ¡çš„ç¬¬ä¸€å¤©å°±è§£å†³ QBã€‚ç„¶è€Œï¼ŒQB ä¹Ÿæ˜¯æœ‰è®¸å¤šæ›¿èº«çš„ï¼ˆä½†åœ¨ç¬¬å…«è¯ä¸­çš„å‰§æƒ…æ˜¾ç¤ºå®ƒä¹Ÿæœ‰å¯èƒ½æ˜¯æ— é™é‡ç”Ÿçš„ï¼‰ï¼Œä¸è¿‡ï¼Œæ„å¿—åšå®šçš„ Homura æ˜¯ä¸ä¼šæ”¾å¼ƒçš„â€”â€”å¥¹å†³å®šæ¶ˆç­æ‰€æœ‰å¯èƒ½æ˜¯ QB çš„ä¸œè¥¿ã€‚ç°åœ¨ï¼Œå¥¹å·²æ„Ÿå—åˆ°é™„è¿‘çš„çŠ¶æ€ï¼Œå¹¶ä¸”æŠŠå®ƒè½¬åŒ–ä¸ºä¸€ä¸ªé•¿åº¦ä¸º n çš„å­—ç¬¦ä¸²äº¤ç»™äº†å­¦ OI çš„ä½ ã€‚<br>ç°åœ¨ä½ ä»å¥¹çš„è¯ä¸­çŸ¥é“ï¼Œæ‰€æœ‰å½¢ä¼¼äº A+B+A çš„å­—ä¸²éƒ½æ˜¯ QB æˆ–å®ƒçš„æ›¿èº«ï¼Œä¸” âˆ£Aâˆ£â‰¥k,âˆ£Bâˆ£â‰¥1ï¼ˆä½ç½®ä¸åŒå…¶ä»–æ€§è´¨ç›¸åŒçš„å­ä¸²ç®—ä¸åŒå­ä¸²ï¼Œä½ç½®ç›¸åŒä½†æ‹†åˆ†ä¸åŒçš„å­ä¸²ç®—åŒä¸€å­ä¸²ï¼‰ï¼Œç„¶åä½ å¿…é¡»å°½å¿«å‘Šè¯‰ Homura è¿™ä¸ªç­”æ¡ˆâ€”â€”QB ä»¥åŠå®ƒçš„æ›¿èº«çš„æ•°é‡ã€‚<br>æ³¨ï¼šå¯¹äºä¸€ä¸ªå­—ç¬¦ä¸² Sï¼Œâˆ£Sâˆ£ è¡¨ç¤º S çš„é•¿åº¦ã€‚</p><p><strong>è§£é¢˜æ€è·¯</strong><br>è¿™é¢˜éœ€è¦å¯¹ç…§æ ·ä¾‹æ¥ç†è§£é¢˜æ„ï¼Œç»è¿‡åˆ†æåï¼Œå‘ç°é¢˜æ„æ˜¯å¦‚æœæœ‰ä¸€ä¸ªå­ä¸²æ»¡è¶³ABAå½¢å¼ï¼Œå…¶ä¸­ |A|&gt;=k ä¸” B ä¸æ˜¯ç©ºä¸²ï¼Œé‚£ä¹ˆè¯¥å­ä¸²å°±æ˜¯QBå¤§é­”ç‹ã€‚ç°åœ¨é—®æœ‰å¤šå°‘ä¸ªè¿™æ ·çš„å­ä¸²ã€‚</p><p>é¦–å…ˆçœ‹æ€è·¯ï¼Œå¯¹äºä¸€ä¸ªå­—ç¬¦ä¸²(s[1,n])ï¼Œæˆ‘ä»¬é€šè¿‡æ±‚å®ƒçš„nexæ•°ç»„ï¼Œå¦‚æœnex[n] &gt;= k å¹¶ä¸” nex[n] å°äº n/2ï¼Œé‚£ä¹ˆè¯¥ä¸²å°±æ˜¯QBï¼›å¦‚æœnex[n] &gt;= n/2ï¼Œé‚£ä¹ˆnex[ nex[n] ] ï¼Œä¸€ç›´åˆ°æ ¹èŠ‚ç‚¹çš„è·¯å¾„ä¸Šï¼Œåªè¦æœ‰ä¸€ä¸ªnexå¤§äºkä¸”å°äºn/2ï¼Œè¯¥ä¸²å°±ä¹Ÿæ˜¯QBã€‚</p><p>ç»¼ä¸Šæ‰€è¿°ï¼Œæˆ‘ä»¬å¯¹äºä¸€ä¸ªä¸‹æ ‡ä¸º[1, p]çš„å­—ç¬¦ä¸²ï¼Œéœ€è¦æ‰¾åˆ°nex[p]åˆ°æ ¹èŠ‚ç‚¹ï¼ˆå°†nexæ•°ç»„çœ‹ä½œä¸€æ£µæ ‘ï¼‰è·¯å¾„ä¸Šå¤§äºç­‰äº k çš„æœ€å° nexå€¼ï¼ˆè´ªå¿ƒæ€æƒ³ï¼‰ã€‚æˆ‘ä»¬ç”¨ f æ•°ç»„æ¥å­˜æ”¾è¯¥å€¼ã€‚ä¹‹æ‰€ä»¥ç”¨ f æ•°ç»„å­˜æ”¾ï¼Œæ˜¯ä¸ºäº†é˜²æ­¢æœ€åæƒ…å†µO(N^2)éå†ã€‚</p><p>æ‰€ä»¥æˆ‘ä»¬å¯¹åŸå­—ç¬¦ä¸² S çš„æ¯ä¸€ä¸ªåç¼€éƒ½è¿›è¡Œä¸Šè¿°æ“ä½œï¼Œæ—¶é—´å¤æ‚åº¦å…±O(N^2)ï¼Œå‹‰å¼ºè¿‡ã€‚ä½†æ˜¯å¸¸æ•°ç¨å¾®å¤§ä¸€äº›å°±è¿‡ä¸äº†äº†ï¼Œæ‰€ä»¥ç»Ÿè®¡ç­”æ¡ˆä¹Ÿè¦åœ¨æ±‚ nex å’Œæ›´æ–° f æ•°ç»„æ—¶é¡ºä¾¿ç´¯åŠ ï¼Œå¦‚æœè§‰å¾—è¿™æ ·å¤ªæ€‚äº†ï¼Œè¿˜å¯ä»¥è¿›è¡Œåˆ«çš„ä¼˜åŒ–ï¼Œä¸è¿‡æˆ‘æ‡’å¾—æ”¹äº†ã€‚</p><p><strong>ä»£ç ç¤ºä¾‹</strong><br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">15000</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> INF = <span class="number">0x3f3f3f3f</span>;</span><br><span class="line"><span class="keyword">char</span> str[N];</span><br><span class="line"><span class="keyword">int</span> nex[N],k, f[N], ans = <span class="number">0</span>;</span><br><span class="line"><span class="comment">//f[i]ä¸ºnex[i]åˆ°æ ¹ä¸­,å¤§äºkçš„æœ€å°çš„ä¸€ä¸ª </span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">getNex</span><span class="params">(<span class="keyword">char</span> *s)</span></span>&#123;</span><br><span class="line"><span class="keyword">int</span> len = <span class="built_in">strlen</span>(s)<span class="number">-1</span>;</span><br><span class="line"><span class="built_in">memset</span>(nex,<span class="number">0</span>,<span class="keyword">sizeof</span> nex); f[<span class="number">0</span>] = INF;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">2</span>,j = <span class="number">0</span>;i &lt;= len;i++)&#123;</span><br><span class="line"><span class="keyword">while</span>(j &gt; <span class="number">0</span> &amp;&amp; s[i] != s[j+<span class="number">1</span>]) j = nex[j];</span><br><span class="line"><span class="keyword">if</span>(s[i] == s[j+<span class="number">1</span>]) j++;</span><br><span class="line">nex[i] = j;</span><br><span class="line"><span class="keyword">if</span>(j &lt; k) f[j] = INF; </span><br><span class="line"><span class="keyword">else</span> f[j] = min(j,f[nex[j]]);</span><br><span class="line"><span class="keyword">if</span>(f[j]&lt;&lt;<span class="number">1</span> &lt; i) ans++;</span><br><span class="line"><span class="comment">//printf("%d %d %d %d\n",i,j,f[j],nex[j]);</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">int</span> n = <span class="built_in">strlen</span>(str)<span class="number">-1</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt; n;i++)&#123;</span><br><span class="line">getNex(str+i<span class="number">-1</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%d\n"</span>,ans);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="comment">//freopen("123.txt","r",stdin);</span></span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%s"</span>,str+<span class="number">1</span>);</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;k);</span><br><span class="line">str[<span class="number">0</span>] = <span class="string">'#'</span>;</span><br><span class="line">solve();</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h4 id="Censoring"><a href="#Censoring" class="headerlink" title="Censoring"></a>Censoring</h4><p>è¿™ä¸ªæˆ‘ä¸€çœ‹å°±çŸ¥é“KMPå¾ˆéš¾å†™ï¼Œåº”è¯¥ç”¨è‡ªåŠ¨æœºï¼Œæ‰€ä»¥æ”¾åœ¨è‡ªåŠ¨æœºä¸“é¢˜æ•´ç†ï¼Œå¦å¤–åæ§½ä¸€ä¸‹ä¹¦ä¸Šçš„ç¿»è¯‘æ˜¯è°å†™çš„ï¼Œå¤ªæ•·è¡äº†å§ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;a href=&quot;http://ybt.ssoier.cn:8088/index.php&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;æµ‹è¯•åœ°å€&lt;/a&gt;&lt;/p&gt;
&lt;h4 id=&quot;å‰ªèŠ±å¸ƒæ¡&quot;&gt;&lt;a href=&quot;#å‰ªèŠ±å¸ƒæ¡&quot; class=&quot;headerlink
      
    
    </summary>
    
      <category term="ACMé¢˜è§£" scheme="http://valenshi.top/categories/ACM%E9%A2%98%E8%A7%A3/"/>
    
    
      <category term="KMP" scheme="http://valenshi.top/tags/KMP/"/>
    
  </entry>
  
</feed>
